System.register(["./chunk-f4346e3b.nomodule.js","./chunk-3d2860de.nomodule.js","./chunk-1292a462.nomodule.js","./chunk-104778d3.nomodule.js"],function(t,e){var n,r,o,i,s,a,c,h,l,d;return{setters:[function(t){n=t.a},function(t){r=t.a,o=t.f,i=t.k,s=t.g,a=t.O,c=t.P},function(t){h=t.a,l=t.b},function(t){d=t.c}],execute:function(){const e=(t,e,o)=>{const i="function"==typeof WebAssembly.instantiateStreaming;r.addMeta("kernel_is_ready",{cachedInIndexedDB:!1});let s=null;i?(r.start("kernel_stream_compile"),s=WebAssembly.instantiateStreaming(fetch(n()+t),e),r.end("kernel_stream_compile")):(r.start("kernel_legacy_compile"),s=fetch(n()+t).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,e))),r.addMeta("kernel_is_ready",{instantiateStreaming:i}),s.then(t=>{r.end(i?"kernel_stream_compile":"kernel_legacy_compile"),o(t.instance)},t=>console.error(t))};let u,_,p,m,g;const f=!(null!=navigator.userAgent.match(/iPad|iPhone|iPod/i)||!window.WebAssembly);class C{constructor(t,e){this._configuratorKernelCallbackListener=new Set,this._subComponentsWaiters=new Map,this._shouldWait=!0,this._creator_=t,this._setupKernelPaths(e),this._setupEmsModule(e),this._useWASM=f,this._kernelPath=f?p:m,window.KernelCallback={isReady:this.isReady.bind(this)},this._lifeCycleManager.addEventListener(this)}_utilityToLongArray(t){const e=new this._kernelContainer.LongArray;return t.forEach(t=>e.push_back(t)),e}get kernelContainer(){return this._kernelContainer}get kernelInstance(){return this._kernelInstance}_setupKernelPaths(t){const e=0===t?"PLANNER":"CONFIGURATOR";u=d.APP.ASM[e].MEM_URL,_=d.APP.WASM[e].URL,p=d.APP.WASM[e].LOADER,m=d.APP.ASM[e].LOADER,g=d.APP.WASM[e].CACHE_COMPILATION}_setupEmsModule(t){this._kernelContainer={locateFile(e){const r=0===t?/RoomleCoreJs[\-a-z0-9]*\.js\.mem/:/ConfiguratorKernelJs[\-a-z0-9]*\.js\.mem/;return e.match(r)?n()+u:e},wasmBinaryFile:n()+_,preRun:[],postRun:[],setStatus:null,print(t){},printErr(t){console.error(t)},quit(t){console.error(t)}},g&&f&&(this._kernelContainer.instantiateWasm=function(t,n){return e(_,t,n),{}})}_passSubComponentsToKernel(t,e){const n=t.id,r=e.get(n);if(r)for(let e=0,o=r.length;e<o;e++){const{parentId:o,partId:i}=r[e];this._kernelInstance.loadedSubComponent(o,i,n,t.configuration)}}_fetchSubComponents(t){let e=[...t.keys()];e.length&&this._rapiAccess.getComponents(e).then(e=>{for(let n=0,r=e.length;n<r;n++)this._passSubComponentsToKernel(e[n],t);this._flushSubComponentsWaiters()})}_flushSubComponentsWaiters(){this._fetchSubComponents(this._subComponentsWaiters),this._subComponentsWaiters=new Map,this._shouldWait=!1}isReady(){this._kernelContainer.setExternalHelpers(this._kernelIo,{convertCObject:o}),d.isProduction||d.isUnitTesting||this.addDebugInfo(),window.KernelCallback&&(window.KernelCallback=null,delete window.KernelCallback)}addDebugInfo(){const t=function(e,n=[]){const r=Object.getPrototypeOf(e),o=r?Object.getOwnPropertyNames(r):[],i=e?Object.getOwnPropertyNames(e):[];return r?t(r,[...n,...i,...o]):[...i,...o,...n]},e=t(this),n=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","valueOf"];[...new Set(e)].forEach(t=>{if("_"!==t[0]&&"function"==typeof this[t]&&-1===n.indexOf(t))try{const e=this[t].bind(this);this[t]=function(...n){return this._kernelIo.log("[ KernelCommunication ]: "+t),e(...n)}}catch(t){}})}loadComponent(t,e,n){this._rapiAccess.getComponent(e.componentId).then(r=>{this._kernelInstance.loadComponent(t,r.configuration,e,n),this._flushSubComponentsWaiters()},r=>{this._kernelInstance.loadComponent(t,"error",e,n),this.onLoadComponentError(r),this._flushSubComponentsWaiters()})}loadSubComponent(t,e,n){if(this._shouldWait){let r=this._subComponentsWaiters.get(n);r||this._subComponentsWaiters.set(n,[]),(r=this._subComponentsWaiters.get(n)).push({parentId:t,partId:e}),this._subComponentsWaiters.set(n,r)}else this._rapiAccess.getComponent(n).then(r=>{this._kernelInstance.loadedSubComponent(t,e,n,r.configuration)})}requestDeleteComponent(t){t&&this._kernelInstance.deleteComponent(t)}dockComponentWithPosition(t,e,n,r,o){this._kernelInstance.dockComponentWithPosition(n,r,t,e,o),this._configuratorUiCallbacks.onUserInitiatedDockDone()}Editor3dAddBakedMesh(t,e,n,r,o,i){this._configuratorKernelCallbackListener.forEach(s=>s.Editor3dAddBakedMesh(t,e,n,r,o,i))}Editor3dAddNamedMesh(t,e,n,r,o,i,s,a){this._configuratorKernelCallbackListener.forEach(c=>c.Editor3dAddNamedMesh(t,e,n,r,o,i,s,a))}Editor3dBeginConstruction(t){this._configuratorKernelCallbackListener.forEach(e=>e.Editor3dBeginConstruction(t))}Editor3dEndConstruction(t){this._configuratorKernelCallbackListener.forEach(e=>e.Editor3dEndConstruction(t))}Editor3dComponentCreated(t,e,n,r){this._configuratorKernelCallbackListener.forEach(o=>o.Editor3dComponentCreated(t,e,n,r,!1))}Editor3dComponentDocked(t,e,n,r){this._configuratorKernelCallbackListener.forEach(o=>o.Editor3dComponentDocked(t,e,n,r))}Editor3dGeometryReady(t){this._configuratorKernelCallbackListener.forEach(e=>e.Editor3dGeometryReady(t))}Editor3dGeometryNotReady(t){this._configuratorKernelCallbackListener.forEach(e=>e.Editor3dGeometryNotReady(t))}componentDeleted(t){this._configuratorKernelCallbackListener.forEach(e=>e.componentDeleted(t))}componentMetaUpdated(t){let e=this._kernelInstance.getComponent(t);this._configuratorKernelCallbackListener.forEach(t=>t.componentMetaUpdated(e))}sceneCleared(){this._configuratorKernelCallbackListener.forEach(t=>t.sceneCleared())}requestMaterialsInGroup(t){this._rapiAccess.getMaterialsByGroup([t]).then(e=>{const n=new this._kernelContainer.StringArray;e.forEach(t=>{t.materials.forEach(t=>n.push_back(t.id))}),this._kernelInstance.setMaterialsInGroup(t,n)})}addConfiguratorListener(t){this._configuratorKernelCallbackListener.add(t)}removeConfiguratorListener(t){this._configuratorKernelCallbackListener.delete(t)}cleanUpCallbacks(){this._kernelContainer.unregisterConfiguratorCallback(this)}registerCallbacks(){this._kernelContainer.registerConfiguratorCallback(this)}pause(){this.cleanUpCallbacks()}resume(){this.cleanUpCallbacks(),this.registerCallbacks()}destroy(){}}t("a",C),h([l],C.prototype,"_rapiAccess",void 0),h([l],C.prototype,"_scriptLoader",void 0),h([l],C.prototype,"_kernelIo",void 0),h([l],C.prototype,"_dataSyncer",void 0),h([l],C.prototype,"_lifeCycleManager",void 0),h([l],C.prototype,"_configuratorUiCallbacks",void 0);const E=i(30);t("b",class extends s{constructor(t,e,n,r){super(),this._offset=new THREE.Vector3(0,0,0),this._mode=void 0===r?1:r,this._scene=t,this._camera=e,this._raycaster=new THREE.Raycaster,this._inputManager=n,this._addInputListeners(n),this._planeBottom=new THREE.Plane(new THREE.Vector3(0,1,0)),this._planeFront=new THREE.Plane(new THREE.Vector3(0,0,1)),this._planeSide=new THREE.Plane(new THREE.Vector3(1,0,0))}_addInputListeners(t){t.addEventListener(3,t=>{this._findCandidate(t.positionRelative)},this),t.addEventListener(5,t=>{this._findSelection(t.positionRelative)},this),t.addEventListener(6,t=>{this._findHover(t.positionRelative,t.type)},this),t.addEventListener(0,t=>{this._onDragStart(t.positionRelative)},this),t.addEventListener(1,t=>{this._onDrag(t.positionRelative)},this),t.addEventListener(2,t=>{this._onDragEnd(t.positionRelative)},this),t.addEventListener(9,t=>{this._onRotate(t.positionRelative,t.rotation)},this),t.addEventListener(10,()=>{this._currentRotate=null},this)}_findCandidate(t){this._intersection(t)&&this._inputManager.onElementHit()}_findSelection(t){let e=this._intersection(t);e?e&&e.object.dispatchEvent({type:"select"}):this.dispatchEvent(3)}_findHover(t,e){let n=this._intersection(t);!n&&this._currentHover?(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:e}}),this._currentHover=null):n&&(this._currentHover&&this._currentHover.id!==n.object.id&&(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:e}}),this._currentHover=null),this._currentHover?this._currentHover.dispatchEvent({type:"hover_move",attachment:{intersection:n,type:e}}):(this._currentHover=n.object,this._currentHover.dispatchEvent({type:"hover_on",attachment:{intersection:n,type:e}})))}_intersection(t){let e=this._intersect(t);if(e.length<=0)return null;let n=e[0];return e.length>1&&this._currentHover&&this._currentDrag&&this._currentDrag.id!==this._currentHover.id&&e.forEach(t=>{t.object.id===this._currentHover.id&&t.object.userData.priority===this._currentHover.userData.priority&&n.object.userData.priority<=t.object.userData.priority&&(n=t)}),n}_intersect(t){this._raycaster.setFromCamera(t,this._camera);let e=[];return this._raycaster.intersectObjects(this._scene.children,!0).forEach(t=>{t.object.userData.hasListener&&e.push(t)}),e.length>=0?e.sort((t,e)=>t.object.userData.priority!==e.object.userData.priority?e.object.userData.priority-t.object.userData.priority:t.distance-e.distance):[]}_onDragStart(t){let e=this._intersection(t);if(!e&&!this._currentDrag)return;if(e&&e.object.userData.roomleId===this._rootComponentId)return;!this._currentDrag&&e&&(this._currentDrag=e.object,this._currentDrag.dispatchEvent({type:"drag_start"}));let n=this._currentDrag.parent;n&&n.computeBoundingBox&&(n.computeBoundingBox(),this._calculateOffset(n)),this._positionPlanes(n)}_onDrag(t){if(!this._currentDrag)return;this._raycaster.setFromCamera(t,this._camera);let e,n=new THREE.Vector3(0,0,-5);this._raycaster.ray.intersectPlane(this._planeBottom,n);let r=this._getDistanceToCamera(n),o=this._camera.userData.yaw;if(0===this._mode)this._currentDragOffset||(this._currentDragOffset=n.clone().sub(this._currentDrag.parent.position.clone())),(e=n.clone().sub(this._currentDragOffset)).y=this._currentDrag.parent.position.y;else{let t=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,0,0);this._raycaster.ray.intersectPlane(this._planeFront,t),this._raycaster.ray.intersectPlane(this._planeSide,i);let s=this._getDistanceToCamera(i),a=this._getDistanceToCamera(t);o>=-E&&o<=E?e=r<a?n.clone():t.clone():r<a&&r<s?e=n.clone():a<r&&a<s?e=t.clone():s<r&&s<a&&(e=i.clone()),e.sub(this._offset)}this._currentDrag.dispatchEvent({type:"drag",attachment:{position:e}})}_getDistanceToCamera(t){let e=t.clone().sub(this._camera.position).length();return a(t)&&(e=Number.POSITIVE_INFINITY),e}_onDragEnd(t){this._currentDrag&&(this._currentDrag.dispatchEvent({type:"drag_end",attachment:{position:t}}),this._currentDrag=null,this._currentDragOffset=null)}_onRotate(t,e){if(!this._currentRotate){let e=this._intersection(t);if(!e)return;this._currentRotate=e.object}this._currentRotate.dispatchEvent({type:"rotate",attachment:{rotation:e}})}_positionPlanes(t){0===this._mode?(this._planeBottom.constant=0,this._camera.userData&&this._camera.userData.pitch&&this._camera.userData.pitch<0&&(this._planeBottom.constant=-3)):t&&t.boundingBox&&this._rootComponentPosition&&(this._planeBottom.constant=-t.boundingBox.getCenter(new THREE.Vector3).y-this._rootComponentPosition.y,this._planeSide.constant=2*-t.boundingBox.getSize(new THREE.Vector3).x+t.boundingBox.getCenter(new THREE.Vector3).x,this._camera.userData.yaw>0&&(this._planeSide.constant*=-1),this._bounds&&(this._planeFront.constant=this._bounds.z/2+t.boundingBox.getCenter(new THREE.Vector3).z))}_calculateOffset(t){t&&t.boundingBox&&(this._offset.copy(t.boundingBox.getCenter(new THREE.Vector3)),this._offset.applyQuaternion(t.getWorldQuaternion(new THREE.Quaternion)))}update(t,e,n){if(t&&(this._bounds=t),e&&(this._rootComponentPosition=e),n){this._backgroundScene=n;let t=this._backgroundScene.children[0];t instanceof THREE.Mesh&&t.geometry.computeBoundingBox()}}clear(){this._currentDrag&&c(this._currentDrag),this._currentHover&&c(this._currentHover)}enableDragIn(t){this._currentDrag=t}setRootComponentId(t){this._rootComponentId=t}setCamera(t){this._camera=t}setScene(t){this._scene=t}})}}});
//# sourceMappingURL=chunk-98cde267.nomodule.js.map
