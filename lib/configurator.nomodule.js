System.register(["./chunk-1a2ba2c6.nomodule.js","./chunk-4353d3e4.nomodule.js","./chunk-ba50315d.nomodule.js","./chunk-95d25a7e.nomodule.js"],function(e,t){var i,n,s,o,r,a,h,l,d,c,_,p,m,u,g,b,w,E,v,C,f,H,y,T,P,S,x,R,I,L,M,k,O,D,G,A,F,U,V,B,j,z;return{setters:[function(e){i=e.a,n=e.b},function(e){s=e.a,o=e.b,r=e.c,a=e.d,h=e.e,l=e.f,d=e.g,c=e.h,_=e.i,p=e.j,m=e.k,u=e.l,g=e.m,b=e.n,w=e.o,E=e.p,v=e.q,C=e.r,f=e.s,H=e.t,y=e.u,T=e.v,P=e.w,S=e.x,x=e.y,R=e.z,I=e.A,L=e.B,M=e.C},function(e){k=e.a,O=e.b,D=e.c,G=e.d,A=e.e,F=e.f,U=e.g,V=e.h,B=e.i,j=e.j},function(e){z=e.a}],execute:function(){class q{constructor(){this.rootComponentParametersAsGlobal=!1,this.lastLoadedRapiId=null,this.selectedRuntimeComponentIds=[],this.selectionMode="standard"}get selectedRuntimeComponentId(){return this.selectedRuntimeComponentIds.length>0?this.selectedRuntimeComponentIds[0]:null}}var N={NO_MATERIAL_ID:"There is no material ID provided. Check the configuration script maybe it is malformed"};const W=new Map,K=new Map;class Z{static loadFont(e){if(K.has(e))return new Promise((t,i)=>{t(K.get(e))});if(W.has(e))return new Promise((t,i)=>{W.get(e).push({resolve:t,reject:i})});let t=new THREE.FontLoader;return new Promise((i,n)=>{W.set(e,[{resolve:i,reject:n}]),t.load(s()+e,t=>{K.set(e,t),Z._resolveAll(e,t)})})}static _resolveAll(e,t){W.has(e)&&W.get(e).forEach(e=>e.resolve(t)),W.delete(e)}}const Y=.02,Q=.025,X=3618615,J=16777215,$=.05;class ee{constructor(e,t){this._textUpdated=!1,this.forceDimensions=!1,this._hoverOnTime=0,this._delayDuration=500,this._dimensionsVisible=!1,this._camera=e,this._formatter=t,this._lineMaterial=new THREE.LineBasicMaterial({color:X}),this._textMaterial=new THREE.MeshPhongMaterial({color:X});let i=new THREE.Geometry;this._widthLine=new THREE.Line(i,this._lineMaterial),this._widthLine.name="dimension width line",this._widthLine.layers.set(6),this._heightLine=new THREE.Line(i,this._lineMaterial),this._heightLine.name="dimension height line",this._heightLine.layers.set(6),this._depthLine=new THREE.Line(i,this._lineMaterial),this._depthLine.name="dimension depth line",this._depthLine.layers.set(6),this._widthText=new THREE.Mesh(i,this._textMaterial),this._widthText.name="dimension width text",this._widthText.layers.set(6),this._heightText=new THREE.Mesh(i,this._textMaterial),this._heightText.name="dimension height text",this._heightText.layers.set(6),this._depthText=new THREE.Mesh(i,this._textMaterial),this._depthText.name="dimension depth text",this._depthText.layers.set(6),this._planeMaterial=new THREE.MeshBasicMaterial({color:J,side:THREE.DoubleSide,opacity:.8,transparent:!0}),this._widthPlane=new THREE.Mesh(i,this._planeMaterial),this._widthPlane.layers.set(6),this._heightPlane=new THREE.Mesh(i,this._planeMaterial),this._heightPlane.layers.set(6),this._depthPlane=new THREE.Mesh(i,this._planeMaterial),this._depthPlane.layers.set(6),Z.loadFont("static/fonts/rubik_regular.json").then(e=>{this._font=e,this._loaded()})}_loaded(){this._textUpdated&&this._font&&this._onLoaded&&(this._onLoaded(),this._onLoaded=null)}_performUpdate(e){if(this._lineBounds||e){if(!this._textUpdated&&this._font&&this._dimensions){let e=this._getWidthEdge().distance(),t=this._getHeightEdge().distance(),i=this._getDepthEdge().distance(),n=Math.round(Math.max(e,Math.max(t,i))),s=Q+(4>n?0:.005*n),o={font:this._font,size:s,height:.001,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:.001};const r=this._formatter;let{x:a,y:h,z:l}=this._dimensions;this._widthTextGeometry&&this._widthTextGeometry.dispose(),this._widthTextGeometry=new THREE.TextGeometry(r.formatMMValueToUnitString(1e3*a),o),this._widthTextGeometry.computeBoundingBox(),this._widthText.geometry=this._widthTextGeometry,this._heightTextGeometry&&this._heightTextGeometry.dispose(),this._heightTextGeometry=new THREE.TextGeometry(r.formatMMValueToUnitString(1e3*h),o),this._heightTextGeometry.computeBoundingBox(),this._heightText.geometry=this._heightTextGeometry,this._depthTextGeometry&&this._depthTextGeometry.dispose(),this._depthTextGeometry=new THREE.TextGeometry(r.formatMMValueToUnitString(1e3*l),o),this._depthTextGeometry.computeBoundingBox(),this._depthText.geometry=this._depthTextGeometry,this._textUpdated=!0,this._loaded()}this._widthTextGeometry&&this._heightTextGeometry&&this._depthTextGeometry&&(this._updateWidth(),this._updateHeight(),this._updateDepth())}}_updateWidth(){let e=new THREE.Geometry,t=this._getWidthEdge();e.vertices.push(t.start,t.end),this._widthLine.geometry.dispose(),this._widthLine.geometry=e;let i=this._widthTextGeometry.boundingBox.getSize(new THREE.Vector3),n=t.getCenter(new THREE.Vector3);if(n.x-=i.x/2*this._getZSign(),n.y+=Y,this._widthText.position.copy(n),0>this._getZSign()){let e=new THREE.Quaternion;e.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),this._widthText.quaternion.copy(e)}else{let e=new THREE.Quaternion;e.setFromAxisAngle(new THREE.Vector3(0,0,0),Math.PI),this._widthText.quaternion.copy(e)}let s=new THREE.PlaneGeometry(i.x+Y,i.y+Y,32);this._widthPlane.geometry.dispose(),this._widthPlane.geometry=s,this._widthPlane.position.copy(t.getCenter(new THREE.Vector3)).add(new THREE.Vector3(0,Y+i.y/2,0))}_updateHeight(){let e=new THREE.Geometry,t=this._getHeightEdge();e.vertices.push(t.start,t.end),this._heightLine.geometry.dispose(),this._heightLine.geometry=e;let i=this._heightTextGeometry.boundingBox.getSize(new THREE.Vector3),n=t.getCenter(new THREE.Vector3);0>this._getXSign()&&this._getZSign()>0?n.x-=i.x+Y:this._getXSign()>0&&0>this._getZSign()?n.x+=i.x+Y:n.x+=Y*this._getXSign(),this._heightText.position.copy(n);let s=new THREE.Quaternion;0>this._getZSign()?(s.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),this._heightText.quaternion.copy(s)):(s.setFromAxisAngle(new THREE.Vector3(0,0,0),Math.PI),this._heightText.quaternion.copy(s));let o=new THREE.PlaneGeometry(i.x+Y,i.y+Y,32);this._heightPlane.geometry.dispose(),this._heightPlane.geometry=o,this._heightPlane.position.copy(n),this._heightPlane.position.add(new THREE.Vector3(this._heightText.geometry.boundingBox.getCenter(new THREE.Vector3).x*this._getZSign(),this._heightText.geometry.boundingBox.getCenter(new THREE.Vector3).y,0))}_updateDepth(){let e=new THREE.Geometry,t=this._getDepthEdge();e.vertices.push(t.start,t.end),this._depthLine.geometry.dispose(),this._depthLine.geometry=e;let i=this._depthTextGeometry.boundingBox.getSize(new THREE.Vector3),n=t.getCenter(new THREE.Vector3);n.y+=Y;let s=new THREE.Quaternion;s.setFromAxisAngle(new THREE.Vector3(0,-1,0),Math.PI/2);let o=s.clone();this._getXSign()>0?(o.setFromAxisAngle(new THREE.Vector3(0,-1,0),Math.PI),o.multiply(s),n.z+=i.x/2):n.z-=i.x/2,this._depthText.position.copy(n),this._depthText.quaternion.copy(o);let r=new THREE.PlaneGeometry(i.x+Y,i.y+Y,32);this._depthPlane.geometry.dispose(),this._depthPlane.geometry=r,this._depthPlane.position.copy(t.getCenter(new THREE.Vector3)).add(new THREE.Vector3(0,Y+i.y/2,0)),this._depthPlane.quaternion.copy(o)}updateBounds(e){this._dimensions=new THREE.Vector3(e.size.x/1e3,e.size.z/1e3,e.size.y/1e3),this._lineBounds=o(e,new THREE.Vector3($,e.origin.z/1e3,$)),this._textUpdated=!1}update(e=!1){this._performUpdate(e)}addToScene(e,t){e.add(this._widthLine),t.add(this._widthPlane),t.add(this._widthText),e.add(this._heightLine),t.add(this._heightPlane),t.add(this._heightText),e.add(this._depthLine),t.add(this._depthPlane),t.add(this._depthText)}_getWidthEdge(){return 0>this._camera.position.z?new THREE.Line3(new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.min.y,this._lineBounds.min.z),new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.min.y,this._lineBounds.min.z)):new THREE.Line3(new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.min.y,this._lineBounds.max.z),new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.min.y,this._lineBounds.max.z))}_getDepthEdge(){return 0>this._camera.position.x?new THREE.Line3(new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.min.y,this._lineBounds.min.z),new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.min.y,this._lineBounds.max.z)):new THREE.Line3(new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.min.y,this._lineBounds.min.z),new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.min.y,this._lineBounds.max.z))}_getHeightEdge(){return 0>this._camera.position.x||0>this._camera.position.z?0>this._camera.position.x&&this._camera.position.z>=0?new THREE.Line3(new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.min.y,this._lineBounds.max.z),new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.max.y,this._lineBounds.max.z)):this._camera.position.x>=0&&0>this._camera.position.z?new THREE.Line3(new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.min.y,this._lineBounds.min.z),new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.max.y,this._lineBounds.min.z)):new THREE.Line3(new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.min.y,this._lineBounds.min.z),new THREE.Vector3(this._lineBounds.min.x,this._lineBounds.max.y,this._lineBounds.min.z)):new THREE.Line3(new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.min.y,this._lineBounds.max.z),new THREE.Vector3(this._lineBounds.max.x,this._lineBounds.max.y,this._lineBounds.max.z))}_getZSign(){return 0>this._camera.position.z?-1:1}_getXSign(){return 0>this._camera.position.x?-1:1}onLoaded(e){this._onLoaded=e,this._loaded()}onDimensionsVisibilityChanged(e){this._onChange=e}onHover(e){e||(this._hoverOnTime=Date.now())}disableDimensions(){this._hoverOnTime=0,this.forceDimensions=!1,this._dimensionsVisible&&(this._dimensionsVisible=!1,this._visibilityChangedCallback())}areDimensionsEnabled(){let e=this._hoverOnTime>0&&Date.now()-this._hoverOnTime>=this._delayDuration;return e&&!this._dimensionsVisible&&(this._dimensionsVisible=!0,this._visibilityChangedCallback()),e}_visibilityChangedCallback(){this._onChange&&this._onChange(this._dimensionsVisible)}clear(){this._lineMaterial.dispose(),this._planeMaterial.dispose(),this._widthLine.geometry.dispose(),this._heightLine.geometry.dispose(),this._depthLine.geometry.dispose(),this._widthPlane.geometry.dispose(),this._heightPlane.geometry.dispose(),this._depthPlane.geometry.dispose(),this._textMaterial.dispose(),this._widthTextGeometry&&this._widthTextGeometry.dispose(),this._heightTextGeometry&&this._heightTextGeometry.dispose(),this._depthTextGeometry&&this._depthTextGeometry.dispose()}}const te=.05,ie=8947848,ne=0,se=.08;class oe{constructor(e,t){this._addOnSpotIcons=new Map,this.previewGhostEnabled=!1,this.addOnSpotsEnabled=!1,this._state=3,this._camera=e,this._textMaterial=new THREE.MeshStandardMaterial({color:ie}),this._textMaterialSelected=new THREE.MeshStandardMaterial({color:ne});let i=new THREE.Geometry;this._plusText=new THREE.Mesh(i,this._textMaterial),this._plusText.layers.set(4),Z.loadFont("static/fonts/rubik_regular.json").then(e=>{this._font=e;let t={font:this._font,size:te,height:.001,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:.001};this._plusTextGeometry=new THREE.TextGeometry("+",t),this._plusTextGeometry.computeBoundingBox(),this._plusText.geometry=this._plusTextGeometry}),this._plusButtonPromise=new Promise((e,i)=>{t.fetch("static/three/lib/loaders/GLTFLoader.js",{id:"gltf-loader-js"}).then(()=>{(new THREE.GLTFLoader).load(s()+"static/geometry/AddButtonRound.glb",t=>{t&&t.scene&&t.scene.children&&t.scene.children.length>0?(this._onPlusButtonLoaded(t.scene.children[0]),e()):i("loaded scene has no childrens")},e=>{},e=>{console.error(e),i(e)})})})}_onPlusButtonLoaded(e){e&&(this._plusButton=e,this._plusButton.material=this._textMaterial,this._plusButton.layers.set(4),this._plusButton.scale.copy(new THREE.Vector3(se,se,se)))}_performUpdate(e){if(this.addOnSpotsEnabled)for(let e of this._addOnSpotIcons.values())e.forEach(e=>{e.geometry.center();let t=new THREE.Vector3(0,1,0);t.applyQuaternion(this._camera.quaternion),e.up.copy(t),e.lookAt(this._camera.position)})}addAddOnSpots(e,t,i){Promise.all([this._plusButtonPromise]).then(()=>{this.addOnSpotsEnabled&&this._plusButton&&(this.deleteAddonPointsForComponent(t.roomleId),i.forEach(i=>{let n=this._plusButton.clone();n.name="addOnSpot "+t.roomleId,n.layers.set(7),n.position.copy(this.getPositionForAddOnPosition(e,t.position,new THREE.Vector3(i.position.x,i.position.y,i.position.z))),this._addOnSpotIcons.has(t.roomleId)?this._addOnSpotIcons.get(t.roomleId).push(n):this._addOnSpotIcons.set(t.roomleId,[n]),n.geometry.computeBoundingBox();let s=n.geometry.boundingBox,o=s.getSize(new THREE.Vector3),a=new THREE.BoxGeometry(o.x,o.y,o.z),h=new THREE.Mesh(a,new THREE.MeshStandardMaterial({color:"#FFFFFF",transparent:!0,opacity:0,polygonOffset:!0,polygonOffsetFactor:-1}));h.layers.set(4),h.translateOnAxis(s.getCenter(new THREE.Vector3),1),h.renderOrder=3,h.visible=!0,n.add(h),h.userData={hasListener:!0,priority:3,roomleId:t.roomleId},h.addEventListener("select",()=>{this._onAddonClick&&this._onAddonClick()}),h.addEventListener("hover_on",()=>{r("pointer"),this._eventHandler.dispatch(74)}),h.addEventListener("hover_off",()=>{r("default"),this._eventHandler.dispatch(75)}),t.add(n)}))})}deleteAddonPointsForComponent(e){this.addOnSpotsEnabled&&this._addOnSpotIcons.has(e)&&(this._addOnSpotIcons.get(e).forEach(e=>{e.parent.remove(e)}),this._addOnSpotIcons.delete(e))}getPositionForAddOnPosition(e,t,i){let n=new THREE.Vector3;return n.set(i.x/1e3,i.z/1e3,i.y/-1e3),n}update(e=!1){this._performUpdate(e)}changePreviewGhostVisibility(e,t){this.previewGhostEnabled&&(t?(e.add(this._plusText),this._plusText.position.copy((new THREE.Vector3).add(e.boundingBox.getCenter(new THREE.Vector3))),this._plusText.geometry.center()):e.remove(this._plusText))}_changeAddOnSpotVisibility(e){this.addOnSpotsEnabled&&this._addOnSpotsVisible!==e&&(this._addOnSpotsVisible=e)}isAddOnSpotVisible(){return this._addOnSpotsVisible&&this.addOnSpotsEnabled}onAddonClick(e){this._onAddonClick=e}setState(e){1===this._state&&2!==e||1===e&&5===this._state||3!==e&&5===this._state||(4!==e&&1!==e&&5!==e||this._changeAddOnSpotVisibility(!1),3!==e&&2!==e&&0!==e||this._changeAddOnSpotVisibility(!0),this._state=e)}}i([n],oe.prototype,"_eventHandler",void 0);class re{constructor(e){const{component:t,preview:i,resetCamera:n,type:s}=e;this.component=t,this.preview=i,this.resetCamera=void 0===n||n,this.type=s||0}}class ae extends a{constructor(e,t,i,n){super(),this._debug=!1,this._dragIn=!1,this._raycastHelper=new k(e,t,i),this._addonHelper=n,this._raycastHelper.addEventListener(3,()=>{this._clickOutside()},this),this._selectionHandler.addEventListener(0,({component:e})=>{this.dispatchEvent(7,new re({component:e})),this._inputManager.setDragEnabled(!0)},this),this._selectionHandler.addEventListener(1,({component:e,resetCamera:t})=>{this._selectionHandler.hasSelection()||this._inputManager.setDragEnabled(!1),this.dispatchEvent(8,new re({component:e,resetCamera:t}))},this),this._inputManager=i,this._addInputListeners(i)}_addInputListeners(e){e.addEventListener(7,e=>this._interaction(),this),e.addEventListener(8,e=>this._interaction(),this)}addComponentHandlers(e){this._addComponentHandlers(e,e.boundingBoxMesh,{hasListener:!0,priority:1,roomleId:e.roomleId}),e.meshes.forEach(t=>{this._addComponentHandlers(e,t,{hasListener:!0,priority:2,roomleId:e.roomleId})})}addComponentDragInHandler(e){this._dragIn&&(this._addComponentHandlers(e,e.boundingBoxMesh,{hasListener:!0,priority:1,roomleId:e.roomleId}),this._raycastHelper.enableDragIn(e.boundingBoxMesh))}_addComponentHandlers(e,t,i){t.userData.hasListener||(t.userData=i,t.addEventListener("select",()=>this._clickComponent(e)),t.addEventListener("hover_on",t=>this._hoverOn(e,t.attachment.type)),t.addEventListener("hover_off",t=>this._hoverOff(e,t.attachment.type)),t.addEventListener("drag_start",()=>this._dragStart(e)),t.addEventListener("drag",t=>this._drag(e,t.attachment.position)),t.addEventListener("drag_end",t=>this._dragEnd(e,t.attachment.position)))}addPreviewHandlers(e){let t=e.boundingBoxMesh;t.userData.hasListener||(t.userData={hasListener:!0,priority:3,roomleId:e.roomleId},t.addEventListener("select",()=>this._clickPreview(e)),t.addEventListener("hover_on",()=>this._hoverOnPreview(e)),t.addEventListener("hover_off",()=>this._hoverOffPreview(e)))}addPreviewLineHandlers(e){let t=e.boundingLineMesh;t.userData.hasListener||(t.userData={hasListener:!0,priority:4,roomleId:e.roomleId},t.addEventListener("select",()=>this._clickPreviewLine(e)),t.addEventListener("hover_on",t=>this._hoverOnPreviewLine(e,t.attachment.intersection)),t.addEventListener("hover_move",t=>this._hoverMovePreviewLine(e,t.attachment.intersection)),t.addEventListener("hover_off",()=>this._hoverOffPreviewLine(e)))}_clickPreview(e){this._dragStartPosition&&(e.position.copy(this._dragStartPosition),this._dragStartPosition=null),this.dispatchEvent(6,new re({preview:e}))}_clickPreviewLine(e){this._dragStartPosition&&(e.position.copy(this._dragStartPosition),this._dragStartPosition=null),this.dispatchEvent(6,new re({preview:e}))}_clickComponent(e){this._debug&&e.roomleId,this._selectionHandler.check(e)}_clickOutside(){this._selectionHandler.cancelSelection(),this.dispatchEvent(3),this._interaction()}_hoverOn(e,t){this._debug&&e.roomleId,2!==t&&e.hoverOn(),this._interaction(),this.dispatchEvent(1,new re({component:e,type:t}))}_hoverOff(e,t){this._debug&&e.roomleId,2!==t&&e.hoverOff(),this._interaction(),this.dispatchEvent(2,new re({component:e,type:t}))}_hoverOnPreview(e){e.hoverOn(),this._interaction(),this._hoveredPreview=e,this._addonHelper&&this._addonHelper.changePreviewGhostVisibility(e,!0)}_hoverOffPreview(e){e.hoverOff(),this._interaction(),this._hoveredPreview=null,this._addonHelper&&this._addonHelper.changePreviewGhostVisibility(e,!1)}_hoverOnPreviewLine(e,t){this._updatePositionForPreviewLine(e,t),this._draggedComponent||e.hoverOn(),this._interaction(),this._hoveredPreview=e}_hoverMovePreviewLine(e,t){this._updatePositionForPreviewLine(e,t),this._hoveredPreview=e,this._interaction()}_updatePositionForPreviewLine(e,t){let i=t.object.parent.parent.worldToLocal(t.point);this._previewLineIntersection=i,e&&(this._draggedComponent?this._draggedComponent.visible=!0:e.updatePreviewPosition(i))}_hoverOffPreviewLine(e){this._draggedComponent||e.hoverOff(),this._interaction(),this._hoveredPreview=null,this._previewLineIntersection=null}_dragStart(e){this._dragStartPosition=e.position.clone(),this._dragStartRotation=e.rotation.clone(),this._draggedComponent=e,this.dispatchEvent(4,new re({component:e})),this._interaction()}_drag(e,t){if(e&&!this._draggedComponent&&(this._draggedComponent=e),this._previewLineIntersection){let e=this._hoveredPreview,t=e.getPositionForIntersectionPoint(this._previewLineIntersection),i=e.parent.localToWorld(t);this._draggedComponent.position.copy(this._draggedComponent.parent.worldToLocal(i)),this._draggedComponent.rotation.copy(e.rotation),e.hideSelectionLine()}else e.parent?e.position.copy(e.parent.worldToLocal(t)):e.position.copy(t);this._hoveredPreview?e.visible=!1:e.visible=!0,this._interaction()}_dragEnd(e,t){if(this._hoveredPreview)if(this._previewLineIntersection){let t=this._hoveredPreview,i=t.getPositionForIntersectionPoint(this._previewLineIntersection),n=t.parent.localToWorld(i);e.position.copy(e.parent.worldToLocal(n)),e.rotation.copy(t.rotation)}else e.position.copy(t);else this._dragStartPosition&&this._dragStartRotation&&(e.position.copy(this._dragStartPosition),e.rotation.copy(this._dragStartRotation),this._dragStartPosition=null,this._dragStartRotation=null,this.addComponentHandlers(e));e.visible=!0,this._draggedComponent=null,this._previewLineIntersection=null,this.dispatchEvent(5,new re({component:e,preview:this._hoveredPreview})),this._interaction()}_interaction(){this.dispatchEvent(0)}hasSelection(){return this._selectionHandler.hasSelection()}update(e,t,i){this._raycastHelper.update(e,t,i)}setDragIn(e,t){this._dragIn=e,e?this._inputManager.enableDragIn(t):this._raycastHelper.clear(),this._interaction()}isDragIn(){return this._dragIn}isDragging(){return null!=this._draggedComponent}setRootComponentId(e){this._raycastHelper.setRootComponentId(e)}cancelSelection(){this._selectionHandler.setSelectionMode("standard"),this._selectionHandler.cancelSelection()}setSelectionMode(e){this._selectionHandler.setSelectionMode(e)}getSelectionMode(){return this._selectionHandler.getSelectionMode()}getSelectedRuntimeComponentIds(){return this._selectionHandler.getSelectedRuntimeComponentIds()}}i([n],ae.prototype,"_selectionHandler",void 0);class he extends a{constructor(e){super(),this._uiIntersectionMask=0,this.floorEnvironment=!1,this._camera=e}updateToBounds(e,t,i){let n=new THREE.Vector3(-e.x/2,0,-e.z/2),s=new THREE.Vector3(e.x/2,e.y,e.z/2);this._boundingBox=new THREE.Box3(n,s),this._clientWidth=t,this._clientHeight=i;let o=this._boundingBox.getSize(new THREE.Vector3);this._boxVertices=[],this._boxVertices.push(this._boundingBox.min),this._boxVertices.push(this._boundingBox.min.clone().add(new THREE.Vector3(o.x,0,0))),this._boxVertices.push(this._boundingBox.max),this._boxVertices.push(this._boundingBox.max.clone().sub(new THREE.Vector3(o.x,0,0)))}set canvasOffset(e){this._offset=e}calculateUIIntersection(){let e=[];if(null==this._boundingBox||null==this._offset)return;let t=this._checkPaddings();t.bottom=this._clientHeight-t.bottom,t.right=this._clientWidth-t.right;let i=0;this.floorEnvironment?(e=["left","right","bottom"],i=11):(this._offset.left>0&&t.left<this._offset.left*this._clientWidth&&(e.push("left"),i|=8),1>this._offset.right&&t.right<(1-this._offset.right)*this._clientWidth&&(e.push("right"),i|=2),this._offset.bottom>0&&t.bottom<this._offset.bottom*this._clientHeight&&(e.push("bottom"),i|=1)),1>this._offset.top&&t.top<(1-this._offset.top)*this._clientHeight&&(e.push("top"),i|=4),i!==this._uiIntersectionMask&&(this.dispatchEvent(0,e),this._uiIntersectionMask=i)}_checkPaddings(){let e={left:this._clientWidth/2,top:this._clientHeight/2,right:this._clientWidth/2,bottom:this._clientHeight/2};return this._boxVertices.forEach(t=>{let i=h(t,this._camera,this._clientWidth,this._clientHeight);i.x<e.left&&(e.left=i.x),i.x>e.right&&(e.right=i.x),i.y<e.top&&(e.top=i.y),i.y>e.bottom&&(e.bottom=i.y)}),e}}class le extends l{constructor(e,t){super(e,t),this._lights=[]}loadFromJSON(e){return new Promise((t,i)=>{this._lights=this._dynamicLightSettingLoader.parse(e),this.addToScene(),t()})}loadFromObject(e){return new Promise((t,i)=>{this._lights=this._dynamicLightSettingLoader.load(e),this._lights.filter((e,t)=>{e.userData.movesWithCamera&&(this._cameraLight=e,this._lights.splice(t,1))}),this.addToScene(),t()})}loadFromURL(e){return new Promise((t,i)=>{fetch(new Request(e,{method:"GET"})).then(c).then(e=>this.loadFromObject(e).then(t,i))})}addToScene(){this._lights.forEach(e=>{this._scene.add(e)}),this._cameraLight&&(this._cameraLight.castShadow=!1,this._scene.add(this._cameraLight))}removeFromScene(){this._lights.forEach(e=>{this._scene.remove(e)}),this._cameraLight&&this._scene.remove(this._cameraLight)}reload(){this.removeFromScene(),this.addToScene()}update(e,t){if(!this._cameraLight)return;let i=e.userData.yaw,n=e.userData.pitch,s=new THREE.Euler(-n,i,0,"ZYX"),o=(new THREE.Quaternion).setFromEuler(s),r=new THREE.Vector3(0,0,-1);r.applyQuaternion(o);let a=this._cameraLight.position.distanceTo(t),h=t.clone().sub(r.multiplyScalar(a));this._cameraLight.position.copy(h),this._cameraLight.lookAt(t)}showGUI(){let e=d();this._cameraLight&&this._addToGUI(e,this._cameraLight),this._lights.forEach(t=>{this._addToGUI(e,t)})}_addToGUI(e,t){t instanceof THREE.SpotLight&&this._addSpotLightToGUI(e,t),t instanceof THREE.AmbientLight&&this._addAmbientLightToGUI(e,t),t instanceof THREE.RectAreaLight&&this._addRectAreaLightToGUI(e,t)}_addRectAreaLightToGUI(e,t){let i=e.addFolder(t.name),n={name:t.name,color:"#"+t.color.getHexString(),intensity:t.intensity*t.width*t.height};i.add(t,"visible"),i.add(n,"intensity").min(100).max(400).step(1).onChange(e=>{t.intensity=e/(t.width*t.height)}),i.add(t,"castShadow"),i.addColor(n,"color").onChange(e=>{t.color=new THREE.Color(e)}),i.add(t.position,"x").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),i.add(t.position,"y").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),i.add(t.position,"z").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))})}_addSpotLightToGUI(e,t){let i=e.addFolder(t.name),n={name:t.name,color:"#"+t.color.getHexString(),angle:180*t.angle/Math.PI};i.add(t,"visible"),i.add(t,"intensity").min(0).max(5).step(.1),i.add(t,"penumbra").min(0).max(1).step(.1),i.addColor(n,"color").onChange(e=>{t.color=new THREE.Color(e)}),i.add(n,"angle").min(10).max(180).step(1).onChange(e=>{t.angle=e*Math.PI/180}),i.add(t.position,"x").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),i.add(t.position,"y").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),i.add(t.position,"z").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))})}_addAmbientLightToGUI(e,t){let i={name:t.name,color:"#"+t.color.getHexString()},n=e.addFolder(t.name);n.add(t,"visible"),n.add(t,"intensity").min(0).max(5).step(.1),n.addColor(i,"color").onChange(e=>{t.color=new THREE.Color(e)})}}i([n],le.prototype,"_dynamicLightSettingLoader",void 0);class de extends l{constructor(e,t){super(e,t),this._params={ambientLight:{color:"#ffffff"},areaLight:{intensity:240,color:"#ffffff"},sideSpot:{color:"#ffffff",angle:50},backSpot:{color:"#ffffff",angle:50}},this._ambientLight=new THREE.AmbientLight(new THREE.Color(this._params.ambientLight.color),.3),this._ambientLight.layers.set(1),this._sideSpot=this._createSpotlight(new THREE.Vector3(2,3,1.5),new THREE.Vector3(0,.1,0),new THREE.Color(this._params.sideSpot.color),this._params.sideSpot.angle,.5,.3),this._backspot=this._createSpotlight(new THREE.Vector3(1,3,-3),new THREE.Vector3(0,.1,0),new THREE.Color(this._params.backSpot.color),this._params.backSpot.angle,1,.3),this._areaLight=new THREE.RectAreaLight(new THREE.Color(this._params.areaLight.color),void 0,.8,.8),this._areaLight.castShadow=!0,this._areaLight.matrixAutoUpdate=!0,this._areaLight.intensity=this._params.areaLight.intensity/(this._areaLight.width*this._areaLight.height),this._areaLight.position.set(-3,4,4),this._areaLight.lookAt(new THREE.Vector3(0,0,0)),this._areaLight.visible=!0,this._areaLight.layers.set(1),this.addToScene()}_createSpotlight(e,t,i,n,s,o){let r=new THREE.SpotLight(i,o);return r.angle=n*Math.PI/180,r.penumbra=s,r.position.copy(e),r.target.position.set(t.x,t.y,t.z),r.shadow.camera.near=.1,r.shadow.camera.far=10,r.shadow.mapSize=new THREE.Vector2(1024,1024),r.visible=!0,r.castShadow=!1,r}addToScene(){this._scene.add(this._ambientLight),this._scene.add(this._areaLight),this._scene.add(this._sideSpot),this._scene.add(this._backspot)}removeFromScene(){this._scene.remove(this._ambientLight),this._scene.remove(this._areaLight),this._scene.remove(this._sideSpot),this._scene.remove(this._backspot)}reload(){this.removeFromScene(),this.addToScene()}showGUI(){let e=d();if(this._areaLight){let t=e.addFolder("Area Light");t.add(this._areaLight,"visible"),t.add(this._params.areaLight,"intensity").min(100).max(400).step(1).onChange(e=>{this._areaLight.intensity=e/(this._areaLight.width*this._areaLight.height)}),t.add(this._areaLight,"castShadow"),t.addColor(this._params.areaLight,"color").onChange(e=>{this._areaLight.color=new THREE.Color(e)}),t.add(this._areaLight.position,"x").min(-10).max(10).step(.1).onChange(()=>{this._areaLight.lookAt(new THREE.Vector3(0,0,0))}),t.add(this._areaLight.position,"y").min(-10).max(10).step(.1).onChange(()=>{this._areaLight.lookAt(new THREE.Vector3(0,0,0))}),t.add(this._areaLight.position,"z").min(-10).max(10).step(.1).onChange(()=>{this._areaLight.lookAt(new THREE.Vector3(0,0,0))})}if(this._ambientLight){let t=e.addFolder("Ambient Light");t.add(this._ambientLight,"visible"),t.add(this._ambientLight,"intensity").min(0).max(5).step(.1),t.addColor(this._params.ambientLight,"color").onChange(e=>{this._ambientLight.color=new THREE.Color(e)})}if(this._sideSpot){let t=e.addFolder("Side Spot");t.add(this._sideSpot,"visible"),t.add(this._sideSpot,"intensity").min(0).max(5).step(.1),t.add(this._sideSpot,"penumbra").min(0).max(1).step(.1),t.addColor(this._params.sideSpot,"color").onChange(e=>{this._sideSpot.color=new THREE.Color(e)}),t.add(this._params.sideSpot,"angle").min(10).max(180).step(1).onChange(e=>{this._sideSpot.angle=e*Math.PI/180}),t.add(this._sideSpot.position,"x").min(-10).max(10).step(.1).onChange(()=>{this._sideSpot.lookAt(new THREE.Vector3(0,0,0))}),t.add(this._sideSpot.position,"y").min(-10).max(10).step(.1).onChange(()=>{this._sideSpot.lookAt(new THREE.Vector3(0,0,0))}),t.add(this._sideSpot.position,"z").min(-10).max(10).step(.1).onChange(()=>{this._sideSpot.lookAt(new THREE.Vector3(0,0,0))})}if(this._backspot){let t=e.addFolder("Back Spot");t.add(this._backspot,"visible"),t.add(this._backspot,"intensity").min(0).max(5).step(.1),t.add(this._backspot,"penumbra").min(0).max(1).step(.1),t.addColor(this._params.backSpot,"color").onChange(e=>{this._backspot.color=new THREE.Color(e)}),t.add(this._params.backSpot,"angle").min(10).max(180).step(1).onChange(e=>{this._backspot.angle=e*Math.PI/180}),t.add(this._backspot.position,"x").min(-10).max(10).step(.1).onChange(()=>{this._backspot.lookAt(new THREE.Vector3(0,0,0))}),t.add(this._backspot.position,"y").min(-10).max(10).step(.1).onChange(()=>{this._backspot.lookAt(new THREE.Vector3(0,0,0))}),t.add(this._backspot.position,"z").min(-10).max(10).step(.1).onChange(()=>{this._backspot.lookAt(new THREE.Vector3(0,0,0))})}}}class ce{constructor(e,t){this._scene=e,t&&(t.removeFromScene(),t.cleanUp())}updateCamera(e){}reload(){this.removeFromScene(),this.addToScene()}updateBounds(e){this._bounds=e}cleanUp(){this._scene=null}}class _e extends ce{constructor(e,t){super(e,t),this._gltfLoaderPromise=this._scriptLoader.fetch("static/three/lib/loaders/GLTFLoader.js",{id:"gltf-loader-js"}).then(()=>{this._gltfLoader=new THREE.GLTFLoader})}needsBounds(){return!0}needsCamera(){return!0}updateBounds(e){if(super.updateBounds(e),this._backgroundMesh){let t=Math.max(e.x,e.z)/6;t=Math.max(t,1),this._backgroundMesh.scale.copy(new THREE.Vector3(t,t,t))}}updateCamera(e){if(this._backgroundMesh){let t=e.getWorldDirection(new THREE.Vector3);t.y=0,.01>t.lengthSq()&&((t=new THREE.Vector3(0,1,0)).applyQuaternion(e.quaternion),t.y=0),t.multiplyScalar(-1),t.normalize();let i=Math.asin(t.x);0>t.z&&(i=Math.PI-i),this._backgroundMesh.rotation.set(0,i,0)}}addToScene(){this._scene&&this._backgroundMesh&&this._scene.add(this._backgroundMesh)}removeFromScene(){this._scene&&this._backgroundMesh&&this._scene.remove(this._backgroundMesh)}loadBackground(e,t){this._backgroundMaterial=t,this._backgroundMaterial||(this._backgroundMaterial=new THREE.MeshBasicMaterial),this._gltfLoaderPromise.then(()=>{this._gltfLoader.load(e,this._onBackgroundLoaded.bind(this),e=>{},e=>{console.error(e)})})}_onBackgroundLoaded(e){this._scene&&(this._backgroundMaterial.vertexColors=THREE.VertexColors,e&&e.scene&&e.scene.children&&e.scene.children.length>0&&(e.scene.children[0].material=this._backgroundMaterial,e.scene.children[0].layers.set(2),e.scene.position.copy(new THREE.Vector3(0,0,0)),this._backgroundMesh=e.scene,this._backgroundMesh.layers.set(2),this._backgroundMesh.receiveShadow=!0,_(this._backgroundMesh,!0,!1),this.removeFromScene(),this.addToScene()))}showGUI(){console.warn("gui not implemented for gltf environment")}}i([n],_e.prototype,"_scriptLoader",void 0);const pe=100,me=8,ue=3,ge=20,be=16185078;class we extends ce{constructor(e,t,i){super(e,t),this._wallVertices=[],this._wallMeshes=[],this._size=me,this._longestSide=2;let n=new THREE.PlaneGeometry(pe,pe,pe,pe),s=new THREE.MeshStandardMaterial({color:11184810,side:THREE.DoubleSide});this._floorMesh=new THREE.Mesh(n,s),this._floorMesh.name="floor",this._floorMesh.position.y=-.001,this._floorMesh.rotation.x=-Math.PI/2,this._floorMesh.layers.set(2),this._floorMesh.receiveShadow=!0,this._fog=i||!1;for(let e=0;4>e;e++){let e=new THREE.Mesh;e.layers.set(2),e.receiveShadow=!0,this._wallMeshes.push(e)}this._updateWallVertices(),this._updateWalls(s),this._textureLoader=new THREE.TextureLoader,this.addToScene()}needsBounds(){return!0}needsCamera(){return this._fog}needsRotation(){return!1}updateBounds(e){super.updateBounds(e),this._longestSide=Math.max(e.x,e.z);let t=this._longestSide+5;me>t?t=me:t+=ue-t%ue,this._size=t,this._update()}updateCamera(e){this._cameraDistance=e.position.distanceTo(new THREE.Vector3(0,0,0)),this._update()}_update(){this._fog?this._updateFog():(this._updateWallVertices(),this._updateWalls(new THREE.MeshBasicMaterial({color:16777215})))}_updateFog(){let e=this._longestSide/2;this._scene.fog=new THREE.Fog(be,this._cameraDistance+e+3,this._cameraDistance+e+3+1),this._scene.background=new THREE.Color(be)}_updateFloor(){if(this._floorMaterial){let e=new THREE.PlaneGeometry(pe,pe,pe/this._width,pe/this._height);this._floorMesh.material=this._floorMaterial,this._floorMesh.geometry=e}else{let e=null,t=this._width/1e3,i=this._height/1e3;this._repeatable?(this._floorTexture.wrapS=THREE.RepeatWrapping,this._floorTexture.wrapT=THREE.RepeatWrapping,this._floorTexture.repeat.set(pe/t,pe/i),e=new THREE.PlaneGeometry(pe,pe,pe/t,pe/i)):e=new THREE.PlaneGeometry(pe,pe,1,1);let n=new THREE.MeshStandardMaterial({map:this._floorTexture,side:THREE.DoubleSide});this._floorMesh.material=n,this._floorMesh.geometry=e}}_updateWallVertices(){this._wallVertices=[];let e=this._size/2;this._wallVertices.push(new THREE.Vector3(-e,0,-e)),this._wallVertices.push(new THREE.Vector3(-e,0,e)),this._wallVertices.push(new THREE.Vector3(e,0,e)),this._wallVertices.push(new THREE.Vector3(e,0,-e))}_updateWalls(e){if(this._wallTexture)for(let t=0;t<this._wallMeshes.length;t++){let i=this._wallMeshes[t],n=this._wallVertices[t],s=this._wallVertices[(t+1)%this._wallVertices.length],o=new THREE.Geometry;o.vertices=[n,s,new THREE.Vector3(n.x,ge,n.z),new THREE.Vector3(s.x,ge,s.z)],o.faceVertexUvs=[[[new THREE.Vector2(n.x+n.z,ge),new THREE.Vector2(s.x+s.z,s.y),new THREE.Vector2(n.x+n.z,n.y)],[new THREE.Vector2(s.x+s.z,s.y),new THREE.Vector2(n.x+n.z,ge),new THREE.Vector2(s.x+s.z,ge)]]],o.uvsNeedUpdate=!0,o.faces=[new THREE.Face3(2,1,0),new THREE.Face3(1,2,3)],o.computeFaceNormals(),o.computeVertexNormals(),i.material=e,i.geometry=o}}addToScene(){this._scene&&(this._scene.add(this._floorMesh),this._wallMeshes.forEach(e=>{this._scene.add(e)}))}removeFromScene(){this._scene.remove(this._floorMesh),this._wallMeshes.forEach(e=>{this._scene.remove(e)})}_getWallPromise(){return new Promise((e,t)=>{this._wallTexture?e():this._textureLoader.load(s()+"static/textures/white_wall_texture.jpg",t=>{this._wallTexture=t,this._wallTexture.wrapS=THREE.RepeatWrapping,this._wallTexture.wrapT=THREE.RepeatWrapping,e()},null,t)})}setFloorMaterial(e,t,i,n){return this._width=t,this._height=i,this._repeatable=n,this._floorPromise=new Promise((t,i)=>{this._textureLoader.load(e,e=>{this._floorTexture=e,t()},null,i)}),new Promise((e,t)=>{Promise.all([this._floorPromise,this._getWallPromise()]).then(()=>{this._updateFloor(),this._update(),e()},()=>t())})}changeFloorMaterial(e,t){this._floorPromise=new Promise((i,n)=>{let s=m(e,this._environmentLoader.getEnvironmentMap());this._rapiAccess.getTexturesOf(e).then(e=>{if(e.length>0){let n=[];e.forEach(e=>{let i=0===e.mmWidth?1:e.mmWidth/1e3,o=0===e.mmHeight?1:e.mmHeight/1e3,r=pe/i,a=pe/o;n.push(p(this._dataSyncer.requestAsset(e.image,!0),e,s,t,r,a))}),Promise.all(n).then(()=>{this._floorMaterial=s,setTimeout(()=>i(),0)})}}),(!e.textures||e.textures&&0===e.textures.length)&&(this._floorMaterial=s,setTimeout(()=>i(),0))});let i=[this._floorPromise];return this._fog||i.push(this._getWallPromise()),new Promise((e,t)=>{Promise.all(i).then(()=>{this._updateFloor(),this._update(),e()},()=>t())})}showGUI(){this._floorMaterial?this._addGUI():this._floorPromise&&this._floorPromise.then(()=>this._addGUI())}_addGUI(){let e=d().addFolder("Floor");e.add(this._floorMaterial,"roughness").min(0).max(1).step(.01),e.add(this._floorMaterial,"reflectivity").min(0).max(1).step(.01),e.add(this._floorMaterial,"clearCoat").min(0).max(1).step(.01),e.add(this._floorMaterial,"clearCoatRoughness").min(0).max(1).step(.01),e.add(this._floorMaterial,"opacity").min(0).max(1).step(.01),e.add(this._floorMaterial,"metalness").min(0).max(1).step(.01),e.add(this._floorMaterial,"bumpScale").min(0).max(1).step(.01)}}i([n],we.prototype,"_rapiAccess",void 0),i([n],we.prototype,"_dataSyncer",void 0),i([n],we.prototype,"_environmentLoader",void 0);const Ee=20,ve="rml-scene-background";class Ce extends ce{constructor(e,t,i,n,s){super(e,t),this._color=i,this._oldBackground=e.background,this._shadowMaterial=new THREE.ShadowMaterial({color:1118481,opacity:.4}),this._generateShadowPlane(Ee),n&&(this._canvas=n,this.addBackground(n,s)),this.addToScene()}addBackground(e,t){const i=document.createElement("style");let n='background-image: url("'+t+'"); background-size: cover;';i.innerText="."+ve+" {"+n+"}",e.appendChild(i)}_generateShadowPlane(e){let t=!1;this._shadowMesh&&(t=!0,this._scene.remove(this._shadowMesh)),this._shadowMesh=new THREE.Mesh(new THREE.PlaneGeometry(e,e),this._shadowMaterial),this._shadowMesh.name="floor",this._shadowMesh.position.y=-.001,this._shadowMesh.rotation.x=-Math.PI/2,this._shadowMesh.layers.set(2),this._shadowMesh.receiveShadow=!0,t&&this._scene.add(this._shadowMesh)}needsBounds(){return!0}needsCamera(){return!0}addToScene(){this._scene&&(this._canvas?this._scene.background=null:this._scene.background=this._color,this._scene.add(this._shadowMesh),this._canvas&&this._canvas.classList.add(ve))}removeFromScene(){this._scene.background=this._oldBackground,this._scene.remove(this._shadowMesh),this._canvas&&this._canvas.classList.remove(ve)}updateBounds(e){super.updateBounds(e),this._generateShadowPlane(Math.max(e.x,e.z)+Ee)}showGUI(){console.warn("gui not implemented for gltf environment")}}class fe{parse(e,t,i,n){let s=JSON.parse(n);return s.environment?this.load(e,t,i,s):null}load(e,t,i,n){let o,r=n.environment;switch(r.type){case"color":o=new Promise(t=>t(new Ce(e,i,new THREE.Color(r.details.color))));break;case"image":o=new Promise(n=>n(new Ce(e,i,null,t,r.details.imageUrl)));break;case"gltf":o=new Promise(t=>{let n=new _e(e,i);n.loadBackground(s()+"static/geometry/PhotoStudioRoom.glb"),t(n)});break;case"floor":o=new Promise(t=>{this._rapiAccess.getMaterial(r.details.material).then(n=>{let s=void 0===r.details.fog||r.details.fog,o=new we(e,i,s);o.changeFloorMaterial(n).then(()=>{t(o)})})});break;default:console.warn("Could not load environment, return old environment"),o=new Promise(e=>e(i))}return o}}i([n],fe.prototype,"_rapiAccess",void 0);const He=3e3;let ye=null,Te=null;class Pe{constructor(e){this._forceRender=!1,this.waitingForMaterials=[],this._maxAnisotrophy=1,this._devicePixelRatio=1,this._clock=new THREE.Clock,this._delta=0,this._shadowDirty=!1,this._components=new Map,this._previews=new Map,this._materialCache=new Map,this._previewMaterial=new THREE.MeshStandardMaterial({color:b,transparent:!0,opacity:w}),this._lastChange=Date.now(),this._running=!1,this._devicePixelRatio=window.devicePixelRatio&&window.__RML__ENV__.initData.retina?window.devicePixelRatio:window.__RML__ENV__.initData.enableHD?1:window.devicePixelRatio,this._setupScene(e);let{plusInPreview:t,addOnSpots:i}=window.__RML__ENV__.initData;(t||i)&&(this._addonHelper=new oe(this._camera,this._scriptLoader),i&&(this._addonHelper.onAddonClick(()=>{this._webGl.openAddOns()}),this._addonHelper.addOnSpotsEnabled=i),this._addonHelper.previewGhostEnabled=t),this._cameraControl=new u(this._configuratorInputManager,this._domHelper.element,null,this._camera),this._sceneEventHandler=new ae(this._scene,this._camera,this._configuratorInputManager,this._addonHelper),this._sceneEventHandler.addEventListener(0,()=>{this._uiIntersectionHelper.calculateUIIntersection(),this._addonHelper&&this._addonHelper.setState(0),this._requestRender()},this),this._sceneEventHandler.addEventListener(1,({component:e,type:t})=>this._onHoverOn(e,t),this),this._sceneEventHandler.addEventListener(2,({type:e})=>this._onHoverOff(e),this),this._sceneEventHandler.addEventListener(3,()=>{this._webGl.clickOutside(),this._dimensionHelper.disableDimensions(),this._cameraControl.unlock(),this._cancelDockings(!1,null,this._previews.size>0,!0),this.cancelSelection(!0),this._requestRender()},this),this._sceneEventHandler.addEventListener(7,({component:e})=>{this._previews.size>0&&this._cancelDockings(!1,null,this._previews.size>0,!0),this._selectComponent(e),this._webGl.context.selectedRuntimeComponentIds=this._sceneEventHandler.getSelectedRuntimeComponentIds(),"standard"===this._sceneEventHandler.getSelectionMode()?this._webGl.onSelectedRuntimeComponentChange(e):this._webGl.onSelectedRuntimeComponentsChange(this._sceneEventHandler.getSelectedRuntimeComponentIds()),this._requestRender()},this),this._sceneEventHandler.addEventListener(8,({resetCamera:e})=>{this._deselectComponent(e),this._requestRender()},this),this._sceneEventHandler.addEventListener(4,({component:e})=>{"multiselect"===this._sceneEventHandler.getSelectionMode()&&this.cancelSelection(),this._webGl.requestDockingsPreviewWithDrag(e.roomleId),this._cameraControl.lock(),this._requestRender()},this),this._sceneEventHandler.addEventListener(5,({component:e,preview:t})=>{if(t){let i=t;if(this._componentFactory.isPreviewLine(i)){let t=this._components.get(i.parentId);this._webGl.dockComponentWithPosition(i,e.getKernelPosition(t))}else this._componentFactory.isPreview(i)&&this._webGl.dockComponent(i);this._cancelDockings(!t,e,!0,!0)}else{let t=this._sceneEventHandler.isDragIn()?e:null;this._cancelDockings(this._sceneEventHandler.isDragIn(),t,!1,!0)}this._cameraControl.unlock(),this._requestRender(!0)},this),this._sceneEventHandler.addEventListener(6,({preview:e})=>{if(this._componentFactory.isPreview(e)){if(this._componentFactory.isPreviewLine(e)){let t=this._components.get(e.parentId);this._webGl.dockComponentWithPosition(e,e.getKernelPosition(t))}else this._webGl.dockComponent(e);this._cancelDockings(!1,null,0===this._previews.size,!1),this._webGl.requestDockingsPreview(!1),this._requestRender()}},this),this._cameraControl.addEventListener(0,()=>{this._addonHelper&&this._addonHelper.setState(1),this._requestRender()},this),this._cameraControl.addEventListener(1,()=>{this._requestRender()},this),this._cameraControl.addEventListener(2,()=>{this._addonHelper&&this._addonHelper.setState(2),this._requestRender()},this),this._cameraControl.addEventListener(5,({minZoom:e,maxZoom:t})=>{this._webGl.onZoomChanged(e,t)},this),D.isProduction||(window.__RML__DEBUG__.SceneHelper=this)}stopRenderLoop(){this._running=!1}_onHoverOn(e,t){2!==t&&this._highlight(e),this._dimensionHelper.onHover(2===t)}_onHoverOff(e){2!==e&&this._highlight(null),this._dimensionHelper.disableDimensions()}_highlight(e){let t=window.__RML__ENV__.initData.meshSelection,i=[];this._outlinePass.selectedObjects.forEach(e=>{e.visible=!0}),e&&(t?i.push(...e.meshes):e.boundingBoxMesh&&i.push(e.boundingBoxMesh)),this._sceneEventHandler.getSelectedRuntimeComponentIds().forEach(e=>{let n=this._components.get(e);n&&(t?i.push(...n.meshes):n.boundingBoxMesh&&i.push(n.boundingBoxMesh))}),this._pixotron?(this._pixotron.getHighLightPass()&&!this._pixotron.getHighLightPass().set&&(this._outlinePass=this._pixotron.getHighLightPass(),this._pixotron.getHighLightPass().visibleEdgeColor=new THREE.Color(g().SELECTION),this._pixotron.getHighLightPass().hiddenEdgeColor=new THREE.Color(g().SELECTION),this._pixotron.getHighLightPass().edgeStrength=3,this._pixotron.getHighLightPass().edgeThickness=1,this._pixotron.getHighLightPass().edgeGlow=0,this._pixotron.getHighLightPass().set=!0),this._pixotron.highlightObjects(i)):this._outlinePass.selectedObjects=i}_requestRender(e){this._pixotron&&(this._pixotron.needsUpdate=!0,e&&(this._forceRender=!0));const t=()=>{if(this._delta=this._clock.getDelta(),this._animateCamera(),this._camera.layers.mask=65535,this._statsHelper&&this._statsHelper.update(this._renderer.info),this._pixotron){this._forceRender&&(this._pixotron.autoShadowsClear=!0,this._pixotron.autoSAOClear=!0),this._checkLayers(),this._pixotron.render(this._renderer,this._scene,this._camera,this._renderTarget),this._forceRender=!1,this._pixotron.blit(),this._renderer.clearDepth();let e=this._renderer.autoClear;this._renderer.autoClear=!1,this._renderer.render(this._uiScene,this._camera),this._renderer.autoClear=e}else this._renderer.clear(),this._checkLayers(),this._composer.render(),this._renderer.clearDepth(),this._renderer.render(this._uiScene,this._camera),this._renderer.clearDepth();this._addonHelper&&this._addonHelper.update(),window.TWEEN&&TWEEN.update(),this._addonHelper&&this._lastChange+1500<Date.now()&&this._addonHelper.isAddOnSpotVisible()&&this._addonHelper.setState(4),this._lastChange+He<Date.now()?this._running=!1:(this._running=!0,requestAnimationFrame(t)),this._shadowDirty&&!this._pixotron&&this._updateShadow()};if(this._lastChange=Date.now(),!this._running){if(this._running=!0,this._addonHelper&&!this._addonHelper.isAddOnSpotVisible()){let e=this._previews.size>0?5:3;this._addonHelper.setState(e)}requestAnimationFrame(t)}}_checkLayers(){this._dimensionHelper.areDimensionsEnabled()&&!this._sceneEventHandler.hasSelection()&&0===this._previews.size&&"multiselect"!==this._sceneEventHandler.getSelectionMode()||this._dimensionHelper.forceDimensions?(this._dimensionHelper.update(),this._camera.layers.enable(6),this._camera.layers.disable(5)):(this._camera.layers.disable(6),this._camera.layers.enable(5)),this._addonHelper&&this._addonHelper.isAddOnSpotVisible()?(this._camera.layers.enable(7),this._eventHandler.dispatch(76)):(this._camera.layers.disable(7),this._eventHandler.dispatch(77))}_animateCamera(){this._cameraControl&&(this._cameraControl.animateCamera(this._delta)?(this._lightSetting instanceof le&&this._lightSetting.update(this._camera,this._cameraControl.getTargetPosition()),this._pixotron&&(this._pixotron.needsUpdate=!0),this._dimensionHelper.forceDimensions=!1):!this._pixotron||this._sceneEventHandler.isDragging()||this._forceRender||(this._pixotron.autoShadowsClear=!1,this._pixotron.autoSAOClear=!1)),this._environment.needsCamera()&&this._environment.updateCamera(this._camera)}_cancelDockings(e,t,i,n){e&&(this._sceneEventHandler.setDragIn(!1),this._removeComponent(t)),this._removePreviews(i),n&&this._webGl.onRemovePreviews(i),this._addonHelper&&this._addonHelper.setState(3)}_removePreviews(e){this._previews.size>0&&(this._previews.forEach(e=>{e.removeFromParent(),e.removeAllMeshes()}),this._previews.clear(),e&&this._cameraControl.updateToBounds(this._webGl.context.planObjectBounds,this._renderer.getSize().width,this._renderer.getSize().height,!0))}_setupScene(e){let t=this._domHelper.getClientDimensions(),i=t.x,n=t.y;this._scene=new THREE.Scene,this._scene.background=new THREE.Color(g().DEFAULT_BACKGROUND),this._uiScene=new THREE.Scene,this._componentFactory=O(),this._camera=this._componentFactory.createCamera(30,i/n,.1,20,this._domHelper.element,e),this._camera.position.copy(new THREE.Vector3(0,.5,5)),this._dimensionHelper=new ee(this._camera,this._unitFormatter),this._uiIntersectionHelper=new he(this._camera),this._uiIntersectionHelper.canvasOffset=e,this._uiIntersectionHelper.addEventListener(0,e=>{this._webGl.onUiIntersectionChange(e)},this),this._camera.layers.set(3),this._camera.layers.enable(1),this._camera.layers.enable(2),this._camera.layers.enable(5),this._camera.layers.enable(4),this._shadowRenderer=new THREE.WebGLRenderer;let o={format:THREE.RGBAFormat,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};this._renderTarget=new THREE.WebGLRenderTarget(i*this._devicePixelRatio,n*this._devicePixelRatio,o),this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this._renderer.setPixelRatio(this._devicePixelRatio),this._renderer.setSize(i,n),this._renderer.gammaOutput=!0,this._renderer.gammaInput=!0,this._renderer.autoClear=!1,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=THREE.BasicShadowMap,this._maxAnisotrophy=this._renderer.capabilities.getMaxAnisotropy(),this._renderer.domElement.classList.add(E.HSC),this._domHelper.element.appendChild(this._renderer.domElement),this._configuratorInputManager.addEvents(this._renderer.domElement),this._lightSetting=new z(this._scene),(new THREE.TextureLoader).setPath(s());let r=new THREE.CubeTextureLoader;r.setPath(s()),this._texture=r.load(["static/textures/blurred/px.png","static/textures/blurred/nx.png","static/textures/blurred/py.png","static/textures/blurred/ny.png","static/textures/blurred/pz.png","static/textures/blurred/nz.png"]),this._texture.wrapS=THREE.RepeatWrapping,this._texture.wrapT=THREE.RepeatWrapping,this._texture.generateMipmaps=!0,this._composer=new THREE.EffectComposer(this._renderer);let a=new THREE.RenderPass(this._scene,this._camera,null,new THREE.Color(g().DEFAULT_BACKGROUND),0);this._composer.addPass(a),this._outlinePass=new THREE.OutlinePass(new THREE.Vector2(window.innerWidth,window.innerHeight),this._scene,this._camera),this._outlinePass.renderToScreen=!0,this._outlinePass.visibleEdgeColor=new THREE.Color(g().SELECTION),this._outlinePass.hiddenEdgeColor=new THREE.Color(g().SELECTION),this._outlinePass.edgeStrength=3,this._outlinePass.edgeThickness=1,this._outlinePass.edgeGlow=0,this._composer.addPass(this._outlinePass),this._composer.setSize(i,n),this._requestRender(),ye=this._onWindowResize.bind(this),Te=this._onKeyDown.bind(this),window.addEventListener("resize",ye,!1),window.addEventListener("keydown",Te,!1),document.addEventListener("visibilitychange",this._tabVisible.bind(this)),this._environment=new _e(this._scene),window.__RML__ENV__.initData.enableHD||this._environment.loadBackground(s()+"static/geometry/PhotoStudioRoom.glb")}_tabVisible(){this._requestRender(!0)}addMesh(e,t,i,n,s,o,r,a){let h=this._components.get(e);if(!h&&!(h=this._previews.get(e.toString())))return;let l=this._configuratorMeshGenerator.generateMesh(t,s,o,r,a);h.addMesh(l,n),this._componentFactory.isPreview(h)?(l.layers.set(4),h.changeMaterialOfMesh(l.id,this._previewMaterial.clone())):(l.layers.set(3),this.waitingForMaterials.push(this._assignMaterial(h,l.id,i)))}addComponent(e,t,i,n,s){let o=null;this._components.has(e)?(o=this._components.get(e)).removeAllMeshes():(s&&this._components.size>0&&console.error("something is wrong, try creating new root component while "+this._components.size+" currently exists"),(o=this._componentFactory.create(e,t,i,n)).layers.set(3)),this._components.set(e,o),s&&(o.roomlePosition=t,this._sceneEventHandler.setRootComponentId(e),this._display(o))}addPreview(e,t){let i=this._componentFactory.createPreview(t,e);this._previews.set(t.toString(),i)}setPreviewAssociations(e,t){let i=this._previews.get(e.toString());if(!i)return;let n=this._components.get(this._webGl.context.rootComponentId);for(let e=0;e<t.length;e++){let s;0===e?s=i:(s=i.clonePreview(e),this._previews.set(s.stringId,s)),s.parentDockId=t[e].parentDockId,s.parentId=t[e].parentId,s.childDockId=t[e].childDockId,s.childId=t[e].childId,s.preparePreview(),s.receivedPointAssociation=!0,n.add(s),s.roomlePosition=t[e].position,s.roomleRotation=t[e].rotation}}setPreviewLineAssociations(e,t){let i=this._previews.get(e.toString());if(!i)return;let n=this._componentFactory.createPreviewLine(i),s=this._components.get(this._webGl.context.rootComponentId);for(let e=0;e<t.length;e++){let i;(i=0===e?n:n.clonePreviewLine(e)).parentDockId=t[e].parentDockId,i.parentId=t[e].parentId,i.childDockId=t[e].childDockId,i.childId=t[e].childId,i.roomleRotation=t[e].rotation,i.roomlePosition=t[e].position,t[e].lineFrom.x>t[e].lineTo.x||t[e].lineFrom.y>t[e].lineTo.y||t[e].lineFrom.z>t[e].lineTo.z?(i.roomleLineFrom=t[e].lineTo,i.roomleLineTo=t[e].lineFrom):(i.roomleLineFrom=t[e].lineFrom,i.roomleLineTo=t[e].lineTo),t[e].positionFrom.x>t[e].positionTo.x||t[e].positionFrom.y>t[e].positionTo.y||t[e].positionFrom.z>t[e].positionTo.z?(i.roomlePositionFrom=t[e].positionTo,i.roomlePositionTo=t[e].positionFrom):(i.roomlePositionFrom=t[e].positionFrom,i.roomlePositionTo=t[e].positionTo),s.add(i),i.preparePreview(),this._previews.set(i.stringId,i)}}updateComponent(e,t){let i=this._components.get(e);if(i||(i=this._previews.get(e.toString()))){if(e===this._webGl.context.rootComponentId){let e=new THREE.Vector3(t.position.x/1e3,t.position.z/1e3,t.position.y/-1e3);this._sceneEventHandler.update(null,e,null)}if(i.roomlePosition=t.position,i.roomleRotation=t.rotation,t.boxForMeasurement&&i.computeBoundingBox(t.boxForMeasurement),this._addonHelper&&i&&t.addOnSpots){let e=this._components.get(this._webGl.context.rootComponentId);this._addonHelper.addAddOnSpots(e,i,t.addOnSpots)}this._requestRender(!0)}}deleteComponent(e){const t=this._components.get(e);t&&(this._addonHelper&&this._addonHelper.deleteAddonPointsForComponent(t.roomleId),t.removeFromParent(),t.removeAllMeshes(),this._components.delete(e),-1===this._sceneEventHandler.getSelectedRuntimeComponentIds().indexOf(e)&&"multiselect"!==this._sceneEventHandler.getSelectionMode()||this.cancelSelection())}sceneCleared(){this._internalClearScene()}componentConstructionBegin(e){let t=this._components.get(e);t&&t.removeAllMeshes()}componentConstructionDone(e,t){let i=this._components.get(e);i&&(i.computeBoundingBox(t.boxForMeasurement),i.boundingBoxMesh&&this._sceneEventHandler.addComponentHandlers(i));let n=this._previews.get(e.toString());n&&n.computeBoundingBox(t.boxForMeasurement,!0)}configurationLoaded(e,t,i){this._environment&&this._environment.reload();let n=this._components.get(t);n&&(n.computeBoundingBox(i.boxForMeasurement),n.boundingBoxMesh&&t!==this._webGl.context.rootComponentId&&this._components.get(this._webGl.context.rootComponentId)&&!this._components.get(this._webGl.context.rootComponentId).isChild(t)&&(this._scene.add(n),this._requestRender(),n.position.copy(new THREE.Vector3(0,0,-100)),this._sceneEventHandler.addComponentDragInHandler(n)))}componentGeometryNotReady(e){let t;this._components.has(e)&&(t=this._components.get(e)).loading()}_display(e){this._scene.add(e),this._requestRender()}_removeComponent(e){this._webGl.context.lastConfigurationLoadedComponentId!==this._webGl.context.rootComponentId&&this._webGl.requestDeleteComponent(),e&&(this._scene.remove(e),this._components.delete(e.roomleId),e.removeAllMeshes())}debugSceneGraph(e){e?this._components.has(e)?this._components.get(e):this._previews.has(e.toString())&&this._previews.get(e.toString()):(this._webGl.context,this._printObjectGraph(this._scene,""))}debugScene(){return this._scene}_printObjectGraph(e,t){e.type,e.id,e.roomleId,e.children.length>0&&e.children.forEach(e=>{let i=t+"    ";this._printObjectGraph(e,i)})}dockComponent(e,t,i,n){let s=this._components.get(t),o=this._components.get(e);o&&(o.roomlePosition=i,o.roomleRotation=n,s&&s.add(o))}_assignMaterial(e,t,i){return new Promise((n,s)=>""===i?(console.error(N.NO_MATERIAL_ID),void this._errorHandler.softReject(()=>n(),N.NO_MATERIAL_ID,2)):this._materialCache.has(i)?(e.changeMaterialOfMesh(t,this._materialCache.get(i)),this._requestRender(),void n()):void this._webGl.requestMaterial(i).then(s=>{let o=m(s,this._texture);this._webGl.requestTextures(s).then(s=>{if(s.length>0){let r=[];s.forEach(e=>{r.push(p(this._dataSyncer.requestAsset(e.image,!0),e,o,this._maxAnisotrophy,1/(0===e.mmWidth?1:e.mmWidth),1/(0===e.mmHeight?1:e.mmHeight)))}),Promise.all(r).then(()=>{this._materialCache.set(i,o),e.changeMaterialOfMesh(t,o),this._requestRender(),setTimeout(()=>n(),0)})}}),(!s.textures||s.textures&&0===s.textures.length)&&(this._materialCache.set(i,o),e.changeMaterialOfMesh(t,o),setTimeout(()=>n(),0)),this._requestRender()},s))}clearScene(){this._internalClearScene()}planObjectUpdate(e,t){if(this._webGl.context.planObjectId===e.id){let i=new THREE.Vector3(e.bounds.x/1e3,e.bounds.z/1e3,e.bounds.y/1e3);this._planObjectBounds=i,this._shadowDirty=!0,t&&(this._webGl.context.planObjectBounds=i,0!==this._previews.size||this._sceneEventHandler.hasSelection()||this._cameraControl.updateToBounds(this._webGl.context.planObjectBounds,this._renderer.getSize().width,this._renderer.getSize().height,!1,!1),this._dimensionHelper.updateBounds(e.boxForMeasurement),this._sceneEventHandler.update(i,null,null),this._uiIntersectionHelper.updateToBounds(i,this._domHelper.element.clientWidth,this._domHelper.element.clientHeight),this._environment.needsBounds()&&this._environment.updateBounds(i),this._camera.updateProjectionMatrix())}this._requestRender()}planObjectConstructionDone(e){this._dimensionHelper.onLoaded(()=>{this._dimensionHelper.addToScene(this._scene,this._uiScene)}),this._dimensionHelper.onDimensionsVisibilityChanged(e=>{e&&this._requestRender(!0),this._webGl.onDimensionsVisibilityChange(e)})}_internalClearScene(){this._scene.children.forEach(e=>{"Object3D"!==e.type&&"Mesh"!==e.type&&"Line"!==e.type||this._scene.remove(e)}),this._uiScene.children.forEach(e=>{this._uiScene.remove(e)}),this._components.forEach(function(e){e.removeFromParent(),e.removeAllMeshes()}),this._components.clear(),this._previews.forEach(e=>{e.removeFromParent(),e.removeAllMeshes()}),this._previews.clear(),this._shadow&&(this._scene.remove(this._shadow),this._shadow=null),this._memoryManager.shouldHardReset()&&(this._dimensionHelper.clear(),this._dimensionHelper=new ee(this._camera,this._unitFormatter),this._configuratorMeshGenerator.clear(),this._materialCache.forEach(e=>e.dispose()),this._materialCache.clear(),this._renderer.renderLists.dispose(),this._memoryManager.executedHardReset()),this._dimensionHelper.disableDimensions(),this._requestRender(!0)}_updateShadow(){THREE.DepthShadowGenerator&&(this._shadow&&this._scene.remove(this._shadow),this._shadow=THREE.DepthShadowGenerator.createShadowPlane(this._shadowRenderer,this._scene,this._planObjectBounds,3),this._shadow.layers.set(2),this._scene.add(this._shadow),this._shadowDirty=!1,this._requestRender())}previewConstructionDone(e,t){let i=!1;this._previews.forEach(e=>{null!==e.parent&&(this._componentFactory.isPreviewLine(e)?this._sceneEventHandler.addPreviewLineHandlers(e):this._sceneEventHandler.addPreviewHandlers(e),i=!0)}),i||(this._cancelDockings(!0,null,!1,!1),this._webGl.context.requestPreviewsIsUserInitiated&&this._webGl.notifyNoPreviews());let n=this._calculateBoundingBoxOfAllMeshes(this._components.get(this._webGl.context.rootComponentId));this._cameraControl.updateToBounds(n.bounds,this._renderer.getSize().width,this._renderer.getSize().height,!0),this._environment&&this._environment.needsBounds()&&this._environment.updateBounds(n.bounds)}preparePerspectiveImage(){return new Promise((e,t)=>{let i=new THREE.WebGLRenderer({antialias:!0,alpha:!0});i.setPixelRatio(this._devicePixelRatio),i.setSize(1024,1024),i.gammaInput=!0,i.gammaOutput=!0,Promise.all(this.waitingForMaterials).then(()=>{this._cancelDockings(!0,null,!0,!1),this._clearSelectionAndHovers();let t=this._camera.clone(),n=this._scene.fog?this._scene.fog.clone():null,s=this._scene.background?this._scene.background.clone():null;this._scene.background=null,this._scene.fog=null,this._lightSetting.removeFromScene();let o=new z(this._scene);t.layers.disable(2),t.layers.disable(5),this._placeCameraForPerspectiveImage(t,-20,-30),i.render(this._scene,t);let r=i.domElement.toDataURL();t.layers.enable(2),this._scene.background=s,this._scene.fog=n,o.removeFromScene(),this._lightSetting.addToScene(),this._requestRender(),this.waitingForMaterials=[],e({image:r,width:1024,height:1024,blob:null})},t)})}_placeCameraForPerspectiveImage(e,t,i){let n=this._calculateBoundingBoxOfAllMeshes(this._components.get(this._webGl.context.rootComponentId));e.far=1e3,e.fov=15,e.aspect=1,e.position.copy(n.center),e.rotation.set(0,0,0),e.rotateY(v(i)),e.rotateX(v(t)),e.translateZ(3.8*n.diagonal),e.updateProjectionMatrix()}_calculateBoundingBoxOfAllMeshes(e){let t=e.recursiveMeshes(),i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;t.forEach(e=>{e.parent.getWorldPosition(new THREE.Vector3),e.geometry.computeBoundingBox();let t=e.geometry.boundingBox.clone();t.translate(e.getWorldPosition(new THREE.Vector3)),i=Math.min(i,t.min.x),n=Math.min(n,t.min.y),s=Math.min(s,t.min.z),o=Math.max(o,t.max.x),r=Math.max(r,t.max.y),a=Math.max(a,t.max.z)});let h=new THREE.Box3(new THREE.Vector3(i,n,s),new THREE.Vector3(o,r,a)),l=h.getSize(new THREE.Vector3);return{center:h.getCenter(new THREE.Vector3),bounds:l,diagonal:Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2)+Math.pow(l.z,2))}}prepareTopImage(){return new Promise((e,t)=>{let i=new THREE.WebGLRenderer({antialias:!0,alpha:!0});i.gammaInput=!0,i.gammaOutput=!0,Promise.all(this.waitingForMaterials).then(()=>{this._cancelDockings(!0,null,!0,!1),this._clearSelectionAndHovers();let t=this._calculateBoundingBoxOfAllMeshes(this._components.get(this._webGl.context.rootComponentId)),n=new THREE.OrthographicCamera(-t.bounds.x/2,t.bounds.x/2,t.bounds.z/2,-t.bounds.z/2,.5);n.position.copy(t.center),n.rotateX(v(-90)),n.translateZ(t.bounds.y+1),n.far=n.position.y+.5,n.layers.mask=65535;let s=200*t.bounds.x,o=200*t.bounds.z;if(s>4096||o>4096){let e=0;s>4096?e=s/4096:o>4096&&(e=o/4096),s/=e,o/=e}i.setPixelRatio(this._devicePixelRatio),i.setSize(s,o);let r=this._scene.fog?this._scene.fog.clone():null,a=this._scene.background?this._scene.background.clone():null;this._scene.background=null,this._scene.fog=null,this._lightSetting.removeFromScene();let h=new z(this._scene);n.layers.disable(2),n.layers.disable(5),i.render(this._scene,n);let l=i.domElement.toDataURL();n.layers.enable(2),n.layers.enable(5),this._scene.background=a,this._scene.fog=r,h.removeFromScene(),this._lightSetting.addToScene(),this._requestRender(),e({image:l,width:s,height:o,blob:null})})})}enableDragIn(e){this._sceneEventHandler.setDragIn(!0,e),this._requestRender()}_getYRotationOfObject(e){let t=e.getWorldDirection(new THREE.Vector3).clone();t.y=0,.01>t.lengthSq()&&((t=new THREE.Vector3(0,1,0)).applyQuaternion(e.quaternion),t.y=0),t.normalize();let i=Math.asin(t.x);return 0>t.z&&(i=Math.PI-i),0>i&&(i+=2*Math.PI),i}zoomToComponent(e){this._cameraControl.saveState(!1);let t=e.boundingBox.getSize(new THREE.Vector3),i=this._getYRotationOfObject(e),n=new THREE.Euler(0,i,0),s=e.getWorldPosition(new THREE.Vector3).clone().add(e.boundingBox.getCenter(new THREE.Vector3).applyEuler(n));this._cameraControl.zoomTo(t,this._renderer.getSize().width,this._renderer.getSize().height,n.y,v(15),s)}resetCamera(){this._cameraControl.hasSavedState()?this.resetCameraToState():this.resetCameraPositionToStart()}resetCameraToState(){this._cameraControl.resetToState()}resetCameraPositionToStart(){this._requestRender(),this._cameraControl.reset(this._webGl.context.planObjectBounds,this._renderer.getSize().width,this._renderer.getSize().height)}_clearSelectionAndHovers(){this.cancelSelection(),this._components.get(this._webGl.context.rootComponentId).clear(!0)}resetPreviews(){this._previews.forEach(e=>e.removeFromParent()),this._previews.clear(),this._addonHelper&&this._addonHelper.setState(5),this._requestRender()}changeOffset(e){this._camera.offset=e}_onWindowResize(){this.updateSize()}updateSize(){let{x:e,y:t}=this._domHelper.getClientDimensions();this._renderer.setSize(e,t),this._camera.aspect=e/t,this._camera.updateProjectionMatrix(),this._webGl.context.planObjectBounds&&this._cameraControl.updateToBounds(this._webGl.context.planObjectBounds,e,t,!1),this._pixotron&&(this._pixotron.autoShadowsClear=!0,this._pixotron.autoSAOClear=!0,this._forceRender=!0,this._pixotron.setSize(e,t)),this._requestRender(!0)}_onKeyDown(e){(e.key&&("Escape"===e.key||"Esc"===e.key)||27===e.keyCode)&&(this.cancelSelection(),e.preventDefault()),this._sceneEventHandler&&this._sceneEventHandler.hasSelection()&&(e.key&&("Backspace"===e.key||"Delete"===e.key)||8===e.keyCode||46===e.keyCode)&&(this._webGl.requestDeleteSelectedComponent(),e.preventDefault())}cancelPreviousDockings(){this._cancelDockings(!0,null,!1,!1)}cancelSelection(e){(this._sceneEventHandler.hasSelection()||"standard"!==this._sceneEventHandler.getSelectionMode())&&this._cancelSelection(e)}_cancelSelection(e){this._sceneEventHandler.cancelSelection(),this._webGl.context.selectionMode="standard",this._webGl.context.selectedRuntimeComponentIds=[],this._removePreviews(!1),e&&this.resetCamera(),this._webGl.sendCancelSelectionEvent()}_selectComponent(e){this._highlight(e)}_deselectComponent(e){"standard"===this._sceneEventHandler.getSelectionMode()&&(this._cancelSelection(e),this._highlight(null)),"multiselect"===this._sceneEventHandler.getSelectionMode()&&(this._sceneEventHandler.hasSelection()?this._webGl.context.selectedRuntimeComponentIds=this._sceneEventHandler.getSelectedRuntimeComponentIds():(this._cancelSelection(e),this._highlight(null)))}getScreenXY(e){return h(e,this._camera,this._domHelper.element.clientWidth,this._domHelper.element.clientHeight)}cleanUp(){window.removeEventListener("resize",ye,!1),window.removeEventListener("keydown",Te,!1),this.stopRenderLoop()}setSelectionMode(e){this._sceneEventHandler.setSelectionMode(e)}setFloorMaterial(e,t,i,n){return this._environment&&this._environment instanceof we||(this._environment=new we(this._scene,this._environment,!0),this._uiIntersectionHelper.floorEnvironment=!0),new Promise((s,o)=>{this._environment.setFloorMaterial(e,t,i,n).then(()=>{this._requestRender(),s()},o)})}changeFloorMaterial(e){return this._environment&&this._environment instanceof we||(this._environment=new we(this._scene,this._environment,!0),this._uiIntersectionHelper.floorEnvironment=!0),new Promise((t,i)=>{this._environment.changeFloorMaterial(e,this._maxAnisotrophy).then(()=>{this._requestRender(),t()},i)})}enableHD(e){e?this.loadDynamicLightSetting(e):this._lightSetting=new de(this._scene,this._lightSetting),this._environment instanceof _e&&(this._environment.removeFromScene(),this._environment.loadBackground(s()+"static/geometry/PhotoStudioRoom.glb",new THREE.MeshStandardMaterial)),this._renderer.toneMapping=THREE.Uncharted2ToneMapping,this._renderer.toneMappingWhitePoint=6,this._renderer.toneMappingExposure=3;let t={saoparams:{intensity:.25,occlusionWorldRadius:1,smoothTransition:!0,samplesPerFrame:4,bias:.005,numSamples:200,accumulative:!0},shadowparams:{shadowMapResolution:1024,shadowRadius:1,shadowQuality:1,smoothTransition:!0,enableAccumulation:!0,shadowBiasMultiplier:.6,nearPlane:.1,farPlane:20,fov:110,numSamples:50,side:THREE.FrontSide}};this._pixotron=new window.PIXOTRON.Pixotron(t),this._requestRender()}disableHD(){this._pixotron=null,this._lightSetting=new z(this._scene,this._lightSetting)}loadDynamicLightSetting(e){return this._lightSetting=new le(this._scene,this._lightSetting),e.url?this._lightSetting.loadFromURL(e.url):e.json?this._lightSetting.loadFromJSON(e.json):e.object?this._lightSetting.loadFromObject(e.object):new Promise((e,t)=>{t("No dynamic light setting source set")})}exportGLB(){this._scriptLoader.fetch("static/three/lib/exporters/GLTFExporter.js",{id:"gltf-exporter"}).then(()=>{let e=new THREE.GLTFExporter,t=[];this._scene.children.forEach(e=>{"Object3D"!==e.type&&"Mesh"!==e.type||t.push(e)}),e.parse(t,e=>{let t=document.createElement("a");const i=new Blob([e],{type:"model/gltf-binary"});t.href=URL.createObjectURL(i),t.download="scene.glb",t.style.display="none",document.body.appendChild(t),t.click()},{binary:!0,embedImages:!0,forceIndices:!0})})}showGUI(){this._lightSetting&&this._lightSetting.showGUI();let e=d();if(this._pixotron){let t=e.addFolder("Renderer");t.add(this._pixotron.getSAOPass(),"enabled"),t.add(this._pixotron.getSAOPass(),"smoothTransition"),t.add(this._pixotron.getSAOPass(),"occlusionWorldRadius").min(0).max(2).step(.01),t.add(this._pixotron.getSAOPass(),"intensity").min(.1).max(2).step(.05),t.add(this._pixotron.getSAOPass(),"bias").min(-.1).max(.1).step(.001),t.add(this._pixotron.getSAOPass(),"numSamples").min(10).max(3e3).step(10),t.add(this._pixotron.getShadowPass(),"smoothTransition"),t.add(this._pixotron.getShadowPass(),"enableAccumulation"),t.add(this._pixotron.getShadowPass(),"shadowRadius").min(0).max(5).step(.1),t.add(this._pixotron.getShadowPass(),"shadowBiasMultiplier").min(0).max(3).step(.1),t.add(this._pixotron.getShadowPass(),"numSamples").min(10).max(3e3).step(10)}this._environment&&this._environment.showGUI(),this._addGUIListener(e)}_addGUIListener(e){let t=e.__folders;Object.keys(t).forEach((e,i)=>{let n=t[e];n.__folders&&Object.keys(n.__folders).forEach((e,i)=>{let n=t[e];this._addGUIListener(n)}),n.__controllers&&n.__controllers.forEach(e=>{e.onFinishChange(()=>{this._requestRender()})})})}zoomIn(e){this._cameraControl.zoomIn(e),this._requestRender(!0)}zoomOut(e){this._cameraControl.zoomOut(e),this._requestRender(!0)}showStats(){t.import("./stats-helper.nomodule.js").then(e=>this._statsHelper=new e.default)}showDimensions(){this._dimensionHelper.forceDimensions=!0,this._requestRender()}hideDimensions(){this._dimensionHelper.disableDimensions(),this._requestRender()}loadSceneSettings(e){let t=new Promise(t=>{(new fe).load(this._scene,this._renderer.domElement,this._environment,e).then(e=>{this._environment=e,t()})});this._lightSetting=new le(this._scene,this._lightSetting);let i=this._lightSetting.loadFromObject(e);return new Promise((e,n)=>{Promise.all([t,i]).then(()=>{this._requestRender(!0),this._uiIntersectionHelper.floorEnvironment=this._environment instanceof we,e()},n)})}setBackgroundColor(e){this._environment=new Ce(this._scene,this._environment,new THREE.Color(e)),this._requestRender()}setBackgroundImage(e){this._environment=new Ce(this._scene,this._environment,null,this._renderer.domElement,e),this._requestRender()}}i([n],Pe.prototype,"_unitFormatter",void 0),i([n],Pe.prototype,"_domHelper",void 0),i([n],Pe.prototype,"_webGl",void 0),i([n],Pe.prototype,"_scriptLoader",void 0),i([n],Pe.prototype,"_configuratorInputManager",void 0),i([n],Pe.prototype,"_eventHandler",void 0),i([n],Pe.prototype,"_dataSyncer",void 0),i([n],Pe.prototype,"_errorHandler",void 0),i([n],Pe.prototype,"_configuratorMeshGenerator",void 0),i([n],Pe.prototype,"_memoryManager",void 0);const Se=new Map,xe=function(e,t,i){let n=Se.get(e);if(n){const s=i?[i]:void 0;n.forEach(({resolve:e,reject:i})=>t?e.apply(e,s):i.apply(i,s)),Se.delete(e)}};class Re{static finishOperation(e,t){xe(e,!0,t)}static failOperation(e,t){xe(e,!1,t)}static waitFor(e,t){return new Promise((i,n)=>{let s=Se.get(e);s||(Se.set(e,[]),s=Se.get(e)),s.push({resolve:i,reject:n}),"function"==typeof t&&t.apply(t)})}}class Ie{constructor(){this._needsSync=!1,this._eventHandler.subscribe(0,this._loadWebGlLib.bind(this)),this._eventHandler.subscribe(41,this._planObjectCreate.bind(this)),this._subscribeToKernelEvent(28,this._componentConstructionBegin.bind(this)),this._subscribeToKernelEvent(29,this._createComponent.bind(this)),this._subscribeToKernelEvent(31,this._bakedMeshLoaded.bind(this)),this._subscribeToKernelEvent(32,this._namedMeshLoaded.bind(this)),this._subscribeToKernelEvent(33,this._componentConstructionDone.bind(this)),this._subscribeToKernelEvent(35,this._dockComponent.bind(this)),this._subscribeToKernelEvent(36,this._deleteComponent.bind(this)),this._subscribeToKernelEvent(26,this._sceneCleared.bind(this)),this._subscribeToKernelEvent(30,this._updateComponent.bind(this)),this._subscribeToKernelEvent(40,this._configurationLoaded.bind(this)),this._subscribeToKernelEvent(42,this._planObjectUpdate.bind(this)),this._subscribeToKernelEvent(43,this._planObjectConstructionDone.bind(this)),this._subscribeToKernelEvent(45,this._enableRootComponentParametersAsGlobal.bind(this)),this._subscribeToKernelEvent(46,this._disableRootComponentParametersAsGlobal.bind(this)),this._subscribeToKernelEvent(50,this._createPreview.bind(this)),this._subscribeToKernelEvent(51,this._setPreviewAssociations.bind(this)),this._subscribeToKernelEvent(52,this._setPreviewLineAssociations.bind(this)),this._subscribeToKernelEvent(53,this._previewConstructionDone.bind(this)),this._subscribeToKernelEvent(58,this._notifyOnMaterialFinished.bind(this)),this._subscribeToKernelEvent(34,this._componentGeometryNotReady.bind(this)),this._eventHandler.subscribe(67,this._requestDeleteComponent.bind(this)),this._eventHandler.subscribe(68,this._requestDeleteComponents.bind(this)),this.context=new q,D.isProduction||(window.__RML__DEBUG__.getConfiguration=(()=>({hash:window.__RML__DEBUG__.Kernel.getHashOfPlanComponent(this.context.planObjectId),configuration:window.__RML__DEBUG__.Kernel.getSerializedConfiguration(this.context.planObjectId)})))}_subscribeToKernelEvent(e,t){this._eventHandler.subscribe(e,function(){this._sceneHelper?t.apply(t,arguments):this._needsSync=!0}.bind(this))}_loadWebGlLib(e,t,i){let n=[this._scriptLoader.fetch("static/three/lib/rthree.js",{id:"three-lib"}),this._scriptLoader.fetch("static/three/lib/shaders/CopyShader.js",{id:"copy-shader-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/EffectComposer.js",{id:"effect-composer-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/RenderPass.js",{id:"render-pass-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/ShaderPass.js",{id:"shader-pass-js"}),this._scriptLoader.fetch("static/three/lib/shaders/LuminosityHighPassShader.js",{id:"luminosity-high-pass-shader-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/UnrealBloomPass.js",{id:"unreal-bloom-pass-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/OutlinePass.js",{id:"outline-pass-js"})];Promise.all(n).then(this._loadingSuccess(e,t,i).bind(this),this._loadingError.bind(this))}_loadingError(){this._eventHandler.dispatch(2)}_loadingSuccess(e,t,i){return()=>{this._eventHandler.dispatch(1),this._sceneHelper=i||new Pe(this._updatedOffset?this._updatedOffset:t);const{initialFloorMaterial:n,enableHD:s,dls:o,ls:r,stats:a}=window.__RML__ENV__.initData,h=void 0===s?D.features.hdEnabledByDefault:s;let l=f.createDynamicLightSettingSource(o,r);h?this.enableHD(l):window.__RML__ENV__.initData.retina=!0,a&&this.showStats(),this._needsSync&&(this._needsSync=!1,this._eventHandler.dispatch(60,[this.context.lastConversationId,this.context.planObjectId]));const d=[this._scriptLoader.fetch("static/three/Tween.js",{id:"tween-js"})];n&&d.push(this._rapiAccess.getMaterial(n).then(e=>this._sceneHelper.changeFloorMaterial(e))),Promise.all(d).then(this._loadingControlsSuccess(e).bind(this),this._loadingControlsError.bind(this))}}_loadingControlsSuccess(e){return()=>{this._eventHandler.dispatch(3)}}_loadingControlsError(){this._eventHandler.dispatch(4)}_createComponent(e,t,i,n,s){s&&(this.context.rootComponentId=e),this._sceneHelper.addComponent(e,t,i,n,s)}_bakedMeshLoaded(e,t,i,n,s,o){this._sceneHelper.addMesh(e,null,t,null,i,n,s,o)}_namedMeshLoaded(e,t,i,n,s,o,r,a){this._sceneHelper.addMesh(e,t,i,n,s,o,r,a)}_componentConstructionBegin(e){this._sceneHelper.componentConstructionBegin(e)}_componentConstructionDone(e,t){this._sceneHelper.componentConstructionDone(e,t)}_componentGeometryNotReady(e){this._sceneHelper.componentGeometryNotReady(e)}_dockComponent(e,t,i,n){this._sceneHelper.dockComponent(e,t,i,n)}_updateComponent(e,t){this._sceneHelper.updateComponent(e,t)}_deleteComponent(e){this._sceneHelper.deleteComponent(e)}_sceneCleared(){this.context.selectedRuntimeComponentIds=[],this._sceneHelper.sceneCleared()}_createPreview(e,t){this._sceneHelper.addPreview(e,t)}_setPreviewAssociations(e,t){this._sceneHelper.setPreviewAssociations(e,t)}_setPreviewLineAssociations(e,t){this._sceneHelper.setPreviewLineAssociations(e,t)}_previewConstructionDone(e,t){this._sceneHelper.previewConstructionDone(e,t)}clearScene(){this._sceneHelper&&this._sceneHelper.clearScene()}_planObjectCreate(e,t){this.context.planObjectId=t,this.context.lastConversationId=e,this._sceneHelper?(this._sceneHelper.clearScene(),this._sceneHelper.waitingForMaterials.push(Re.waitFor(2))):this._needsSync=!0}_planObjectUpdate(e,t){this._sceneHelper.planObjectUpdate(e,t)}_planObjectConstructionDone(e){this._sceneHelper.planObjectUpdate(e,!0),this._sceneHelper.planObjectConstructionDone(e),this._sceneHelper.resetCameraPositionToStart()}_enableRootComponentParametersAsGlobal(){this.context.selectedRuntimeComponentId||(this.context.rootComponentParametersAsGlobal=!0)}_disableRootComponentParametersAsGlobal(){this.context.rootComponentParametersAsGlobal=!1}_requestDeleteComponent(e){this._sceneHelper.resetCamera()}_requestDeleteComponents(e){this._sceneHelper.resetCamera()}_configurationLoaded(e,t,i){this.context.lastConfigurationLoadedComponentId=t,this._sceneHelper.configurationLoaded(e,t,i)}_notifyOnMaterialFinished(e,t){Promise.all(this._sceneHelper.waitingForMaterials).then(e,t)}onSelectedRuntimeComponentChange(e){let t=!1,i=null;e&&(t=e.roomleId===this.context.rootComponentId,i=e.roomleId),this._eventHandler.dispatch(11,[i,t,this.context.selectionMode]),e&&(this._eventHandler.dispatch(9,[e.roomleId]),this._sceneHelper.zoomToComponent(e))}onSelectedRuntimeComponentsChange(e){this._eventHandler.dispatch(12,[e,this.context.rootComponentId])}debugSceneGraph(e){this._sceneHelper.debugSceneGraph(e)}requestMaterial(e){return this._rapiAccess.getMaterial(e)}requestTextures(e){return this._rapiAccess.getTexturesOf(e)}requestDockingsPreview(e,t,i,n){e&&this._sceneHelper.cancelPreviousDockings(),this.cancelSelection(),n&&this._sceneHelper.enableDragIn(i),t&&(this.context.lastPossibleChild=t),this.context.requestPreviewsIsUserInitiated=e,this._sceneHelper.resetPreviews(),this._eventHandler.dispatch(13,[this.context,n])}dockComponent(e){const t=C.start("dock_component_"+e.childId);this._eventHandler.dispatch(6,[e.parentId,e.parentDockId,e.childId,e.childDockId]),this.context.lastConfigurationLoadedComponentId=null,C.end(t)}dockComponentWithPosition(e,t){const i=C.start("dock_component_with_position_"+e.childId);this._eventHandler.dispatch(7,[e.parentId,e.parentDockId,e.childId,e.childDockId,t]),this.context.lastConfigurationLoadedComponentId=null,C.end(i)}requestDockingsPreviewWithDrag(e){this._sceneHelper.cancelPreviousDockings(),this.context.rootComponentId!==e&&(this._sceneHelper.resetPreviews(),this._eventHandler.dispatch(14,[e,this.context]))}preparePerspectiveImage(){return this._sceneHelper.preparePerspectiveImage()}prepareTopImage(){return this._sceneHelper.prepareTopImage()}resetCameraPosition(){this._sceneHelper.resetCameraPositionToStart()}changeOffset(e){this._sceneHelper?this._sceneHelper.changeOffset(e):this._updatedOffset=e}cancelSelection(){this._sceneHelper.cancelSelection()}sendCancelSelectionEvent(){this._eventHandler.dispatch(10,[this.context.planObjectId])}notifyNoPreviews(){this._eventHandler.dispatch(15)}enableHD(e){return new Promise((t,i)=>{const n=this._scriptLoader,s=()=>{this._sceneHelper.enableHD(e),t()};Promise.all([n.fetch("static/three/lib/lights/RectAreaLightUniformsLib.js",{id:"rect-area-light-uniforms-lib-js"})]).then(()=>{n.fetch("static/three/pixotron.min.js",{id:"pixotron-js"}).then(s,i)},i)})}disableHD(){return new Promise(e=>{this._sceneHelper.disableHD(),e()})}enableMultiselect(){this._sceneHelper.setSelectionMode("multiselect"),this.context.selectionMode="multiselect"}disableMultiselect(){this._sceneHelper.setSelectionMode("standard"),this.context.selectionMode="standard"}requestDeleteComponent(){this.context.lastConfigurationLoadedComponentId&&this._eventHandler.dispatch(8,[this.context.lastConfigurationLoadedComponentId]),this.context.lastConfigurationLoadedComponentId=null}requestDeleteSelectedComponent(){switch(this.context.selectionMode){case"standard":this._eventHandler.dispatch(67,[this.context.selectedRuntimeComponentId]);break;case"multiselect":this._eventHandler.dispatch(68,[this.context.selectedRuntimeComponentIds])}}onUiIntersectionChange(e){this._eventHandler.dispatch(17,[e])}onDimensionsVisibilityChange(e){this._eventHandler.dispatch(19,[e])}onRemovePreviews(e){this._eventHandler.dispatch(20,[e])}cleanUp(){this._sceneHelper.cleanUp()}openAddOns(){this._eventHandler.dispatch(21)}clickOutside(){this._eventHandler.dispatch(22)}setFloorMaterial(e,t,i,n){return this._sceneHelper.setFloorMaterial(e,t,i,n)}changeFloorMaterial(e){return this._sceneHelper.changeFloorMaterial(e)}showGUI(){const e=document.createElement("style");e.innerText=".dg.ac {right:auto!important}",document.head.appendChild(e),this._scriptLoader.fetch("three/dat.gui.min.js",{id:"dat-gui-js"}).then(()=>this._sceneHelper.showGUI(),e=>console.error(e))}showStats(){this._sceneHelper.showStats()}stopRenderLoop(){this._sceneHelper.stopRenderLoop()}showDimensions(){this._sceneHelper.showDimensions()}hideDimensions(){this._sceneHelper.hideDimensions()}loadDynamicLightSetting(e){return this._sceneHelper.loadDynamicLightSetting(e)}loadSceneSettings(e){return this._sceneHelper.loadSceneSettings(e)}setBackgroundColor(e){this._sceneHelper.setBackgroundColor(e)}setBackgroundImage(e){this._sceneHelper.setBackgroundImage(e)}updateSize(){this._sceneHelper.updateSize()}zoomIn(e){this._sceneHelper.zoomIn(e)}zoomOut(e){this._sceneHelper.zoomOut(e)}onZoomChanged(e=!1,t=!1){this._eventHandler.dispatch(18,[e,t])}}i([n],Ie.prototype,"_scriptLoader",void 0),i([n],Ie.prototype,"_eventHandler",void 0),i([n],Ie.prototype,"_rapiAccess",void 0),i([n],Ie.prototype,"_memoryManager",void 0);const Le=function(e){return e.validRange&&"string"==typeof e.validRange.type},Me=function(e){return e.validValues&&e.validValues.length>0},ke=function(e){return"length"===e.unitType||"area"===e.unitType},Oe=function(e){return"Material"===e.type};let De={InchFeet:null,MM:null,CM:null},Ge={NoUnitString:null,LongUnitString:null,ShortUnitString:null};const Ae="mm",Fe="cm",Ue="'",Ve="ft",Be='"',je="inch",ze="m²",qe="sqft";class Ne{static sort(e,t){return e.sort||t.sort?e.sort?t.sort?e.sort-t.sort:-1:1:0}}class We{constructor(){this._isKernelReady=!1,this._isLoadError=!1,this._waitingForPreload=!1,this._waitingForWebGlLib=!0,this._isReloading=!1;const e=this._eventHandler;e.subscribe(25,this._kernelIsReady.bind(this)),e.subscribe(2,this._loadError.bind(this)),e.subscribe(24,this._loadError.bind(this)),e.subscribe(39,this._updateCommonComponentParameters.bind(this)),e.subscribe(37,this._updateComponentParameters.bind(this)),e.subscribe(44,this._updatePlanObjectParameters.bind(this)),e.subscribe(47,this._updatePlanComponentPossibleChildren.bind(this)),e.subscribe(48,this._updatePlanObjectPossibleChildren.bind(this)),e.subscribe(49,(e,t)=>this._configuratorUiCallbacks.onUpdatePrice(e,t)),e.subscribe(42,this._updatePlanObject.bind(this)),e.subscribe(54,(e,t,i,n)=>this._configuratorUiCallbacks.onSelectionChange(e,t,i,n)),e.subscribe(55,this._partListUpdate.bind(this)),e.subscribe(15,()=>this._configuratorUiCallbacks.onNoDockingsAvailable()),e.subscribe(10,()=>this._configuratorUiCallbacks.onSelectionCancel()),e.subscribe(17,e=>this._configuratorUiCallbacks.onUiIntersectionChange(e)),e.subscribe(19,e=>this._configuratorUiCallbacks.onDimensionsVisibilityChange(e)),e.subscribe(20,this._onRemovedPreviews.bind(this)),e.subscribe(56,e=>this._configuratorUiCallbacks.onConfigurationHasChildren(e)),e.subscribe(1,this._webglLibLoaded.bind(this)),e.subscribe(59,()=>this._configuratorUiCallbacks.onUserInitiatedDockDone()),e.subscribe(21,()=>this._configuratorUiCallbacks.onOpenAddOns()),e.subscribe(22,()=>this._configuratorUiCallbacks.onClickOutside()),e.subscribe(74,()=>this._configuratorUiCallbacks.onAddonPlusHover()),e.subscribe(76,()=>this._configuratorUiCallbacks.onAddonPlusShown()),e.subscribe(38,e=>this._configuratorUiCallbacks.onComponentLoadError(e)),e.subscribe(62,()=>this._configuratorUiCallbacks.onMemoryCorruption()),e.subscribe(18,(e,t)=>this._configuratorUiCallbacks.onZoomChange(e,t)),e.subscribe(79,()=>this._configuratorUiCallbacks.onSyncStarted()),e.subscribe(80,()=>this._configuratorUiCallbacks.onSyncDone());const t=this._errorHandler;t.subscribe(0,e=>this._configuratorUiCallbacks.onErrorDueToOffline(e)),t.subscribe(1,e=>this._configuratorUiCallbacks.onError(e)),t.subscribe(2,(e,t)=>this._configuratorUiCallbacks.onContentProblem({rapiPath:e,ids:t})),window.RoomleConfigurator=this}get _waitingForDependencies(){return this._waitingForPreload||this._waitingForWebGlLib}_loadError(){this._isLoadError=!0,this._rejectOnLoadError&&this._rejectOnLoadError()}_webglLibLoaded(){this._waitingForWebGlLib=!1,this._notifyDependenciesWaiter()}_initPromiseCallback(e,t){this._isKernelReady?e():this._isLoadError?t():(this._resolveOnInitDone=e,this._rejectOnLoadError=t)}_notifyOnConfigurationReady(e){return t=>{e(t.partList),this._configuratorUiCallbacks.onConfigurationReady(t.partList,t.hash,t.rootComponentLabel)}}_notifyOnConfigurationLoadingError(e){return()=>{this._configuratorUiCallbacks.onConfigurationLoadError()}}_loadItemOrConfigById(e,t,i=null){this._webGl.context.lastLoadedRapiId=e,this._onLoadConfiguration(),this.setOverrides(i),i?i.id=e:i={id:e},this._preloadPackage(e),this._webGl.clearScene();const{offlineSync:n}=window.__RML__ENV__.initData;if(n){const t=G(e);t&&this._dataSyncer.start(t)}return new Promise((n,s)=>{(t?this._rapiAccess.getConfiguration(e):this._rapiAccess.getItem(e)).then(t=>{t&&t.configuration?this._loadConfiguration(t.configuration,i).then(e=>{const i=this._notifyOnConfigurationReady(n);t.label?this._notifyUiAboutNewItem(t,e.rootComponentLabel):this._notifyUiAboutNewConfiguration(t),i(e)},this._notifyOnConfigurationLoadingError(s).bind(this)):s(new Error("Could not load item or config with id "+e))},s)})}_updateCommonComponentParameters(e,t,i){this._updateParameters(e,i,t,2)}_updatePlanObjectParameters(e,t,i){this._updateParameters(t,i,e,0)}_updateComponentParameters(e,t,i){this._updateParameters(t,i,e,1)}_updatePlanComponentPossibleChildren(e,t){this._updatePossibleChildren(e,t,1)}_updatePlanObjectPossibleChildren(e,t){this._updatePossibleChildren(e,t,0)}_shouldBroadcastToUi(e){return!(0===e&&this._webGl.context.selectedRuntimeComponentId||1===e&&!this._webGl.context.selectedRuntimeComponentId||2===e&&!this._webGl.context.selectedRuntimeComponentIds.length)}_isCorrectResponse(e,t){if(0===e)return t===this._webGl.context.planObjectId;if(1===e)return t===this._webGl.context.selectedRuntimeComponentId;const i=t.length;if(i!==this._webGl.context.selectedRuntimeComponentIds.length)return!1;for(let e=0;i>e;e++)if(t[e]!==this._webGl.context.selectedRuntimeComponentIds[e])return!1;return!0}_addUiDataToPartList(e,t){const i=[];return e.forEach(e=>{const t=this._rapiAccess.peekComponent(e.componentId);t&&(e.label=t.label),e.parameters.forEach(e=>{if(this._unitFormatter.formatPartListParameter(e),Oe(e)){const t=this._rapiAccess.peekMaterial(e.value);t?e.valueLabel=t.label||t.name||e.value:-1===i.indexOf(e.value)&&i.push(e.value)}})}),i.length&&this._rapiAccess.getMaterials(i).then(e=>{const i=this._lastPartListHash!==t;Array.isArray(e)&&e.length&&i&&(this._lastPartListHash=t,this._eventHandler.dispatch(73,[this._webGl.context]))}),e}_updatePlanObject(e){if(!e.bounds)return;let t={width:this._unitFormatter.formatMMValueToUnitString(e.bounds.x),height:this._unitFormatter.formatMMValueToUnitString(e.bounds.z),depth:this._unitFormatter.formatMMValueToUnitString(e.bounds.y)};this._configuratorUiCallbacks.onBoundsUpdate(t)}_partListUpdate(e,t){const i=e.fullList;this._addUiDataToPartList(i,t),this._configuratorUiCallbacks.onPartListUpdate(i,t)}_onLoadConfiguration(){this._webGl.clearScene(),this._configuratorUiCallbacks.onLoadConfiguration()}_onRemovedPreviews(e){e&&this._configuratorUiCallbacks.onDockingsPreviewRemoved()}_updatePossibleChildren(e,t,i){const n=[],s=[];let o;for(let e=0,i=t.length;i>e;e++){const i=t[e];if(!i.possible)continue;let r=i.itemId;i.itemId?s.push(i.itemId):(n.push(i.componentId),r=i.componentId),i.isDefault&&!o&&(o=r)}Promise.all([this._rapiAccess.getComponents(n),this._rapiAccess.getItems(s)]).then(e=>{const t=[],i=e[0],n=e[1];let s;for(let e=0,n=i.length;n>e;e++){const n=i[e];n.isItem=!1,n.isComponent=!0,n.id===o&&(n.isDefault=!0,s=n),t.push(n)}for(let e=0,i=n.length;i>e;e++){const i=n[e];i.isItem=!0,i.isComponent=!1,i.id===o&&(i.isDefault=!0,s=i),t.push(i)}return t.sort(Ne.sort),{possibleChildren:t,defaultChild:s||null}}).then(({possibleChildren:e,defaultChild:t})=>{const i=[],n=new Map,s=[];for(let t=0,o=e.length;o>t;t++){const o=e[t],r=o.tags;if(o.tags&&Array.isArray(o.tags)&&o.tags.length)for(let e=0,t=o.tags.length;t>e;e++){const t=r[e];-1===i.indexOf(t)&&i.push(t);let s=n.get(t);if(!s){const e=[];n.set(t,e),s=n.get(t)}s.push(o)}else s.push(o)}return{tagIds:i,associations:n,defaultChild:t,noTagChilds:s}}).then(({tagIds:t,associations:n,defaultChild:s,noTagChilds:o})=>{this._rapiAccess.getTags(t).then(t=>{if(this._isCorrectResponse(i,e)&&this._shouldBroadcastToUi(i)){for(let e=0,i=t.length;i>e;e++){const i=t[e];i.possibleChildren=n.get(i.id)}t.sort(Ne.sort),o.length&&t.unshift({id:"",externalIdentifier:"",global:!1,created:(new Date).toISOString(),updated:(new Date).toISOString(),language:H.actualLocale,catalog:null,tags:[],parents:[],materials:[],items:[],possibleChildren:o}),this._configuratorUiCallbacks.onUpdatePossibleChildren(t,s)}},e=>{console.error("Couldnt load tags of possible children"),console.error(e)})},e=>console.error(e))}_updateParameters(e,t,i,n){const s={};t||(t=[],console.warn("Kernel returned no parameter groups! Check why!")),t.forEach(e=>{s[e.key]=e}),e.sort(Ne.sort),e.forEach(e=>{e.group?e.grouping=s[e.group]:e.grouping=null,this._unitFormatter.formatParameter(e),Oe(e)&&Object.defineProperty(e,"groups",{get:()=>new Promise((t,s)=>{this._getMaterialGroups(e).then(e=>{this._isCorrectResponse(n,i)&&this._shouldBroadcastToUi(n)?t(e):s("Response does not match to ids")},s)})})}),this._shouldBroadcastToUi(n)&&this._configuratorUiCallbacks.onUpdateParameters(e)}_notifyUiAboutNewItem(e,t){this._rapiAccess.getCatalog(e.catalog).then(i=>this._configuratorUiCallbacks.onConfigurationLabelChange(i.name,e.label,t))}_notifyUiAboutNewConfiguration(e){Promise.all([this._rapiAccess.getCatalog(e.catalog),this._rapiAccess.getComponent(e.rootComponentId)]).then(([e,t])=>this._configuratorUiCallbacks.onConfigurationLabelChange(e.name,null,t.label))}_getMaterialGroups(e){const t=(e,t)=>{const i=e.label,n=t.label;if(i&&!n)return 1;if(!i&&n)return-1;if(i&&n)return i.localeCompare(n);const s=e.id,o=t.id;return s&&!o?1:!s&&o?-1:s||o?s.localeCompare(o):0},i=e=>(e.sort(t),e.forEach(e=>e.materials.sort(t)),e);if(e.validGroups.length>0)return new Promise((t,n)=>this._rapiAccess.getMaterialsByGroup(e.validGroups).then(e=>t(i(e)),n));const n=[];return e.validValues.forEach(e=>n.push(e.value)),new Promise((e,t)=>this._rapiAccess.getMaterials(n).then(t=>e(i(this._rapiAccess.combineMaterialsToGroups(t))),t))}_kernelIsReady(){this._isKernelReady=!0;const e=C.getMeasure("kernel_is_ready");if(Array.isArray(e)&&1===e.length){const t=e[0],i=C.getMeta("kernel_is_ready");this._configuratorUiCallbacks.onTrackTiming("Timing","KernelIsReady",Math.round(t.duration),Object.assign(i,{startTime:t.startTime}))}this._resolveOnInitDone&&this._resolveOnInitDone(),this._configuratorUiCallbacks.onKernelIsReady()}_loadConfiguration(e,t){return new Promise((i,n)=>{const s=()=>{C.start("ui_load_configuration");const s=[];if(t.applyCurrentGlobalParameters){const e=this._webGl.context.planObjectId,t=this._webGl.context.rootComponentParametersAsGlobal;s.push(this._eventHandler.request(1,[e,t]))}Promise.all(s).then(([s])=>{Re.waitFor(2).then(([e,n,o,r])=>{const a=[];s&&t.applyCurrentGlobalParameters&&s.forEach(e=>a.push(this.setParameter(e,e.value,!0)));const h=this._rapiAccess.peekComponent(r);Promise.all(a).then(()=>{const e=[];a.length&&(e.push(this._eventHandler.request(2)),e.push(this._eventHandler.request(3,[this._webGl.context]))),Promise.all(e).then(e=>{const t=e&&e[0]?e[0]:n,s=e&&e[1]?e[1]:o;i({partList:this._addUiDataToPartList(t,s),hash:s,rootComponentLabel:h?h.label:""})})})},n),this._eventHandler.dispatch(63,[e,t])})};this._waitingForDependencies?this._waiterForPreload=s:s()})}_notifyDependenciesWaiter(){this._waitingForDependencies||"function"!=typeof this._waiterForPreload||(this._waiterForPreload(),this._waiterForPreload=null)}_preLoadItemOrConfig(e,t){return new Promise((i,n)=>{(t?this._rapiAccess.getConfiguration(e):this._rapiAccess.getItem(e)).then(i,n)})}_preloadPackage(e){this._waitingForPreload=!0;let t=null;t=A(e)?this._rapiAccess.getPreloadForItem.bind(this._rapiAccess):this._rapiAccess.getPreloadForConfiguration.bind(this._rapiAccess),C.start("rapi_preloads");const i=()=>{C.end("rapi_preloads");const t=C.getMeasure("rapi_preloads");if(Array.isArray(t)&&1===t.length){const i=t[0];this._configuratorUiCallbacks.onTrackTiming("Timing","RapiPreloads",Math.round(i.duration),{id:e})}};t(e).then(()=>{this._waitingForPreload=!1,this._notifyDependenciesWaiter(),i()},e=>{this._waitingForPreload=!1,this._notifyDependenciesWaiter(),console.error(e),i()})}_reloadConfiguration(e,t,i,n){return this._performLoadConfiguration(e,{preloadHint:t}).then(()=>{this._isReloading=!1,i()},e=>{this._isReloading=!1,n(e)})}_performLoadConfiguration(e,t){return this._onLoadConfiguration(),new Promise((i,n)=>{t&&t.preloadHint?this._preloadPackage(t.preloadHint):console.warn("When loading a configuration string you have to supply a preloadHint to use fast loading!"),this.setOverrides(t),setTimeout(()=>{this._loadConfiguration(e,t).then(this._notifyOnConfigurationReady(i).bind(this),this._notifyOnConfigurationLoadingError(n).bind(this))},0)})}_changeHDGeometry(e){return new Promise((t,i)=>e===H.useHDGeometry?t():this._isReloading?i("Change of HD Geometry in progress"):(this._isReloading=!0,Re.waitFor(3).then(([e,n])=>{this._reloadConfiguration(e,n,t,i)},i),H.useHDGeometry=e,void this._eventHandler.dispatch(69,[this._webGl.context,H.useHDGeometry])))}setOverrides(e){e&&(window.__RML__ENV__.initData=Object.assign(window.__RML__ENV__.initData,e),e.colors&&window.__RML__ENV__.initData.colors&&(window.__RML__ENV__.initData.colors=Object.assign(window.__RML__ENV__.initData.colors,e.colors)),e.overrideTenant&&this._rapiAccess.overrideTenant(e.overrideTenant),e.overrideCountry&&this._rapiAccess.overrideCountry(e.overrideCountry),e.overrideRapi&&this._rapiAccess.overrideRapi(e.overrideRapi))}init(e,t){t=t||{};const{preloadHint:i,offset:n,locale:s,startTag:o}=t;let{configuratorId:r}=window.__RML__ENV__.initData;if(!r){const e=document.referrer;r=-1!==e.indexOf("design-bestseller")?"desing-bestseller":-1!==e.indexOf("signature-safes")?"hartmann_tresore":-1!==e.indexOf("sitzfeldt")?"sitzfeldt":""===e?null:"demoConfigurator"}return this._rapiAccess.setConfiguratorId(r),this._domHelper.setDomElement(e),this.setOverrides(t),i?this._preloadPackage(i):console.warn("No preload hint! Therefore no preload during init!!"),o&&this.getTagById(o,{include:["items"]}).then(e=>this._configuratorUiCallbacks.onOpenTag(e),e=>console.error(e)),this._eventHandler.dispatch(0,[e,n]),new Promise(this._initPromiseCallback.bind(this))}cancelSelection(){this._webGl.cancelSelection()}enableHDGeometry(){return this._changeHDGeometry(!0)}disableHDGeometry(){return this._changeHDGeometry(!1)}changeOffset(e){this._webGl.changeOffset(e)}previewDockings(e,t,i){i||(i=!1),this._webGl.requestDockingsPreview(!0,e,t,i)}requestDeleteComponent(){this._webGl.requestDeleteSelectedComponent()}preparePerspectiveImage(){return this._webGl.preparePerspectiveImage()}saveCurrentConfiguration(){return new Promise((e,t)=>{this._eventHandler.request(0,[this._webGl.context.planObjectId]).then(i=>{this._rapiAccess.saveConfiguration(i).then(i=>{this._rapiAccess.getComponent(i.rootComponentId).then(n=>{let s=!0,o=!0,r=i.perspectiveImage,a=i.topImage;i.perspectiveImage||(s=!1,this._webGl.preparePerspectiveImage().then(h=>{this._rapiAccess.savePerspectiveImage(i,h).then(t=>{s=!0,r=t.perspectiveImage,o&&(t.label=n.label,t.topImage=a,e(t))},t)})),i.topImage||(o=!1,this._webGl.prepareTopImage().then(h=>{this._rapiAccess.saveTopImage(i,h).then(t=>{o=!0,a=t.topImage,s&&(t.label=n.label,t.perspectiveImage=r,e(t))},t)})),s&&o&&(i.label=n.label,e(i))},e=>{throw new Error(e)})},t)}).catch(t)})}generateImagesOfCurrentConfiguration(){return new Promise((e,t)=>this.saveCurrentConfiguration().then(t=>e({topImage:t.topImage,perspectiveImage:t.perspectiveImage,isLocally:t.isLocally}),t))}prepareTopImage(){return this._webGl.prepareTopImage()}resetCameraPosition(){this._webGl.resetCameraPosition()}showBenchmarks(e){C.showBenchmarks(e)}debugSceneGraph(e){this._webGl.debugSceneGraph(e)}loadConfiguration(e,t={}){return this._webGl.context.lastLoadedRapiId=null,this._webGl.clearScene(),this._performLoadConfiguration(e,t)}loadConfigurationById(e,t={}){return this._loadItemOrConfigById(e,!0,t)}syncPlanObjectToView(e,t){this._webGl.clearScene(),this._eventHandler.dispatch(60,[e,t]),this._eventHandler.dispatch(61,[t])}loadConfigurableItemById(e,t={}){return this._loadItemOrConfigById(e,!1,t)}preLoadConfigurationById(e){return this._preLoadItemOrConfig(e,!0)}preLoadConfigurableItemById(e){return this._preLoadItemOrConfig(e,!1)}_getTag(e){return this._rapiAccess.getTag(e)}_dispatchSetParameter(e,t,i,n,s){const o=this._webGl.context.selectedRuntimeComponentId?"local":"global",r=C.start("kernel_change_param_"+o+"_"+e);switch(this._webGl.context.selectionMode){case"standard":if(this._webGl.context.selectedRuntimeComponentId||this._webGl.context.rootComponentParametersAsGlobal){let o=this._webGl.context.selectedRuntimeComponentId?this._webGl.context.selectedRuntimeComponentId:this._webGl.context.rootComponentId;this._eventHandler.dispatch(65,[o,e,t,i,n,s])}else this._eventHandler.dispatch(66,[this._webGl.context.planObjectId,e,t,i,n,s]);break;case"multiselect":this._eventHandler.dispatch(64,[this._webGl.context.selectedRuntimeComponentIds,e,t,i,n,s])}C.end(r)}setParameter(e,t,i=!1){return new Promise((n,s)=>{const{key:o,type:r}=e;if(Le(e)){if(!i&&!this._unitFormatter.isParseableUnitString(t))return s(new SyntaxError('Value "'+t+'" is not parseable'));const n=i?t:this._unitFormatter.parseMMValueFromUnitString(t,e.unitType),{valueFrom:o,valueTo:a}=e.validRange;if(!Number.isNaN(o)&&o>n)return s(new RangeError('Value "'+t+'" is too small, min-val "'+o+'"'));if(!Number.isNaN(a)&&n>a)return s(new RangeError('Value "'+t+'" is too big, max-val "'+a+'"'));t="Integer"===r&&"number"==typeof n?n.toFixed():n.toString()}this._dispatchSetParameter(o,r,t,n,s)})}enableHD(){return this._webGl.enableHD()}disableHD(){return this._webGl.disableHD()}enableMultiselect(){return this._webGl.enableMultiselect()}disableMultiselect(){return this._webGl.disableMultiselect()}getCurrentConfiguration(){return Re.waitFor(1,()=>this._eventHandler.dispatch(71,[this._webGl.context.planObjectId]))}loadComponentIntoKernel(e){return Re.waitFor(0,()=>this._eventHandler.dispatch(72,[e]))}getShortUrlOfCurrentConfiguration(){return new Promise((e,t)=>{this.saveCurrentConfiguration().then(i=>navigator.onLine?this._rapiAccess.getShortUrl(i.id,3).then(t=>{const i=D.detailEnvironment===D.environments.PRODUCTION||D.detailEnvironment===D.environments.ALPHA?t.shortId:t.referencedId,n=D.APP.SHORTENER_URL+i;e(n)},t):t("Can not generate short url when offline"),t)})}formatMMValueToUnitString(e,t){return this._unitFormatter.formatMMValueToUnitString(e,t)}setFloorMaterial(e,t,i,n){return this._webGl.setFloorMaterial(e,t,i,n)}getTagById(e,t){return new Promise((i,n)=>{this._getTag(e).then(e=>{let s=Promise.resolve([]),o=Promise.resolve([]);t&&t.include&&t.include.forEach(t=>{"materials"===t&&(s=this._rapiAccess.getMaterialsOf(e)),"items"===t&&(o=this._rapiAccess.getItems(e.items))}),Promise.all([s,o]).then(([t,n])=>i(Object.assign({},e,{items:n,materials:t})),n)},n)})}requestAsset(e){return this._dataSyncer.requestAsset(e)}changeFloorMaterial(e){return this._webGl.changeFloorMaterial(e)}openFloorMaterials(){this._configuratorUiCallbacks.onOpenFloorMaterials()}openPartList(){this._configuratorUiCallbacks.onOpenPartList()}getAdditionalContentsOf(e){return this._rapiAccess.getAdditionalContentsOfItems(e)}changeTypeChangeTag(e){navigator.onLine&&window.__RML__ENV__.initData.offlineSync&&this._dataSyncer.syncTypeChangeTag(e),this._configuratorUiCallbacks.onChangeTypeChangeTag(e)}removeTypeChangeTag(e){this._configuratorUiCallbacks.onRemoveTypeChangeTag(e)}showGUI(){this._webGl.showGUI()}showStats(){this._webGl.showStats()}showDimensions(){this._webGl.showDimensions()}hideDimensions(){this._webGl.hideDimensions()}syncCatalog(e){return this._dataSyncer.syncCatalog(e)}syncFloorTag(e){return this._dataSyncer.syncFloorTag(e)}syncTypeChangeTag(e){return this._dataSyncer.syncTypeChangeTag(e)}loadDynamicLightSetting(e){return this._webGl.loadDynamicLightSetting(e)}setBackgroundColor(e){this._webGl.setBackgroundColor(e)}setBackgroundImage(e){this._webGl.setBackgroundImage(e)}loadSceneSetting(e){return this._webGl.loadSceneSettings(e)}enableMeshSelection(e){window.__RML__ENV__.initData&&(window.__RML__ENV__.initData.meshSelection=e)}updateSize(){this._webGl.updateSize()}cleanup(){this._eventHandler.dispatch(26),this._eventHandler.dispatch(81)}resume(){this._eventHandler.dispatch(82)}zoomIn(e){this._webGl.zoomIn(e)}zoomOut(e){this._webGl.zoomOut(e)}get callbacks(){return this._configuratorUiCallbacks}}i([n],We.prototype,"_eventHandler",void 0),i([n],We.prototype,"_webGl",void 0),i([n],We.prototype,"_rapiAccess",void 0),i([n],We.prototype,"_dataSyncer",void 0),i([n],We.prototype,"_errorHandler",void 0),i([n],We.prototype,"_unitFormatter",void 0),i([n],We.prototype,"_domHelper",void 0),i([n],We.prototype,"_configuratorUiCallbacks",void 0);const Ke=["material"],Ze="tried to set a parameter to a none string value!";class Ye extends F{constructor(){super(1),C.addMeta("kernel_is_ready",{isWasm:this._useWASM}),H.kernelInstance?(this._kernelContainer=H.kernelContainer,setTimeout(()=>this._loadSuccess(),0)):this._scriptLoader.fetch(this._kernelPath,{id:"kernel"}).then(this._loadSuccess.bind(this),this._loadError.bind(this)),this._eventHandler.subscribe(9,this._webGlSelectedComponent.bind(this)),this._eventHandler.subscribe(10,this._webGlSelectionCancel.bind(this)),this._eventHandler.subscribe(11,this._webGlSelectionChange.bind(this)),this._eventHandler.subscribe(12,this._webGlMultiSelectionChange.bind(this)),this._eventHandler.subscribe(6,this._webGlDockComponent.bind(this)),this._eventHandler.subscribe(7,this._webGlDockComponentWithPosition.bind(this)),this._eventHandler.subscribe(8,this._requestDeleteComponent.bind(this)),this._eventHandler.subscribe(13,this._webGlPreviewDockings.bind(this)),this._eventHandler.subscribe(14,this._webGlPreviewDockingsWithDrag.bind(this)),this._eventHandler.subscribe(63,this._loadConfiguration.bind(this)),this._eventHandler.subscribe(71,this._uiRequestConfiguration.bind(this)),this._eventHandler.subscribe(64,this._changeCommonComponentParameter.bind(this)),this._eventHandler.subscribe(65,this._changeComponentParameter.bind(this)),this._eventHandler.subscribe(66,this._changePlanObjectParameter.bind(this)),this._eventHandler.subscribe(67,this._requestDeleteComponent.bind(this)),this._eventHandler.subscribe(68,this._requestDeleteComponents.bind(this)),this._eventHandler.subscribe(69,this._changeUseOfHDGeometry.bind(this)),this._eventHandler.subscribe(72,this._loadComponentIntoKernel.bind(this)),this._eventHandler.subscribe(73,this._requestPartList.bind(this)),this._eventHandler.subscribe(60,this._requestSync.bind(this)),this._eventHandler.subscribe(61,this._requestPlanObjectConstruction.bind(this)),this._eventHandler.subscribe(81,this._cleanup.bind(this)),this._eventHandler.subscribe(82,this._resume.bind(this)),this._eventHandler.provide(0,this._getConfigurationData.bind(this)),this._eventHandler.provide(1,this._getGlobalParameters.bind(this)),this._eventHandler.provide(2,this._getPartList.bind(this)),this._eventHandler.provide(3,this._getConfigurationHash.bind(this))}_cleanup(){this._kernelContainer.unregisterConfiguratorCallback(this)}_resume(){this._kernelContainer.registerConfiguratorCallback(this)}_loadSuccess(){C.start("kernel_is_ready"),H.kernelInstance?setTimeout(()=>this.isReady(),0):(window.ConfiguratorKernel(this._kernelContainer),window.ConfiguratorKernel=null),this._eventHandler.dispatch(23)}_loadError(){this._eventHandler.dispatch(24)}_webGlSelectedComponent(e){this._updateComponentDependencies(e)}_webGlSelectionCancel(e){this._updatePlanObjectDependencies(e)}_uiRequestConfiguration(e){const t=this._kernelInstance.getSerializedConfiguration(e);Re.finishOperation(1,t)}_updateComponentParameters(e){let t=V(this._kernelInstance.getComponentParameters(e));const i=V(this._kernelInstance.getComponent(e));this._eventHandler.dispatch(37,[e,t,i.parameterGroups])}_webGlSelectionChange(e,t){let i=!1,n=[];if(e){let t=V(this._kernelInstance.getComponent(e));t.componentId=this._kernelInstance.getComponentId(e),t&&t.childIds&&t.childIds.length>0&&(i=!0),n.push(t)}this._eventHandler.dispatch(54,["standard",t,i,n])}_webGlMultiSelectionChange(e,t){this._updateCommonComponentDependencies(e);let i=!1,n=!1,s=[];e&&e.forEach(e=>{let o=V(this._kernelInstance.getComponent(e));o.componentId=this._kernelInstance.getComponentId(e),o&&o.childIds&&o.childIds.length>0&&(i=!0),o.id===t&&(n=!0),s.push(o)}),this._eventHandler.dispatch(54,["multiselect",n,i,s])}_updateCommonComponentDependencies(e){const{parameters:t,parameterGroups:i}=V(this._kernelInstance.getCommonPlanComponentParameters(this._utilityToLongArray(e)));this._eventHandler.dispatch(39,[t,e,i])}_updateComponentChildren(e){const t=V(this._kernelInstance.getPlanComponentPossibleChildren(e));this._eventHandler.dispatch(47,[e,t])}_updateComponentDependencies(e){this._updateComponentParameters(e),this._updateComponentChildren(e)}_updatePlanObjectParameters(e){let t,i=V(this._kernelInstance.getPlanObjectParameters(e));if(0===i.length){let n=this._kernelInstance.getRootPlanComponentIdFromObjectId(e);i=V(this._kernelInstance.getComponentParameters(n)),this._eventHandler.dispatch(45),t=V(this._kernelInstance.getComponent(n))}else this._eventHandler.dispatch(46),t=V(this._kernelInstance.getPlanObject(e));this._eventHandler.dispatch(44,[e,i,t.parameterGroups])}_updatePlanObjectChildren(e){const t=V(this._kernelInstance.getPlanObjectPossibleChildren(e));this._eventHandler.dispatch(48,[e,t])}_updatePlanObjectDependencies(e){this._updatePlanObjectParameters(e),this._updatePlanObjectChildren(e)}_updateConfigurationHasChildren(e,t=null){t||(t=V(this._kernelInstance.getComponent(this._kernelInstance.getRootPlanComponentIdFromObjectId(e))));const i=t.childIds.size?t.childIds.size():t.childIds.length;this._eventHandler.dispatch(56,[i>0])}_webGlDockComponent(e,t,i,n){this._kernelInstance.dockComponent(i,n,e,t),this._eventHandler.dispatch(59)}_changeUseOfHDGeometry(e,t){this._rapiAccess.changeUseOfHDGeometry();const i=e.planObjectId,n=e.lastLoadedRapiId?e.lastLoadedRapiId:this._kernelInstance.getComponentId(i),s=this._kernelInstance.getSerializedConfiguration(i);this._kernelInstance.clearAll(),this._kernelInstance.useHDGeometry(t),Re.finishOperation(3,[s,n])}_webGlDockComponentWithPosition(e,t,i,n,s){this._kernelInstance.dockComponentWithPosition(i,n,e,t,s),this._eventHandler.dispatch(59)}_webGlPreviewDockings(e,t){Re.waitFor(4).then(i=>{t&&this._kernelInstance.requestPlanComponentConstruction(i),this._kernelInstance.requestPreviewGeometry(i,e.planObjectId)}),e.lastPossibleChild&&e.lastPossibleChild.isComponent&&this._kernelInstance.loadPlainComponent(10,e.lastPossibleChild.id,e.lastPossibleChild.configuration),e.lastPossibleChild&&e.lastPossibleChild.isItem&&this._kernelInstance.loadFreeFlyingConfiguration(10,e.lastPossibleChild.configuration)}_webGlPreviewDockingsWithDrag(e,t){this._kernelInstance.requestPreviewGeometry(e,t.planObjectId)}_loadConfiguration(e,t){t&&t.id?this._memoryManager.loadingConfiguration(t.id):this._memoryManager.loadingConfigurationString(),this._memoryManager.shouldHardReset()?this._kernelInstance.clearAll():this._kernelInstance.clearScene(),this._kernelInstance.loadConfiguration(9,e,{x:0,y:0,z:0})}_getConfigurationData(e){return new Promise(t=>{const i=V(this._kernelInstance.getPlanObject(e)),n=(new Date).toISOString(),s=this._kernelInstance.getComponentId(e),o=G(s);t({created:n,lastAccess:n,configuration:this._kernelInstance.getSerializedConfiguration(e),configurationHash:this._kernelInstance.getHashOfPlanComponent(e),parts:JSON.stringify(V(this._kernelInstance.getPartList(e))),rootComponentId:s,width:parseInt(i.bounds.x,10),height:parseInt(i.bounds.z,10),depth:parseInt(i.bounds.y,10),catalog:o,orderable:!1,requestable:!1})})}_changeCommonComponentParameter(e,t,i,n,s,o){"string"==typeof n?this._kernelInstance.setPlanComponentParameters(this._utilityToLongArray(e),t,n):console.warn(Ze,n,t,i),this._finishParameterChange(i,s,o),this._updateCommonComponentDependencies(e)}_changeComponentParameter(e,t,i,n,s,o){"string"==typeof n?this._kernelInstance.setComponentParameter(e,t,n):console.warn(Ze,n,t,i),this._finishParameterChange(i,s,o),this._updateComponentDependencies(e)}_changePlanObjectParameter(e,t,i,n,s,o){"string"==typeof n?this._kernelInstance.setPlanObjectParameter(e,t,n):console.warn(Ze,n,t,i),this._finishParameterChange(i,s,o)}_finishParameterChange(e,t,i){-1===Ke.indexOf(e)?setTimeout(()=>t(),0):this._eventHandler.dispatch(58,[t,i])}_requestDeleteComponent(e){e&&this._kernelInstance.deleteComponent(e)}_requestDeleteComponents(e){e&&this._kernelInstance.deletePlanComponents(this._utilityToLongArray(e))}_calcPrice(){if(!window.__RML__ENV__.initData.useRoomlePrice)return;let e=V(this._kernelInstance.getFullPartList());if(e&&e.fullList&&e.fullList.length){const t=e.fullList[0].currencySymbol,i=e.fullList.reduce((e,t)=>e+(t.count?t.count:0)*(t.price?t.price:0),0);this._eventHandler.dispatch(49,[t,i])}}_loadComponentIntoKernel(e){this._kernelInstance.loadComponentDefinition(10,e)}_requestPartList(e){let t=V(this._kernelInstance.getFullPartList());this._eventHandler.dispatch(55,[t,this._kernelInstance.getHashOfPlanComponent(e.planObjectId)])}_requestSync(e,t){this._eventHandler.dispatch(41,[e,t]),this._kernelInstance.syncPlanObjectToView(e,t)}_getGlobalParameters(e,t){return new Promise(i=>{let n=this._kernelInstance.getPlanObjectParameters,s=e;t&&(n=this._kernelInstance.getComponentParameters,s=this._kernelInstance.getRootPlanComponentIdFromObjectId(e)),i(V(n.apply(this._kernelInstance,[s])))})}_getPartList(){return new Promise(e=>{e(V(this._kernelInstance.getFullPartList()).fullList)})}_getConfigurationHash(e){return new Promise(t=>t(this._kernelInstance.getHashOfPlanComponent(e.planObjectId)))}_requestPlanObjectConstruction(e){this._kernelInstance.requestPlanObjectConstruction(e)}isReady(){super.isReady(),C.end("kernel_is_ready"),C.start("kernel_create_instance"),H.kernelInstance?this._kernelInstance=H.kernelInstance:this._kernelInstance=new this._kernelContainer.Kernel,this._kernelContainer.registerConfiguratorCallback(this),C.end("kernel_create_instance");const{overrideCountry:e,locale:t}=window.__RML__ENV__.initData;e&&(this._kernelInstance.resetPriceListIds(),this._kernelInstance.addPriceList(e)),D.isProduction||(window.__RML__DEBUG__.Kernel=this._kernelInstance,window.__RML__DEBUG__.KernelContainer=this._kernelContainer,window.__RML__DEBUG__.Helper={convertCObject:V}),this._kernelInstance.setEnvironmentVariable("language",t),this._unitFormatter.init(this._kernelContainer,this._kernelInstance),this._eventHandler.dispatch(25,[this._kernelContainer,this._kernelInstance]),H.planObjectId&&this.planObjectCreated(-1,H.planObjectId)}onLoadComponentError(e){this._eventHandler.dispatch(38,[e])}configurationLoaded(e,t,i,n,s){Re.finishOperation(4,i),this._kernelInstance.requestPlanObjectConstruction(t);let o=V(this._kernelInstance.getComponent(i));this._eventHandler.dispatch(40,[t,i,o])}componentDefinitionLoaded(e,t){Re.finishOperation(0,t)}componentDefinitionLoadingError(e,t){Re.failOperation(0,new Error(t))}configurationLoadingError(){const e="Configuration loading error";Re.failOperation(4,new Error(e)),Re.failOperation(2,new Error(e))}componentConfigurationUpdated(e){this._kernelInstance.requestPlanComponentConstruction(e)}componentMetaUpdated(e){let t=V(this._kernelInstance.getComponent(e));this._eventHandler.dispatch(30,[e,t])}componentParameters(){}componentDeleted(e){this._eventHandler.dispatch(36,[e])}requestComponentDimensions(){}planObjectCreated(e,t){this._eventHandler.dispatch(41,[e,t])}planObjectUpdated(e){let t=V(this._kernelInstance.getPlanObject(e));this._eventHandler.dispatch(42,[t,!0])}planObjectConfigurationUpdated(e,t,i){let n=V(this._kernelInstance.getPlanObject(e));this._eventHandler.dispatch(42,[n,!0]),this._updatePlanObjectDependencies(e);let s=V(this._kernelInstance.getComponent(this._kernelInstance.getRootPlanComponentIdFromObjectId(e)));this._eventHandler.dispatch(30,[s.id,s]);let o=V(this._kernelInstance.getFullPartList());this._eventHandler.dispatch(55,[o,i]),this._updateConfigurationHasChildren(e,s),this._calcPrice()}planObjectDeleted(){}requestPlanObjectDimensions(){}sceneCleared(){this._eventHandler.dispatch(26)}requestExternalMesh(e,t){return new Promise((i,n)=>{this._rapiAccess.getMesh(e,U,t).then(s=>{fetch(new Request(this._dataSyncer.requestAsset(s.url,!0))).then(e=>e.arrayBuffer()).then(n=>{try{this._kernelContainer.addMeshCorto(e,t,new Uint8Array(n)),i()}catch(e){console.error(e),this._eventHandler.dispatch(62),i()}}).catch(e=>{console.error(e),n(e)})},e=>{console.error(e),n(e)})})}Editor3dComponentCreated(e,t,i,n){this._eventHandler.dispatch(29,[e,t,i,n,!1]),n&&n>0&&this._eventHandler.dispatch(35,[e,n,t,i])}Editor3dRootComponentCreated(e,t,i,n){this._eventHandler.dispatch(29,[e,t,i,n,!0])}Editor3dBeginConstruction(e){this._eventHandler.dispatch(28,[e])}Editor3dEndConstruction(e){let t=V(this._kernelInstance.getComponent(e));this._eventHandler.dispatch(33,[e,t])}Editor3dGeometryReady(e){this._kernelInstance.requestPlanComponentConstruction(e)}Editor3dGeometryNotReady(e){this._eventHandler.dispatch(34,[e])}Editor3dPlanObjectConstructionDone(e){const t=V(this._kernelInstance.getPlanObject(e)),i=V(this._kernelInstance.getFullPartList()),n=this._kernelInstance.getHashOfPlanComponent(e),s=this._kernelInstance.getComponentId(t.rootPlanComponentId),o=[t,i.fullList,n,s];Re.finishOperation(2,o),this._eventHandler.dispatch(43,o),this._updatePlanObjectDependencies(e),this._updateConfigurationHasChildren(e),this._calcPrice(),C.end("ui_load_configuration")}Editor3dBeginGroup(){}Editor3dEndGroup(){}Editor3dSetMaterial(){}Editor3dLoadMaterial(){}Editor3dAddDockPreview(e,t){this._eventHandler.dispatch(50,[e,t])}Editor3dSetPreviewPointAssociations(e,t){this._eventHandler.dispatch(51,[t,V(e)])}Editor3dSetPreviewLineAssociations(e,t){this._eventHandler.dispatch(52,[t,V(e)])}Editor3dPreviewConstructionDone(e,t){this._eventHandler.dispatch(53,[e,t])}Editor3dTranslateBy(){}Editor3dRotateBy(){}Editor3dRotateAround(){}Editor3dAddCube(){}Editor3dAddCubeUVMod(){}Editor3dAddSphere(){}Editor3dAddSphereUVMod(){}Editor3dAddRectangle(){}Editor3dAddRectangleUVMod(){}Editor3dAddMesh(){}Editor3dAddMeshUVMod(){}Editor3dAddMeshUVCoord(){}Editor3dAddCylinder(){}Editor3dAddCylinderUVMod(){}Editor3dAddPrism(){}Editor3dAddPrismUVMod(){}Editor3dAddFittingPoint(){}Editor3dAddFittingLine(){}Editor3dSelectObject(){}Editor3dCopy(){}Editor3dComponentDocked(e,t,i,n){this._eventHandler.dispatch(35,[e,t,i,n])}Editor3dUpdatePlanObjectPosition(){}Editor3dUpdatePlanObjectRotation(){}Editor3dUpdatePlanObjectTransform(){}Editor3dUpdatePlanComponentPosition(){}Editor3dUpdatePlanComponentRotation(){}Editor3dUpdatePlanComponentTransform(){}Editor3dAddBakedMesh(e,t,i,n,s,o){this._eventHandler.dispatch(31,[e,t,i,n,s,o])}Editor3dAddNamedMesh(e,t,i,n,s,o,r,a){this._eventHandler.dispatch(32,[e,t,i,n,s,o,r,a])}}i([n],Ye.prototype,"_eventHandler",void 0),i([n],Ye.prototype,"_unitFormatter",void 0),i([n],Ye.prototype,"_memoryManager",void 0);class Qe{constructor(e){const{component:t,resetCamera:i}=e;this.component=t,this.resetCamera=void 0===i||i}}class Xe extends a{constructor(){super(...arguments),this._selectionMode="standard",this._selectedComponents=new Map}check(e){"standard"===this._selectionMode&&this._checkStandard(e),"multiselect"===this._selectionMode&&this._checkMulti(e)}cancelSelection(){0!==this._selectedComponents.size&&this._selectedComponents.forEach((e,t)=>{e.deselect(),this._selectedComponents.delete(t),this.dispatchEvent(1,new Qe({component:e}))})}_checkStandard(e){if(this._selectedComponents.has(e.roomleId))return this._selectedComponents.delete(e.roomleId),void this.dispatchEvent(1,new Qe({component:e}));this._selectedComponents.size>0&&this._selectedComponents.forEach((e,t)=>{this._selectedComponents.delete(t),this.dispatchEvent(1,new Qe({component:e,resetCamera:!1}))}),this._selectedComponents.set(e.roomleId,e),this.dispatchEvent(0,new Qe({component:e}))}_checkMulti(e){if(this._selectedComponents.has(e.roomleId))return this._selectedComponents.delete(e.roomleId),void this.dispatchEvent(1,new Qe({component:e,resetCamera:0===this._selectedComponents.size}));this._selectedComponents.set(e.roomleId,e),this.dispatchEvent(0,new Qe({component:e}))}setSelectionMode(e){this._selectionMode=e}getSelectionMode(){return this._selectionMode}hasSelection(){return this._selectedComponents.size>0}getSelectedRuntimeComponentIds(){let e=[];return this._selectedComponents.forEach(t=>e.push(t.roomleId)),e}}const Je=[new I("event-handler",class{constructor(){this._listeners={},this._providers={}}_subscribe(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}subscribe(e,t){this._subscribe(e,t)}dispatch(e,t){if(!this._listeners[e])return;const i=this._listeners[e];let n=i.length;for(let e=0;n>e;e++){const n=i[e];n.apply(n,t)}}request(e,t){return"function"==typeof this._providers[e]?this._providers[e].apply(this._providers[e],t):new Promise((t,i)=>i("No one provides data for: "+e))}provide(e,t){this._providers[e]||(this._providers[e]=t)}unsubscribe(e,t){if(!this._listeners[e])return;const i=this._listeners[e];let n=i.length;for(let e=0;n>e;e++)if(i[e]===t)return i.splice(e,1),n--,void e--}}),new I("kernel-access",Ye),new I("logger",x),new I("ui-api",We),new I("rapi-access",j),new I("script-loader",S),new I("unit-formatter",class{constructor(){this._formatter=null}init(e,t){const i=new e.UnitMeasureFormatter;De=e.Unit,Ge=e.UnitStringType,this._initActualUnit(),this._initActualUnitStringType();const{precisionCm:n,precisionInch:s}=window.__RML__ENV__.initData;let o=0;this._actualUnit===De.InchFeet?o=s?parseInt(s,10):2:this._actualUnit===De.CM&&(o=n?parseInt(n,10):1),i.init(Ae,Fe,Ue,Ve,Be,je,ze,qe,!0,o),this._formatter=i}_initActualUnit(){const{unit:e}=window.__RML__ENV__.initData;switch(e){case"cm":this._actualUnit=De.CM;break;case"mm":this._actualUnit=De.MM;break;case"inchfeet":this._actualUnit=De.InchFeet;break;default:this._actualUnit=De.CM}}_initActualUnitStringType(){const{unitStringType:e}=window.__RML__ENV__.initData;switch(e){case"none":this._actualUnitStringType=Ge.NoUnitString;break;case"long":this._actualUnitStringType=Ge.LongUnitString;break;case"short":this._actualUnitStringType=Ge.ShortUnitString;break;default:this._actualUnitStringType=Ge.ShortUnitString}}_isFormatterReady(){return!!this._formatter||(console.warn("Formatter is not ready..."),!1)}isParseableNumber(e){return this._isFormatterReady()?this._formatter.isParseableNumber(e):null}isParseableUnitString(e){return this._isFormatterReady()?this._formatter.isParseableUnitString(e,this._actualUnit):null}parseMMValueFromUnitString(e,t){return this._isFormatterReady()?"count"===t?parseFloat(e):this._formatter.parseMMValueFromUnitString(e,this._actualUnit):null}parseNumber(e){return this._isFormatterReady()?this._formatter.parseNumber(e):null}formatNumber(e,t=0){return this._isFormatterReady()?this._formatter.formatNumber(e,t):null}formatSquareMMValueToUnitString(e){return this._isFormatterReady()?this._formatter.formatSquareMMValueToUnitString(e,this._actualUnit):null}formatMMValueToUnitString(e,t){return this._isFormatterReady()?"count"===t?e.toString():this._formatter.formatMMValueToUnitString(e,this._actualUnit,this._actualUnitStringType):null}formatMMValueWithReqMaxLength(e,t){return this._isFormatterReady()?this._formatter.formatMMValueWithReqMaxLength(e,this._actualUnit,t):null}_formatParameterValue(e,t){return"length"===t?this.formatMMValueToUnitString(parseFloat(e)):"area"===t?this.formatSquareMMValueToUnitString(parseFloat(e)):e}formatPartListParameter(e){ke(e)&&(e.valueLabel=this._formatParameterValue(e.value,e.unitType))}formatParameter(e){ke(e)&&Array.isArray(e.validValues)&&e.validValues.forEach(({value:t},i)=>{e.validValues[i].label=this._formatParameterValue(t,e.unitType)}),e.valueLabel=e.value,Oe(e)?e.uiType="Material":function(e){return"Boolean"===e.type}(e)?e.uiType="Boolean":Le(e)?(e.uiType="Range",e.valueLabel=this._formatParameterValue(e.value,e.unitType),e.validRangeLabels={valueFrom:this.formatMMValueToUnitString(e.validRange.valueFrom,e.unitType),valueTo:this.formatMMValueToUnitString(e.validRange.valueTo,e.unitType),type:e.validRange.type}):Me(e)?(e.uiType="Options",function(e){return!!Me(e)&&Array.isArray(e.validValues)&&e.validValues.length>0&&"string"==typeof e.validValues[0].thumbnail}(e)&&(e.uiType="Thumbnails")):(console.error("Could not detect uiType of param"),e.uiType=null)}}),new I("web-gl",Ie),new I("camera-control-3d",u),new I("camera-control",P),new I("configurator-context",q),new I("configurator-input-manager",class extends y{}),new I("dom-helper",T),new I("selection-handler",Xe),new I("data-syncer",R),new I("selection-handler",Xe),new I("configurator-mesh-generator",class extends B{generateMesh(e,t,i,n,s){let o=this._generateGeometry(e,t,i,n,s);return new THREE.Mesh(o,this._previewMaterial)}clear(){this._waitingForMaterials=[]}}),new I("configurator-ui-callbacks",class{constructor(){this.onKernelIsReady=(()=>void 0),this.onUpdateParameters=(e=>void 0),this.onUpdatePossibleChildren=((e,t)=>void 0),this.onUpdatePrice=((e,t)=>void 0),this.onSelectionChange=((e,t,i,n)=>void 0),this.onSelectionCancel=(()=>void 0),this.onPartListUpdate=((e,t)=>void 0),this.onBoundsUpdate=(e=>void 0),this.onLoadConfiguration=(()=>void 0),this.onConfigurationReady=((e,t,i)=>void 0),this.onOpenTag=(e=>void 0),this.onOpenAddOns=(()=>void 0),this.onClickOutside=(()=>void 0),this.onNoDockingsAvailable=(()=>void 0),this.onUiIntersectionChange=(e=>void 0),this.onZoomChange=((e,t)=>void 0),this.onDimensionsVisibilityChange=(e=>void 0),this.onErrorDueToOffline=(e=>void 0),this.onError=(e=>void 0),this.onDockingsPreviewRemoved=(()=>void 0),this.onConfigurationHasChildren=(e=>void 0),this.onTrackTiming=((e,t,i,n)=>void 0),this.onUserInitiatedDockDone=(()=>void 0),this.onAddonPlusHover=(()=>void 0),this.onAddonPlusShown=(()=>void 0),this.onContentProblem=(e=>void 0),this.onSyncStarted=(()=>void 0),this.onSyncDone=(()=>void 0),this.onOpenFloorMaterials=(()=>void 0),this.onOpenPartList=(()=>void 0),this.onComponentLoadError=(e=>void 0),this.onConfigurationLoadError=(()=>void 0),this.onChangeTypeChangeTag=(e=>void 0),this.onRemoveTypeChangeTag=(e=>void 0),this.onConfigurationLabelChange=((e,t,i)=>void 0),this.onMemoryCorruption=(()=>void 0)}})];e("Configurator",class extends L{setupDependencies(){M.setup(Je),this.lookup("ui-api"),this.lookup("kernel-access"),this.lookup("rapi-access"),this.lookup("script-loader"),this.lookup("web-gl"),this.lookup("logger")}pause(){this.lookup("web-gl").stopRenderLoop()}cleanUpGlobals(){delete window.RoomleConfigurator}cleanUpDependencies(){const e=this.lookup("script-loader"),t=this.lookup("rapi-access"),i=this.lookup("web-gl"),n=this.lookup("dom-helper"),s=this.lookup("scene-helper");e&&e.cleanUp(),t&&t.cleanUp(),i&&i.cleanUp(),n&&n.cleanUp(),s&&s.cleanUp()}setupGlobals(e={}){const{locale:t}=window.__RML__ENV__.initData,{kernelInstance:i,kernelContainer:n,planObjectId:s}=e;H.init({locale:t,kernelInstance:i,kernelContainer:n,planObjectId:s})}getApi(){return this.lookup("ui-api")}bootFinished(){}})}}});
//# sourceMappingURL=configurator.nomodule.js.map
