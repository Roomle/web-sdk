System.register(["./chunk-1a2ba2c6.nomodule.js","./chunk-e3df09fe.nomodule.js","./chunk-c132145a.nomodule.js","./chunk-f9ed4e7a.nomodule.js"],function(e,t){var s,i,r,n,a,o,h,c,d,l,p,_,m,u,g;return{setters:[function(e){s=e.a,i=e.b},function(e){r=e.u,n=e.y,a=e.v,o=e.x,h=e.A,c=e.l,d=e.f,l=e.p,p=e.B,_=e.r,m=e.C},function(e){u=e.a},function(e){g=e.a}],execute:function(){const t=[new h("script-loader",o),new h("dom-helper",a),new h("glb-input-manager",class extends r{}),new h("logger",n)];class w extends c{constructor(){super(...arguments),this.shouldIgnoreStandardBehavior=!1}adjust(e,t,s,i,r){let n=new THREE.Vector3(-e.x/2,0,-e.z/2),a=new THREE.Vector3(e.x/2,e.y,e.z/2);this._boundingBox=new THREE.Box3(n,a);let o=new THREE.Euler(-Math.PI/2+i,s,0,"ZYX"),h=(new THREE.Quaternion).setFromEuler(o);this._camera.updateProjectionMatrix(),this._camera.quaternion.copy(h),this._camera.position.copy(t)}_setDistanceAndRangesBasedOnBounds(e,t,s){let i=super._setDistanceAndRangesBasedOnBounds(e,t,s);return this.maxDistance=1.1*i,i}_update(e){this.shouldIgnoreStandardBehavior?this._saveYawAndPitch():super._update(e)}animateCamera(e){return!!this.shouldIgnoreStandardBehavior||super.animateCamera(e)}}class E extends d{constructor(e,t){super(e,t),this._ambientLight=new THREE.AmbientLight(16777215,1.1),this._areaLight=new THREE.RectAreaLight(16767899,void 0,10,10),this._areaLight.castShadow=!0,this._areaLight.matrixAutoUpdate=!0,this._areaLight.intensity=1e3/(this._areaLight.width*this._areaLight.height),this._areaLight.position.set(5,4,5),this._areaLight.lookAt(new THREE.Vector3(0,0,0)),this._areaLight.visible=!0,this.addToScene()}addToScene(){this._scene.add(this._ambientLight)}removeFromScene(){this._scene.remove(this._ambientLight)}reload(){this.removeFromScene(),this.addToScene()}showGUI(){}}class f extends u{constructor(e){super(e,l.GLB,"3D",!0),this._itemsCount=0,this._standardSceneBackgroundColor=this._scene.background,this._lightSetting=new E(this._scene)}createCameraControl(e){this._cameraControl=new w(this._getInputManager(),this._domHelper.element,new THREE.Vector3(-1,1,1))}_getInputManager(){return this._glbInputManager}loadGLB(e,t=!0){return this.clearScene(),new Promise((s,i)=>{this._loadGLB(e,new THREE.Vector3(0,0,0),0,new THREE.Vector3(1,1,1)).then(e=>{if(this._scene.add(e),t){let{x:t,y:s}=this._domHelper.getClientDimensions(),i=(new THREE.Box3).setFromObject(e),r=i.getSize(new THREE.Vector3),n=i.getCenter(new THREE.Vector3);this._cameraControl instanceof w&&(this._cameraControl.updateToBounds(r,t,s,!1,!0,n),this._cameraControl.reset(r,t,s,n,-15,0)),this._requestRender()}s()})})}preparePerspectiveImage(e,t,s){return new Promise((i,r)=>{t||(t=1e3),s||(s=1e3),e||((e=new THREE.WebGLRenderer({antialias:!0})).setSize(t,s),e.gammaInput=!0,e.gammaOutput=!0,e.autoClear=!1,e.shadowMap.enabled=!0,e.shadowMap.type=THREE.BasicShadowMap,e.toneMapping=THREE.Uncharted2ToneMapping,e.toneMappingWhitePoint=6,e.toneMappingExposure=3);let n=this._cameraControl.getCamera().clone();n instanceof THREE.PerspectiveCamera&&(n.aspect=t/s,n.updateProjectionMatrix()),this._lightSetting.removeFromScene();let a=new g(this._scene);e.render(this._scene,n);let o=e.domElement.toDataURL();e.domElement.toBlob(e=>{i({image:o,width:t,height:s,blob:e})},"image/png"),a.removeFromScene(),this._lightSetting.addToScene()})}adjustCamera(e,t,s,i){if(this._cameraControl instanceof w){let r=(new THREE.Box3).setFromObject(this._scene).getSize(new THREE.Vector3);this._cameraControl.adjust(r,e,t,s,i),this._requestRender()}}onStart(e){this._itemsCount=e,this._scene.background=null,this._cameraControl instanceof w&&(this._cameraControl.shouldIgnoreStandardBehavior=!0)}onElementFinished(e){this._itemsCount,Math.round(100/this._itemsCount*e)}onFinished(e){this._scene.background=this._standardSceneBackgroundColor,this._cameraControl instanceof w&&(this._cameraControl.shouldIgnoreStandardBehavior=!1)}}s([i],f.prototype,"_glbInputManager",void 0);class b{constructor(e,t,s){this._prefix="https://furniture.roomle.com/3d/glb/",this._listeners=new Set,this._finishedItems=0,this._sceneManager=e,this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this._width=t,this._height=s,this._renderer.setSize(t,s),this._renderer.setClearColor(16777215,0),this._renderer.gammaInput=!0,this._renderer.gammaOutput=!0}addListener(e){this._listeners.add(e)}removeListener(e){this._listeners.delete(e)}start(e){return this._entries=[],e.forEach(e=>{this._entries.push(this._transform(e))}),this._finishedItems=0,this._listeners.forEach(e=>e.onStart(this._entries.length)),this._zip=new window.JSZip,this._doNextEntry(),new Promise((e,t)=>{this._resolve=e,this._reject=t})}_transform(e){return{name:e.path.replace(".glb",".png"),url:this._prefix+e.path,position:new THREE.Vector3(e.camera.position.x,e.camera.position.z,-e.camera.position.y),fov:2*e.camera.fieldOfView,yaw:e.camera.rotation.z,pitch:e.camera.rotation.x}}_doNextEntry(){0===this._entries.length?(this._listeners.forEach(e=>e.onFinished(this._zip)),this._resolve(this._zip)):this._processEntry(this._entries[0])}_processEntry(e){this._sceneManager.loadGLB(e.url,!1).then(()=>{this._sceneManager.adjustCamera(e.position,e.yaw,e.pitch,e.fov),this._sceneManager.preparePerspectiveImage(this._renderer,this._width,this._height).then(t=>{this._entryFinished(e,t)})})}_entryFinished(e,t){let s=this._entries.indexOf(e);s>-1&&this._entries.splice(s,1),this._finishedItems++,this._listeners.forEach(e=>e.onElementFinished(this._finishedItems)),this._zip.file(e.name,t.blob),this._doNextEntry()}}class L{init(e){return this._domHelper.setDomElement(e),new Promise(this._initPromiseCallback.bind(this))}_initPromiseCallback(e,t){this._scriptLoader.fetch("static/three/lib/rthree.js",{id:"three-lib"}).then(()=>{let t=this._scriptLoader.fetch("static/three/lib/loaders/GLTFLoader.js",{id:"gltf-loader"}),s=this._scriptLoader.fetch("static/three/Tween.js",{id:"tween-js"});Promise.all([t,s]).then(()=>{this._sceneManager=new f({left:0,top:1,right:1,bottom:0}),this.enableHD(),e()})})}enableHD(){return new Promise((e,t)=>{const s=()=>{this._sceneManager.enableHD(),e()};Promise.all([this._scriptLoader.fetch("static/three/lib/postprocessing/EffectComposer.js",{id:"effect-composer-js"}),this._scriptLoader.fetch("static/three/lib/lights/RectAreaLightUniformsLib.js",{id:"rect-area-light-uniforms-lib-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/ShaderPass.js",{id:"shader-pass-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/RenderPass.js",{id:"render-pass-js"}),this._scriptLoader.fetch("static/three/lib/shaders/CopyShader.js",{id:"copy-shader-js"})]).then(()=>{this._scriptLoader.fetch("static/three/pixotron.min.js",{id:"pixotron-js"}).then(s,t)},t)})}loadGLB(e){return this._sceneManager.loadGLB(e)}preparePerspectiveImage(){return this._sceneManager.preparePerspectiveImage()}processRenderList(e,t=320,s=320){let i=JSON.parse(e);this._scriptLoader.fetch("static/jszip/lib/jszip.js",{id:"jszip-js"}).then(()=>{let e=new b(this._sceneManager,t,s);e.addListener(this._sceneManager),e.start(i.items).then(t=>{t.generateAsync({type:"blob"}).then(t=>{let s=document.createElement("a");s.href=URL.createObjectURL(t),s.download="content.zip",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),e.removeListener(this._sceneManager)})})})}updateSize(){this._sceneManager.updateCamera()}}s([i],L.prototype,"_domHelper",void 0),s([i],L.prototype,"_scriptLoader",void 0),e("GlbViewer",class extends p{setupGlobals(){}setupDependencies(){m.setup(t),this.lookup("logger")}cleanUpGlobals(){throw new Error("Method not implemented.")}cleanUpDependencies(){throw new Error("Method not implemented.")}constructor(){super(),_.start("loadingTime")}bootFinished(){this._viewer=new L,window.RoomleGLBViewer||(window.RoomleGLBViewer=this._viewer)}pause(){throw new Error("Method not implemented.")}getApi(){return this._viewer}})}}});
//# sourceMappingURL=glb-viewer.nomodule.js.map
