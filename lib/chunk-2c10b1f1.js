import{c as o,D as ft,b as s,E as ot,n as g,F as ht,o as b,G as rt,d as r,q as E,t as f,H as Nt,h as d,r as v,a as i,I as Tt,J as pt}from"./chunk-50382bc7.js";import{a as e,b as n}from"./chunk-2d0907d4.js";const $e=function(e){return new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/-1e3)},Kt=function(e){return new THREE.Euler(e.x,e.z,-e.y)},Qt=function(e){return new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/1e3)},$t=function(e){return{x:1e3*e.x,y:-1e3*e.z,z:1e3*e.y}},eo=function(e){return decodeURIComponent(e)},U=function(e){if(!e){const t=typeof e;return"number"===t||"boolean"===t?e:null}if(!e.hasOwnProperty("size")&&e.size&&"function"==typeof e.size){let t=to(e);for(let e=0;e<t.length;e++)t[e]=U(t[e]);return"string"==typeof t?eo(t):t}if("object"==typeof e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=U(e[t]));return"string"==typeof e?eo(e):e},to=function(e){let t=[];if(e){let o=e.size();for(let n=0;o>n;n++)t.push(e.get(n))}return t},oo=function(e){let t=new THREE.Matrix4,o=U(e);return t.fromArray(o),t.transpose(),function(e){let t=new THREE.Matrix4;t.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),t.scale(new THREE.Vector3(.001,.001,.001));let o=new THREE.Matrix4;return o.set(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1),o.scale(new THREE.Vector3(1e3,1e3,1e3)),t.multiply(e).multiply(o)}(t)};function k(){class e extends THREE.Object3D{constructor(e,t,o,n){super(),this._selected=!1,this.meshes=[],this.castShadow=!0,this.receiveShadow=!0,this._setValues(e,t,o,n)}static _generateDashedLine(e,t){let o=new THREE.LineSegments(e,new THREE.LineDashedMaterial({color:"#000000",dashSize:.03,gapSize:.01,linewidth:1}));return o.translateOnAxis(t,1),o}static _generateCubeGeometry(e,t,o){let n=new THREE.Geometry;return n.vertices.push(new THREE.Vector3(-e,-t,-o),new THREE.Vector3(-e,t,-o),new THREE.Vector3(-e,t,-o),new THREE.Vector3(e,t,-o),new THREE.Vector3(e,t,-o),new THREE.Vector3(e,-t,-o),new THREE.Vector3(e,-t,-o),new THREE.Vector3(-e,-t,-o),new THREE.Vector3(-e,-t,o),new THREE.Vector3(-e,t,o),new THREE.Vector3(-e,t,o),new THREE.Vector3(e,t,o),new THREE.Vector3(e,t,o),new THREE.Vector3(e,-t,o),new THREE.Vector3(e,-t,o),new THREE.Vector3(-e,-t,o),new THREE.Vector3(-e,-t,-o),new THREE.Vector3(-e,-t,o),new THREE.Vector3(-e,t,-o),new THREE.Vector3(-e,t,o),new THREE.Vector3(e,t,-o),new THREE.Vector3(e,t,o),new THREE.Vector3(e,-t,-o),new THREE.Vector3(e,-t,o)),n}_setValues(e,t,o,n){e&&(this.roomleId=e),t&&(this.roomlePosition=Object.assign({},t)),o&&(this.roomleRotation=Object.assign({},o)),n&&(this.parentObjectId=n)}get loadingMesh(){return this._loadingMesh}get boundingBoxMesh(){return this._boundingBoxMesh}get boundingBox(){return this._boundingBox}set roomlePosition(e){this._roomlePosition=e,e&&this.position.set(e.x/1e3,e.z/1e3,e.y/-1e3)}get roomlePosition(){return this._roomlePosition}set roomleRotation(e){this._roomleRotation=e,e&&this.rotation.set(e.x,e.z,-e.y)}get roomleRotation(){return this._roomleRotation}addMesh(e,t){e.renderOrder=2,e.userData.meshType=0,e.castShadow=!0,e.receiveShadow=!0,t&&e.applyMatrix(oo(t)),this.add(e),this.meshes.push(e)}removeAllMeshes(){this.meshes.forEach(e=>{this.remove(e),ft(e)}),this.meshes=[],this.remove(this._loadingMesh),ft(this._loadingMesh),this._loadingMesh=null,this.remove(this._boundingBoxMesh),ft(this._boundingBoxMesh),this._boundingBoxMesh=null}changeMaterialOfMesh(e,t){let o=this.meshes.find(t=>t.id===e);o?(o.material=t,o.material.needsUpdate=!0):console.warn("could not find mesh with id "+e)}select(){this._selected=!0}loading(){if(!this._kernelBoundingBox)return void console.warn("Bounding box (box for measurements) for component "+this.roomleId+" not set, can not show external mesh loading box!");this.removeAllMeshes();let{x:e,y:t,z:o}=this._kernelBoundingBox.getSize(new THREE.Vector3),n=new THREE.BoxGeometry(e,t,o);this._loadingMesh=new THREE.Mesh(n,new THREE.MeshStandardMaterial({transparent:!0,opacity:b,color:new THREE.Color(g)})),this._loadingMesh.name="loading mesh",this._loadingMesh.receiveShadow=!1,this._loadingMesh.castShadow=!1,this._loadingMesh.layers.set(5),this._loadingMesh.translateOnAxis(this._kernelBoundingBox.getCenter(new THREE.Vector3),1),this._loadingMesh.renderOrder=3,this.add(this._loadingMesh)}deselect(){this._selected=!1}hoverOn(){o("pointer")}hoverOff(){o("default")}removeFromParent(){this.parent&&(this.parent.remove(this),this.removeAllMeshes())}clear(t){this.hoverOff(),t&&this.children.forEach(o=>{o instanceof e&&o.clear(t)})}computeBoundingBox(e,t=!1){this._boundingBoxMesh&&this.remove(this._boundingBoxMesh);let o=null;if(!e||t){let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;this.meshes.forEach(o=>{o.geometry.computeBoundingBox();let a=o.geometry.boundingBox;e=Math.min(e,a.min.x),t=Math.min(t,a.min.y),n=Math.min(n,a.min.z),r=Math.max(r,a.max.x),s=Math.max(s,a.max.y),i=Math.max(i,a.max.z)}),this._boundingBox=new THREE.Box3(new THREE.Vector3(e,t,n),new THREE.Vector3(r,s,i)),this._kernelBoundingBox=this._boundingBox.clone();let a=this._boundingBox.max.x-this._boundingBox.min.x,h=this._boundingBox.max.y-this._boundingBox.min.y,c=this._boundingBox.max.z-this._boundingBox.min.z;o=new THREE.BoxGeometry(a,h,c)}else{this._kernelBoundingBox=s(e),this._boundingBox=this._kernelBoundingBox.clone();let{x:t,y:n,z:r}=this._boundingBox.getSize(new THREE.Vector3);o=new THREE.BoxGeometry(t,n,r)}this._boundingBoxMesh=new THREE.Mesh(o,new THREE.MeshStandardMaterial({color:"#FFFFFF",transparent:!0,opacity:0,polygonOffset:!0,polygonOffsetFactor:-1})),this._boundingBoxMesh.position.add(this._boundingBox.getCenter(new THREE.Vector3)),this._boundingBoxMesh.layers.set(5),this._boundingBoxMesh.renderOrder=3,this.add(this._boundingBoxMesh)}recursiveMeshes(){let t=this.meshes.slice();return this.children.forEach(o=>{o instanceof e&&t.push(...o.recursiveMeshes())}),t}isChild(t){let o=!1;return this.children.forEach(n=>{n instanceof e&&!o&&(o=n.roomleId===t||n.isChild(t))}),o}getKernelPosition(e){let t=this.parent.localToWorld(this.position);return $t(e.worldToLocal(t))}}class t extends e{constructor(e,t){super(e,null,null,null),this.glbUrl=t}}class n extends e{constructor(e,t,o,n){super(e,t,o,n),this._stringId=null,this.receivedPointAssociation=!1,this.castShadow=!1,this.receiveShadow=!1}get stringId(){return this._stringId?this._stringId:this.roomleId.toString()}addMesh(e){super.addMesh(e),e.renderOrder=1,e.castShadow=!1,e.receiveShadow=!1}hoverOn(){this.meshes.forEach(({material:e})=>{e.opacity=.9,e.roughness=rt,e.metalness=ht,e.color=new THREE.Color(g)}),o("pointer")}hoverOff(){this.meshes.forEach(({material:e})=>{e.opacity=b,e.roughness=rt,e.metalness=ht,e.color=new THREE.Color(g)}),o("default")}clonePreview(e){let t=new n(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId);return t._stringId=this.roomleId+"_"+e,this.children.forEach(e=>{e instanceof THREE.Mesh&&0===e.userData.meshType&&t.meshes.push(e.clone(!0))}),t.meshes.forEach(e=>{e.material=e.material.clone(),e.geometry=e.geometry.clone(),t.add(e)}),this._boundingBoxMesh&&(t._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(t._boundingBox=this._boundingBox.clone()),t}preparePreview(){this.add(this._boundingBoxMesh)}}class r extends n{constructor(e,t,o,n,r){super(e,t,o,n),r&&(this._stringId=this.roomleId+"_has_additional_dock_point_copy")}set roomleLineFrom(e){this._roomleLineFrom=e,this.lineFrom=$e(e)}get roomleLineFrom(){return this._roomleLineFrom}set roomleLineTo(e){this._roomleLineTo=e,this.lineTo=$e(e)}get roomleLineTo(){return this._roomleLineTo}set roomlePositionFrom(e){this._roomlePositionFrom=e,this.positionFrom=$e(e)}get roomlePositionFrom(){return this._roomlePositionFrom}set roomlePositionTo(e){this._roomlePositionTo=e,this.positionTo=$e(e)}get roomlePositionTo(){return this._roomlePositionTo}addMesh(e){super.addMesh(e),e.visible=!1,e.renderOrder=3}hoverOn(){o("pointer")}hoverOff(){o("default")}preparePreview(){super.preparePreview();let e=this.lineTo.clone(),t=this.lineFrom.clone(),o=(new THREE.Vector3).subVectors(e,t),n=new THREE.ArrowHelper(o,t),r=new THREE.CylinderGeometry(.01,.01,o.length(),16,1);this.lineMesh=new THREE.Mesh(r,new THREE.MeshStandardMaterial({color:g,transparent:!0,opacity:ot})),this.lineMesh.setRotationFromEuler(new THREE.Euler(n.rotation.x-this.rotation.x,n.rotation.y-this.rotation.y,n.rotation.z-this.rotation.z)),this.lineMesh.renderOrder=1;let s=(new THREE.Vector3).addVectors(e,t).multiplyScalar(.5);this.lineMesh.position.copy((new THREE.Vector3).subVectors(s,this.position.clone())),this.add(this.lineMesh);let i=this._boundingBox.getCenter(new THREE.Vector3),a=null,h=0;o.x>o.y&&o.x>o.z?(a=new THREE.Vector3(i.x,0,0),h=Math.sqrt(i.y*i.y+i.z*i.z)):o.y>o.x&&o.y>o.z?(a=new THREE.Vector3(0,i.y,0),h=Math.sqrt(i.x*i.x+i.z*i.z)):o.z>o.y&&o.z>o.x&&(a=new THREE.Vector3(0,0,i.z),h=Math.sqrt(i.y*i.y+i.x*i.x));let c=new THREE.CylinderGeometry(1.1*h,1.1*h,(new THREE.Vector3).subVectors(this.positionTo.clone(),this.positionFrom.clone()).length()+a.length(),32,1);this.boundingLineMesh=new THREE.Mesh(c,new THREE.MeshStandardMaterial({color:"#ffffff",transparent:!0,opacity:0}));let l=this.positionTo.clone(),d=this.positionFrom.clone(),u=(new THREE.Vector3).subVectors(l,d),p=new THREE.ArrowHelper(u,d);this.boundingLineMesh.setRotationFromEuler(new THREE.Euler(p.rotation.x-this.rotation.x,p.rotation.y-this.rotation.y,p.rotation.z-this.rotation.z)),this.boundingLineMesh.renderOrder=3;let m=(new THREE.Vector3).addVectors(this.positionTo.clone(),this.positionFrom.clone()).multiplyScalar(.5).add(i);this.boundingLineMesh.position.copy((new THREE.Vector3).subVectors(m,this.position.clone())),this.add(this.boundingLineMesh)}clonePreviewLine(e){let t=new r(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId,this.receivedPointAssociation);return t._stringId=this.roomleId+"_"+e,this.children.forEach(e=>{e instanceof THREE.Mesh&&0===e.userData.meshType&&t.meshes.push(e.clone(!0))}),t.meshes.forEach(e=>{e.material=e.material.clone(),e.geometry=e.geometry.clone(),t.add(e)}),this._boundingBoxMesh&&(t._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(t._boundingBox=this._boundingBox.clone()),t}getPositionForIntersectionPoint(e){let t=this.positionTo.clone().add(this._boundingBox.getCenter(new THREE.Vector3)),o=this.positionFrom.clone().add(this._boundingBox.getCenter(new THREE.Vector3));return new THREE.Line3(o,t).closestPointToPoint(e,!0,new THREE.Vector3).sub(this._boundingBox.getCenter(new THREE.Vector3))}updatePreviewPosition(e){let t=this.getPositionForIntersectionPoint(e),o=this.parent.localToWorld(t);this._newPosition=this.worldToLocal(o)}hideSelectionLine(){}getKernelPosition(e){if(this._newPosition){let t=this.localToWorld(this._newPosition);return $t(e.worldToLocal(t))}return super.getKernelPosition(e)}}class i extends THREE.PerspectiveCamera{constructor(e,t,o,n,r,s){super(e,t,o,n),this._element=r,this.offset=s}set offset(e){this._offset=e,this.updateProjectionMatrix()}get offset(){return this._offset}_calculateProjectionMatrix(){let e,t,o,n,r=this.fov*(2*Math.PI/360)/2;n=-(o=Math.tan(r));let s=this._element.clientWidth/this._element.clientHeight,i=Math.atan(s*Math.tan(r));e=-(t=Math.tan(i));let a=this._offset.left,h=this._offset.right,c=this._offset.top,l=this._offset.bottom,d=new THREE.Vector2(h-a,c-l),u=new THREE.Vector2(a+d.x/2,l+d.y/2);if(d.x<d.y){let r=(1-u.x)/(d.x/2),s=u.x/(d.x/2);t*=r,e*=s;let i=(r+s)/2;o*=i,n*=i}else{let r=(1-u.y)/(d.y/2),s=u.y/(d.y/2);o*=r,n*=s;let i=(s+r)/2;e*=i,t*=i}e*=this.near,t*=this.near,o*=this.near,n*=this.near;let g=this.near*Math.tan(Math.PI/180*.5*this.fov)/this.zoom*2,p=this.aspect*g;return this.view&&this.view.enabled&&(e+=this.view.offsetX*p/this.view.fullWidth,o-=this.view.offsetY*g/this.view.fullHeight,t+=this.view.offsetX*p/this.view.fullWidth,n-=this.view.offsetY*g/this.view.fullHeight),(new THREE.Matrix4).makePerspective(e,t,o,n,this.near,this.far)}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){this._offset?this.projectionMatrix=this._calculateProjectionMatrix():super.updateProjectionMatrix()}}return{create:function(t,o,n,r){return new e(t,o,n,r)},createPreview:function(e,t){return new n(e,{x:0,y:0,z:0},{x:0,y:0,z:0},t)},createStatic:function(e,o){return new t(e,o)},createPreviewLine:function(e){let t=new r(e.id,e.roomlePosition,e.roomleRotation,e.parentObjectId,e.receivedPointAssociation);return e.meshes.forEach(e=>{let o=e.clone();o.material=e.material.clone(),o.geometry=e.geometry.clone(),t.addMesh(o)}),t.computeBoundingBox(),t},isPreview:function(e){return e instanceof n},isPreviewLine:function(e){return e instanceof r},createCamera:function(e,t,o,n,r,s){return new i(e,t,o,n,r,s)}}}const no={isProduction:!0,isUnitTesting:JSON.parse("false"),environment:"production",detailEnvironment:"development",features:{hdEnabledByDefault:JSON.parse("false")},APP:{RAPI:{server:"https://api.roomle.com/v2",liveServer:"https://api.roomle.com/v2",testServer:"https://api.test.roomle.com/v2",headers:{apiKey:"roomle_portal_v2",currentTenant:9,locale:"en",language:"en",device:1,token:"anonymous"}},WASM:{CONFIGURATOR:{URL:"static/kernel-artifacts/wasm/ConfiguratorKernel.wasm",CACHE_COMPILATION:!0,HASH:"9280d672b3cde34d8edc02491faa0990",LOADER:"static/kernel-artifacts/wasm/ConfiguratorKernel.js"},PLANNER:{URL:"static/kernel-artifacts/wasm/RoomleCore.wasm",CACHE_COMPILATION:!0,HASH:"b574e1adf08376cbde4481df90d681e7",LOADER:"static/kernel-artifacts/wasm/RoomleCore.js"}},ASM:{CONFIGURATOR:{MEM_URL:"static/kernel-artifacts/ConfiguratorKernelJs.mem",LOADER:"static/kernel-artifacts/ConfiguratorKernelJs.js"},PLANNER:{MEM_URL:"static/kernel-artifacts/RoomleCoreJs.mem",LOADER:"static/kernel-artifacts/RoomleCoreJs.js"}},SHORTENER_URL:"http://rml.co/"},environments:{PRODUCTION:"production",DEVELOPMENT:"development",TEST:"test",TEST_SERVER:"test_server",ALPHA:"alpha"}};window.IS_DEBUG=!0;const ro=no,so=E(30);class M extends r{constructor(e,t,o){super(),this._offset=new THREE.Vector3(0,0,0),this._scene=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._addInputListeners(o),this._planeBottom=new THREE.Plane(new THREE.Vector3(0,1,0)),this._planeFront=new THREE.Plane(new THREE.Vector3(0,0,1)),this._planeSide=new THREE.Plane(new THREE.Vector3(1,0,0))}_addInputListeners(e){e.addEventListener(5,e=>{this._findSelection(e.positionRelative)},this),e.addEventListener(6,e=>{this._findHover(e.positionRelative,e.type)},this),e.addEventListener(0,e=>{this._onDragStart(e.positionRelative)},this),e.addEventListener(1,e=>{this._onDrag(e.positionRelative)},this),e.addEventListener(2,e=>{this._onDragEnd(e.positionRelative)},this)}_findSelection(e){let t=this._intersection(e);t?t&&t.object.dispatchEvent({type:"select"}):this.dispatchEvent(3)}_findHover(e,t){let o=this._intersection(e);!o&&this._currentHover?(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:t}}),this._currentHover=null):o&&(this._currentHover&&this._currentHover.id!==o.object.id&&(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:t}}),this._currentHover=null),this._currentHover?this._currentHover.dispatchEvent({type:"hover_move",attachment:{intersection:o,type:t}}):(this._currentHover=o.object,this._currentHover.dispatchEvent({type:"hover_on",attachment:{intersection:o,type:t}})))}_intersection(e){let t=this._intersect(e);if(0>=t.length)return null;let o=t[0];return t.length>1&&this._currentHover&&this._currentDrag&&this._currentDrag.id!==this._currentHover.id&&t.forEach(e=>{e.object.id!==this._currentHover.id||e.object.userData.priority!==this._currentHover.userData.priority||o.object.userData.priority>e.object.userData.priority||(o=e)}),o}_intersect(e){this._raycaster.setFromCamera(e,this._camera);let t=[];return this._raycaster.intersectObjects(this._scene.children,!0).forEach(e=>{e.object.userData.hasListener&&t.push(e)}),0>t.length?[]:t.sort((e,t)=>e.object.userData.priority!==t.object.userData.priority?t.object.userData.priority-e.object.userData.priority:e.distance-t.distance)}_onDragStart(e){let t=this._intersection(e);if(!t&&!this._currentDrag)return;if(t&&t.object.userData.roomleId===this._rootComponentId)return;!this._currentDrag&&t&&(this._currentDrag=t.object,this._currentDrag.dispatchEvent({type:"drag_start"}));let o=this._currentDrag.parent;o&&o.computeBoundingBox&&(o.computeBoundingBox(),this._positionPlanes(o),this._calculateOffset(o))}_onDrag(e){if(!this._currentDrag)return;this._raycaster.setFromCamera(e,this._camera);let t=new THREE.Vector3(0,0,-5),o=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,0,0);this._raycaster.ray.intersectPlane(this._planeBottom,t),this._raycaster.ray.intersectPlane(this._planeFront,o),this._raycaster.ray.intersectPlane(this._planeSide,n);let r,s=t.clone().sub(this._camera.position),i=o.clone().sub(this._camera.position),a=n.clone().sub(this._camera.position),h=s.length(),c=i.length(),l=a.length(),d=this._camera.userData.yaw;-so>d||d>so?c>h&&l>h?r=t.clone():h>c&&l>c?r=o.clone():h>l&&c>l&&(r=n.clone()):r=c>h?t.clone():o.clone(),r.sub(this._offset),this._currentDrag.dispatchEvent({type:"drag",attachment:{position:r}})}_onDragEnd(e){this._currentDrag&&(this._currentDrag.dispatchEvent({type:"drag_end",attachment:{position:e}}),this._currentDrag=null)}_positionPlanes(e){e&&e.boundingBox&&this._rootComponentPosition&&(this._planeBottom.constant=-e.boundingBox.getCenter(new THREE.Vector3).y-this._rootComponentPosition.y,this._planeSide.constant=2*-e.boundingBox.getSize(new THREE.Vector3).x+e.boundingBox.getCenter(new THREE.Vector3).x,this._camera.userData.yaw>0&&(this._planeSide.constant*=-1),this._bounds&&(this._planeFront.constant=this._bounds.z/2+e.boundingBox.getCenter(new THREE.Vector3).z))}_calculateOffset(e){e&&e.boundingBox&&(this._offset.copy(e.boundingBox.getCenter(new THREE.Vector3)),this._offset.applyQuaternion(e.getWorldQuaternion(new THREE.Quaternion)))}update(e,t,o){if(e&&(this._bounds=e),t&&(this._rootComponentPosition=t),o){this._backgroundScene=o;let e=this._backgroundScene.children[0];e instanceof THREE.Mesh&&(e.geometry.computeBoundingBox(),this._backgroundSceneWidth=e.geometry.boundingBox.getSize(new THREE.Vector3).x)}}clear(){this._currentDrag&&ft(this._currentDrag),this._currentHover&&ft(this._currentHover)}enableDragIn(e){this._currentDrag=e}setRootComponentId(e){this._rootComponentId=e}setCamera(e){this._camera=e}}const G=function(e){return!(!e||"string"!=typeof e)&&2>=e.split(":").length},D=function(e){if(!e||"string"!=typeof e)return null;const t=e.split(":");return 2>t.length?null:t[0]},{APP:io}=ro,{RAPI:ao}=io,ho=ao.headers,co=ho.token,lo="live",uo=1500,F="crt",go=50,po={GET:"GET",POST:"POST"},mo=6e4;let _o=new Map,Eo=new Map,fo=new Map,wo=new Map,yo=new Map,To=new Map,bo=new Map,vo=new Map;const Ro="hsc_configurations_offline_queue_v1";let Mo=new Map;const xo="__rapi_path__";class B{constructor(){window.addEventListener("online",this._flushOfflineQueue.bind(this))}overrideTenant(e){e&&(this._overrideTenant=e)}setConfiguratorId(e){e&&(this._configuratorId=e)}overrideCountry(e){e&&(this._overrideCountry=e)}overrideRapi(e){e&&(this._overrideRapi=e)}getPreloadForItem(e){return this._getPreload(e,!0)}getPreloadForConfiguration(e){return this._getPreload(e,!1)}_getPreload(e,t){return new Promise((o,n)=>{if(!navigator.onLine)return o();if(this._dataSyncer.getIsCatalogSynced(D(e)))return o();if(bo.get(e))return o();const r=t?"?itemId=":"?configurationId=";this._get("/preloads/components/"+r+e,"preloads/components").then(t=>{if(bo.get(e))return o();t.forEach(e=>{this._prepareData(e,"components")}),bo.set(e,!0),o()},n)})}changeUseOfHDGeometry(){const e=wo.get("components");bo.clear(),To.clear(),e&&wo.delete("components")}getHSCPackage(e){return new Promise((t,o)=>{if(To.get(e))return t();this._get("/catalogs/"+e+"/package","package").then(o=>{if(To.get(e))return t(o);o.components.forEach(e=>{this._prepareData(e,"components")}),o.materials.forEach(e=>{this._prepareData(e,"materials"),this._prepareGroups(e)}),o.textures.forEach(e=>{this._prepareData(e,"textures")}),To.set(e,!0),t(o)},o)})}getComponent(e){return this._getById(e,"components")}getConfiguration(e){return this._getById(e,"configurations")}getItem(e){return this._getById(e,"items")}getComponents(e){return this._getByIds(e,"components")}getItems(e){return this._getByIds(e,"items")}getTag(e){return this._getById(e,"tags")}getTags(e){return this._getByIds(e,"tags")}getTexture(e){return this._getById(e,"textures")}getCatalog(e){return this._getById(e,"catalogs")}getMesh(e,t=F,o=go){return this._getById(e,"meshes",{path:"/data?format="+t+"&targetQuality="+o.toString()})}getMeshesOfCatalog(e){return new Promise((t,o)=>{const n=yo.get(e);n?t(n):this._get("/meshes?catalog="+e,"catalogMeshes").then(o=>{yo.set(e,o),t(o)},o)})}getTexturesOf(e){return this._getRelationData(e,{rapiPath:"textures"})}getItemsOf(e){return this._getRelationData(e,{rapiPath:"items"})}getMaterialsOf(e){return this._getRelationData(e,{rapiPath:"materials"})}getComponentsOf(e){return this._getRelationData(e,{rapiPath:"components"})}getAdditionalContentsOfItems(e){const t=[],o=[];return e.forEach(e=>{const n=Eo.get(e.id);n?o.push(...n):t.push(e.id)}),new Promise((e,n)=>{0!==t.length?this._getByIdsPackets(t,"itemAdditionalContents",{filterKey:"itemIds"}).then(t=>{t.forEach(e=>{let t=Eo.get(e.itemId);t||(t=[]);for(let o=0,n=t.length;n>o;o++)if(t[o].id===e.id)return;t.push(e),Eo.set(e.itemId,t)}),e([...t,...o])},n):e(o)})}getMaterial(e){return this._getById(e,"materials")}peekMaterial(e){return this._peekData(e,"materials")}peekComponent(e){return this._peekData(e,"components")}getMaterials(e){return this._getByIds(e,"materials")}getPlan(e){return this._getById(e,"plans")}cleanUp(){_o=new Map,fo=new Map,wo=new Map,To=new Map,bo=new Map,vo=new Map,Eo=new Map}getMaterialsByGroup(e){const t=e.slice(),o=[];let n=t.length;for(let e=0;n>e;e++){const r=_o.get(t[e]);if(r){const s=r.length;for(let e=0;s>e;e++){const t=this._getCache("materials").get(r[e]);o.push(t)}t.splice(e,1),n--,e--}}return new Promise((e,n)=>{0!==t.length&&navigator.onLine?this._getByIdsPackets(t,"materials",{filterKey:"groups"}).then(t=>{e(this.combineMaterialsToGroups([...t,...o]))},n):e(this.combineMaterialsToGroups(o))})}_flushOfflineQueue(){return new Promise((e,t)=>{const o=this._localStorage.getItem(Ro),n=[];for(let e in o)if(o.hasOwnProperty(e)){const t=o[e];n.push(new Promise((e,o)=>{this.saveConfiguration(t.data).then(n=>{const r=[];t.perspectiveImage&&!n.perspectiveImage&&r.push(this.savePerspectiveImage(n,t.perspectiveImage)),t.topImage&&!n.topImage&&r.push(this.savePerspectiveImage(n,t.topImage)),Promise.all(r).then(e,o)},o)}))}Promise.all(n).then(()=>{this._localStorage.setItem(Ro,{}),e()},t)})}_setQueuedConfiguration(e,t={}){const o=e.configurationHash,{perspectiveImage:n,topImage:r}=t;let s=this._localStorage.getItem(Ro)||{},i=s[o]||{};i.data=e,i.perspectiveImage=n,i.topImage=r,s[o]=i,this._localStorage.setItem(Ro,s)}saveConfiguration(e){return navigator.onLine?this._save("/configurations",{configuration:e},"configurations",{accept:"application/json",contentType:"application/json; charset=UTF-8"}):(e.perspectiveImage=null,e.topImage=null,this._setQueuedConfiguration(e),this._markConfigurationAsLocally(e),Promise.resolve(e))}saveTopImage(e,t){return this._saveConfigurationImage(e,t,"topImage")}savePerspectiveImage(e,t){return this._saveConfigurationImage(e,t,"perspectiveImage")}getShortUrl(e,t){return new Promise((o,n)=>this._fetchJson("/shortIds","shortIds",{method:po.POST,resolve:o,reject:n,data:JSON.stringify({shortId:{type:t,referencedId:e}})}))}_peekData(e,t){const o=wo.get(t);return o&&o.get(e)||null}_saveConfigurationImage(e,t,o){if(!navigator.onLine){const n={};return n[o]=t,this._setQueuedConfiguration(e,n),this._markConfigurationAsLocally(e),e[o]=t.image,Promise.resolve(e)}const n=this._formDataUtil.create(t.image,e.configurationHash,Nt.PNG,o);return this._save("/configurations/"+e.id+"/"+o,n,"configurations",{accept:"application/json"})}_markConfigurationAsLocally(e){e.isLocally=!0,e.id=e.configurationHash}_save(e,t,o,n={}){const r=t instanceof FormData?t:JSON.stringify(t);return new Promise((t,s)=>{const i={method:po.POST,data:r,resolve:t,reject:s};n.contentType&&(i.contentType=n.contentType),n.accept&&(i.accept=n.accept),this._fetchJson(e,o,i)})}combineMaterialsToGroups(e){const t=new Map,o={id:null,label:null,materials:[]};for(let n=0,r=e.length;r>n;n++){const r=e[n],s=r.group,i=r.id,a=[];let h=s?_o.get(s):a;h||(_o.set(s,[]),h=_o.get(s)),-1===h.indexOf(i)&&h.push(i);let c=s?t.get(s):o;c||(t.set(s,{id:s,label:r.groupLabel,materials:[]}),c=t.get(s)),c.materials.push(r)}const n=o.materials.length?[o]:[];return t.forEach((e,t)=>{n.push({id:t,label:e.label,materials:e.materials})}),n}_getByIds(e,t){const o=this._getCache(t),n=this._getErrorCache(t),r=[],s=e.slice();let i=s.length;if(o&&o.size){const e=(new Date).getTime();for(let t=0;i>t;t++){const a=s[t],h=o.get(a),c=n.get(a);let l=!1;null!=h?(r.push(h),l=!0):l=void 0!==c&&(e-c.timestamp<mo||!1===navigator.onLine),l&&(s.splice(t,1),i--,t--)}}return new Promise((e,o)=>{0!==s.length&&navigator.onLine?this._getByIdsPackets(s,t).then(t=>{e([...t,...r])},o):e(r)})}_getByIdsPackets(e,t,o={}){const n=o.filterKey||"ids";let r,s="/"+t+"/",i="?",a=[];const h=e.length;if(!h)return new Promise(e=>e([]));let c=!0,l=[];for(r=0;h>r;r++){c=!1;const o=e[r],h=i+n+"[]="+o,d=h.length+s.length;l.push(o),i="&",d>uo?(d>uo&&(l.pop(),r--),a.push({url:s,ids:l}),c=!0,s="/"+t+"/",i="?",l=[]):s+=h}c||a.push({url:s,ids:l});const d=[];return a.forEach(e=>d.push(this._getByIdsSingle(e.ids,e.url,t))),new Promise((e,t)=>{Promise.all(d).then(t=>{const o=[];t.length&&t.forEach(e=>o.push(...e)),e(o)},t)})}_getByIdsSingle(e,t,o){return new Promise((n,r)=>{this._get(t,o).then(t=>{for(let o=0,n=t.length;n>o;o++){const n=e.indexOf(t[o].id);-1!==n&&e.splice(n,1)}const r=e.length;if(r){const t=this._getCache(o),n=this._getErrorCache(o),s=(new Date).getTime();for(let o=0;r>o;o++)n.set(e[o],{code:0,timestamp:s}),t.delete(e[o]);this._errorHandler.dispatch(2,[o,e.map(e=>'"'+e+'"').join(",")])}n(t)},r)})}_getById(e,t,o={}){const n=this._getCache(t).get(e);if(n)return new Promise(e=>e(n));if(!navigator.onLine)return Promise.reject("Nothing cached but tried to fetch in offline mode");const r={id:e},s=o.path||"";return this._get("/"+t+"/"+e+s,t,r)}_get(e,t,o=null){const n=f.useHDGeometry?"includeGeometryHD=true":"";if(""!==n){const t=-1===e.indexOf("?")?"?":"&";e+=t+n}return new Promise((n,r)=>{const s=vo.get(e);Array.isArray(s)&&s.length>0?s.push({resolve:n,reject:r}):(vo.set(e,[{resolve:n,reject:r}]),this._fetchJson(e,t,o))})}_fetchJson(e,t,o){const n={method:o&&o.method?o.method:po.GET,headers:this._createHeaders(o),mode:"cors",cache:"default"};o&&o.data&&(n.body=o.data);let r=ao.server;const s=this._overrideRapi;s&&(r=s===lo?ao.liveServer:ao.testServer);const i=new Request(r+e,n);this._networkLayer.fetch(i).then(d.bind(this)).then(this._handleJson(e,t,o).bind(this)).catch(this._handleError(e,o).bind(this))}_createHeaders(e){this._overrideTenant&&(ho.currentTenant=this._overrideTenant),this._overrideCountry&&(ho.country=this._overrideCountry);const{locale:t}=window.__RML__ENV__.initData;ho.language=t,ho.locale=t,e&&e.contentType&&(ho["content-type"]=e.contentType),e&&e.accept&&(ho.accept=e.accept),this._configuratorId&&(ho.configurator=this._configuratorId),ho.token="03-"+window.btoa((new Date).toISOString()+";"+co+";"+ho.apiKey);const o=new Headers(ho);return e&&e.data instanceof FormData&&o.delete("content-type"),o}_handleJson(e,t,o){return n=>{let r=null,s=null;for(let e in n)"meta"!==e&&n.hasOwnProperty(e)&&(r=n[e],s=e);if("error"===s)return this._handleError(e,o)(new Error(JSON.stringify(r)));if(!r)throw new TypeError("RAPI returned empty JSON");if(Array.isArray(r))for(let e=0,n=r.length;n>e;e++)this._prepareData(r[e],t,o);else this._prepareData(r,t,o);o&&o.resolve?o.resolve(r):this._notifyWaiters(e,null,r)}}_getCache(e){return this._getCacheFrom(e,wo)}_getErrorCache(e){return this._getCacheFrom(e,Mo)}_getCacheFrom(e,t){let o=t.get(e);return o||(t.set(e,new Map),o=t.get(e)),o}_prepareData(e,t,o=null){let n=this._getCache(t);if(!(e.id||o&&o.id))return void("shortIds"!==t&&console.error("Can not cache because there is no ID!"));const r=e.id?e.id:o.id;n.set(r,e),e[xo]=t}_getRelationsCacheFor(e,t,o){let n=fo.get(t);if(!n){const r=new Map,s=new Map;s.set(o,void 0),r.set(e,s),fo.set(t,r),n=fo.get(t)}let r=n.get(e);if(!r){const t=new Map;t.set(o,void 0),n.set(e,t),r=n.get(e)}return r.get(o)}_prepareGroups(e){const t=e.group,o=e.id;let n=_o.get(t);n||(_o.set(t,[]),n=_o.get(t)),-1===n.indexOf(o)&&n.push(o)}_handleError(e,t){return o=>{navigator.onLine?(o.rmlErrorCode=1,this._errorHandler.dispatch(1,[o])):(o.rmlErrorCode=0,this._errorHandler.dispatch(0,[o])),t&&t.reject?t.reject(o):this._notifyWaiters(e,o,null)}}_getRelationData(e,t){const o=e.id,n=e[xo],r=t.rapiPath;let s=this._getCache(r),i=this._getRelationsCacheFor(o,n,r),a=[];return i?(i.forEach(e=>a.push(s.get(e))),new Promise(e=>e(a))):navigator.onLine?new Promise((e,t)=>{this._get("/"+n+"/"+o+"/"+r,r).then(t=>{let s=fo.get(n).get(o),i=this._getCache(r),a=[];for(let e=0,o=t.length;o>e;e++){const o=t[e],n=o.id;a.push(n),i.set(n,o)}s.set(r,a),e(t)},t)}):Promise.resolve([])}_notifyWaiters(e,t,o){const n=vo.get(e);if(n&&n.length){for(let e=0,r=n.length;r>e;e++)t?n[e].reject(t):n[e].resolve(o);vo.delete(e)}}}e([n],B.prototype,"_formDataUtil",void 0),e([n],B.prototype,"_errorHandler",void 0),e([n],B.prototype,"_dataSyncer",void 0),e([n],B.prototype,"_networkLayer",void 0),e([n],B.prototype,"_localStorage",void 0);const Ho="404";class Io{static openDb(e,t,o){return new Promise((n,r)=>{const s=indexedDB.open(e,t);s.onerror=function(){r(`Error in OpenDB: ${this.error}`)},s.onsuccess=function(){n(this.result)},s.onupgradeneeded=o})}static getObjectStore(e,t,o){return e.transaction([t],o).objectStore(t)}static getRecordFromObjectStore(e,t,o){return new Promise((n,r)=>{const s=Io.getObjectStore(e,t,"readonly").get(o);s.onerror=function(){r(`Error in GetRecordFromObjectStore: ${this.error}`)},s.onsuccess=function(){const e=this.result;e?n(e):r(Ho)}})}static deleteRecordFromObjectStore(e,t,o){return new Promise((n,r)=>{const s=Io.getObjectStore(e,t,"readwrite").delete(o);s.onerror=function(){r(`Error in DeleteRecordFromObjectStore: ${this.error}`)},s.onsuccess=function(){n()}})}static saveRecordToObjectStore(e,t,o){return new Promise((n,r)=>{let s=null;try{s=Io.getObjectStore(e,t,"readwrite").put(o)}catch(e){return r(e)}if(!s)return r(new Error("Unknown problem"));s.onerror=function(){r(`Error in SaveToIndexedDB: ${this.error}`)},s.onsuccess=function(){n()}})}}const Po="WasmCache",Co=1,Bo="Modules";class So{static getCompiledModuleFromIndexedDB(e,t,o,n){Io.openDb(Po,Co,So.handleUpgradeDB).then(r=>{Io.getRecordFromObjectStore(r,Bo,So.DB_KEY).then(s=>{s.wasmVersion!==t?Io.deleteRecordFromObjectStore(r,Bo,So.DB_KEY).then(()=>{So.loadWebAssemblyFromFile(r,e,t,o,n)}):(v.start("kernel_compile_instance"),v.addMeta("kernel_is_ready",{cachedInIndexedDB:!0}),window.WebAssembly.instantiate(s.wasmModule,o).then(e=>n(e)),v.end("kernel_compile_instance"))},s=>{s!==Ho&&console.error(s),So.loadWebAssemblyFromFile(r,e,t,o,n)})},r=>{console.error(r),So.loadWebAssemblyFromFile(null,e,t,o,n)})}static handleUpgradeDB(e){e.target.result.createObjectStore(Bo,{keyPath:"key"})}static loadWebAssemblyFromFile(e,t,o,n,r){const s="function"==typeof WebAssembly.instantiateStreaming;v.addMeta("kernel_is_ready",{cachedInIndexedDB:!1});let a=null;s?(v.start("kernel_stream_compile"),a=WebAssembly.instantiateStreaming(fetch(i()+t),n),v.end("kernel_stream_compile")):(v.start("kernel_legacy_compile"),a=fetch(i()+t).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,n))),v.addMeta("kernel_is_ready",{instantiateStreaming:s}),a.then(t=>{if(v.end(s?"kernel_stream_compile":"kernel_legacy_compile"),r(t.instance),null!==e)try{const n={key:So.DB_KEY,wasmVersion:o,wasmModule:t.module};(window.requestIdleCallback?window.requestIdleCallback:window.requestAnimationFrame)(()=>Io.saveRecordToObjectStore(e,Bo,n).then(()=>!0,e=>console.warn(`WASM not saved to IndexedDB: ${e.message}`)))}catch(e){console.error(`Unable to save the WebAssembly module to IndexedDB: ${e.message}`)}},e=>{console.error(e)})}}let Oo,Do,Vo,Ao,Lo,ko;So.DB_KEY="";const Fo=!(null!=navigator.userAgent.match(/iPad|iPhone|iPod/i)||!window.WebAssembly);class A{constructor(e){this._subComponentsWaiters=new Map,this._shouldWait=!0,this._setupKernelPaths(e),this._setupEmsModule(e),this._useWASM=Fo,this._kernelPath=Fo?Ao:Lo,window.KernelCallback={isReady:this.isReady.bind(this)}}_utilityToLongArray(e){const t=new this._kernelContainer.LongArray;return e.forEach(e=>t.push_back(e)),t}_setupKernelPaths(e){const t=0===e?"PLANNER":"CONFIGURATOR";Oo=ro.APP.ASM[t].MEM_URL,Do=ro.APP.WASM[t].URL,Vo=t+":"+ro.APP.WASM[t].HASH,So.DB_KEY=t+"_KERNEL_WASM",Ao=ro.APP.WASM[t].LOADER,Lo=ro.APP.ASM[t].LOADER,ko=ro.APP.WASM[t].CACHE_COMPILATION}_setupEmsModule(e){this._kernelContainer={locateFile(t){const o=0===e?/RoomleCoreJs[\-a-z0-9]*\.js\.mem/:/ConfiguratorKernelJs[\-a-z0-9]*\.js\.mem/;return t.match(o)?i()+Oo:t},wasmBinaryFile:i()+Do,preRun:[],postRun:[],setStatus:null,print(e){},printErr(e){console.error(e)},quit(e){console.error(e)}},ko&&Fo&&(this._kernelContainer.instantiateWasm=function(e,t){return So.getCompiledModuleFromIndexedDB(Do,Vo,e,t),{}})}_passSubComponentsToKernel(e,t){const o=e.id,n=t.get(o);if(n)for(let t=0,r=n.length;r>t;t++){const{parentId:r,partId:s}=n[t];this._kernelInstance.loadedSubComponent(r,s,o,e.configuration)}}_fetchSubComponents(e){let t=[...e.keys()];t.length&&this._rapiAccess.getComponents(t).then(t=>{for(let o=0,n=t.length;n>o;o++)this._passSubComponentsToKernel(t[o],e);this._flushSubComponentsWaiters()})}_flushSubComponentsWaiters(){this._fetchSubComponents(this._subComponentsWaiters),this._subComponentsWaiters=new Map,this._shouldWait=!1}isReady(){this._kernelContainer.setIoContext(this._kernelIo),ro.isProduction||ro.isUnitTesting||this.addDebugInfo(),window.KernelCallback&&(window.KernelCallback=null,delete window.KernelCallback)}addDebugInfo(){const e=function(t,o=[]){const n=Object.getPrototypeOf(t),r=n?Object.getOwnPropertyNames(n):[],s=t?Object.getOwnPropertyNames(t):[];return n?e(n,[...o,...s,...r]):[...s,...r,...o]},t=e(this),o=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","valueOf"];[...new Set(t)].forEach(e=>{if("_"!==e[0]&&"function"==typeof this[e]&&-1===o.indexOf(e))try{const t=this[e].bind(this);this[e]=function(...o){return this._kernelIo.log("[ KernelCommunication ]: "+e),t(...o)}}catch(e){}})}loadComponent(e,t,o){this._rapiAccess.getComponent(t.componentId).then(n=>{this._kernelInstance.loadComponent(e,n.configuration,t,o),this._flushSubComponentsWaiters()},n=>{this._kernelInstance.loadComponent(e,"error",t,o),this.onLoadComponentError(n),this._flushSubComponentsWaiters()})}loadSubComponent(e,t,o){if(this._shouldWait){let n=this._subComponentsWaiters.get(o);n||this._subComponentsWaiters.set(o,[]),(n=this._subComponentsWaiters.get(o)).push({parentId:e,partId:t}),this._subComponentsWaiters.set(o,n)}else this._rapiAccess.getComponent(o).then(n=>{this._kernelInstance.loadedSubComponent(e,t,o,n.configuration)})}}e([n],A.prototype,"_rapiAccess",void 0),e([n],A.prototype,"_scriptLoader",void 0),e([n],A.prototype,"_kernelIo",void 0),e([n],A.prototype,"_dataSyncer",void 0);class V{constructor(){this._materialCache=new Map,this._maxAnisotrophy=1,this._waitingForMaterials=[],this._textureLoader=new THREE.TextureLoader,this._previewMaterial=new THREE.MeshStandardMaterial({color:g,roughness:rt,metalness:ht})}generatePreviewBox(e,t,o,n){let r=new THREE.BoxGeometry(e.x,e.y,e.z),s=new THREE.Color(g);n>0&&(s=pt(n));let i=new THREE.MeshStandardMaterial({color:s,opacity:b,transparent:!0}),a=new THREE.Mesh(r,i);return t.y=t.y+e.y/2,a.position.copy(t),a.rotation.y=o,a.castShadow=!1,a.receiveShadow=!1,a}_generateGeometry(e,t,o,n,r){let s;(s=new THREE.Geometry).faceVertexUvs=[],s.faceVertexUvs[0]=[];for(let e=0,o=t.length;o>e;e+=3)s.vertices.push(new THREE.Vector3(t[e]/1e3,t[e+2]/1e3,t[e+1]/-1e3));let i=0;for(let e=0,t=o.length;t>e;e+=3){let t=e,a=e+1,h=e+2,c=3*o[t],l=3*o[a],d=3*o[h],u=[new THREE.Vector3(r[c],r[c+2],-1*r[c+1]),new THREE.Vector3(r[l],r[l+2],-1*r[l+1]),new THREE.Vector3(r[d],r[d+2],-1*r[d+1])];s.faces.push(new THREE.Face3(o[t],o[a],o[h],u));let g=2*o[t],p=2*o[a],m=2*o[h];s.faceVertexUvs[0][i]=[],s.faceVertexUvs[0][i][0]=new THREE.Vector2(n[g],n[g+1]),s.faceVertexUvs[0][i][1]=new THREE.Vector2(n[p],n[p+1]),s.faceVertexUvs[0][i][2]=new THREE.Vector2(n[m],n[m+1]),i++}return s}changeMaterialOfMesh(e,t){e?(e.material=t,e.material.needsUpdate=!0):console.warn("could not find mesh with id "+e.id)}set maxAnisotrophy(e){this._maxAnisotrophy=e}clear(){for(const e of this._materialCache.values())Tt(e);this._materialCache.clear(),this._waitingForMaterials=[]}}e([n],V.prototype,"_rapiAccess",void 0),e([n],V.prototype,"_environmentLoader",void 0),e([n],V.prototype,"_dataSyncer",void 0);export{M as a,k as b,ro as c,D as d,G as e,A as f,F as g,U as h,V as i,B as j,$e as k,Qt as l,Kt as m,oo as n};
//# sourceMappingURL=chunk-2c10b1f1.js.map
