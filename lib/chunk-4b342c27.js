import{c as getColors}from"./chunk-9cf49ec4.js";import{m as CANVAS_ID,o as BasicEnvironment,k as CameraControl3D,K as createMaterial,a4 as getMaterialShading,t as getGUI,x as DependencyInjectionAssignment,z as ScriptLoader,B as DomHelper,y as Logger,h as InputManager,a5 as EnvironmentLoader,E as Main,F as RoomleDependencyInjection,a as Benchmark}from"./chunk-70ef6cff.js";import{a as __decorate,b as inject}from"./chunk-0434d6fb.js";import{d as UiCallback,e as RapiAccess}from"./chunk-21f95e1a.js";import{a as HdLightSetting,b as ConfiguratorMeshGenerator}from"./chunk-89d00103.js";import{a as SceneManager}from"./chunk-53a010d6.js";const SIZE={x:1,y:1,z:1};class MaterialViewerSceneManager extends SceneManager{constructor(e,t){super(e,t,CANVAS_ID.RMV,"3D",!1),this._sceneParams={type:"cube"},this._materialParams={color:"#ffffff",metallic:.5,alpha:0,alphaCutoff:0,doubleSided:!1},this._lightSetting=new HdLightSetting(this._scene),this._initScene()}_initScene(){let e=new THREE.BoxGeometry(SIZE.x,SIZE.y,SIZE.z,100,100,100);if(this._setMaterial(new THREE.MeshPhysicalMaterial({color:getColors().PRIMARY})),this._mesh=new THREE.Mesh(e,this._material),this._mesh.castShadow=!0,this._mesh.position.setY(SIZE.y/2),this._scene.add(this._mesh),this._environment=new BasicEnvironment(this._scene,null,new THREE.Color(16777215)),this._cameraControl instanceof CameraControl3D){const e=new THREE.Box3;e.setFromObject(this._mesh);let{x:t,y:a}=this._domHelper.getClientDimensions();this._cameraControl.updateAndReset(e.getSize(new THREE.Vector3),t,a,e.getCenter(new THREE.Vector3))}this.showGUI()}loadMaterialId(e){return new Promise(t=>{this._configuratorMeshGenerator.loadMaterial(e,100*SIZE.x,100*SIZE.y).then(e=>{this._setMaterial(e),this._mesh.material=this._material,this._updateGUI(),this._requestRender(!0),t()})})}loadMaterial(e){return new Promise(t=>{e.__rapi_path__||(e.__rapi_path__="materials"),this._setMaterial(createMaterial(e,this._environmentLoader.getEnvironmentMap())),this._mesh.material=this._material,this._configuratorMeshGenerator.loadTextures(e,this._material,100*SIZE.x,100*SIZE.y).then(()=>{this._updateGUI(),this._requestRender(!0)}),t()})}loadMaterialShading(e){return new Promise(t=>{let a={shading:e};this._setMaterial(createMaterial(a,this._environmentLoader.getEnvironmentMap())),this._mesh.material=this._material,this._updateGUI(),this._requestRender(!0),t()})}_setMaterial(e){this._material=e,this._materialParams.alpha=e.opacity,this._materialParams.alphaCutoff=e.alphaTest,this._materialParams.color="#"+e.color.getHexString(),this._materialParams.doubleSided=e.side===THREE.DoubleSide,this._materialParams.metallic=1===e.metalness?1:e.reflectivity}getMaterialShading(){return getMaterialShading(this._material)}createCameraControl(e){this._cameraControl=new CameraControl3D(this._creator_,this._getInputManager(),new THREE.Vector3(-1,1,1))}_getInputManager(){return this._inputManager}sceneChanged(){}getPixotronParams(){return{saoparams:{intensity:.25,occlusionWorldRadius:.6,smoothTransition:!0,samplesPerFrame:4,bias:.02,numSamples:200,accumulative:!0},shadowparams:{shadowMapResolution:1024,shadowRadius:1,shadowQuality:1,smoothTransition:!0,enableAccumulation:!0,shadowBiasMultiplier:.05,nearPlane:.01,farPlane:50,fov:40,numSamples:50,side:THREE.FrontSide},groundShadow:{enable:!1,smoothTransition:!0,numSamples:500,numSamplesPerFrame:4,onComplete:this._addGroundShadows.bind(this)}}}_guiLoaded(){this._updateGUI()}_updateGUI(){let e=getGUI();this._guiGeometryFolder||(this._guiGeometryFolder=e.addFolder("Geometry"),this._guiGeometryFolder.add(this._sceneParams,"type",{Cube:"cube",Sphere:"sphere",PlaneVertical:"plane_v",PlaneHorizontal:"plane_h"}).onChange(e=>{this._setGeometry()})),this._material&&(this._guiMaterialFolder&&e.removeFolder(this._guiMaterialFolder),this._guiMaterialFolder=e.addFolder("Material"),this._guiMaterialFolder.addColor(this._materialParams,"color").onChange(e=>{this._material.color=new THREE.Color(e),this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"metallic").min(0).max(1).step(.01).onChange(e=>{this._material.metalness=1===e?1:.5,this._material.reflectivity=e||.5,this._shadingChanged()}),this._guiMaterialFolder.add(this._material,"roughness").min(0).max(1).step(.01).onChange(e=>{this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"alpha").min(0).max(1).step(.01).onChange(e=>{this._material.transparent=e<1,this._material.opacity=e,this._material.depthWrite=e>=1,this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"alphaCutoff").min(0).max(1).step(.01).onChange(e=>{this._material.alphaTest=e||0,this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"doubleSided").onChange(e=>{this._material.side=e?THREE.DoubleSide:THREE.FrontSide,this._shadingChanged()})),this._addGUIListener(e)}_shadingChanged(){this._roomleMaterialViewerUiCallback.onMaterialShadingChanged(getMaterialShading(this._material))}_setGeometry(){let e;"cube"===this._sceneParams.type&&(e=new THREE.BoxGeometry(SIZE.x,SIZE.y,SIZE.z,100,100,100)),"sphere"===this._sceneParams.type&&(e=new THREE.SphereGeometry(.5,100,100)),"plane_h"===this._sceneParams.type&&(e=new THREE.PlaneGeometry(SIZE.x,SIZE.z)).rotateX(-Math.PI/2),"plane_v"===this._sceneParams.type&&(e=new THREE.PlaneGeometry(SIZE.x,SIZE.z)),this._mesh.geometry=e,this._requestRender(!0)}}__decorate([inject],MaterialViewerSceneManager.prototype,"_inputManager",void 0),__decorate([inject],MaterialViewerSceneManager.prototype,"_environmentLoader",void 0),__decorate([inject],MaterialViewerSceneManager.prototype,"_configuratorMeshGenerator",void 0),__decorate([inject],MaterialViewerSceneManager.prototype,"_roomleMaterialViewerUiCallback",void 0);class RoomleMaterialViewer{constructor(e){this._creator_=e}init(e){return this._domHelper.setDomElement(e),this._sceneManager?(this._lifeCycleManager.resume(),Promise.resolve()):new Promise(this._initPromiseCallback.bind(this))}_initPromiseCallback(e,t){this._threeLoader.fetch().then(()=>{let t=this._scriptLoader.fetch("static/three/lib/loaders/GLTFLoader.js",{id:"gltf-loader"}),a=this._scriptLoader.fetch("static/three/Tween.js",{id:"tween-js"});Promise.all([t,a]).then(()=>{this._sceneManager=new MaterialViewerSceneManager(this._creator_,{left:0,top:1,right:1,bottom:0}),this.enableHD(),e()})})}enableHD(){return new Promise((e,t)=>{const a=()=>{this._sceneManager.enableHD(),e()};Promise.all([this._scriptLoader.fetch("static/three/lib/postprocessing/EffectComposer.js",{id:"effect-composer-js"}),this._scriptLoader.fetch("static/three/lib/lights/RectAreaLightUniformsLib.js",{id:"rect-area-light-uniforms-lib-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/ShaderPass.js",{id:"shader-pass-js"}),this._scriptLoader.fetch("static/three/lib/postprocessing/RenderPass.js",{id:"render-pass-js"}),this._scriptLoader.fetch("static/three/lib/shaders/CopyShader.js",{id:"copy-shader-js"})]).then(()=>{this._scriptLoader.fetch("static/three/pi.min.js",{id:"pi-js"}).then(a,t)},t)})}get callbacks(){return this._roomleMaterialViewerUiCallback}set callbacks(e){this._roomleMaterialViewerUiCallback=e}loadMaterialShading(e){return this._sceneManager.loadMaterialShading(e)}loadMaterial(e){return this._sceneManager.loadMaterial(e)}loadMaterialId(e){return this._sceneManager.loadMaterialId(e)}getMaterialShading(){return this._sceneManager.getMaterialShading()}loadSceneSetting(e){return this._sceneManager.loadSceneSettings(e)}loadQualitySetting(e){this._sceneManager.loadQualitySetting(e)}setOverrides(e){if(!e)return;const t=Object.assign(window.__RML__ENV__.initData,e);window.__RML__ENV__.initData=t}updateSize(){this._sceneManager.updateCamera()}resumeTest(e){this._domHelper.setDomElement(e),this._lifeCycleManager.resume()}pauseTest(){this._lifeCycleManager.pause()}showGUI(){this._sceneManager.showGUI()}}__decorate([inject],RoomleMaterialViewer.prototype,"_domHelper",void 0),__decorate([inject],RoomleMaterialViewer.prototype,"_scriptLoader",void 0),__decorate([inject],RoomleMaterialViewer.prototype,"_lifeCycleManager",void 0),__decorate([inject],RoomleMaterialViewer.prototype,"_threeLoader",void 0),__decorate([inject],RoomleMaterialViewer.prototype,"_roomleMaterialViewerUiCallback",void 0);const INJECTABLES=[new DependencyInjectionAssignment("script-loader",ScriptLoader),new DependencyInjectionAssignment("dom-helper",DomHelper,1),new DependencyInjectionAssignment("logger",Logger),new DependencyInjectionAssignment("input-manager",InputManager,1),new DependencyInjectionAssignment("environment-loader",EnvironmentLoader),new DependencyInjectionAssignment("configurator-mesh-generator",ConfiguratorMeshGenerator),new DependencyInjectionAssignment("rapi-access",RapiAccess),new DependencyInjectionAssignment("roomle-material-viewer-ui-callback",class extends UiCallback{constructor(e){super(e),this.onMaterialShadingChanged=(e=>void 0)}},1)];class MaterialViewer extends Main{setupGlobals(){}setupDependencies(){RoomleDependencyInjection.setup(INJECTABLES),this._context=RoomleDependencyInjection.getContext("glb-viewer"),this.lookup("logger",this._context)}cleanUpGlobals(){throw new Error("Method not implemented.")}cleanUpDependencies(){throw new Error("Method not implemented.")}constructor(){super(),Benchmark.start("loadingTime")}bootFinished(){this._viewer=new RoomleMaterialViewer(this._context),window.RoomleMaterialViewer||(window.RoomleMaterialViewer=this._viewer)}getApi(){return this._viewer}}export{MaterialViewer};
//# sourceMappingURL=chunk-4b342c27.js.map
