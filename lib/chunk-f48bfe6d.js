import{a as __decorate,b as inject}from"./chunk-0434d6fb.js";const LINE_MATERIAL="component_dimensioning_line_material",PLANE_MATERIAL="component_dimensioning_plane_material",TEXT_MATERIAL="component_dimensioning_text_material",TEXT_SPACING=.02,TEXT_SIZE=.025,TEXT_COLOR=3618615,PLANE_COLOR=16777215,LINE_SPACING=.05;class ComponentDimensioning extends THREE.Object3D{constructor(e,i,t,n){super(),this._center=i.getCenter(new THREE.Vector3),this._size=i.getSize(new THREE.Vector3),this._origin=this._center.clone().sub(this._size.clone().multiplyScalar(.5)),this._dimensioning=e,this._level=this._dimensioning.maxLevel-this._dimensioning.level,this._font=t,this._cameraPosition=n,this._init()}_initMaterials(){this._cacheHolder.materialCache.has(LINE_MATERIAL)?this._lineMaterial=this._cacheHolder.materialCache.get(LINE_MATERIAL):(this._lineMaterial=new THREE.LineBasicMaterial({color:TEXT_COLOR}),this._cacheHolder.materialCache.set(LINE_MATERIAL,this._lineMaterial)),this._cacheHolder.materialCache.has(PLANE_MATERIAL)?this._planeMaterial=this._cacheHolder.materialCache.get(PLANE_MATERIAL):(this._planeMaterial=new THREE.MeshBasicMaterial({color:PLANE_COLOR,side:THREE.DoubleSide,opacity:.8,transparent:!0}),this._cacheHolder.materialCache.set(PLANE_MATERIAL,this._planeMaterial)),this._cacheHolder.materialCache.has(TEXT_MATERIAL)?this._textMaterial=this._cacheHolder.materialCache.get(TEXT_MATERIAL):(this._textMaterial=new THREE.MeshPhongMaterial({color:TEXT_COLOR}),this._cacheHolder.materialCache.set(TEXT_MATERIAL,this._textMaterial))}_init(){this._initMaterials();let e=new THREE.Geometry;this._line=new THREE.Line(e,this._lineMaterial),this._line.name="component dimension line "+this._dimensioning.type.value,this._text=new THREE.Mesh(e,this._textMaterial),this._text.name="component dimension text "+this._dimensioning.type.value,this._plane=new THREE.Mesh(e,this._planeMaterial),this._plane.name="component dimension plane "+this._dimensioning.type.value;let i,t=new THREE.Geometry,n=Math.round(Math.max(this._size.y,this._size.x,this._size.z)),s=Math.abs(this._dimensioning.to-this._dimensioning.from),o=TEXT_SIZE+(n<4?0:.005*n);s<.3&&(o*=.5+s);let _={font:this._font,size:o,height:.001,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:.001},a=this._dimensioning.label?this._dimensioning.label:this._unitFormatter.formatMMValueToUnitString(1e3*s),h=new THREE.TextGeometry(a,_);h.computeBoundingBox();let E=h.boundingBox.getSize(new THREE.Vector3).y;if(0===this._dimensioning.type.value&&(i=this._getXEdge(E),this._addXEdgeSideLines(E)),1===this._dimensioning.type.value&&(i=this._getYEdge(E),this._addYEdgeSideLines(E)),2===this._dimensioning.type.value&&(i=this._getZEdge(E),this._addZEdgeSideLines(E)),t.vertices.push(i.start,i.end),this._line.geometry.dispose(),this._line.geometry=t,this.add(this._line),this._text.geometry=h,0===this._dimensioning.type.value&&this._addText(i,h,new THREE.Quaternion,new THREE.Vector3(0,2*TEXT_SPACING,0)),1===this._dimensioning.type.value){let e=new THREE.Quaternion,t=this._getXSign()>0?Math.PI/2:Math.PI/2*3;e.setFromAxisAngle(new THREE.Vector3(0,0,1),t),this._addText(i,h,e,new THREE.Vector3(2*TEXT_SPACING,0,0))}if(2===this._dimensioning.type.value){let e=this._getXSign()>0?Math.PI/2:Math.PI/2*3,t=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(-1,0,0),Math.PI/2),n=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,0,1),e);this._addText(i,h,t.multiply(n),new THREE.Vector3(2*TEXT_SPACING,0,0))}}_getXEdge(e){let i=this._size.y+LINE_SPACING+(3*TEXT_SPACING+e)*this._level;const t=new THREE.Vector3(0,this._origin.y,this._origin.z);let n=t.clone().add(new THREE.Vector3(this._dimensioning.from,i,0)),s=t.clone().add(new THREE.Vector3(this._dimensioning.to,i,0));return new THREE.Line3(n,s)}_addXEdgeSideLines(e){let i=this._size.y+LINE_SPACING+(3*TEXT_SPACING+e)*(this._level-.5),t=this._size.y+LINE_SPACING+(3*TEXT_SPACING+e)*this._level;const n=new THREE.Vector3(0,this._origin.y,this._origin.z);let s=n.clone().add(new THREE.Vector3(this._dimensioning.from,i,0)),o=n.clone().add(new THREE.Vector3(this._dimensioning.from,t,0)),_=n.clone().add(new THREE.Vector3(this._dimensioning.to,i,0)),a=n.clone().add(new THREE.Vector3(this._dimensioning.to,t,0));this._addLine(s,o),this._addLine(_,a)}_getZEdge(e){let i=(this._getXSign()>0?this._size.x:0)+LINE_SPACING+(3*TEXT_SPACING+e)*this._level;i*=this._getXSign();const t=new THREE.Vector3(this._origin.x,this._origin.y,0);let n=t.clone().add(new THREE.Vector3(i,0,this._dimensioning.from)),s=t.clone().add(new THREE.Vector3(i,0,this._dimensioning.to));return new THREE.Line3(n,s)}_addZEdgeSideLines(e){let i=this._getXSign()>0?this._size.x:0,t=i+LINE_SPACING+(3*TEXT_SPACING+e)*(this._level-.5),n=i+LINE_SPACING+(3*TEXT_SPACING+e)*this._level;t*=this._getXSign(),n*=this._getXSign();const s=new THREE.Vector3(this._origin.x,this._origin.y,0);let o=s.clone().add(new THREE.Vector3(t,0,this._dimensioning.from)),_=s.clone().add(new THREE.Vector3(n,0,this._dimensioning.from)),a=s.clone().add(new THREE.Vector3(t,0,this._dimensioning.to)),h=s.clone().add(new THREE.Vector3(n,0,this._dimensioning.to));this._addLine(o,_),this._addLine(a,h)}_getYEdge(e){let i=(this._getXSign()>0?this._size.x:0)+LINE_SPACING+(3*TEXT_SPACING+e)*this._level;i*=this._getXSign();const t=new THREE.Vector3(this._origin.x,0,this._origin.z);let n=t.clone().add(new THREE.Vector3(i,this._dimensioning.from,0)),s=t.clone().add(new THREE.Vector3(i,this._dimensioning.to,0));return new THREE.Line3(n,s)}_addYEdgeSideLines(e){let i=this._getXSign()>0?this._size.x:0,t=i+LINE_SPACING+(3*TEXT_SPACING+e)*(this._level-.5),n=i+LINE_SPACING+(3*TEXT_SPACING+e)*this._level;t*=this._getXSign(),n*=this._getXSign();const s=new THREE.Vector3(this._origin.x,0,this._origin.z);let o=s.clone().add(new THREE.Vector3(t,this._dimensioning.from,0)),_=s.clone().add(new THREE.Vector3(n,this._dimensioning.from,0)),a=s.clone().add(new THREE.Vector3(t,this._dimensioning.to,0)),h=s.clone().add(new THREE.Vector3(n,this._dimensioning.to,0));this._addLine(o,_),this._addLine(a,h)}_addLine(e,i){let t=new THREE.Geometry;t.vertices.push(e,i),this.add(new THREE.Line(t,this._lineMaterial))}_addText(e,i,t,n){let s=e.getCenter(new THREE.Vector3);n.x*=this._getXSign(),s.add(n);let o=i.boundingBox.getSize(new THREE.Vector3);i.center(),this._text.position.copy(s),this._text.quaternion.copy(t),this.add(this._text);let _=new THREE.PlaneGeometry(o.x+TEXT_SPACING,o.y+TEXT_SPACING,32);_.center(),this._plane.geometry=_,this._plane.position.copy(s),this._plane.quaternion.copy(t),this.add(this._plane)}_getXSign(){return this._cameraPosition.x>=0?1:-1}}__decorate([inject],ComponentDimensioning.prototype,"_cacheHolder",void 0),__decorate([inject],ComponentDimensioning.prototype,"_unitFormatter",void 0);export default ComponentDimensioning;
//# sourceMappingURL=chunk-f48bfe6d.js.map
