System.register(["./chunk-ea0824e0.nomodule.js","./chunk-5f398f9a.nomodule.js"],function(e,t){var s,i,o,n,a,r,h,l,c;return{setters:[function(e){s=e.a,i=e.d,o=e.e,n=e.b,a=e.f,r=e.g},function(e){h=e.a,l=e.b,c=e.c}],execute:function(){e("n",le);const t=["language","browserLanguage","userLanguage","systemLanguage"],d=(e=null)=>{const s=window.navigator;if(e)return e.substr(0,2);if(Array.isArray(s.languages)&&s.languages.length>0)return s.languages[0].substr(0,2);for(let e=0,i=t.length;e<i;e++){const i=s[t[e]];if(i)return i.substr(0,2)}return"en"};class _{static init(e={}){const{locale:t,kernelInstance:s,kernelContainer:i,planObjectId:o}=e;_.kernelInstance=s,_.kernelContainer=i,_.planObjectId=o,_.actualLocale=t?d(t):d()}static cleanUp(){_.actualLocale=d(),_.useHDGeometry=!1,_.kernelInstance=null,_.kernelContainer=null,_.planObjectId=null}}e("b",_),_.actualLocale=d(),_.useHDGeometry=!1,_.kernelInstance=null,_.kernelContainer=null,_.planObjectId=null;class u{constructor(){this._context=new Map,this._lookups=new Map,this._singletons=new Map}getContext(e){if(this._context.has(e)){const t=this._context.get(e);return this._context.set(e,t+1),e+t}return this._context.set(e,1),e+0}addDependencyInjectionAssignments(e){e.forEach(e=>{this._lookups.set(e.className,e)})}lookup(e,t){if(!this._lookups.has(e))return null;let s=this._lookups.get(e);if(1===s.type&&void 0===t){const t="Dependency "+e+" has definition context but no context was defined!";return console.trace(t),console.error(t),null}let i=t&&1===s.type?t:"global";if(i+="_"+e,2===s.type)return new s.classDefinition;if(this._singletons.has(i))return this._singletons.get(i);let o=new s.classDefinition(t);return this._singletons.set(i,o),o}cleanUp(e){if(e){let t=[];this._singletons.forEach((s,i)=>{i.startsWith(e)&&t.push(i)}),t.forEach(e=>{this._singletons.delete(e)})}else this._singletons.clear(),this._singletons=new Map}}class m{constructor(e,t,s){this.className=e,this.classDefinition=t,this.type=void 0===s?0:s}}e("x",m);const g=e("G",{JPG:".jpg",JPEG:".jpeg",PNG:".png",GIF:".gif"});class p{_base64toBlob(e,t){t=t||"";const s=atob(e),i=s.length,o=Math.ceil(i/1024),n=new Array(o);for(let e=0;e<o;++e){let t=1024*e,o=Math.min(t+1024,i);const a=new Array(o-t);for(let e=t,i=0;e<o;++i,++e)a[i]=s[e].charCodeAt(0);n[e]=new Uint8Array(a)}return new Blob(n,{type:t})}_createFormData(e,t,s,i){const o=new FormData;-1!==e.indexOf(",")&&(e=e.substr(e.indexOf(",")+1));const n=-1===Object.keys(g).map(e=>g[e]).indexOf(s)?"application":"image",a=this._base64toBlob(e,n+"/"+s.substr(1));return o.append(i,a,t+s),o}create(e,t,s,i){return this._createFormData(e,t,s,i)}}class w{getEnvironmentMap(){if(!this._environmentMap){let e=new THREE.CubeTextureLoader;e.setPath(s()),this._environmentMap=e.load(["static/textures/env/px.jpg","static/textures/env/nx.jpg","static/textures/env/py.jpg","static/textures/env/ny.jpg","static/textures/env/pz.jpg","static/textures/env/nz.jpg"])}return this._environmentMap}getEnvironmentMapBlurred(){if(!this._environmentMapBlurred){let e=new THREE.CubeTextureLoader;e.setPath(s()),this._environmentMapBlurred=e.load(["static/textures/env_blurred/px.jpg","static/textures/env_blurred/nx.jpg","static/textures/env_blurred/py.jpg","static/textures/env_blurred/ny.jpg","static/textures/env_blurred/pz.jpg","static/textures/env_blurred/nz.jpg"])}return this._environmentMapBlurred}}e("a5",w);const E=.8,f={SOFA:"sofa",SHELF:"shelf",SHELF_FRONT:"shelf_front",BAKED:"baked",CAMERA:"camera",EQUAL:"equal"};class T{static createDynamicLightSettingSource(e,t){let i={};if(e)i.url=e;else if(t)switch(t){case f.SHELF:i.url=s()+"static/predefined_lightsettings/shelf.json";break;case f.SHELF_FRONT:i.url=s()+"static/predefined_lightsettings/shelf_front.json";break;case f.SOFA:i.url=s()+"static/predefined_lightsettings/sofa.json";break;case f.BAKED:i.url=s()+"static/predefined_lightsettings/baked.json";break;case f.CAMERA:i.url=s()+"static/predefined_lightsettings/camera.json";break;case f.EQUAL:i.url=s()+"static/predefined_lightsettings/equal.json";break;default:i=null}else i=null;return i}parse(e){let t=JSON.parse(e);return t.lights?this.load(t):[]}load(e){let t=[];return e.lights?(e.lights.forEach(e=>{let s;switch(e.type){case"ambient":s=this._parseAmbientLight(e);break;case"rectarea":s=this._parseRectAreaLight(e);break;case"spot":s=this._parseSpotLight(e);break;case"directional":s=this._parseDirectionalLight(e)}s&&t.push(s)}),t):[]}_parseAmbientLight(e){let t=new THREE.AmbientLight;return this._parseCommon(t,e),t}_parseRectAreaLight(e){let t=new THREE.RectAreaLight;this._parseCommon(t,e);let{intensity:s,castShadow:i,target:o,width:n,height:a}=e;return t.width=n||E,t.height=a||E,t.castShadow=i||!1,t.matrixAutoUpdate=!0,t.intensity=(s||240)/((n||E)*(a||E)),t.lookAt(o?new THREE.Vector3(o.x,o.y,o.z):new THREE.Vector3(0,0,0)),t}_parseSpotLight(e){let t=new THREE.SpotLight;this._parseCommon(t,e);let{angle:s,penumbra:i,target:o,castShadow:n}=e;return t.angle=(s||100)*Math.PI/180,t.penumbra=i||.5,t.lookAt(o?new THREE.Vector3(o.x,o.y,o.z):new THREE.Vector3(0,0,0)),t.shadow.camera.near=.1,t.shadow.camera.far=10,t.shadow.mapSize=new THREE.Vector2(1024,1024),t.castShadow=n||!1,t}_parseDirectionalLight(e){let t=new THREE.DirectionalLight;this._parseCommon(t,e);let{target:s,castShadow:i}=e;return t.castShadow=i||!1,t.shadow.camera.near=.1,t.shadow.camera.far=100,t.shadow.mapSize=new THREE.Vector2(1024,1024),t.lookAt(s?new THREE.Vector3(s.x,s.y,s.z):new THREE.Vector3(0,0,0)),t}_parseCommon(e,t){let{name:s,intensity:i,color:o,position:n,movesWithCamera:a}=t;e.name=s||"",e.intensity=i||1,e.color=new THREE.Color(o||"#ffffff"),e.position.copy(n?new THREE.Vector3(n.x,n.y,n.z):new THREE.Vector3(0,0,0)),e.visible=!0,e.layers.set(1),e.userData.movesWithCamera=a}}e("D",T);const y=40;class v{constructor(){this._queue=[],this._pendingRequests=0}_nextSlot(){if(this._pendingRequests-=1,!this._queue.length)return;const{request:e,resolve:t,reject:s}=this._queue.shift();this._fetch(e).then(t,s)}_fetch(e){return this._pendingRequests+=1,new Promise((t,s)=>{self.fetch(e).then(function(){this._nextSlot(),t(...arguments)}.bind(this),e=>{this._nextSlot(),s(e)})})}fetch(e){return this._pendingRequests>=y?new Promise((t,s)=>this._queue.push({request:e,resolve:t,reject:s})):this._fetch(e)}}class M{info(...e){console}log(...e){console}warn(...e){console.warn.apply(console,e)}error(...e){console.warn.apply(console,e)}}e("y",M);const x=new Map,R=new Map,P=new Map,b=new Map;class C{constructor(e){this._bootCallbacks=[],this._isStarted=!1,this._isStarting=!1,this._alwaysUseCache=!1,this._creator_=e}start(e){return this._configuratorUiCallbacks.onSyncStarted(),this._startWorker().then(()=>this._handleCatalog(e)).then(()=>{const{typeChangeTag:e,floorMaterialsTag:t}=window.__RML__ENV__.initData;Promise.all([this._syncFloorTag(t),this._syncTypeChangeTag(e)]).then(()=>{b.set(e,!0),this._configuratorUiCallbacks.onSyncDone()})})}syncCatalog(e){return this._startWorker().then(()=>this._handleCatalog(e))}syncFloorTag(e){return this._startWorker().then(()=>this._syncFloorTag(e))}syncTypeChangeTag(e){return this._startWorker().then(()=>this._syncTypeChangeTag(e))}_syncFloorTag(e){const t=[];return e&&!P.get(e)?(t.push(this._handleTags([e])),this._rapiAccess.getTag(e).then(e=>{t.push(this._handleMaterialsAndTextures(e))}),this._singlePromiseFactory.create(1,e,s=>{Promise.all(t).then(()=>{P.set(e,!0),s()},e=>this._softReject(s,'_syncFloorTag error: "'+e+'"'))})):Promise.resolve()}_syncTypeChangeTag(e){const t=[];return e&&!b.get(e)?(t.push(this._handleTags([e])),this._rapiAccess.getTag(e).then(e=>{this._rapiAccess.getItems(e.items).then(e=>{e.forEach(e=>{this.getIsCatalogSynced(e.catalog)&&t.push(this._handleCatalog(e.catalog))})})}),this._singlePromiseFactory.create(2,e,s=>{Promise.all(t).then(()=>{P.set(e,!0),s()},e=>this._softReject(s,'_syncTypeChangeTag error: "'+e+'"'))})):Promise.resolve()}getIsCatalogSynced(e){return!!R.get(e)}_startWorker(){return new Promise((e,t)=>{if(this._isStarted)return e();this._bootCallbacks.push({resolve:e,reject:t}),this._isStarting||(this._worker=new Worker(s()+"static/workers/asset-loader.worker.js"),this._mainThreadToWorker=new i(this,this._worker),this._isStarting=!0,this._mainThreadToWorker.sendToWorker(1))})}onCommand(e,t,s){switch(e){case 4:this._isStarted=!0,this._bootCallbacks.forEach(({resolve:e})=>e());break;case 3:this._mainThreadToWorker.resolvePromises(t,s)}}_handleCatalog(e){return this._singlePromiseFactory.create(0,e,t=>this.getIsCatalogSynced(e)?t():this._rapiAccess.getCatalog(e).then(e=>Promise.all([this._handleContentWithAssets(this._rapiAccess.getComponentsOf(e),["perspectiveImage"]),this._handleItemsAndAdditionalContents(e),this._handleMaterialsAndTextures(e),this._handleExternalMeshes(e),this._handleTags(e.tags)])).then(()=>{R.set(e,!0),t()},e=>this._softReject(t,'Catalog sync error: "'+e+'"')))}_handleTags(e){return this._handleContentWithAssets(this._rapiAccess.getTags(e),["pngIcon","svgIcon"])}_handleExternalMeshes(e){return new Promise(t=>{this._rapiAccess.getMeshesOfCatalog(e.id).then(e=>{const s=[];e.forEach(e=>{s.push(this._handleContentWithAssets(Promise.all([this._rapiAccess.getMesh(e.id)]),["url"]))}),Promise.all(s).then(t,e=>this._softReject(t,'Sync crt files error: "'+e+'"'))},e=>this._softReject(t,'getMeshesOfCatalog error: "'+e+'"'))})}_handleItemsAndAdditionalContents(e){return new Promise((t,s)=>{this._rapiAccess.getItemsOf(e).then(e=>{const s=[];s.push(this._handleContentWithAssets(Promise.resolve(e),["perspectiveImage"])),this._rapiAccess.getAdditionalContentsOfItems(e).then(e=>{const t=e.filter(e=>-1!==[5,6,4].indexOf(e.type));s.push(this._handleContentWithAssets(Promise.resolve(t),["content"]))},e=>this._softReject(t,'getAdditionalContentsOfItems error: "'+e+'"')),Promise.all(s).then(t,e=>this._softReject(t,'AdditionalContent image sync error:"'+e+'"'))})})}_handleMaterialsAndTextures(e){return new Promise((t,s)=>{this._rapiAccess.getMaterialsOf(e).then(e=>{const s=[];s.push(this._handleContentWithAssets(Promise.resolve(e),["thumbnail"])),e.forEach(e=>{s.push(this._handleContentWithAssets(this._rapiAccess.getTexturesOf(e),["image"]))}),Promise.all(s).then(t,e=>this._softReject(t,'getTexturesOf error: "'+e+'"'))},e=>this._softReject(t,'getMaterialsOf error: "'+e+'"'))})}_handleContentWithAssets(e,t){return new Promise(s=>e.then(e=>this._fetchAssets(e,t).then(s,e=>this._softReject(s,'_handleContentWithAssets error: "'+e+'"')),e=>this._softReject(s,'_handleContentWithAssets promise error: "'+e+'"')))}_fetchAssets(e,t){const s=[];e||(e=[]);for(let i=0,o=e.length;i<o;i++){const o=e[i];t.forEach(e=>{const t=o[e];t&&s.push(this._preCacheAsset(t))})}return Promise.all(s)}_preCacheAsset(e){return new Promise(t=>{if(x.get(e))return t();this._assetUrlToBase64(e).then(s=>{x.set(e,s),t()},e=>this._softReject(t,'_preCacheAsset error: "'+e+'"'))})}_assetUrlToBase64(e){return new Promise(t=>{this._mainThreadToWorker.sendToWorker(5,e,t,e=>this._softReject(t,'_assetUrlToBase64 error: "'+e+'"'))})}_softReject(e,t){this._errorHandler.softReject(e,t,2)}requestAsset(e,t=!1){return navigator.onLine&&!this._alwaysUseCache?e:x.get(e)||(t?e:null)}setAlwaysUseCache(e){this._alwaysUseCache=e}preFillAssetCache(e,t){x.set(e,t)}}e("C",C),h([l],C.prototype,"_rapiAccess",void 0),h([l],C.prototype,"_singlePromiseFactory",void 0),h([l],C.prototype,"_errorHandler",void 0),h([l],C.prototype,"_configuratorUiCallbacks",void 0);class H{loadGLB(e,t,s,i,o,n){return this._gltfLoader||(this._gltfLoader=new THREE.GLTFLoader,THREE.DRACOLoader.setDecoderPath("static/three/lib/draco/"),this._gltfLoader.setDRACOLoader(new THREE.DRACOLoader)),new Promise((a,r)=>{this._gltfLoader.load(e,e=>{a(this._handleGLTFScene("GLB",e,t,s,i,o,n))},e=>{},e=>{r(e)})})}loadGLTF(e,t,s,i,o,n){return this._gltfLoader||(this._gltfLoader=new THREE.GLTFLoader),new Promise((a,r)=>{this._gltfLoader.parse(e,null,e=>{a(this._handleGLTFScene("GLTF",e,t,s,i,o,n))},e=>{},e=>{r(e)})})}_handleGLTFScene(e,t,s,i,o,n,a){if(!t||!t.scene||!t.scene.children||0===t.scene.children.length)return null;if(s&&t.scene.position.copy(s),i&&(t.scene.rotation.y=i),o){const e=new THREE.Box3;e.setFromObject(t.scene);const{x:s,y:i,z:n}=e.getSize(new THREE.Vector3);let a=new THREE.Vector3(o.x/s,o.y/i,o.z/n);t.scene.scale.copy(a)}return t.scene.type=e,t.scene.traverse(e=>{if(e instanceof THREE.Mesh){if(e.material instanceof THREE.MeshStandardMaterial){let t=e.material;if(t.envMap=this._environmentLoader.getEnvironmentMap(),a&&n&&n>0){let e=new THREE.Color(n);t.color=e.copyGammaToLinear(e),t.roughness=.5,t.metalness=.1}t.needsUpdate=!0}e.castShadow=!0,e.receiveShadow=!0}}),t.scene}}h([l],H.prototype,"_environmentLoader",void 0);class S{constructor(e){this._jsonLoaded=!1,this._creator_=e}_loadShaders(){return new Promise((e,t)=>{if(this._jsonLoaded)return e();this._networkLayer.fetch(s()+"static/three/lib/shaders.json").then(o,t).then(t=>{window._rsl=t,this._jsonLoaded=!0,e()},t)})}fetch(){return window._rsl||(window._rsl={}),new Promise((e,t)=>this._loadShaders().then(()=>{this._scriptLoader.fetch("static/three/lib/rthree.js",{id:"three-lib"}).then(e,t)},t))}}h([l],S.prototype,"_scriptLoader",void 0),h([l],S.prototype,"_networkLayer",void 0);const L="rml_default",k=5;class I{constructor(e){this._context_=e}getStore(e=L){return this._localStorage.getItem(e)||{entries:[]}}saveStore(e,t){this._localStorage.setItem(e,t)}addItem(e,t,s=L,i=k){const o=this.getStore(s),n=o.entries.find(t=>t.id===e);if(n?(n.payload=t,n.date=Date.now()):o.entries.push({id:e,date:Date.now(),payload:t}),o.entries.length>i)for(o.entries.sort((e,t)=>t.date-e.date);o.entries.length>i;)o.entries.pop();this.saveStore(s,o)}getItem(e,t=L){const s=this.getStore(t).entries.find(t=>t.id===e);return s?s.payload:null}}h([l],I.prototype,"_localStorage",void 0);class A{set(e,t){t&&(void 0!==t.enableAA&&(e.enableAA=t.enableAA),this._setSAOPass(e,t),this._setShadowPass(e,t),this._setGroundShadow(e,t))}_setSAOPass(e,t){if(t.SAOPass){const s=t.SAOPass;void 0!==s.enabled&&(e.getSAOPass().enabled=s.enabled),void 0!==s.smoothTransition&&(e.getSAOPass().smoothTransition=s.smoothTransition),s.occlusionWorldRadius&&(e.getSAOPass().occlusionWorldRadius=s.occlusionWorldRadius),s.intensity&&(e.getSAOPass().intensity=s.intensity),s.bias&&(e.getSAOPass().bias=s.bias),s.numSamples&&(e.getSAOPass().numSamples=s.numSamples)}}_setShadowPass(e,t){if(t.shadowPass){const s=t.shadowPass;void 0!==s.enabled&&(e.getShadowPass().enabled=s.enabled),void 0!==s.smoothTransition&&(e.getShadowPass().smoothTransition=s.smoothTransition),void 0!==s.enableAccumulation&&(e.getShadowPass().enableAccumulation=s.enableAccumulation),s.shadowRadius&&(e.getShadowPass().shadowRadius=s.shadowRadius),s.shadowBiasMultiplier&&(e.getShadowPass().shadowBiasMultiplier=s.shadowBiasMultiplier),s.numSamples&&(e.getShadowPass().numSamples=s.numSamples)}}_setGroundShadow(e,t){if(t.groundShadow){const s=t.groundShadow;void 0!==s.enable&&(e.getShadowPlanePass().enable=s.enable),void 0!==s.smoothTransition&&(e.getShadowPlanePass().smoothTransition=s.smoothTransition),s.numSamples&&(e.getShadowPlanePass().numSamples=s.numSamples),s.numSamplesPerFrame&&(e.getShadowPlanePass().numSamplesPerFrame=s.numSamplesPerFrame)}}}e("a3",A);const V=e("p",function(e){return e*(Math.PI/180)}),D=function(e,t,s,i,o,n){let a=Math.tan(i*(2*Math.PI/360)/2),r=s/2,h=t/2/a+r,l=e/2/(o/n)/a+r;return Math.max(h,l)},B=function(e){return Math.round(1e3*e)/1e3},F=(e("a0",function(e,t){return Math.abs(e.y-t.y)+Math.abs(e.x-t.x)}),e("O",.6)),O=.4,z=e("H","#FFFFFF"),U=e("I",1),j=e("J",.5),N=(e("j",(e,t,s,i)=>{if(!e||!t||0===s||0===i)return new THREE.Vector3;let o=e.clone(),n=s/2,a=i/2;return o.project(t),o.x=o.x*n+n,o.y=-o.y*a+a,o.z=0,o}),e("i",(e,t)=>{t||(t=new THREE.Vector3(0,0,0));let s=new THREE.Vector3(e.size.x/1e3,e.size.z/1e3,e.size.y/1e3),i=new THREE.Vector3(e.origin.x/1e3,e.origin.z/1e3,e.origin.y/-1e3),o=new THREE.Vector3(0,0,-s.z).add(i).sub(t),n=new THREE.Vector3(s.x,s.y,0).add(i).add(t);return new THREE.Box3(o,n)})),G=(e("v",e=>(e.from=e.from/1e3,e.to=e.to/1e3,1===e.type.value?(e.type={value:2},e.from*=-1,e.to*=-1):2===e.type.value&&(e.type={value:1}),e)),(e,t,s)=>{e.castShadow=s,e.receiveShadow=t,e.children.forEach(e=>{G(e,t,s)})}),W=e("_",(e,t)=>{let s=B(e.x),i=B(e.y),o=B(e.z),n=B(t.x),a=B(t.y),r=B(t.z);return s===n&&i===a&&o===r}),Y=(e("$",(e,t)=>{let s=B(e.w),i=B(e.x),o=B(e.y),n=B(e.z),a=B(t.w),r=B(t.x),h=B(t.y),l=B(t.z);return s===a&&i===r&&o===h&&n===l}),e("a2",(e,t)=>{let s=B(e.x),i=B(e.y),o=B(t.x),n=B(t.y);return s===o&&i===n})),q=e("K",(e,t)=>{let s=new THREE.MeshPhysicalMaterial({metalness:1===e.shading.metallic?1:.5,reflectivity:e.shading.metallic||.5,roughness:e.shading.roughness||.5,transparent:e.shading.alpha<1,opacity:e.shading.alpha,depthWrite:e.shading.alpha>=1});if(e.shading.basecolor){const t=new THREE.Color(e.shading.basecolor.r,e.shading.basecolor.g,e.shading.basecolor.b);s.color=t.copyGammaToLinear(t)}return t&&(s.envMap=t),e.shading.doubleSided?s.side=THREE.DoubleSide:s.side=THREE.FrontSide,e.shading.alphaCutoff?s.alphaTest=e.shading.alphaCutoff:s.alphaTest=0,s}),X=(e("a4",e=>{let t=e.color.clone().copyLinearToGamma(e.color),s={alpha:e.opacity,metallic:e.reflectivity,basecolor:{r:t.r,g:t.g,b:t.b},roughness:e.roughness,doubleSided:e.side===THREE.DoubleSide,alphaCutoff:e.alphaTest};return 1===e.metalness?s.metallic=1:s.metallic=e.reflectivity,s}),e("L",(e,t,s,i,o,n)=>new Promise((a,r)=>{(new THREE.TextureLoader).load(e,e=>{e.anisotropy=i,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.set(o,n),"XYZ"===t.mapping?s.normalMap=e:s.map=e,"RGBA"===t.mapping&&(s.transparent=!0),s.needsUpdate=!0,a()},r)}))),Z=e("t",(e=!0)=>(window.__RML_GUI__||(window.__RML_GUI__=new dat.GUI({autoPlace:e})),window.__RML_GUI__)),K=(e("X",(e,t,s=!0)=>{let i=e.getWorldDirection(new THREE.Vector3),o=Math.abs(i.y);o<.5&&!t.transparent&&K(t,!0,s),o>.5&&t.transparent&&K(t,!1,s)}),e("Y",(e,t,s=!0)=>{if(!e.userData.tween)if(t)if(e.transparent=!0,s){let t={opacity:1};e.userData.tween=!0,new TWEEN.Tween(t).to({opacity:.2},400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{e.opacity=t.opacity}).onComplete(()=>{e.userData.tween=!1}).start()}else e.opacity=.2;else if(s){let t={opacity:.2};e.userData.tween=!0,new TWEEN.Tween(t).to({opacity:1},400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{e.opacity=t.opacity}).onComplete(()=>{e.transparent=!1,e.userData.tween=!1}).start()}else e.opacity=1,e.transparent=!1})),Q=(e("U",e=>{let t=new THREE.Color;return t.setRGB((e>>16)/255,(e>>8&255)/255,(e>>0&255)/255),t}),e("S",e=>{e.traverse(e=>{if(e instanceof THREE.Mesh&&TWEEN){let t=e.material;if(0===t.opacity)return;let s={opacity:0,transparent:!0},i={opacity:t.opacity,transparent:t.transparent};t.transparent=s.transparent,t.opacity=s.opacity,new TWEEN.Tween(s).to(i,500).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{t.opacity=s.opacity}).onComplete(()=>{t.transparent=i.transparent}).start()}})}),e("W",(e,t)=>{let s=(new THREE.Box3).setFromObject(e),i=s.getSize(new THREE.Vector3),o=Math.min(i.x,i.y,i.z),n=!0;return o>5&&(console.warn("GLB seems to be too big ("+o+")",t),n=!1),s.min.y<-.01&&(console.warn("GLB seems to be under the floor ("+s.min.y+"): ",t),n=!1),n}),e("w",e=>{"Mesh"===e.type?J(e):Q(e)}),e=>{e&&e.children&&0!==e.children.length&&e.children.forEach(e=>{J(e)})}),J=e("N",e=>{e&&(e.material&&ee(e.material),e.geometry&&$(e.geometry),e.children&&e.children.length>0&&Q(e))}),$=e=>{e&&e.dispose()},ee=e=>{e&&(e.map&&e.map.dispose(),e.normalMap&&e.normalMap.dispose(),e.dispose())};let te;e("T",()=>(te||((te=new THREE.MeshBasicMaterial).visible=!1),te)),e("V",(e,t)=>{let s=t.x/2,i=t.z/2,o=new THREE.Vector3(-s,.01,i),n=[o,new THREE.Vector3(o.x,o.y,o.z+.2),new THREE.Vector3(o.x-.2,o.y,o.z+.2),new THREE.Vector3(o.x-.2,o.y,o.z)],a=[new THREE.Face3(3,2,0),new THREE.Face3(2,1,0)],r=new THREE.Geometry;return r.vertices.push(...n),r.faces.push(...a),r.computeFaceNormals(),r.computeVertexNormals(),r}),e("M",e=>0===e.x&&0===e.y&&0===e.z);const se=e("Q",e=>new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/-1e3)),ie=e=>new THREE.Euler(e.x,e.z,-e.y),oe=(e("R",e=>new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/1e3)),e=>({x:1e3*e.x,y:-1e3*e.z,z:1e3*e.y})),ne=e=>decodeURIComponent(encodeURIComponent(e)),ae=e("f",e=>{if(!e){const t=typeof e;return"number"===t||"boolean"===t?e:null}if(!e.hasOwnProperty("size")&&e.size&&"function"==typeof e.size){let t=re(e);for(let e=0;e<t.length;e++)t[e]=ae(t[e]);return"string"==typeof t?ne(t):t}if("object"==typeof e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=ae(e[t]));return"string"==typeof e?ne(e):e}),re=e=>{let t=[];if(e){let s=e.size();for(let i=0;i<s;i++)t.push(e.get(i))}return t},he=e=>{let t=new THREE.Matrix4,s=ae(e);return t.fromArray(s),t.transpose(),(e=>{let t=new THREE.Matrix4;t.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),t.scale(new THREE.Vector3(.001,.001,.001));let s=new THREE.Matrix4;return s.set(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1),s.scale(new THREE.Vector3(1e3,1e3,1e3)),t.multiply(e).multiply(s)})(t)};function le(){class e extends THREE.Object3D{constructor(e,t,s,i){super(),this._selected=!1,this.meshes=[],this.castShadow=!0,this.receiveShadow=!0,this._setValues(e,t,s,i)}static _generateDashedLine(e,t){let s=new THREE.LineSegments(e,new THREE.LineDashedMaterial({color:"#000000",dashSize:.03,gapSize:.01,linewidth:1}));return s.translateOnAxis(t,1),s}static cloneDockLine(e,t){let s=new THREE.LineSegments(e.geometry,e.material);return s.translateOnAxis(t.getCenter(new THREE.Vector3),1),s.name="dockline",s.layers.set(5),s}static _generateCubeGeometry(e,t,s){let i=new THREE.Geometry;return i.vertices.push(new THREE.Vector3(-e,-t,-s),new THREE.Vector3(-e,t,-s),new THREE.Vector3(-e,t,-s),new THREE.Vector3(e,t,-s),new THREE.Vector3(e,t,-s),new THREE.Vector3(e,-t,-s),new THREE.Vector3(e,-t,-s),new THREE.Vector3(-e,-t,-s),new THREE.Vector3(-e,-t,s),new THREE.Vector3(-e,t,s),new THREE.Vector3(-e,t,s),new THREE.Vector3(e,t,s),new THREE.Vector3(e,t,s),new THREE.Vector3(e,-t,s),new THREE.Vector3(e,-t,s),new THREE.Vector3(-e,-t,s),new THREE.Vector3(-e,-t,-s),new THREE.Vector3(-e,-t,s),new THREE.Vector3(-e,t,-s),new THREE.Vector3(-e,t,s),new THREE.Vector3(e,t,-s),new THREE.Vector3(e,t,s),new THREE.Vector3(e,-t,-s),new THREE.Vector3(e,-t,s)),i}_setValues(e,t,s,i){e&&(this.roomleId=e),t&&(this.roomlePosition=Object.assign({},t)),s&&(this.roomleRotation=Object.assign({},s)),i&&(this.parentObjectId=i)}get loadingMesh(){return this._loadingMesh}get boundingBoxMesh(){return this._boundingBoxMesh}get boundingBox(){return this._boundingBox}set roomlePosition(e){this._roomlePosition=e,e&&this.position.set(e.x/1e3,e.z/1e3,e.y/-1e3)}get roomlePosition(){return this._roomlePosition}set roomleRotation(e){this._roomleRotation=e,e&&this.rotation.set(e.x,e.z,-e.y)}get roomleRotation(){return this._roomleRotation}replaceMeshes(e){this.removeAllMeshes(),e.forEach(e=>{this.addMesh(new THREE.Mesh(e.geometry,e.material))})}addMesh(e,t){e.renderOrder=2,e.userData.meshType=0,e.castShadow=!0,e.receiveShadow=!0,t&&e.applyMatrix(he(t)),this.add(e),this.meshes.push(e)}removeMesh(e){const t=this.meshes.indexOf(e);this.remove(e),J(e),t<0||this.meshes.splice(t,1)}removeAllMeshes(e=!0){this.meshes.forEach(t=>{this.remove(t),e&&J(t)}),this.meshes=[],this.remove(this._loadingMesh),J(this._loadingMesh),this._loadingMesh=null,this.remove(this._boundingBoxMesh),J(this._boundingBoxMesh),this._boundingBoxMesh=null}select(){this._selected=!0}loading(){if(!this._kernelBoundingBox)return void console.warn("Bounding box (box for measurements) for component "+this.roomleId+" not set, can not show external mesh loading box!");this.removeAllMeshes();let{x:e,y:t,z:s}=this._kernelBoundingBox.getSize(new THREE.Vector3),i=new THREE.BoxGeometry(e,t,s);this._loadingMesh=new THREE.Mesh(i,new THREE.MeshStandardMaterial({transparent:!0,opacity:F,color:new THREE.Color(z)})),this._loadingMesh.name="loading mesh",this._loadingMesh.receiveShadow=!1,this._loadingMesh.castShadow=!1,this._loadingMesh.layers.set(5),this._loadingMesh.translateOnAxis(this._kernelBoundingBox.getCenter(new THREE.Vector3),1),this._loadingMesh.renderOrder=3,this.add(this._loadingMesh)}deselect(){this._selected=!1}hoverOn(){n("pointer")}hoverOff(){n("default")}removeFromParent(){this.parent&&(this.parent.remove(this),this.removeAllMeshes())}clear(t){this.hoverOff(),t&&this.children.forEach(s=>{s instanceof e&&s.clear(t)})}computeBoundingBox(t,s=!1){this._boundingBoxMesh&&this.remove(this._boundingBoxMesh);let i=null,o=null;if(!t||s){let t=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;this.meshes.forEach(e=>{e.geometry.computeBoundingBox();let i=e.geometry.boundingBox;t=Math.min(t,i.min.x),s=Math.min(s,i.min.y),n=Math.min(n,i.min.z),a=Math.max(a,i.max.x),r=Math.max(r,i.max.y),h=Math.max(h,i.max.z)}),this._boundingBox=new THREE.Box3(new THREE.Vector3(t,s,n),new THREE.Vector3(a,r,h)),this._kernelBoundingBox=this._boundingBox.clone();let l=this._boundingBox.max.x-this._boundingBox.min.x,c=this._boundingBox.max.y-this._boundingBox.min.y,d=this._boundingBox.max.z-this._boundingBox.min.z;i=new THREE.BoxGeometry(l,c,d),o=e._generateCubeGeometry(l/2,c/2,d/2)}else{this._kernelBoundingBox=N(t),this._boundingBox=this._kernelBoundingBox.clone();let{x:s,y:n,z:a}=this._boundingBox.getSize(new THREE.Vector3);i=new THREE.BoxGeometry(s,n,a),o=e._generateCubeGeometry(s/2,n/2,a/2)}this._boundingBoxMesh=new THREE.Mesh(i,new THREE.MeshStandardMaterial({color:"#FFFFFF",transparent:!0,opacity:0,polygonOffset:!0,polygonOffsetFactor:-1})),this._boundingBoxMesh.position.add(this._boundingBox.getCenter(new THREE.Vector3)),this._boundingBoxMesh.layers.set(5),this._boundingBoxMesh.renderOrder=3,this.add(this._boundingBoxMesh),this._dockline=e._generateDashedLine(o,this._boundingBox.getCenter(new THREE.Vector3)),this._dockline.name="dockline",this._dockline.layers.set(5),this._selected&&this.add(this._dockline)}recursiveMeshes(){let t=this.meshes.slice();return this.children.forEach(s=>{s instanceof e&&t.push(...s.recursiveMeshes())}),t}isChild(t){let s=!1;return this.children.forEach(i=>{i instanceof e&&!s&&(s=i.roomleId===t||i.isChild(t))}),s}getKernelPosition(e){let t=this.parent.localToWorld(this.position);return oe(e.worldToLocal(t))}}class t extends e{constructor(e,t){super(e,null,null,null),this.glbUrl=t}}class s extends e{constructor(e,t,s,i){super(e,t,s,i),this._stringId=null,this.receivedPointAssociation=!1,this.castShadow=!1,this.receiveShadow=!1}get stringId(){return this._stringId?this._stringId:this.roomleId.toString()}addMesh(e,t){super.addMesh(e,t),e.renderOrder=1,e.castShadow=!1,e.receiveShadow=!1}hoverOn(){this.remove(this._dockline),this.meshes.forEach(({material:e})=>{e.opacity=.9,e.roughness=U,e.metalness=j,e.color=new THREE.Color(z)}),n("pointer")}hoverOff(){this.add(this._dockline),this.meshes.forEach(({material:e})=>{e.opacity=F,e.roughness=U,e.metalness=j,e.color=new THREE.Color(z)}),n("default")}clonePreview(t){let i=new s(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId);return i._stringId=this.roomleId+"_"+t,this.children.forEach(e=>{e instanceof THREE.Mesh&&0===e.userData.meshType&&i.meshes.push(e.clone(!0))}),i.meshes.forEach(e=>{e.material=e.material.clone(),e.geometry=e.geometry.clone(),i.add(e)}),this._dockline&&(i._dockline=e.cloneDockLine(this._dockline,this._boundingBox)),this._boundingBoxMesh&&(i._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(i._boundingBox=this._boundingBox.clone()),i}preparePreview(){this.add(this._dockline),this.add(this._boundingBoxMesh)}}class i extends s{constructor(e,t,s,i,o){super(e,t,s,i),o&&(this._stringId=this.roomleId+"_has_additional_dock_point_copy")}set roomleLineFrom(e){this._roomleLineFrom=e,this.lineFrom=se(e)}get roomleLineFrom(){return this._roomleLineFrom}set roomleLineTo(e){this._roomleLineTo=e,this.lineTo=se(e)}get roomleLineTo(){return this._roomleLineTo}set roomlePositionFrom(e){this._roomlePositionFrom=e,this.positionFrom=se(e)}get roomlePositionFrom(){return this._roomlePositionFrom}set roomlePositionTo(e){this._roomlePositionTo=e,this.positionTo=se(e)}get roomlePositionTo(){return this._roomlePositionTo}addMesh(e,t){super.addMesh(e,t),e.visible=!1,e.renderOrder=3}hoverOn(){this._dockline.visible=!0,n("pointer")}hoverOff(){this._dockline.visible=!1,n("default")}preparePreview(){super.preparePreview(),this._dockline.visible=!1;let e=this.lineTo.clone(),t=this.lineFrom.clone(),s=(new THREE.Vector3).subVectors(e,t).normalize(),i=new THREE.ArrowHelper(s,t),o=new THREE.CylinderGeometry(.01,.01,s.length(),16,1);this.lineMesh=new THREE.Mesh(o,new THREE.MeshStandardMaterial({color:z,transparent:!0,opacity:O})),this.lineMesh.name="line mesh";const n=(new THREE.Quaternion).setFromEuler(i.rotation);this.lineMesh.quaternion.multiply(n),this.lineMesh.renderOrder=1;let a=(new THREE.Vector3).addVectors(e,t).multiplyScalar(.5);this.lineMesh.position.copy((new THREE.Vector3).subVectors(a,this.position.clone())),this.add(this.lineMesh);let r=this._boundingBox.getCenter(new THREE.Vector3),h=null,l=0,c=Math.abs(s.x),d=Math.abs(s.y),_=Math.abs(s.z);c>=d&&c>=_?(h=new THREE.Vector3(r.x,0,0),l=Math.sqrt(r.y*r.y+r.z*r.z)):d>=c&&d>=_?(h=new THREE.Vector3(0,r.y,0),l=Math.sqrt(r.x*r.x+r.z*r.z)):_>=d&&_>=c&&(h=new THREE.Vector3(0,0,r.z),l=Math.sqrt(r.y*r.y+r.x*r.x));let u=new THREE.CylinderGeometry(1.1*l,1.1*l,(new THREE.Vector3).subVectors(this.positionTo.clone(),this.positionFrom.clone()).length()+h.length(),32,1);this.boundingLineMesh=new THREE.Mesh(u,new THREE.MeshStandardMaterial({color:"#ffffff",transparent:!0,opacity:0})),this.boundingLineMesh.name="bounding line mesh";let m=this.positionTo.clone(),g=this.positionFrom.clone(),p=(new THREE.Vector3).subVectors(m,g).normalize(),w=new THREE.ArrowHelper(p,g);const E=(new THREE.Quaternion).setFromEuler(w.rotation);this.boundingLineMesh.quaternion.multiply(E),this.boundingLineMesh.renderOrder=3;let f=(new THREE.Vector3).addVectors(this.positionTo.clone(),this.positionFrom.clone()).multiplyScalar(.5).add(r);this.boundingLineMesh.position.copy((new THREE.Vector3).subVectors(f,this.position.clone())),this.add(this.boundingLineMesh)}clonePreviewLine(t){let s=new i(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId,this.receivedPointAssociation);return s._stringId=this.roomleId+"_"+t,this.children.forEach(e=>{e instanceof THREE.Mesh&&0===e.userData.meshType&&s.meshes.push(e.clone(!0))}),s.meshes.forEach(e=>{e.material=e.material.clone(),e.geometry=e.geometry.clone(),s.add(e)}),this._dockline&&(s._dockline=e.cloneDockLine(this._dockline,this._boundingBox)),this._boundingBoxMesh&&(s._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(s._boundingBox=this._boundingBox.clone()),s}getPositionForIntersectionPoint(e){let t=this.positionTo.clone().add(this._boundingBox.getCenter(new THREE.Vector3)),s=this.positionFrom.clone().add(this._boundingBox.getCenter(new THREE.Vector3));return new THREE.Line3(s,t).closestPointToPoint(e,!0,new THREE.Vector3).sub(this._boundingBox.getCenter(new THREE.Vector3))}updatePreviewPosition(e){let t=this.getPositionForIntersectionPoint(e),s=this.parent.localToWorld(t);this._newPosition=this.worldToLocal(s),this._dockline.position.copy((new THREE.Vector3).addVectors(this._newPosition,this._boundingBox.getCenter(new THREE.Vector3))),this._dockline.rotation.copy(this.docklineRotation)}hideSelectionLine(){this._dockline.visible=!1}getKernelPosition(e){if(this._newPosition){let t=this.localToWorld(this._newPosition);return oe(e.worldToLocal(t))}return super.getKernelPosition(e)}}class o extends THREE.PerspectiveCamera{constructor(e,t,s,i,o){super(e,t,s,i),this.offset=o}set offset(e){this._offset=e,this.updateProjectionMatrix()}get offset(){return this._offset}_calculateProjectionMatrix(){let e,t,s,i,o=this.fov*(2*Math.PI/360)/2;i=-(s=Math.tan(o));let n=Math.atan(this.aspect*Math.tan(o));e=-(t=Math.tan(n));let a=this._offset.left,r=this._offset.right,h=this._offset.top,l=this._offset.bottom,c=new THREE.Vector2(r-a,h-l),d=new THREE.Vector2(a+c.x/2,l+c.y/2);if(c.x<c.y){let o=(1-d.x)/(c.x/2),n=d.x/(c.x/2);t*=o,e*=n;let a=(o+n)/2;s*=a,i*=a}else{let o=(1-d.y)/(c.y/2),n=d.y/(c.y/2);s*=o,i*=n;let a=(n+o)/2;e*=a,t*=a}e*=this.near,t*=this.near,s*=this.near,i*=this.near;let _=this.near*Math.tan(Math.PI/180*.5*this.fov)/this.zoom*2,u=this.aspect*_;return this.view&&this.view.enabled&&(e+=this.view.offsetX*u/this.view.fullWidth,s-=this.view.offsetY*_/this.view.fullHeight,t+=this.view.offsetX*u/this.view.fullWidth,i-=this.view.offsetY*_/this.view.fullHeight),(new THREE.Matrix4).makePerspective(e,t,s,i,this.near,this.far)}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){this._offset?this.projectionMatrix=this._calculateProjectionMatrix():super.updateProjectionMatrix()}}return{create:function(t,s,i,o){return new e(t,s,i,o)},createPreview:function(e,t){return new s(e,{x:0,y:0,z:0},{x:0,y:0,z:0},t)},createStatic:function(e,s){return new t(e,s)},createPreviewLine:function(e){let t=new i(e.id,e.roomlePosition,e.roomleRotation,e.parentObjectId,e.receivedPointAssociation);return e.meshes.forEach(e=>{let s=e.clone();s.material=e.material.clone(),s.geometry=e.geometry.clone(),t.addMesh(s)}),t.computeBoundingBox(),t},isPreview:function(e){return e instanceof s},isPreviewLine:function(e){return e instanceof i},createCamera:function(e,t,s,i,n){return new o(e,t,s,i,n)}}}const ce=new Map,de=function(e,t,s){let i=ce.get(e);if(i){const o=s?[s]:void 0;i.forEach(({resolve:e,reject:s})=>t?e.apply(e,o):s.apply(s,o)),ce.delete(e)}};class _e{static finishOperation(e,t){de(e,!0,t)}static failOperation(e,t){de(e,!1,t)}static waitFor(e,t){return new Promise((s,i)=>{let o=ce.get(e);o||(ce.set(e,[]),o=ce.get(e)),o.push({resolve:s,reject:i}),"function"==typeof t&&t.apply(t)})}}e("c",_e);const ue="_start",me=new Map;class ge{static start(e){if(!window.performance||!window.performance.getEntriesByName)return"";let t=window.performance.getEntriesByName(e).length++,s="";t<100&&(s="0"),t<10&&(s="0"+s);const i=t>0?e+"_"+s+t:e,o=i+ue;return window.performance.mark(o),i}static addMeta(e,t){const s=ge.getMeta(e);me.set(e,Object.assign(s,t))}static getMeta(e){return me.get(e)||{}}static end(e){}static getMeasure(e){return[]}static showBenchmarks(e){const t=window.performance.getEntriesByType("measure");t.sort(function(e,t){return e.startTime-t.startTime});const s=[];for(let i=0,o=t.length;i<o;i++){const o=t[i];e&&-1===o.name.indexOf(e)||s.push({Start:parseFloat(o.startTime.toFixed(2)),Name:o.name,Duration:parseFloat(o.duration.toFixed(2))})}console.table(s)}}e("a",ge);const pe=e("d",10);e("e",9);class we{constructor(e){this._mergeThreshold=3,this._componentsToMerge=new Ee,this._mergeInProgress=!1,this._components=new Map,this._previews=new Map,this._creator_=e,this._getKernelAccess().addConfiguratorListener(this),this._componentFactory=le()}get waitingForMaterials(){return this._configuratorMeshGenerator.waitingForMaterials}set waitingForMaterials(e){this._configuratorMeshGenerator.waitingForMaterials=e}_getKernelAccess(){return Te.lookup("kernel-access",this._creator_)}clearReference(){this._getKernelAccess().removeConfiguratorListener(this)}_addMeshToComponent(e,t,s,i,o,n,a,r){let h=this._components.get(e);if(!h&&!(h=this._previews.get(e.toString())))return void console.warn("component not found!",e);const l=this._componentFactory.isPreview(h);let c=this._generateMesh(t,l?null:s,o,n,a,r);s&&(c.userData.material=s),i&&(c.userData.transform=he(i),c.applyMatrix(c.userData.transform)),l&&c.layers.set(4),h&&h.addMesh(c),h.meshes.length>this._mergeThreshold&&this._componentsToMerge.set(e,h.meshes.length)}tryToMergeComponents(){this._mergeInProgress||(this._mergeInProgress=!0,this._componentsToMerge.size,this._requestMergeComponents())}_requestMergeComponents(){window.requestIdleCallback(this._mergeNextComponent.bind(this))}_mergeNextComponent(){if(this._componentsToMerge.size>0){const e=this._componentsToMerge.largestValue();this._componentsToMerge.delete(e),this._mergeComponent(e),this._requestMergeComponents()}else this._mergeInProgress=!1,this._geometriesMerged&&this._geometriesMerged(),this._components.forEach(e=>{e.loadingMesh&&console.warn("component still has loading mesh: ",e.hash)})}_mergeComponent(e){const t=this._components.get(e);if(t&&!(t.meshes.length<=this._mergeThreshold))if(this._cacheHolder.componentCache.has(t.hash)){const e=this._cacheHolder.componentCache.get(t.hash).meshes;t.replaceMeshes(e)}else{const e=new Map,s=[],i=[];t.meshes.forEach(t=>{const o=t.userData.material;if(!o)return void console.warn("mesh has no material id set");if(!e.has(o)){const i=new THREE.Mesh(new THREE.Geometry,t.material);i.userData.material=o,i.receiveShadow=!0,i.castShadow=!0,i.layers.set(3),this._setMaterial(i,o),s.push(i),e.set(o,i)}const n=e.get(o).geometry;t.userData.transform?n.merge(t.geometry,t.userData.transform):n.merge(t.geometry),i.push(t)}),s.forEach(e=>t.addMesh(e)),i.forEach(e=>t.removeMesh(e)),this._cacheHolder.componentCache.set(t.hash,t)}}_addRootComponent(e){this._listener&&this._listener.display(e)}removeDockingComponent(){this._getKernelAccess().requestDeleteComponent(this._configuratorContext.dockingRootComponentId),this._configuratorContext.dockingRootComponentId=null}dockComponent(e,t,s,i){let o=this._components.get(t),n=this._components.get(e);n&&(n.roomlePosition=s,n.roomleRotation=i,o&&o.add(n))}dockComponentWithPosition(e,t){let s,i=this._components.get(e.parentId);s=t?t.getKernelPosition(i):e.getKernelPosition(i);const o=ge.start("dock_component_with_position_"+e.childId);this._getKernelAccess().dockComponentWithPosition(e.parentId,e.parentDockId,e.childId,e.childDockId,s),this._configuratorContext.dockingRootComponentId=null,ge.end(o)}removePreviews(){this._previews.size>0&&(this._previews.forEach(e=>{e.removeFromParent(),e.removeAllMeshes()}),this._previews.clear())}_updatePlanObject(e){this._listener&&this._listener.planObjectUpdated(e)}Editor3dAddBakedMesh(e,t,s,i,o,n){this._addMeshToComponent(e,null,t,null,s,i,o,n)}Editor3dAddDockPreview(e,t){let s=this._componentFactory.createPreview(t,e);this._previews.set(t.toString(),s)}Editor3dAddNamedMesh(e,t,s,i,o,n,a,r){this._addMeshToComponent(e,t,s,i,o,n,a,r)}Editor3dBeginConstruction(e){let t=this._components.get(e);t&&t.removeAllMeshes()}Editor3dComponentCreated(e,t,s,i,o){o&&(this._configuratorContext.rootComponentId=e);let n=null;this._components.has(e)?(n=this._components.get(e)).removeAllMeshes():(n=this._componentFactory.create(e,t,s,i)).layers.set(3),this._components.set(e,n),o&&this._addRootComponent(n)}Editor3dComponentDocked(e,t,s,i){this.dockComponent(e,t,s,i)}Editor3dEndConstruction(e){let t=this._getKernelAccess().kernelInstance.getComponent(e),s=this._components.get(e);s&&(s.computeBoundingBox(t.boxForMeasurement),s.boundingBoxMesh&&this._listener&&this._listener.addComponentHandlers(s));let i=this._previews.get(e.toString());i&&i.computeBoundingBox(t.boxForMeasurement,!0)}Editor3dGeometryReady(e){this._getKernelAccess().kernelInstance.requestPlanComponentConstruction(e)}Editor3dGeometryNotReady(e){let t;this._components.has(e)&&(t=this._components.get(e)).loading()}Editor3dPlanObjectConstructionDone(e){const t=this._getKernelAccess().kernelInstance.getPlanObject(e),s=this._getKernelAccess().kernelInstance.getFullPartList(),i=this._getKernelAccess().kernelInstance.getHashOfConfiguration(e),o=this._getKernelAccess().kernelInstance.getComponentId(t.rootPlanComponentId),n=[t,s.fullList,i,o];_e.finishOperation(2,n),this._updatePlanObject(t),this._listener&&this._listener.planObjectConstructionDone(t)}Editor3dPreviewConstructionDone(e,t){let s=!1;this._previews.forEach(e=>{null!==e.parent&&(this._listener&&(this._componentFactory.isPreviewLine(e)?this._listener.addPreviewLineHandlers(e):this._listener.addPreviewHandlers(e)),s=!0)}),this._listener&&this._listener.previewConstructionDone(this._components.get(e),s)}Editor3dSetPreviewLineAssociations(e,t){let s=this._previews.get(t.toString());if(s.clear(),!s)return;let i=this._componentFactory.createPreviewLine(s),o=this._components.get(this._configuratorContext.rootComponentId);for(let t=0;t<e.length;t++){let s;(s=0===t?i:i.clonePreviewLine(t)).name="Preview Line",s.parentDockId=e[t].parentDockId,s.parentId=e[t].parentId,s.childDockId=e[t].childDockId,s.childId=e[t].childId,s.docklineRotation=ie(e[t].rotation),s.roomlePosition=e[t].position,e[t].lineFrom.x>e[t].lineTo.x||e[t].lineFrom.y>e[t].lineTo.y||e[t].lineFrom.z>e[t].lineTo.z?(s.roomleLineFrom=e[t].lineTo,s.roomleLineTo=e[t].lineFrom):(s.roomleLineFrom=e[t].lineFrom,s.roomleLineTo=e[t].lineTo),e[t].positionFrom.x>e[t].positionTo.x||e[t].positionFrom.y>e[t].positionTo.y||e[t].positionFrom.z>e[t].positionTo.z?(s.roomlePositionFrom=e[t].positionTo,s.roomlePositionTo=e[t].positionFrom):(s.roomlePositionFrom=e[t].positionFrom,s.roomlePositionTo=e[t].positionTo),o.add(s),s.preparePreview(),this._previews.set(s.stringId,s)}}Editor3dSetPreviewPointAssociations(e,t){let s=this._previews.get(t.toString());if(!s)return;let i=this._components.get(this._configuratorContext.rootComponentId);for(let t=0;t<e.length;t++){let o;0===t?o=s:(o=s.clonePreview(t),this._previews.set(o.stringId,o)),o.name="Preview Point",o.parentDockId=e[t].parentDockId,o.parentId=e[t].parentId,o.childDockId=e[t].childDockId,o.childId=e[t].childId,o.preparePreview(),o.receivedPointAssociation=!0,i.add(o),o.roomlePosition=e[t].position,o.roomleRotation=e[t].rotation}}componentDeleted(e){const t=this._components.get(e);t&&(this._listener&&this._listener.componentDeleted(t),t.removeFromParent(),t.removeAllMeshes(),this._components.delete(e))}componentMetaUpdated(e){let t=this._components.get(e.id);(t||(t=this._previews.get(e.id.toString())))&&(t.hash=e.hash,t.roomlePosition=e.position,t.roomleRotation=e.rotation,e.boxForMeasurement&&t.computeBoundingBox(e.boxForMeasurement),this._listener&&this._listener.componentUpdated(t,e))}configurationLoaded(e,t,s,i,o){e===pe&&(this._configuratorContext.dockingRootComponentId=s);let n=0===t;this._getKernelAccess().kernelInstance.requestPlanObjectConstruction(t);let a=this._getKernelAccess().kernelInstance.getComponent(s),r=this._components.get(s);r&&(r.computeBoundingBox(a.boxForMeasurement),r.hash=a.hash),this._listener&&this._listener.configurationLoaded(r,n&&void 0!==r.boundingBoxMesh)}finishParameterChange(e,t){Promise.all(this.waitingForMaterials).then(e,t)}planObjectConfigurationUpdated(e,t,s){let i=this._getKernelAccess().kernelInstance.getPlanObject(e);this._updatePlanObject(i)}planObjectCreated(e,t){this._configuratorContext.planObjectId=t,this._listener&&this._listener.clearScene(),this.waitingForMaterials.push(_e.waitFor(2))}planObjectUpdated(e){this._updatePlanObject(e)}sceneCleared(){this._components.forEach(function(e){e.removeFromParent(),e.removeAllMeshes()}),this._components.clear(),this._previews.forEach(e=>{e.removeFromParent(),e.removeAllMeshes()}),this._previews.clear()}setListener(e){this._listener=e}getBoundingBox(){const e=this._components.get(this._configuratorContext.rootComponentId);return e?(new THREE.Box3).setFromObject(e):null}hasPreviews(){return this._previews.size>0}clearRootComponent(){this._components.get(this._configuratorContext.rootComponentId).clear(!0)}debugSceneGraph(e){e?this._components.has(e)?this._components.get(e):this._previews.has(e.toString())&&this._previews.get(e.toString()):this._configuratorContext}getComponentsForIds(e){let t=[];return e.forEach(e=>{const s=this._components.get(e);s&&t.push(s)}),t}isPreviewLine(e){return this._componentFactory.isPreviewLine(e)}isPreview(e){return this._componentFactory.isPreview(e)}setGeometriesMergedListener(e){this._geometriesMerged=e}removeGeometriesMergedListener(){this._geometriesMerged=void 0}setMergeThreshold(e){this._mergeThreshold=e}_generateMesh(e=null,t,s,i,o,n,a=!1){return this._configuratorMeshGenerator.generateMesh(e,t,s,i,o,n)}_setMaterial(e,t,s){this._configuratorMeshGenerator.setMaterial(e,t)}constructComponents(e){this._getKernelAccess().kernelInstance.requestPlanObjectConstruction(e)}}e("Z",we),h([l],we.prototype,"_configuratorMeshGenerator",void 0),h([l],we.prototype,"_configuratorContext",void 0),h([l],we.prototype,"_cacheHolder",void 0);class Ee extends Map{largestValue(){let e=this.entries().next().value[0],t=0;return this.forEach((s,i)=>{s>t&&(e=i,t=s)}),e}}const fe=[new m("error-handler",class{constructor(){this._listeners={}}_subscribe(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}subscribe(e,t){this._subscribe(e,t)}dispatch(e,t){if(!this._listeners[e])return;const s=this._listeners[e];let i=s.length;for(let e=0;e<i;e++){const i=s[e];i.apply(i,t)}}unsubscribe(e,t){if(!this._listeners[e])return;const s=this._listeners[e];let i=s.length;for(let e=0;e<i;e++)if(s[e]===t)return s.splice(e,1),i--,void e--}softReject(e,t,s){return this.dispatch(s,[t]),e()}}),new m("form-data-util",p),new m("environment-loader",w),new m("static-item-loader",H,0),new m("form-data-util",p),new m("single-promise-factory",class{constructor(e){this._promises=new Map,this._creator_=e}create(e,t,s){return new Promise((i,o)=>{let n=this._promises.get(e),a=!0;if(!n){const t=new Map;this._promises.set(e,t),n=this._promises.get(e),a=!1}n.get(t)||(n.set(t,[]),a=!1);const r=n.get(t);r.push({resolve:i,reject:o}),n.set(t,r);const h=()=>{n.delete(t),0===n.size&&this._promises.delete(e)};a||new Promise(s).then(e=>{n.get(t).forEach(({resolve:t})=>t(e)),h()},e=>{n.get(t).forEach(({reject:t})=>t(e)),h()})})}},1),new m("dynamic-light-setting-loader",T),new m("dynamic-quality-setting-loader",A),new m("network-layer",v),new m("local-storage",class{constructor(e){this._context_=e}get _localStorage(){let e=null;try{e=window.localStorage}catch(e){console.error(e)}return e}getItem(e){if(!this._localStorage)return null;const t=this._localStorage.getItem(e);try{return JSON.parse(t)}catch(e){return t}}setItem(e,t){if(this._localStorage)try{const s=JSON.stringify(t);this._localStorage.setItem(e,s)}catch(e){console.error(e)}}}),new m("network-layer",v),new m("kernel-io",class extends M{throw(e){this.error("[Kernel Exception]: "+e)}}),new m("data-syncer",C),new m("memory-manager",class{constructor(){this._configurationStringSet=new Set,this._singleLoadCounter=0}loadingConfigurationString(){this._singleLoadCounter+=1}loadingConfiguration(e){this._configurationStringSet.add(e),this._singleLoadCounter+=1}shouldHardReset(){return this._configurationStringSet.size>=15||this._singleLoadCounter>=30}executedHardReset(){this._configurationStringSet.clear(),this._singleLoadCounter=0}}),new m("life-cycle-manager",class{constructor(){this._listeners=[]}addEventListener(e){this._listeners.push(e)}removeEventListener(e){const t=this._listeners;let s=t.length;if(s)for(let i=0;i<s;i++)t[i]===e&&(t.splice(i,1),i--,s--)}pause(){this._listeners.forEach(e=>e.pause())}resume(){this._listeners.forEach(e=>e.resume())}destroy(){this._listeners.forEach(e=>e.destroy())}},1),new m("three-loader",S),new m("local-storage-helper",I),new m("cache-holder",class{constructor(){this._componentCache=new Map,this._geometryCache=new Map,this._materialCache=new Map}get componentCache(){return this._componentCache}get geometryCache(){return this._geometryCache}get materialCache(){return this._materialCache}clear(){for(const e of this._componentCache.values())Q(e);for(const e of this._materialCache.values())ee(e);for(const e of this._geometryCache.values())$(e);this._componentCache.clear(),this._geometryCache.clear(),this._materialCache.clear()}},0),new m("kernel-access-callback",class{constructor(e){this._callbackListener=new Set,this._creator_=e}addListener(e){this._callbackListener.add(e)}removeListener(e){this._callbackListener.delete(e)}isReady(){this._callbackListener.forEach(e=>e.isReady())}loadError(e){this._callbackListener.forEach(t=>t.loadError(e))}},1),new m("configurator-kernel-access-callback",class{constructor(e){this._callbackListener=new Set,this._creator_=e}addListener(e){this._callbackListener.add(e)}removeListener(e){this._callbackListener.delete(e)}isReady(){this._callbackListener.forEach(e=>e.isReady())}updatePossibleChildren(e,t,s){this._callbackListener.forEach(i=>i.updatePossibleChildren(e,t,s))}updateParameters(e,t,s,i){this._callbackListener.forEach(o=>o.updateParameters(e,t,s,i))}loadError(e){this._callbackListener.forEach(t=>t.loadError(e))}},1),new m("configurator-view-model",we,1),new m("configurator-context",class{constructor(){this.rootComponentParametersAsGlobal=!1,this.lastLoadedRapiId=null,this.selectedRuntimeComponentIds=[],this.selectionMode="standard"}get selectedRuntimeComponentId(){return this.selectedRuntimeComponentIds.length>0?this.selectedRuntimeComponentIds[0]:null}},1)];class Te{static setup(e){Te.addToContainer(e)}static lookup(e,t){return window.__RML__DI__?window.__RML__DI__.lookup(e,t):null}static getContext(e){return window.__RML__DI__?window.__RML__DI__.getContext(e):null}static cleanUp(e){return window.__RML__DI__?window.__RML__DI__.cleanUp(e):null}static addToContainer(e){window.__RML__DI__||(window.__RML__DI__=new u,window.__RML__DI__.addDependencyInjectionAssignments(fe)),window.__RML__DI__.addDependencyInjectionAssignments(e)}}e("F",Te),e("E",class{constructor(e){this._context=e}_setupCommonGlobals(){window.__RML__DEBUG__||(window.__RML__DEBUG__={}),window.__RML__ENV__||(window.__RML__ENV__={},window.__RML__ENV__.assetPath||(window.__RML__ENV__.assetPath=""));const e={retina:!1,overrideCountry:null,locale:_.actualLocale,unit:null,unitStringType:null,dls:null,ls:null,meshSelection:!0,colors:r,enableHSC:!1,mode:"3D",stats:!1,_measureTraffic:!1,enableHD:!0,gammaIO:!0,debug:!1};window.__RML__ENV__.initData?window.__RML__ENV__.initData=Object.assign(e,window.__RML__ENV__.initData):window.__RML__ENV__.initData=e;const t=a();window.__RML__ENV__.initData=Object.assign(window.__RML__ENV__.initData,t)}_setupCommonDependencies(){}_cleanUpCommonGlobals(){window.__RML__DEBUG__&&(window.__RML__DEBUG__.Kernel&&window.__RML__DEBUG__.Kernel.clearAll&&window.__RML__DEBUG__.Kernel.clearAll(),delete window.__RML__DEBUG__),delete window.__RML__ENV__;for(const e in window.THREE)if(window.THREE.hasOwnProperty(e))try{delete window.THREE[e]}catch(e){console.error(e)}window.THREE=void 0}_cleanUpCommonDependencies(){}boot(e){this._setupCommonGlobals(),this.setupGlobals(e),this._setupCommonDependencies(),this.setupDependencies(),this.bootFinished()}lookup(e,t){return window.__RML__DI__.lookup(e,t)}teardown(){this.cleanUpDependencies(),this._cleanUpCommonDependencies(),this.cleanUpGlobals(),this._cleanUpCommonGlobals(),window.__RML__DI__&&delete window.__RML__DI__}pause(){this.lookup("life-cycle-manager",this._context).pause(),window.TWEEN&&TWEEN.removeAll()}resume(e){e&&this.lookup("dom-helper",this._context).setDomElement(e),this.lookup("life-cycle-manager",this._context).resume()}destroy(){this.pause(),this.lookup("life-cycle-manager",this._context).destroy(),Te.cleanUp(this._context)}}),e("m",{HSC:"rml-hsc",HSP:"rml-hsp",GLB:"rml-glb",RMV:"rml-mv"});const ye="rml-threejs-canvas-container";class ve{constructor(e){this._creator_=e,this._lifeCycleManager.addEventListener(this)}get element(){return this._container}setDomElement(e){if(!this._container){this._container=document.createElement("div"),this._container.classList.add(ye),this._container.style.position="relative",this._container.style.width="100%",this._container.style.height="100%";const t=document.createElement("style");t.innerText="."+ye+" canvas{position:absolute;top:0;left:0;right:0;bottom:0;}."+ye+" .foreground{z-index:100; opacity:1;}."+ye+" .background{z-index:-1; opacity:0;}",this._container.appendChild(t),e.appendChild(this._container)}this._element=e}getClientDimensions(){return new THREE.Vector2(this._element.clientWidth,this._element.clientHeight)}_removeDomElement(e){if(!e)return;const t=e.parentElement;t&&t.removeChild(e)}reset(){this._element=null,this._removeDomElement(this._container),this._container=null}pause(){this.reset()}resume(){}destroy(){}}e("B",ve),h([l],ve.prototype,"_lifeCycleManager",void 0);class Me{constructor(){this._listeners={}}_addEventListener(e,t,s){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push({callback:t,scope:s})}addEventListener(e,t,s){this._addEventListener(e,t,s)}dispatchEvent(e,t){if(!this._listeners[e])return;const s=this._listeners[e];let i=s.length;for(let e=0;e<i;e++){const i=s[e];i.callback.apply(i.scope,[t])}}removeEventListener(e,t){const s=this._listeners[e];if(s)for(let e=0,i=s.length;e<i;e++)if(s[e].callback===t)return void s.splice(e,1)}}e("g",Me);const xe=-1;class Re extends Me{constructor(e,t,s){super(),this._tweenEnd=null,this._pitch=V(10),this._yaw=V(-15),this._distance=xe,this._locked=!1,this._inputListeners=[],this._creator_=e,this._inputManager=t,this._initInputListener(),this._addInputListeners(),this._cameraPosition=new THREE.Vector3,this._targetPosition=new THREE.Vector3,s?this._cameraPosition.copy(s):this._cameraPosition=new THREE.Vector3(0,.5,3);let i=this._domHelper.getClientDimensions();this._width=i.x,this._height=i.y}getCamera(){return this._getCamera()}_addInputListeners(){this._inputListeners.forEach(e=>{this._inputManager.addEventListener(e.key,e.fun,this)})}_removeInputListeners(){this._inputListeners.forEach(e=>{this._inputManager.removeEventListener(e.key,e.fun)}),this._inputListeners=[]}cleanUp(){this._removeInputListeners()}animateCamera(e){let t=this._cameraPosition;if(!t||W(t,this.getCamera().position))return!1;let s=this.getCamera().position.clone(),i=Math.min(10*e,1);return s.lerp(t,i),this.getCamera().position.copy(s),!0}_areEqual(e,t){return e.yaw.toFixed(5)===t.yaw.toFixed(5)&&e.pitch.toFixed(5)===t.pitch.toFixed(5)&&e.distance.toFixed(5)===t.distance.toFixed(5)&&e.targetX===t.targetX&&e.targetY===t.targetY&&e.targetZ===t.targetZ}_tweenCameraParameter(e,t,s){return new Promise(s=>{if(t.yaw-e.yaw<=-Math.PI?e.yaw-=2*Math.PI:t.yaw-e.yaw>=Math.PI&&(e.yaw+=2*Math.PI),window.TWEEN){if(null!==this._tweenEnd&&this._tweenEnd.blockOtherTweens)return;this._tweenEnd=t,new TWEEN.Tween(e).to(t,400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{this._yaw=e.yaw,this._pitch=e.pitch,this._distance=e.distance,this._update(new THREE.Vector3(e.targetX,e.targetY,e.targetZ))}).onComplete(()=>{this._tweenEnd=null,s()}).start()}})}_getCurrentCameraParameters(){let e=this._targetPosition.clone();return{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:e.x,targetY:e.y,targetZ:e.z}}_rotateHorizontal(e){this._yaw-=e,this._yaw<-Math.PI?this._yaw+=2*Math.PI:this._yaw>Math.PI&&(this._yaw-=2*Math.PI)}_rotateVertical(e){this._pitch+=e,this._pitch<-Math.PI?this._pitch+=2*Math.PI:this._pitch>Math.PI&&(this._pitch-=2*Math.PI)}saveState(e){if(e||!this._stateSaved){let e=this._yaw,t=this._pitch,s=this._distance,i=this._targetPosition.clone();if(this._stateSaved={yaw:e,pitch:t,distance:s,targetX:i.x,targetY:i.y,targetZ:i.z,blockOtherTweens:!0},this._getCamera().fov){let e=this._getCamera();this._stateSaved.fov=e.fov,this._stateSaved.near=e.near,this._stateSaved.far=e.far}return this._stateSaved}return null}resetToState(){if(this._stateSaved){this._stateSaved.blockOtherTweens=!1;let e=this._targetPosition.clone();this._tweenCameraParameter({yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:e.x,targetY:e.y,targetZ:e.z},this._stateSaved,!0)}this._stateSaved=null}setToState(e,t){this._tweenCameraParameter(e,t,!0)}hasSavedState(){return null!=this._stateSaved}lock(){this._locked=!0}unlock(){this._locked=!1}getTargetPosition(){return this._targetPosition}_saveYawAndPitch(){this._getCamera().userData.yaw=this._yaw,this._getCamera().userData.pitch=this._pitch}getInputPosition(e){const{x:t,y:s}=this._domHelper.getClientDimensions();return new THREE.Vector3(e.x/t*2-1,-e.y/s*2+1,.5)}}e("A",Re),h([l],Re.prototype,"_domHelper",void 0);class Pe{constructor(e,t){this.minZoom=!1,this.maxZoom=!1,this.minZoom=e,this.maxZoom=t}}e("k",class extends Re{constructor(e,t,s,i){super(e,t,s),this._bounds=new THREE.Vector3,this._scale=1,this._state=0,this._zoomSpeed=Math.pow(.95,4),this.minDistance=0,this.maxDistance=5,this.minPolarAngle=V(0),this.maxPolarAngle=V(85),this.minAzimuthAngle=Number.NEGATIVE_INFINITY,this.maxAzimuthAngle=Number.POSITIVE_INFINITY,this._currentZoomHash="",i?this._camera=i:this._initCamera(),this._targetPosition=new THREE.Vector3(0,0,0);let{cameraRestriction:o,minVerticalCameraAngle:n,maxVerticalCameraAngle:a,minHorizontalCameraAngle:r,maxHorizontalCameraAngle:h}=window.__RML__ENV__.initData;if(void 0!==n&&(this.minPolarAngle=V(n<0?n:-1*n)),void 0!==a&&(this.maxPolarAngle=V(a)),void 0!==r&&(this.minAzimuthAngle=V(r<0?r:-1*r)),void 0!==h&&(this.maxAzimuthAngle=V(h)),void 0!==o){let e=Math.abs(V(o));this.minAzimuthAngle=-e,this.maxAzimuthAngle=e,this.maxPolarAngle=Math.min(e,V(85))}}_getCamera(){return this._camera?this._camera:(this._initCamera(),this._camera)}_initCamera(){this._camera=new THREE.PerspectiveCamera,this._camera.fov=30,this._camera.aspect=this._width/this._height,this._camera.near=.1,this._camera.far=100,this._camera.updateProjectionMatrix(),this._camera.layers.set(3),this._camera.layers.enable(1),this._camera.layers.enable(2),this._camera.layers.enable(5),this._camera.layers.enable(4)}updateCamera(){let{x:e,y:t}=this._domHelper.getClientDimensions();this._camera.aspect=e/t,this._camera.updateProjectionMatrix()}animateCamera(e){if(!super.animateCamera(e))return!1;let t=this._targetPosition;return!!t&&(this.getCamera().lookAt(t),!0)}_initInputListener(){this._inputListeners.push({key:3,fun:e=>{this._state=1}}),this._inputListeners.push({key:6,fun:e=>{1!==this._state||this._locked||this._move(new THREE.Vector2(e.position.x,e.position.y))}}),this._inputListeners.push({key:4,fun:e=>{1===this._state&&this.dispatchEvent(2),this._state=0,this._orbitPosition=null}}),this._inputListeners.push({key:7,fun:e=>this.zoomIn()}),this._inputListeners.push({key:8,fun:e=>this.zoomOut()})}_move(e){this._orbitPosition||(this._orbitPosition=new THREE.Vector2(e.x,e.y),this.dispatchEvent(0));let t=e.clone().sub(this._orbitPosition),s=this._domHelper.element;this._rotateHorizontal(2*Math.PI*t.x/s.clientWidth*1),this._rotateVertical(2*Math.PI*t.y/s.clientHeight*1),Y(this._orbitPosition,e)||this.dispatchEvent(1),this._orbitPosition.copy(e),this._update()}setBounds(e){let t=new THREE.Vector3(-e.x/2,0,-e.z/2),s=new THREE.Vector3(e.x/2,e.y,e.z/2);this._boundingBox=new THREE.Box3(t,s)}updateToBounds(e,t,s,i,o=!0,n){this._boundingBox=e;let a=e.getSize(new THREE.Vector3);const r=e.getCenter(new THREE.Vector3);this._targetPosition=n?n.clone():new THREE.Vector3(r.x,r.y,r.z);const h=this._setDistanceAndRangesBasedOnBounds(a,t,s);this._distance===xe?(this._distance=Math.max(4,h),this._update()):o&&this._tweenCameraParameter(this._getCurrentCameraParameters(),{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:this._targetPosition.x,targetY:this._targetPosition.y,targetZ:this._targetPosition.z},i)}_setDistanceAndRangesBasedOnBounds(e,t,s){this._bounds.copy(e),this.minDistance=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);let i=1.1*D(e.x,e.y,e.z,this._camera.fov,t,s);return this._distance<i&&(this._distance=i),this.maxDistance=1.5*i,this.maxDistance=Math.min(this.maxDistance,i+6),this.maxDistance<4&&(this.maxDistance=4),this._camera.far=5*this.maxDistance,i}reset(e,t,s,i,o,n,a=!0){if(e){i?this._targetPosition.copy(i):this._targetPosition=new THREE.Vector3(0,e.y/2,0);let r=this._getCurrentCameraParameters();o||(o=-15),n||(n=10),this._pitch=V(n),this._yaw=V(o),this._setDistanceAndRangesBasedOnBounds(e,t,s);let h=this._targetPosition.clone();this._areEqual(r,{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:h.x,targetY:h.y,targetZ:h.z})?this._moveCameraForthAndBack():a?this._tweenCameraParameter(r,{yaw:this._yaw,pitch:this._pitch,distance:this.maxDistance,targetX:h.x,targetY:h.y,targetZ:h.z},!0):this._update(this._targetPosition)}else console.warn("you cant reset without bounds!")}updateAndReset(e,t,s,i,o,n,a,r=!0){let h=new THREE.Vector3(-e.x/2,0,-e.z/2),l=new THREE.Vector3(e.x/2,e.y,e.z/2);if(this._boundingBox=new THREE.Box3(h,l),a&&e.addScalar(a),i?this._targetPosition.copy(i):this._targetPosition=new THREE.Vector3(0,e.y/2,0),this._distance===xe){let i=this._setDistanceAndRangesBasedOnBounds(e,t,s);this._distance=Math.max(4,i)}let c=this._getCurrentCameraParameters();o||(o=-15),n||(n=10),this._pitch=V(n),this._yaw=V(o),this._setDistanceAndRangesBasedOnBounds(e,t,s);let d=this._targetPosition.clone();r?this._tweenCameraParameter(c,{yaw:this._yaw,pitch:this._pitch,distance:this.maxDistance,targetX:d.x,targetY:d.y,targetZ:d.z},!0):this._update(this._targetPosition)}_moveCameraForthAndBack(){if(window.TWEEN){let e={value:.6*this._camera.far},t={value:this._distance};new TWEEN.Tween(e).to(t,300).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{this._distance=e.value,this._update()}).start()}}_restoreFromState(e){this._yaw=e.yaw,this._pitch=e.pitch,this._distance=e.distance,this._targetPosition.copy(new THREE.Vector3(e.targetX,e.targetY,e.targetZ)),this._simulateUpdate()}simulateTo2D(e,t){return new Promise(s=>{let i=Math.max(e.x,e.z),o=D(i,i,i,this._camera.fov,window.innerWidth,window.innerHeight),n=this._getCurrentCameraParameters();this._camera.near=1,this._camera.far=o+50,this._camera.updateProjectionMatrix();let a={yaw:0,pitch:V(90),distance:o,targetX:t.x,targetY:o,targetZ:t.z};if(window.TWEEN){if(null!==this._tweenEnd&&this._tweenEnd.blockOtherTweens)return;this._tweenEnd=a,new TWEEN.Tween(n).to(a,500).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(()=>{this._yaw=n.yaw,this._pitch=n.pitch,this._distance=n.distance,this._targetPosition.copy(new THREE.Vector3(n.targetX,0,n.targetZ)),this._simulateUpdate()}).onComplete(()=>{this._tweenEnd=null,s()}).start()}})}simulateTo3D(e,t){return new Promise(s=>{if(this._restoreFromState(e),window.TWEEN){if(null!==this._tweenEnd&&this._tweenEnd.blockOtherTweens)return;this._tweenEnd=t,new TWEEN.Tween(e).to(t,500).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{this._yaw=e.yaw,this._pitch=e.pitch,this._distance=e.distance,this._targetPosition.copy(new THREE.Vector3(e.targetX,e.targetY,e.targetZ)),this._simulateUpdate()}).onComplete(()=>{this._tweenEnd=null,s()}).start()}})}simulateToFirstPerson(e){return new Promise(t=>{if(window.TWEEN){let s=this.getCamera().position,i={x:s.x,y:s.y,z:s.z,yaw:this._yaw,pitch:this._pitch},o={x:e.x,y:e.y,z:e.z,yaw:0,pitch:0};new TWEEN.Tween(i).to(o,500).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{this._yaw=i.yaw,this._pitch=i.pitch,this._targetPosition.copy(new THREE.Vector3(i.x,i.y,i.z)),this._simulateUpdate()}).onComplete(()=>{this._tweenEnd=null,t()}).start()}})}_update(e){this._yaw=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this._yaw)),this._pitch=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._pitch)),this._saveYawAndPitch();let t=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX"),s=(new THREE.Quaternion).setFromEuler(t),i=new THREE.Vector3(0,0,-1);i.applyQuaternion(s),this._distance*=this._scale,this._distance=Math.min(this.maxDistance,this._distance),e&&this._targetPosition.copy(e);let o=this._targetPosition.clone().sub(i.multiplyScalar(this._distance)),n=this._getCameraSphere(o);null!=this._boundingBox&&this._boundingBox.intersectsSphere(n)&&this._scale>=1?this._distance+=.1:null==this._boundingBox||this._boundingBox.intersectsSphere(n)?this._zoomChanged(!1,!0):(this._cameraPosition.copy(o),this._distance===this.maxDistance?this._zoomChanged(!0,!1):this._zoomChanged(!1,!1)),this._scale=1}_zoomChanged(e,t){let s=e+""+t;0!==this._currentZoomHash.length&&this._currentZoomHash===s||(this.dispatchEvent(5,new Pe(e,t)),this._currentZoomHash=s)}_simulateUpdate(){let e=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX"),t=(new THREE.Quaternion).setFromEuler(e),s=new THREE.Vector3(0,0,-1);s.applyQuaternion(t),this._cameraPosition.copy(this._targetPosition.clone().sub(s.multiplyScalar(this._distance)))}zoomTo(e,t,s,i,o,n){return this._tweenCameraParameter(this._getCurrentCameraParameters(),{yaw:i,pitch:o,distance:2.725*D(e.x,e.y,e.z,this._camera.fov,t,s),targetX:n.x,targetY:n.y,targetZ:n.z,blockOtherTweens:!0},!0)}_getCameraSphere(e){return new THREE.Sphere(e,.1)}zoomIn(e){this._scale*=e?Math.pow(.95,e):this._zoomSpeed,this._update(),this.dispatchEvent(3)}zoomOut(e){this._scale/=e?Math.pow(.95,e):this._zoomSpeed,this._update(),this.dispatchEvent(4)}});let be={},Ce={};class He{constructor(e){this._creator_=e}fetch(e,t){return this._singlePromiseFactory.create(5,e,(i,o)=>{!function(e,t,i,o){if(-1===e.indexOf("http")&&(e=s()+e),be[e])return i();if(t.id&&Ce[t.id])return o(new Error('There is already a script with ID "'+t.id+'"'));const n=ge.start("load_"+t.id.replace(/-/g,"_")),a=document.createElement("script");a.async=!1,a.src=e,a.id=t.id,a.onload=(()=>{be[e]=!0,Ce[t.id]=!0,ge.end(n),Object.defineProperty(i,"name",{value:"resolve-"+t.id}),i()}),a.onerror=(e=>{o(e)}),document.body.appendChild(a)}(e,t,i,o)})}cleanUp(){for(let e in Ce)if(Ce.hasOwnProperty(e)){const t=document.getElementById(e);t&&t.parentElement.removeChild(t)}be={},Ce={}}}e("z",He),h([l],He.prototype,"_singlePromiseFactory",void 0);const Se={MOUSE_MOVE:"mousemove",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_LEAVE:"mouseleave",MOUSE_ENTER:"mouseenter",MOUSE_WHEEL:"wheel",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend",CONTEXT_MENU:"contextmenu"};class Le{constructor(e,t,s){this.position=e,this.positionRelative=t,this.type=s}}const ke=e("a1",5*window.devicePixelRatio),Ie=2*window.devicePixelRatio;class Ae extends Me{constructor(e){super(),this._debug=!1,this._delta=-1,this._state=0,this._pinchDistance=-1,this._lastMouseWheelEvent=null,this._lastTouchEvent=null,this._events=Object.keys(Se).map(e=>Se[e]),this._creator_=e,this._position={x:0,y:0},this._positionRelative={x:0,y:0},this._downPosition={x:0,y:0},this._downPositionRelative={x:0,y:0}}enableDragIn(e){this._state=1,this._dragEnabled=!0,e&&(this._dragMV=this._dragM.bind(this),this._dragEV=this._dragE.bind(this),this._dragTarget=e.currentTarget||e.target,this._delta=-1,this._dragMVName="drag",this._dragEVName="dragend",window.TouchEvent&&e instanceof TouchEvent?(this._dragMVName="touchmove",this._dragEVName="touchend"):e.dataTransfer&&e.dataTransfer.setData&&e.dataTransfer.setData("text/plain"," "),this._firefoxDragPosition={x:0,y:0},document.ondragover=(e=>{e=e||window.event,this._firefoxDragPosition.x=e.pageX,this._firefoxDragPosition.y=e.pageY}),this._dragTarget.addEventListener(this._dragMVName,this._dragMV,!1),this._dragTarget.addEventListener(this._dragEVName,this._dragEV,!1))}_dragM(e){let t=e,s=null,i=null;window.TouchEvent&&e instanceof TouchEvent?(s=this._getTouchPosition(t),i=this._getTouchPositionRelative(t)):(s=this._getMousePosition(t),i=this._getMousePositionRelative(t)),s.x>0&&s.y>0&&this._move(s,i)}_dragE(e){let t=e;document.ondragover=null,this._firefoxDragPosition=null,this._dragTarget.removeEventListener(this._dragMVName,this._dragMV),this._dragTarget.removeEventListener(this._dragEVName,this._dragEV),window.TouchEvent&&e instanceof TouchEvent?this._onUp(this._getTouchPosition(t),this._getTouchPositionRelative(t)):this._onUp(this._getMousePosition(t),this._getMousePositionRelative(t))}addEvents(e){this._events.forEach(t=>e.addEventListener(t,this,!1))}removeEvents(e){this._events.forEach(t=>e.removeEventListener(t,this,!1))}_dolly(e){if(this._lastTouchEvent&&e.timeStamp-this._lastTouchEvent.timeStamp<40)return;let t=e.touches[0].pageX-e.touches[1].pageX,s=e.touches[0].pageY-e.touches[1].pageY,i=Math.abs(t)+Math.abs(s);i>this._pinchDistance+Ie&&this.dispatchEvent(7,new Le(this._getTouchPosition(e),this._getTouchPositionRelative(e))),i<this._pinchDistance-Ie&&this.dispatchEvent(8,new Le(this._getTouchPosition(e),this._getTouchPositionRelative(e))),this._pinchDistance=i,this._lastTouchEvent=e}_move(e,t,s){void 0===s&&(s=0),void 0===this._dragEnabled&&(this._dragEnabled=!1),(1===this._state&&this._canDrag(s)||1===this._state&&this._dragEnabled&&2===s)&&(this._delta=this._getDelta(),this._delta>ke&&(this._state=2,this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(0,new Le(e,t)))),2===this._state&&this.dispatchEvent(1,new Le(e,t)),this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(6,new Le(e,t,s))}_longClick(){this._state=2,this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(0,new Le(this._downPosition,this._downPositionRelative)),this.dispatchEvent(1,new Le(this._downPosition,this._downPositionRelative))}_onUp(e,t){this.dispatchEvent(4,new Le(e)),this._getDelta()<=ke&&this.dispatchEvent(5,new Le(e,t)),2===this._state&&this.dispatchEvent(2,new Le(e,t)),3===this._state&&(this._pinchDistance=-1),this._lastTouchEvent=null,this._state=0,this._dragTarget=null,this._longClickTimer&&clearTimeout(this._longClickTimer)}_getTouchPosition(e){if(e.changedTouches.length){let{clientX:t,clientY:s}=e.changedTouches[0];this._position.x=t,this._position.y=s}return this._position}_getTouchPositionRelative(e){if(e.changedTouches.length){let t=this._domHelper.element.getBoundingClientRect(),{clientX:s,clientY:i}=e.changedTouches[0];this._positionRelative.x=(s-t.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(i-t.top)/this._domHelper.element.clientHeight*2+1}return this._positionRelative}_getMousePosition(e){return this._position.x=e.clientX,this._position.y=e.clientY,this._position}_getMousePositionRelative(e){if(0!==e.clientX&&0!==e.clientY){let t=this._domHelper.element.getBoundingClientRect();this._positionRelative.x=(e.clientX-t.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(e.clientY-t.top)/this._domHelper.element.clientHeight*2+1}else if(this._firefoxDragPosition&&0!==this._firefoxDragPosition.x&&0!==this._firefoxDragPosition.y){let e=this._domHelper.element.getBoundingClientRect();this._positionRelative.x=(this._firefoxDragPosition.x-e.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(this._firefoxDragPosition.y-e.top)/this._domHelper.element.clientHeight*2+1}return this._positionRelative}_getDelta(){return Math.abs(this._downPosition.y-this._position.y)+Math.abs(this._downPosition.x-this._position.x)}setDragEnabled(e){this._dragEnabled=e}handleEvent(e){switch(this._debug&&e.type,e.type){case Se.MOUSE_MOVE:this._onMouseMove(e);break;case Se.MOUSE_DOWN:this._onMouseDown(e);break;case Se.MOUSE_UP:this._onMouseUp(e);break;case Se.MOUSE_LEAVE:this._onMouseLeave(e);break;case Se.MOUSE_ENTER:this._onMouseEnter(e);break;case Se.MOUSE_WHEEL:this._onMouseWheel(e);break;case Se.TOUCH_MOVE:this._onTouchMove(e);break;case Se.TOUCH_START:this._onTouchStart(e);break;case Se.TOUCH_END:this._onTouchEnd(e);break;case Se.CONTEXT_MENU:this._onContextMenu(e)}}_onMouseDown(e){e.preventDefault();let{x:t,y:s}=this._getMousePosition(e);this._downPosition={x:t,y:s},this._downPositionRelative=this._getMousePositionRelative(e),this.dispatchEvent(3,new Le({x:t,y:s},this._downPositionRelative,1)),this._state=1}_onMouseUp(e){e.preventDefault(),this._onUp(this._getMousePosition(e),this._getMousePositionRelative(e))}_onMouseMove(e){e.preventDefault(),this._move(this._getMousePosition(e),this._getMousePositionRelative(e),1)}_onMouseLeave(e){this._delta=-1,this._onMouseUp(e)}_onMouseEnter(e){e.preventDefault()}_onMouseWheel(e){e.preventDefault(),e.stopPropagation(),this._lastMouseWheelEvent&&e.timeStamp-this._lastMouseWheelEvent.timeStamp<40||(e.deltaY<0?this.dispatchEvent(7,new Le(this._getMousePosition(e),this._getMousePositionRelative(e))):this.dispatchEvent(8,new Le(this._getMousePosition(e),this._getMousePositionRelative(e))),this._lastMouseWheelEvent=e)}_onTouchMove(e){e.preventDefault(),this._dragTarget||(1===e.touches.length&&this._move(this._getTouchPosition(e),this._getTouchPositionRelative(e),2),2===e.touches.length&&(this._state=3,this._dolly(e)))}_onTouchStart(e){if(e.preventDefault(),1===e.touches.length){let{x:t,y:s}=this._getTouchPosition(e);this._downPosition={x:t,y:s},this._downPositionRelative=this._getTouchPositionRelative(e),this.dispatchEvent(3,new Le({x:t,y:s},this._downPositionRelative,2)),this._state=1,this._longClickTimer=window.setTimeout(this._longClick.bind(this),350)}else 2===e.touches.length&&(1!==this._state&&2!==this._state||this._onUp(this._getTouchPosition(e),this._getTouchPositionRelative(e)),this._state=3)}_onTouchEnd(e){e.preventDefault(),this._onUp(this._getTouchPosition(e),this._getTouchPositionRelative(e))}_onContextMenu(e){e.preventDefault()}_canDrag(e){return 2!==e}}e("h",Ae),h([l],Ae.prototype,"_domHelper",void 0);class Ve{constructor(e,t){this._scene=e,t&&t.removeFromScene()}needsBounds(){return!1}updateBounds(e){}}e("P",Ve);class De extends Ve{constructor(e,t){super(e,t),this._lights=[]}loadFromJSON(e){return new Promise((t,s)=>{this._lights=this._dynamicLightSettingLoader.parse(e),this.addToScene(),t()})}loadFromObject(e){return new Promise((t,s)=>{e.lights||t(),this._lights=this._dynamicLightSettingLoader.load(e),this._lights.filter((e,t)=>{e.userData.movesWithCamera&&(this._cameraLight=e,this._lights.splice(t,1))}),this.addToScene(),t()})}loadFromURL(e){return new Promise((t,s)=>{fetch(new Request(e,{method:"GET"})).then(o).then(e=>this.loadFromObject(e).then(t,s))})}addToScene(){this._lights.forEach(e=>{this._scene.add(e)}),this._cameraLight&&(this._cameraLight.castShadow=!1,this._scene.add(this._cameraLight))}removeFromScene(){this._lights.forEach(e=>{this._scene.remove(e)}),this._cameraLight&&this._scene.remove(this._cameraLight)}reload(){this.removeFromScene(),this.addToScene()}update(e,t){if(!this._cameraLight)return;let s=e.userData.yaw,i=e.userData.pitch,o=new THREE.Euler(-i,s,0,"ZYX"),n=(new THREE.Quaternion).setFromEuler(o),a=new THREE.Vector3(0,0,-1);a.applyQuaternion(n);let r=this._cameraLight.position.distanceTo(t),h=t.clone().sub(a.multiplyScalar(r));this._cameraLight.position.copy(h),this._cameraLight.lookAt(t)}showGUI(){let e=Z();this._cameraLight&&this._addToGUI(e,this._cameraLight),this._lights.forEach(t=>{this._addToGUI(e,t)})}_addToGUI(e,t){t instanceof THREE.SpotLight&&this._addSpotLightToGUI(e,t),t instanceof THREE.AmbientLight&&this._addAmbientLightToGUI(e,t),t instanceof THREE.DirectionalLight&&this._addDirectionalLightToGUI(e,t),t instanceof THREE.RectAreaLight&&this._addRectAreaLightToGUI(e,t)}_addRectAreaLightToGUI(e,t){let s=e.addFolder(t.name),i={name:t.name,color:"#"+t.color.getHexString(),intensity:t.intensity*(t.width*t.height)};s.add(t,"visible"),s.add(i,"intensity").min(10).max(400).step(10).onChange(e=>{t.intensity=e/(t.width*t.height)}),s.add(t,"castShadow"),s.addColor(i,"color").onChange(e=>{t.color=new THREE.Color(e)}),s.add(t.position,"x").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),s.add(t.position,"y").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),s.add(t.position,"z").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))})}_addSpotLightToGUI(e,t){let s=e.addFolder(t.name),i={name:t.name,color:"#"+t.color.getHexString(),angle:180*t.angle/Math.PI};s.add(t,"visible"),s.add(t,"intensity").min(0).max(5).step(.1),s.add(t,"penumbra").min(0).max(1).step(.1),s.addColor(i,"color").onChange(e=>{t.color=new THREE.Color(e)}),s.add(i,"angle").min(10).max(180).step(1).onChange(e=>{t.angle=e*Math.PI/180}),s.add(t.position,"x").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),s.add(t.position,"y").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),s.add(t.position,"z").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))})}_addAmbientLightToGUI(e,t){let s={name:t.name,color:"#"+t.color.getHexString()},i=e.addFolder(t.name);i.add(t,"visible"),i.add(t,"intensity").min(0).max(5).step(.1),i.addColor(s,"color").onChange(e=>{t.color=new THREE.Color(e)})}_addDirectionalLightToGUI(e,t){let s=e.addFolder(t.name),i={name:t.name,color:"#"+t.color.getHexString()};s.add(t,"visible"),s.add(t,"intensity").min(0).max(5).step(.1),s.addColor(i,"color").onChange(e=>{t.color=new THREE.Color(e)}),s.add(t,"castShadow"),s.add(t.position,"x").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),s.add(t.position,"y").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))}),s.add(t.position,"z").min(-10).max(10).step(.1).onChange(()=>{t.lookAt(new THREE.Vector3(0,0,0))})}}e("l",De),h([l],De.prototype,"_dynamicLightSettingLoader",void 0);class Be{constructor(e,t){this._scene=e,t&&(t.removeFromScene(),t.cleanUp())}updateCamera(e){}reload(){this.removeFromScene(),this.addToScene()}updateBounds(e){this._bounds=e}cleanUp(){this._scene=null}}class Fe extends Be{constructor(e,t){super(e,t),this._gltfLoaderPromise=this._scriptLoader.fetch("static/three/lib/loaders/GLTFLoader.js",{id:"gltf-loader-js"}).then(()=>{this._gltfLoader=new THREE.GLTFLoader})}needsBounds(){return!0}needsCamera(){return!0}updateBounds(e){if(super.updateBounds(e),this._backgroundMesh){let t=Math.max(e.x,e.z)/6;t=Math.max(t,1),this._backgroundMesh.scale.copy(new THREE.Vector3(t,t,t))}}updateCamera(e){if(this._backgroundMesh){let t=e.getWorldDirection(new THREE.Vector3);t.y=0,t.lengthSq()<.01&&((t=new THREE.Vector3(0,1,0)).applyQuaternion(e.quaternion),t.y=0),t.multiplyScalar(-1),t.normalize();let s=Math.asin(t.x);t.z<0&&(s=Math.PI-s),this._backgroundMesh.rotation.set(0,s,0)}}addToScene(){this._scene&&this._backgroundMesh&&this._scene.add(this._backgroundMesh)}removeFromScene(){this._scene&&this._backgroundMesh&&this._scene.remove(this._backgroundMesh)}loadBackground(e,t){this._backgroundMaterial=t,this._backgroundMaterial||(this._backgroundMaterial=new THREE.MeshBasicMaterial),this._gltfLoaderPromise.then(()=>{this._gltfLoader.load(e,this._onBackgroundLoaded.bind(this),e=>{},e=>{console.error(e)})})}_onBackgroundLoaded(e){this._scene&&(this._backgroundMaterial.vertexColors=THREE.VertexColors,e&&e.scene&&e.scene.children&&e.scene.children.length>0&&(e.scene.children[0].material=this._backgroundMaterial,e.scene.children[0].layers.set(2),e.scene.position.copy(new THREE.Vector3(0,0,0)),this._backgroundMesh=e.scene,this._backgroundMesh.layers.set(2),this._backgroundMesh.receiveShadow=!0,G(this._backgroundMesh,!0,!1),this.removeFromScene(),this.addToScene()))}showGUI(){console.warn("gui not implemented for gltf environment")}}e("r",Fe),h([l],Fe.prototype,"_scriptLoader",void 0);const Oe=100,ze=8,Ue=3,je=20,Ne=16185078;class Ge extends Be{constructor(e,t,s){super(e,t),this._wallVertices=[],this._wallMeshes=[],this._size=ze,this._longestSide=2;let i=new THREE.PlaneGeometry(Oe,Oe,Oe,Oe),o=new THREE.MeshStandardMaterial({color:11184810,side:THREE.DoubleSide});this._floorMesh=new THREE.Mesh(i,o),this._floorMesh.name="floor",this._floorMesh.position.y=-.001,this._floorMesh.rotation.x=-Math.PI/2,this._floorMesh.layers.set(2),this._floorMesh.receiveShadow=!0,this._fog=s||!1;for(let e=0;e<4;e++){let e=new THREE.Mesh;e.layers.set(2),e.receiveShadow=!0,this._wallMeshes.push(e)}this._updateWallVertices(),this._updateWalls(o),this._textureLoader=new THREE.TextureLoader,this.addToScene()}needsBounds(){return!0}needsCamera(){return this._fog}needsRotation(){return!1}updateBounds(e){super.updateBounds(e),this._longestSide=Math.max(e.x,e.z);let t=this._longestSide+5;t<ze?t=ze:t+=Ue-t%Ue,this._size=t,this._update()}updateCamera(e){this._cameraDistance=e.position.distanceTo(new THREE.Vector3(0,0,0)),this._update()}_update(){this._fog?this._updateFog():(this._updateWallVertices(),this._updateWalls(new THREE.MeshBasicMaterial({color:16777215})))}_updateFog(){let e=this._longestSide/2;this._scene.fog=new THREE.Fog(Ne,this._cameraDistance+e+3,this._cameraDistance+e+3+1),this._scene.background=new THREE.Color(Ne)}_updateFloor(){if(this._floorMaterial){let e=new THREE.PlaneGeometry(Oe,Oe,Oe/this._width,Oe/this._height);this._floorMesh.material=this._floorMaterial,this._floorMesh.geometry=e}else{let e=null,t=this._width/1e3,s=this._height/1e3;this._repeatable?(this._floorTexture.wrapS=THREE.RepeatWrapping,this._floorTexture.wrapT=THREE.RepeatWrapping,this._floorTexture.repeat.set(Oe/t,Oe/s),e=new THREE.PlaneGeometry(Oe,Oe,Oe/t,Oe/s)):e=new THREE.PlaneGeometry(Oe,Oe,1,1);let i=new THREE.MeshStandardMaterial({map:this._floorTexture,side:THREE.DoubleSide});this._floorMesh.material=i,this._floorMesh.geometry=e}}_updateWallVertices(){this._wallVertices=[];let e=this._size/2;this._wallVertices.push(new THREE.Vector3(-e,0,-e)),this._wallVertices.push(new THREE.Vector3(-e,0,e)),this._wallVertices.push(new THREE.Vector3(e,0,e)),this._wallVertices.push(new THREE.Vector3(e,0,-e))}_updateWalls(e){if(this._wallTexture)for(let t=0;t<this._wallMeshes.length;t++){let s=this._wallMeshes[t],i=this._wallVertices[t],o=this._wallVertices[(t+1)%this._wallVertices.length],n=new THREE.Geometry;n.vertices=[i,o,new THREE.Vector3(i.x,je,i.z),new THREE.Vector3(o.x,je,o.z)],n.faceVertexUvs=[[[new THREE.Vector2(i.x+i.z,je),new THREE.Vector2(o.x+o.z,o.y),new THREE.Vector2(i.x+i.z,i.y)],[new THREE.Vector2(o.x+o.z,o.y),new THREE.Vector2(i.x+i.z,je),new THREE.Vector2(o.x+o.z,je)]]],n.uvsNeedUpdate=!0,n.faces=[new THREE.Face3(2,1,0),new THREE.Face3(1,2,3)],n.computeFaceNormals(),n.computeVertexNormals(),s.material=e,s.geometry=n}}addToScene(){this._scene&&(this._scene.add(this._floorMesh),this._wallMeshes.forEach(e=>{this._scene.add(e)}))}removeFromScene(){this._scene.remove(this._floorMesh),this._wallMeshes.forEach(e=>{this._scene.remove(e)})}_getWallPromise(){return new Promise((e,t)=>{this._wallTexture?e():this._textureLoader.load(s()+"static/textures/white_wall_texture.jpg",t=>{this._wallTexture=t,this._wallTexture.wrapS=THREE.RepeatWrapping,this._wallTexture.wrapT=THREE.RepeatWrapping,e()},null,t)})}setFloorMaterial(e,t,s,i){return this._width=t,this._height=s,this._repeatable=i,this._floorPromise=new Promise((t,s)=>{this._textureLoader.load(e,e=>{this._floorTexture=e,t()},null,s)}),new Promise((e,t)=>{Promise.all([this._floorPromise,this._getWallPromise()]).then(()=>{this._updateFloor(),this._update(),e()},t)})}changeFloorMaterial(e,t){this._floorPromise=new Promise((s,i)=>{let o=q(e,this._environmentLoader.getEnvironmentMap());this._rapiAccess.getTexturesOf(e).then(n=>{if(n.length>0){let e=[];n.forEach(s=>{let i=0===s.mmWidth?1:s.mmWidth/1e3,n=0===s.mmHeight?1:s.mmHeight/1e3,a=Oe/i,r=Oe/n;e.push(X(this._dataSyncer.requestAsset(s.image,!0),s,o,t,a,r))}),Promise.all(e).then(()=>{this._floorMaterial=o,setTimeout(()=>s(),0)},i)}else i("textures for material "+e.id+" are empty")}),(!e.textures||e.textures&&0===e.textures.length)&&(this._floorMaterial=o,setTimeout(()=>s(),0))});let s=[this._floorPromise];return this._fog||s.push(this._getWallPromise()),new Promise((e,t)=>{Promise.all(s).then(()=>{this._updateFloor(),this._update(),e()},t)})}showGUI(){this._floorMaterial?this._addGUI():this._floorPromise&&this._floorPromise.then(()=>this._addGUI())}_addGUI(){let e=Z().addFolder("Floor");e.add(this._floorMaterial,"roughness").min(0).max(1).step(.01),e.add(this._floorMaterial,"reflectivity").min(0).max(1).step(.01),e.add(this._floorMaterial,"clearCoat").min(0).max(1).step(.01),e.add(this._floorMaterial,"clearCoatRoughness").min(0).max(1).step(.01),e.add(this._floorMaterial,"opacity").min(0).max(1).step(.01),e.add(this._floorMaterial,"metalness").min(0).max(1).step(.01),e.add(this._floorMaterial,"bumpScale").min(0).max(1).step(.01)}}e("q",Ge),h([l],Ge.prototype,"_rapiAccess",void 0),h([l],Ge.prototype,"_dataSyncer",void 0),h([l],Ge.prototype,"_environmentLoader",void 0);const We=30,Ye="rml-scene-background";class qe extends Be{constructor(e,t,s,i,o){super(e,t),this._color=s,this._oldBackground=e.background,this._shadowMaterial=new THREE.ShadowMaterial({color:1118481,opacity:.4}),this._generateShadowPlane(We),i&&(this._canvas=i,this.addBackground(i,o)),this.addToScene()}addBackground(e,t){const s=document.createElement("style");let i='background-image: url("'+t+'"); background-size: cover;';s.innerText="."+Ye+" {"+i+"}",e.appendChild(s)}_generateShadowPlane(e){let t=!1;this._shadowMesh&&(t=!0,this._scene.remove(this._shadowMesh)),this._shadowMesh=new THREE.Mesh(new THREE.PlaneGeometry(e,e),this._shadowMaterial),this._shadowMesh.name="floor",this._shadowMesh.position.y=-.001,this._shadowMesh.rotation.x=-Math.PI/2,this._shadowMesh.layers.set(2),this._shadowMesh.receiveShadow=!0,t&&this._scene.add(this._shadowMesh)}needsBounds(){return!0}needsCamera(){return!0}addToScene(){this._scene&&(this._canvas?this._scene.background=null:this._scene.background=this._color,this._scene.add(this._shadowMesh),this._canvas&&this._canvas.classList&&this._canvas.classList.add(Ye))}removeFromScene(){this._scene.background=this._oldBackground,this._scene.remove(this._shadowMesh),this._canvas&&this._canvas.classList.remove(Ye)}updateBounds(e){super.updateBounds(e),this._generateShadowPlane(Math.max(e.x,e.z)+We)}showGUI(){console.warn("gui not implemented for gltf environment")}}e("o",qe);class Xe{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(){this._resolve()}reject(e){this._reject(e)}wait(){return new Promise((e,t)=>Promise.all([this._promise]).then(()=>e(),t))}}const Ze="rml-scene-background";class Ke extends Be{constructor(e,t,s,i,o){if(super(e,t),this._pixotronGuard=new Xe,this._color=s,this._oldBackground=e.background,i&&o){this._canvas=i,this._style=document.createElement("style");let e='background-image: url("'+o+'"); background-size: cover;';this._style.innerText="."+Ze+" {"+e+"}",this._canvas.appendChild(this._style)}}needsBounds(){return!0}needsCamera(){return!1}needsRotation(){return!1}setPixotron(e){this._pixotron=e,this._pixotron.getShadowPlanePass().enable=!0,this._wasAAEnabled=this._pixotron.enableAA,this._pixotronGuard.resolve()}onShadowPlaneReady(){return c(this,void 0,void 0,function*(){yield this._pixotronGuard.wait(),this._pixotron.needsUpdate=!0,this._shadowPlane=this._pixotron.getShadowPlanePass().getShadowPlane(),this._shadowPlane.name="Shadow plane",this._shadowPlane.receiveShadow=!1,this.addToScene()})}updateBounds(e){super.updateBounds(e),this._pixotronGuard.wait().then(()=>{this._pixotron.updateShadowPlane(this._scene)})}addToScene(){this._scene.add(this._shadowPlane),this._color&&(this._scene.background=this._color),this._canvas&&this._canvas.classList&&(this._scene.background=null,this._canvas.classList.add(Ze)),this._pixotron&&(this._pixotron.enableAA=!1)}removeFromScene(){this._scene.remove(this._shadowPlane),this._oldBackground&&(this._scene.background=this._oldBackground),this._canvas&&this._canvas.classList.remove(Ze),this._pixotron&&(this._pixotron.enableAA=this._wasAAEnabled)}showGUI(){}}e("s",Ke);class Qe{parse(e,t,s,i){let o=JSON.parse(i);return o.environment?this.load(e,t,s,o):null}load(e,t,i,o){let n,a=o.environment;if(!a)return console.warn("No environment set in scene settings"),Promise.resolve(null);switch(a.type){case"color":n=new Promise(t=>t(new qe(e,i,new THREE.Color(a.details.color))));break;case"image":n=new Promise(s=>s(new qe(e,i,null,t,a.details.imageUrl)));break;case"gltf":n=new Promise(t=>{let o=new Fe(e,i);o.loadBackground(s()+"static/geometry/PhotoStudioRoom.glb"),t(o)});break;case"floor":n=new Promise(t=>{this._rapiAccess.getMaterial(a.details.material).then(s=>{let o=void 0===a.details.fog||a.details.fog,n=new Ge(e,i,o);n.changeFloorMaterial(s).then(()=>{t(n)})})});break;case"baked_shadow":n=new Promise(s=>{a.details&&a.details.color?s(new Ke(e,i,new THREE.Color(a.details.color))):a.details&&a.details.imageUrl?s(new Ke(e,i,null,t,a.details.imageUrl)):s(new Ke(e,i))});break;default:console.warn("Could not load environment, return old environment"),n=new Promise(e=>e(i))}return n}}e("u",Qe),h([l],Qe.prototype,"_rapiAccess",void 0)}}});
//# sourceMappingURL=chunk-ec9039a8.nomodule.js.map
