var factory;factory=function(){var e="undefined"!=typeof window?window.document:{createElement:function(){return new(require("canvas-prebuilt"))}},t={},r=t,n=function(n){var i=1,o={red:255,green:0,blue:255,alpha:255},a={r:0,g:0,b:0,a:0};function u(e,t){return(Math.abs(e.r-t.r)+Math.abs(e.g-t.g)+Math.abs(e.b-t.b))/3}function f(e,t,r,n,i){return e>(i.left||0)&&e<(i.right||r)&&t>(i.top||0)&&t<(i.bottom||n)}var s,g,h,l={flat:function(e,t){e[t]=o.red,e[t+1]=o.green,e[t+2]=o.blue,e[t+3]=o.alpha},movement:function(e,t,r,n){e[t]=(n.r*(o.red/255)+o.red)/2,e[t+1]=(n.g*(o.green/255)+o.green)/2,e[t+2]=(n.b*(o.blue/255)+o.blue)/2,e[t+3]=n.a},flatDifferenceIntensity:function(e,t,r,n){e[t]=o.red,e[t+1]=o.green,e[t+2]=o.blue,e[t+3]=u(r,n)},movementDifferenceIntensity:function(e,t,r,n){var i=u(r,n)/255*.8;e[t]=(1-i)*(n.r*(o.red/255))+i*o.red,e[t+1]=(1-i)*(n.g*(o.green/255))+i*o.green,e[t+2]=(1-i)*(n.b*(o.blue/255))+i*o.blue,e[t+3]=n.a},diffOnly:function(e,t,r,n){e[t]=n.r,e[t+1]=n.g,e[t+2]=n.b,e[t+3]=n.a}},c=l.flat,d=1200,m=!0,b={},p=[],v=[],w={red:16,green:16,blue:16,alpha:16,minBrightness:16,maxBrightness:240},y=!1,x=!1,B=!1;function M(){var e,t=v.length;for(e=0;e<t;e++)"function"==typeof v[e]&&v[e](b)}function I(e,t,r){var n,i;for(n=0;n<e;n++)for(i=0;i<t;i++)r(n,i)}function D(t,r){var n,i;if("undefined"!=typeof Image)i=new Image;else{var o=require("canvas-prebuilt").Image;(i=new o).setAttribute=function(){}}m&&i.setAttribute("crossorigin","anonymous"),i.onerror=function(e){i.onerror=null,p.push({error:e?e+"":"Image load error."}),r()},i.onload=function(){i.onload=null;var t,n=e.createElement("canvas"),o=i.width,a=i.height;B&&1==p.length&&(o=p[0].width,a=p[0].height),n.width=o,n.height=a,n.getContext("2d").drawImage(i,0,0,o,a),t=n.getContext("2d").getImageData(0,0,o,a),p.push(t),r(t,o,a)},"string"==typeof t?(i.src=t,i.complete&&i.naturalWidth>0&&i.onload()):void 0!==t.data&&"number"==typeof t.width&&"number"==typeof t.height?(p.push(t),r(t,t.width,t.height)):"undefined"!=typeof Buffer&&t instanceof Buffer?i.src=t:((n=new FileReader).onload=function(e){i.src=e.target.result},n.readAsDataURL(t))}function S(e,t,r){var n=Math.abs(e-t);return void 0!==e&&void 0!==t&&(e===t||n<w[r])}function C(e,t){var r=S(e.a,t.a,"alpha");return S(e.brightness,t.brightness,"minBrightness")&&r}function T(e,t,r){return.3*e+.59*t+.11*r}function k(e,t){var r=e.r===t.r,n=e.g===t.g,i=e.b===t.b;return r&&n&&i}function A(e,t,r,n,i,o){var u,f,s,g,h=0,l=0,c=0;for(N(e),u=-1;u<=1;u++)for(f=-1;f<=1;f++)if(0===u&&0===f);else{if(!O(a,t,4*((n+f)*o+(i+u))))continue;if(P(a),N(a),s=e,g=a,Math.abs(s.brightness-g.brightness)>w.maxBrightness&&h++,k(e,a)&&c++,Math.abs(a.h-e.h)>.3&&l++,l>1||h>1)return!0}return c<2}function E(e,t,r){"diffOnly"!==s&&(e[t]=r.brightness,e[t+1]=r.brightness,e[t+2]=r.brightness,e[t+3]=r.a*i)}function O(e,t,r){return t.length>r&&(e.r=t[r],e.g=t[r+1],e.b=t[r+2],e.a=t[r+3],!0)}function P(e){e.brightness=T(e.r,e.g,e.b)}function N(e){e.h=function(e,t,r){e/=255,t/=255,r/=255;var n,i,o=Math.max(e,t,r),a=Math.min(e,t,r);if(o==a)n=0;else{switch(i=o-a,o){case e:n=(t-r)/i+(t<r?6:0);break;case t:n=(r-e)/i+2;break;case r:n=(e-t)/i+4}n/=6}return n}(e.r,e.g,e.b)}function R(t,r,n){var i,o;return t.height<n||t.width<r?((i=e.createElement("canvas")).width=r,i.height=n,(o=i.getContext("2d")).putImageData(t,0,0),o.getImageData(0,0,r,n)):t}function z(e){var t;if(e.errorColor)for(t in e.errorColor)o[t]=void 0===e.errorColor[t]?o[t]:e.errorColor[t];e.errorType&&l[e.errorType]&&(c=l[e.errorType],s=e.errorType),e.errorPixel&&"function"==typeof e.errorPixel&&(c=e.errorPixel),i=isNaN(Number(e.transparency))?i:e.transparency,void 0!==e.largeImageThreshold&&(d=e.largeImageThreshold),void 0!==e.useCrossOrigin&&(m=e.useCrossOrigin),void 0!==e.boundingBox&&(g=e.boundingBox),void 0!==e.ignoredBox&&(h=e.ignoredBox)}var L={onComplete:function(e){v.push(e),D(n,function(e,t,r){!function(e,t,r){var n=0,i=0,o=0,a=0,u=0,f=0,s=0,g=0;I(t,r,function(r,h){var l=4*(h*t+r),c=e[l],d=e[l+1],m=e[l+2],b=e[l+3],p=T(c,d,m);c==d&&c==m&&b&&(0==c?g++:255==c&&s++),n++,i+=c/255*100,o+=d/255*100,a+=m/255*100,u+=(255-b)/255*100,f+=p/255*100}),b.red=Math.floor(i/n),b.green=Math.floor(o/n),b.blue=Math.floor(a/n),b.alpha=Math.floor(u/n),b.brightness=Math.floor(f/n),b.white=Math.floor(s/n*100),b.black=Math.floor(g/n*100),M()}(e.data,t,r)})},compareTo:function(o){return function o(a){var u,l="function"==typeof a;l||(u=a);var m={scaleToSameSize:function(){return B=!0,l&&a(),m},useOriginalSize:function(){return B=!1,l&&a(),m},ignoreNothing:function(){return w.red=0,w.green=0,w.blue=0,w.alpha=0,w.minBrightness=0,w.maxBrightness=255,y=!1,x=!1,l&&a(),m},ignoreLess:function(){return w.red=16,w.green=16,w.blue=16,w.alpha=16,w.minBrightness=16,w.maxBrightness=240,y=!1,x=!1,l&&a(),m},ignoreAntialiasing:function(){return w.red=32,w.green=32,w.blue=32,w.alpha=32,w.minBrightness=64,w.maxBrightness=96,y=!0,x=!1,l&&a(),m},ignoreColors:function(){return w.alpha=16,w.minBrightness=16,w.maxBrightness=240,y=!1,x=!0,l&&a(),m},ignoreAlpha:function(){return w.red=16,w.green=16,w.blue=16,w.alpha=255,w.minBrightness=16,w.maxBrightness=240,y=!1,x=!1,l&&a(),m},repaint:function(){return l&&a(),m},outputSettings:function(e){return z(e),m},onComplete:function(a){v.push(a);var l=function(){!function(n,o){function a(){var t,r;if(2===p.length){if(p[0].error||p[1].error)return(b={}).error=p[0].error?p[0].error:p[1].error,void M();t=p[0].width>p[1].width?p[0].width:p[1].width,r=p[0].height>p[1].height?p[0].height:p[1].height,p[0].width===p[1].width&&p[0].height===p[1].height?b.isSameDimensions=!0:b.isSameDimensions=!1,b.dimensionDifference={width:p[0].width-p[1].width,height:p[0].height-p[1].height},function(t,r,n,o){var a=e.createElement("canvas"),u=t.data,l=r.data;a.width=n,a.height=o;var m,p=a.getContext("2d"),v=p.createImageData(n,o),w=v.data,B=0,M={top:o,left:n,bottom:0,right:0},D=function(e,t){M.left=Math.min(e,M.left),M.right=Math.max(e,M.right),M.top=Math.min(t,M.top),M.bottom=Math.max(t,M.bottom)},T=Date.now();d&&y&&(n>d||o>d)&&(m=6);var k={r:0,g:0,b:0,a:0},N={r:0,g:0,b:0,a:0};I(n,o,function(e,t){if(!m||t%m!=0&&e%m!=0){var r,a,d,b,p,v,M=4*(t*n+e),I=function(e,t,r,n){var i=!0;return void 0===g||f(e,t,r,n,g)||(i=!1),void 0!==h&&f(e,t,r,n,h)&&(i=!1),i}(e,t,n,o);if(O(k,u,M)&&O(N,l,M))return x?(P(k),P(N),void(C(k,N)||!I?E(w,M,N):(c(w,M,k,N),B++,D(e,t)))):(d=S((r=k).r,(a=N).r,"red"),b=S(r.g,a.g,"green"),p=S(r.b,a.b,"blue"),v=S(r.a,a.a,"alpha"),void(d&&b&&p&&v||!I?function(e,t,r){"diffOnly"!==s&&(e[t]=r.r,e[t+1]=r.g,e[t+2]=r.b,e[t+3]=r.a*i)}(w,M,k):y&&(P(k),P(N),A(k,u,0,t,e,n)||A(N,l,0,t,e,n))&&(C(k,N)||!I)?E(w,M,N):(c(w,M,k,N),B++,D(e,t))))}}),b.rawMisMatchPercentage=B/(o*n)*100,b.misMatchPercentage=b.rawMisMatchPercentage.toFixed(2),b.diffBounds=M,b.analysisTime=Date.now()-T,b.getImageDataUrl=function(e){var t=0;return e&&(t=function(e,t,r){t.font="12px sans-serif";var n=t.measureText(e).width+4;return n>r.width&&(r.width=n),r.height+=22,t.fillStyle="#666",t.fillRect(0,0,r.width,18),t.fillStyle="#fff",t.fillRect(0,18,r.width,4),t.fillStyle="#fff",t.textBaseline="top",t.font="12px sans-serif",t.fillText(e,2,1),22}(e,p,a)),p.putImageData(v,0,t),a.toDataURL("image/png")},a.toBuffer&&(b.getBuffer=function(e){if(e){var n=a.width+2;a.width=3*n,p.putImageData(t,0,0),p.putImageData(r,n,0),p.putImageData(v,2*n,0)}else p.putImageData(v,0,0);return a.toBuffer()})}(R(p[0],t,r),R(p[1],t,r),t,r),M()}}r!==t&&z(r),p=[],D(n,a),D(o,a)}(n,u)};return l(),o(l)}};return m}(o)},outputSettings:function(e){return z(e),L}};return L};function i(e,t){switch(t){case"nothing":e.ignoreNothing();break;case"less":e.ignoreLess();break;case"antialiasing":e.ignoreAntialiasing();break;case"colors":e.ignoreColors();break;case"alpha":e.ignoreAlpha();break;default:throw new Error("Invalid ignore: "+t)}}return n.compare=function(e,t,r,o){"function"==typeof r&&(o=r,r=void 0);var a,u=n(e),f=r||{};f.output&&u.outputSettings(f.output),a=u.compareTo(t),f.scaleToSameSize&&a.scaleToSameSize(),"string"==typeof f.ignore?i(a,f.ignore):f.ignore&&f.ignore.forEach&&f.ignore.forEach(function(e){i(a,e)}),a.onComplete(function(e){e.error?o(e.error):o(null,e)})},n.outputSettings=function(e){return console.warn("warning resemble.outputSettings mutates global state, and will be removed in 3.0.0"),r=e,this},n},"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():this.resemble=factory();