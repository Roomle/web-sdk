THREE.HDRLoader=THREE.RGBELoader=function(r){this.manager=void 0!==r?r:THREE.DefaultLoadingManager,this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype),THREE.RGBELoader.prototype._parser=function(r){var e=function(r,e){switch(r){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},t=function(r,e,t){e=e||1024;for(var a=r.pos,n=-1,o=0,i="",s=String.fromCharCode.apply(null,new Uint16Array(r.subarray(a,a+128)));0>(n=s.indexOf("\n"))&&o<e&&a<r.byteLength;)i+=s,o+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(a,a+128)));return-1<n&&(!1!==t&&(r.pos+=o+n+1),i+s.slice(0,n))},a=new Uint8Array(r);a.byteLength,a.pos=0;var n,o,i,s,E,d,p=function(r){var a,n,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,E=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,d={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(r.pos>=r.byteLength||!(a=t(r)))return e(1,"no header found");if(!(n=a.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(d.valid|=1,d.programtype=n[1],d.string+=a+"\n";!1!==(a=t(r));)if(d.string+=a+"\n","#"!==a.charAt(0)){if((n=a.match(o))&&(d.gamma=parseFloat(n[1],10)),(n=a.match(i))&&(d.exposure=parseFloat(n[1],10)),(n=a.match(s))&&(d.valid|=2,d.format=n[1]),(n=a.match(E))&&(d.valid|=4,d.height=parseInt(n[1],10),d.width=parseInt(n[2],10)),2&d.valid&&4&d.valid)break}else d.comments+=a+"\n";return 2&d.valid?4&d.valid?d:e(3,"missing image size specifier"):e(3,"missing format specifier")}(a);if(-1!==p){var f=p.width,l=p.height,y=function(r,t,a){var n,o,i,s,E,d,p,f,l,y,h,u,g,c=t,R=a;if(c<8||c>32767||2!==r[0]||2!==r[1]||128&r[2])return new Uint8Array(r);if(c!==(r[2]<<8|r[3]))return e(3,"wrong scanline width");if(!(n=new Uint8Array(4*t*a))||!n.length)return e(4,"unable to allocate buffer space");for(o=0,i=0,f=4*c,g=new Uint8Array(4),d=new Uint8Array(f);R>0&&i<r.byteLength;){if(i+4>r.byteLength)return e(1);if(g[0]=r[i++],g[1]=r[i++],g[2]=r[i++],g[3]=r[i++],2!=g[0]||2!=g[1]||(g[2]<<8|g[3])!=c)return e(3,"bad rgbe scanline format");for(p=0;p<f&&i<r.byteLength;){if((u=(s=r[i++])>128)&&(s-=128),0===s||p+s>f)return e(3,"bad scanline data");if(u)for(E=r[i++],l=0;l<s;l++)d[p++]=E;else d.set(r.subarray(i,i+s),p),p+=s,i+=s}for(y=c,l=0;l<y;l++)h=0,n[o]=d[l+h],h+=c,n[o+1]=d[l+h],h+=c,n[o+2]=d[l+h],h+=c,n[o+3]=d[l+h],o+=4;R--}return n}(a.subarray(a.pos),f,l);if(-1!==y){if(this.type===THREE.UnsignedByteType)var h=y,u=THREE.RGBEFormat,g=THREE.UnsignedByteType;else if(this.type===THREE.FloatType){for(var c=y.length/4*3,R=new Float32Array(c),m=0;m<c;m++)i=R,s=3*m,E=(n=y)[3+(o=4*m)],d=Math.pow(2,E-128)/255,i[s+0]=n[o+0]*d,i[s+1]=n[o+1]*d,i[s+2]=n[o+2]*d;h=R,u=THREE.RGBFormat,g=THREE.FloatType}else console.error("THREE.RGBELoader: unsupported type: ",this.type);return{width:f,height:l,data:h,header:p.string,gamma:p.gamma,exposure:p.exposure,format:u,type:g}}}return null},THREE.RGBELoader.prototype.setType=function(r){return this.type=r,this};