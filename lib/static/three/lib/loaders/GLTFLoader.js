THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,t,r,a){var s=this,n=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),i=new THREE.FileLoader(s.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){try{s.parse(e,n,t,a)}catch(e){if(void 0===a)throw e;a(e)}},r,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,o,l){var d,h={};if("string"==typeof e)d=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===i){try{h[r.KHR_BINARY_GLTF]=new p(e)}catch(e){return void(l&&l(e))}d=h[r.KHR_BINARY_GLTF].content}else d=THREE.LoaderUtils.decodeText(new Uint8Array(e));var E=JSON.parse(d);void 0===E.asset||2>E.asset.version[0]?l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")):(E.extensionsUsed&&(0>E.extensionsUsed.indexOf(r.KHR_LIGHTS)||(h[r.KHR_LIGHTS]=new s(E)),0>E.extensionsUsed.indexOf(r.KHR_MATERIALS_UNLIT)||(h[r.KHR_MATERIALS_UNLIT]=new n(E)),0>E.extensionsUsed.indexOf(r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)||(h[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new c),0>E.extensionsUsed.indexOf(r.KHR_DRACO_MESH_COMPRESSION)||(h[r.KHR_DRACO_MESH_COMPRESSION]=new u(this.dracoLoader)),0>E.extensionsUsed.indexOf(r.MSFT_TEXTURE_DDS)||(h[r.MSFT_TEXTURE_DDS]=new a)),new A(E,h,{path:t||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(e,t,r,a,s){o({scene:e,scenes:t,cameras:r,animations:a,asset:s})},l))}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function a(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function s(e){this.name=r.KHR_LIGHTS,this.lights={};var t=(e.extensions&&e.extensions[r.KHR_LIGHTS]||{}).lights||{};for(var a in t){var s,n=t[a],i=(new THREE.Color).fromArray(n.color);switch(n.type){case"directional":(s=new THREE.DirectionalLight(i)).target.position.set(0,0,1),s.add(s.target);break;case"point":s=new THREE.PointLight(i);break;case"spot":s=new THREE.SpotLight(i),n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,s.angle=n.spot.outerConeAngle,s.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,s.target.position.set(0,0,1),s.add(s.target);break;case"ambient":s=new THREE.AmbientLight(i)}s&&(s.decay=2,void 0!==n.intensity&&(s.intensity=n.intensity),s.name=n.name||"light_"+a,this.lights[a]=s)}}function n(e){this.name=r.KHR_MATERIALS_UNLIT}n.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},n.prototype.extendParams=function(e,t,r){var a=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){var n=s.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}void 0!==s.baseColorTexture&&a.push(r.assignTexture(e,"map",s.baseColorTexture.index))}return Promise.all(a)};var i="glTF",o=12,l={JSON:1313821514,BIN:5130562};function p(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,o);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==i)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(2>this.header.version)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var a=new DataView(e,o),s=0;s<a.byteLength;){var n=a.getUint32(s,!0);s+=4;var p=a.getUint32(s,!0);if(s+=4,p===l.JSON){var u=new Uint8Array(e,o+s,n);this.content=THREE.LoaderUtils.decodeText(u)}else if(p===l.BIN){var c=o+s;this.body=e.slice(c,c+n)}s+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=e}function c(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var a=t.extensions[this.name],s=THREE.ShaderLib.standard,n=THREE.UniformsUtils.clone(s.uniforms),i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),p=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c=s.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",p).replace("#include <lights_physical_fragment>",u);delete n.roughness,delete n.metalness,delete n.roughnessMap,delete n.metalnessMap,n.specular={value:(new THREE.Color).setHex(1118481)},n.glossiness={value:.5},n.specularMap={value:null},n.glossinessMap={value:null},e.vertexShader=s.vertexShader,e.fragmentShader=c,e.uniforms=n,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(a.diffuseFactor)){var h=a.diffuseFactor;e.color.fromArray(h),e.opacity=h[3]}if(void 0!==a.diffuseTexture&&d.push(r.assignTexture(e,"map",a.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var E=a.specularGlossinessTexture.index;d.push(r.assignTexture(e,"glossinessMap",E)),d.push(r.assignTexture(e,"specularMap",E))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,a=0,s=r.length;s>a;a++)t[r[a]]=e[r[a]];return t},refreshUniforms:function(e,t,r,a,s,n){if(!0===s.isGLTFSpecularGlossinessMaterial){var i,o,l,p=s.uniforms,u=s.defines;if(p.opacity.value=s.opacity,p.diffuse.value.copy(s.color),p.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),p.map.value=s.map,p.specularMap.value=s.specularMap,p.alphaMap.value=s.alphaMap,p.lightMap.value=s.lightMap,p.lightMapIntensity.value=s.lightMapIntensity,p.aoMap.value=s.aoMap,p.aoMapIntensity.value=s.aoMapIntensity,s.map?i=s.map:s.specularMap?i=s.specularMap:s.displacementMap?i=s.displacementMap:s.normalMap?i=s.normalMap:s.bumpMap?i=s.bumpMap:s.glossinessMap?i=s.glossinessMap:s.alphaMap?i=s.alphaMap:s.emissiveMap&&(i=s.emissiveMap),void 0!==i)if(i.isWebGLRenderTarget&&(i=i.texture),void 0!==i.matrix){if(!0===i.matrixAutoUpdate){o=i.offset,l=i.repeat;var c=i.rotation,d=i.center;i.matrix.setUvTransform(o.x,o.y,l.x,l.y,c,d.x,d.y)}p.uvTransform.value.copy(i.matrix)}else o=i.offset,l=i.repeat,p.offsetRepeat.value.set(o.x,o.y,l.x,l.y);p.envMap.value=s.envMap,p.envMapIntensity.value=s.envMapIntensity,p.flipEnvMap.value=s.envMap&&s.envMap.isCubeTexture?-1:1,p.refractionRatio.value=s.refractionRatio,p.specular.value.copy(s.specular),p.glossiness.value=s.glossiness,p.glossinessMap.value=s.glossinessMap,p.emissiveMap.value=s.emissiveMap,p.bumpMap.value=s.bumpMap,p.normalMap.value=s.normalMap,p.displacementMap.value=s.displacementMap,p.displacementScale.value=s.displacementScale,p.displacementBias.value=s.displacementBias,null!==p.glossinessMap.value&&void 0===u.USE_GLOSSINESSMAP&&(u.USE_GLOSSINESSMAP="",u.USE_ROUGHNESSMAP=""),null===p.glossinessMap.value&&void 0!==u.USE_GLOSSINESSMAP&&(delete u.USE_GLOSSINESSMAP,delete u.USE_ROUGHNESSMAP)}}}}function d(e,t,r,a){THREE.Interpolant.call(this,e,t,r,a)}u.prototype.decodePrimitive=function(e,t){var r=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,n={};for(var i in s)i in R&&(n[R[i]]=s[i]);return t.getDependency("bufferView",a).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,t,n)})})},d.prototype=Object.create(THREE.Interpolant.prototype),d.prototype.constructor=d,d.prototype.interpolate_=function(e,t,r,a){for(var s=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=2*i,l=3*i,p=a-t,u=(r-t)/p,c=u*u,d=c*u,h=e*l,E=h-l,m=2*d-3*c+1,f=d-2*c+u,T=-2*d+3*c,v=d-c,R=0;R!==i;R++){var g=n[E+R+i],S=n[E+R+o]*p,M=n[h+R+i],H=n[h+R]*p;s[R]=m*g+f*S+T*M+v*H}return s};var h=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),E={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},m={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},f={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},T={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},v=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),R={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},g={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};function M(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function H(e,t,r,a){for(var s=e.geometry,n=r.targets,i=!1,o=!1,l=0,p=n.length;p>l&&(void 0!==(d=n[l]).POSITION&&(i=!0),void 0!==d.NORMAL&&(o=!0),!i||!o);l++);if(i||o){var u=[],c=[];for(l=0,p=n.length;p>l;l++){var d=n[l],h="morphTarget"+l;if(i){if(void 0!==d.POSITION){var E=x(a[d.POSITION]);E.name=h;for(var m=s.attributes.position,f=0,T=E.count;T>f;f++)E.setXYZ(f,E.getX(f)+m.getX(f),E.getY(f)+m.getY(f),E.getZ(f)+m.getZ(f))}else E=s.attributes.position;u.push(E)}if(o){if(void 0!==d.NORMAL){var v;(v=x(a[d.NORMAL])).name=h;var R=s.attributes.normal;for(f=0,T=v.count;T>f;f++)v.setXYZ(f,v.getX(f)+R.getX(f),v.getY(f)+R.getY(f),v.getZ(f)+R.getZ(f))}else v=s.attributes.normal;c.push(v)}}if(i&&(s.morphAttributes.position=u),o&&(s.morphAttributes.normal=c),e.updateMorphTargets(),void 0!==t.weights)for(l=0,p=t.weights.length;p>l;l++)e.morphTargetInfluences[l]=t.weights[l];if(t.extras&&Array.isArray(t.extras.targetNames)){var g=t.extras.targetNames;if(e.morphTargetInfluences.length===g.length)for(e.morphTargetDictionary={},l=0,p=g.length;p>l;l++)e.morphTargetDictionary[g[l]]=l;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}}function y(e,t){if(e.indices!==t.indices)return!1;var r=e.attributes||{},a=t.attributes||{},s=Object.keys(r),n=Object.keys(a);if(s.length!==n.length)return!1;for(var i=0,o=s.length;o>i;i++){var l=s[i];if(r[l]!==a[l])return!1}return!0}function L(e,t){for(var r=0,a=e.length;a>r;r++){var s=e[r];if(y(s.primitive,t))return s.promise}return null}function x(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,a=e.array.slice(0,t*r),s=0;t>s;++s)a[s]=e.getX(s),2>r||(a[s+1]=e.getY(s)),3>r||(a[s+2]=e.getZ(s)),4>r||(a[s+3]=e.getW(s));return new THREE.BufferAttribute(a,r,e.normalized)}return e.clone()}function A(e,r,a){this.json=e||{},this.extensions=r||{},this.options=a||{},this.cache=new t,this.primitiveCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function _(e,t,r){var a=t.attributes;for(var s in a){var n=R[s],i=r[a[s]];n&&(n in e.attributes||e.addAttribute(n,i))}void 0===t.indices||e.index||e.setIndex(r[t.indices])}return A.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var a=t.scenes||[],s=a[r.scene||0],n=t.animations||[],i=r.asset,o=t.cameras||[];e(s,a,o,n,i)}).catch(t)},A.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a={},s={},n=0,i=t.length;i>n;n++)for(var o=t[n].joints,l=0,p=o.length;p>l;l++)e[o[l]].isBone=!0;for(var u=0,c=e.length;c>u;u++){var d=e[u];void 0!==d.mesh&&(void 0===a[d.mesh]&&(a[d.mesh]=s[d.mesh]=0),a[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=s},A.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this.loadMesh(t);break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this.loadBufferView(t);break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this.loadMaterial(t);break;case"texture":a=this.loadTexture(t);break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},A.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(a.map(function(t,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t},A.prototype.getMultiDependencies=function(e){for(var t={},r=[],a=0,s=e.length;s>a;a++){var n=e[a],i=this.getDependencies(n);i=i.then(function(e,r){t[e]=r}.bind(this,n+("mesh"===n?"es":"s"))),r.push(i)}return Promise.all(r).then(function(){return t})},A.prototype.loadBuffer=function(e){var t=this.json.buffers[e],a=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var s=this.options;return new Promise(function(e,r){a.load(M(t.uri,s.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},A.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+r)})},A.prototype.loadAccessor=function(e){var t=this,r=this.json,a=this.json.accessors[e];if(void 0===a.bufferView&&void 0===a.sparse)return null;var s=[];return void 0!==a.bufferView?s.push(this.getDependency("bufferView",a.bufferView)):s.push(null),void 0!==a.sparse&&(s.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(s).then(function(e){var s,n,i=e[0],o=v[a.type],l=h[a.componentType],p=l.BYTES_PER_ELEMENT,u=p*o,c=a.byteOffset||0,d=r.bufferViews[a.bufferView].byteStride,E=!0===a.normalized;if(d&&d!==u){var m="InterleavedBuffer:"+a.bufferView+":"+a.componentType,f=t.cache.get(m);f||(s=new l(i),f=new THREE.InterleavedBuffer(s,d/p),t.cache.add(m,f)),n=new THREE.InterleavedBufferAttribute(f,o,c/p,E)}else s=null===i?new l(a.count*o):new l(i,c,a.count*o),n=new THREE.BufferAttribute(s,o,E);if(void 0!==a.sparse){var T=v.SCALAR,R=h[a.sparse.indices.componentType],g=a.sparse.indices.byteOffset||0,S=a.sparse.values.byteOffset||0,M=new R(e[1],g,a.sparse.count*T),H=new l(e[2],S,a.sparse.count*o);null!==i&&n.setArray(n.array.slice());for(var y=0,L=M.length;L>y;y++){var x=M[y];if(n.setX(x,H[y*o]),2>o||n.setY(x,H[y*o+1]),3>o||n.setZ(x,H[y*o+2]),4>o||n.setW(x,H[y*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})},A.prototype.loadTexture=function(e){var t,a=this,s=this.json,n=this.options,i=this.textureLoader,o=window.URL||window.webkitURL,l=s.textures[e],p=l.extensions||{},u=(t=p[r.MSFT_TEXTURE_DDS]?s.images[p[r.MSFT_TEXTURE_DDS].source]:s.images[l.source]).uri,c=!1;return void 0!==t.bufferView&&(u=a.getDependency("bufferView",t.bufferView).then(function(e){c=!0;var r=new Blob([e],{type:t.mimeType});return u=o.createObjectURL(r)})),Promise.resolve(u).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=p[r.MSFT_TEXTURE_DDS]?a.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:i),new Promise(function(r,a){t.load(M(e,n.path),r,void 0,a)})}).then(function(e){!0===c&&o.revokeObjectURL(u),e.flipY=!1,void 0!==l.name&&(e.name=l.name),p[r.MSFT_TEXTURE_DDS]||(e.format=void 0!==l.format?f[l.format]:THREE.RGBAFormat),void 0!==l.internalFormat&&e.format!==f[l.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==l.type?T[l.type]:THREE.UnsignedByteType;var t=(s.samplers||{})[l.sampler]||{};return e.magFilter=E[t.magFilter]||THREE.LinearFilter,e.minFilter=E[t.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=m[t.wrapS]||THREE.RepeatWrapping,e.wrapT=m[t.wrapT]||THREE.RepeatWrapping,e})},A.prototype.assignTexture=function(e,t,r){return this.getDependency("texture",r).then(function(r){e[t]=r})},A.prototype.loadMaterial=function(e){this.json;var t,a=this.extensions,s=this.json.materials[e],n={},i=s.extensions||{},o=[];if(i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=l.getMaterialType(s),o.push(l.extendParams(n,s,this))}else if(i[r.KHR_MATERIALS_UNLIT]){var p=a[r.KHR_MATERIALS_UNLIT];t=p.getMaterialType(s),o.push(p.extendParams(n,s,this))}else{t=THREE.MeshStandardMaterial;var u=s.pbrMetallicRoughness||{};if(n.color=new THREE.Color(1,1,1),n.opacity=1,Array.isArray(u.baseColorFactor)){var c=u.baseColorFactor;n.color.fromArray(c),n.opacity=c[3]}if(void 0!==u.baseColorTexture&&o.push(this.assignTexture(n,"map",u.baseColorTexture.index)),n.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,n.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture){var d=u.metallicRoughnessTexture.index;o.push(this.assignTexture(n,"metalnessMap",d)),o.push(this.assignTexture(n,"roughnessMap",d))}}!0===s.doubleSided&&(n.side=THREE.DoubleSide);var h=s.alphaMode||"OPAQUE";return"BLEND"===h?n.transparent=!0:(n.transparent=!1,"MASK"===h&&(n.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==THREE.MeshBasicMaterial&&(o.push(this.assignTexture(n,"normalMap",s.normalTexture.index)),n.normalScale=new THREE.Vector2(1,1),void 0!==s.normalTexture.scale&&n.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(o.push(this.assignTexture(n,"aoMap",s.occlusionTexture.index)),void 0!==s.occlusionTexture.strength&&(n.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(n.emissive=(new THREE.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==THREE.MeshBasicMaterial&&o.push(this.assignTexture(n,"emissiveMap",s.emissiveTexture.index)),Promise.all(o).then(function(){var e;return e=t===THREE.ShaderMaterial?a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(n):new t(n),void 0!==s.name&&(e.name=s.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),s.extras&&(e.userData=s.extras),e})},A.prototype.loadGeometries=function(e){var t=this,a=this.extensions,s=this.primitiveCache;return this.getDependencies("accessor").then(function(n){for(var i=[],o=0,l=e.length;l>o;o++){var p=e[o],u=L(s,p);if(u)i.push(u);else if(p.extensions&&p.extensions[r.KHR_DRACO_MESH_COMPRESSION]){var c=a[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(p,t).then(function(e){return _(e,p,n),e});s.push({primitive:p,promise:c}),i.push(c)}else{var d=new THREE.BufferGeometry;_(d,p,n),c=Promise.resolve(d),s.push({primitive:p,promise:c}),i.push(c)}}return Promise.all(i)})},A.prototype.loadMesh=function(e){var t=this,a=(this.json,this.extensions),s=this.json.meshes[e];return this.getMultiDependencies(["accessor","material"]).then(function(n){var i=new THREE.Group,o=s.primitives;return t.loadGeometries(o).then(function(l){for(var p=0,u=o.length;u>p;p++){var c=o[p],d=l[p],h=void 0===c.material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):n.materials[c.material];h.aoMap&&void 0===d.attributes.uv2&&void 0!==d.attributes.uv&&d.addAttribute("uv2",new THREE.BufferAttribute(d.attributes.uv.array,2));var E,m=void 0!==d.attributes.color,f=void 0===d.attributes.normal,T=!0===s.isSkinnedMesh,v=void 0!==c.targets;if((m||f||T||v)&&(h=h.isGLTFSpecularGlossinessMaterial?a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(h):h.clone()),m&&(h.vertexColors=THREE.VertexColors,h.needsUpdate=!0),f&&(h.flatShading=!0),4===c.mode||5===c.mode||6===c.mode||void 0===c.mode)T?(E=new THREE.SkinnedMesh(d,h),h.skinning=!0):E=new THREE.Mesh(d,h),5===c.mode?E.drawMode=THREE.TriangleStripDrawMode:6===c.mode&&(E.drawMode=THREE.TriangleFanDrawMode);else if(1===c.mode||3===c.mode||2===c.mode){var R="LineBasicMaterial:"+h.uuid,g=t.cache.get(R);g||(g=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(g,h),g.color.copy(h.color),g.lights=!1,t.cache.add(R,g)),h=g,E=1===c.mode?new THREE.LineSegments(d,h):3===c.mode?new THREE.Line(d,h):new THREE.LineLoop(d,h)}else{if(0!==c.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);R="PointsMaterial:"+h.uuid;var S=t.cache.get(R);S||(S=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(S,h),S.color.copy(h.color),S.map=h.map,S.lights=!1,t.cache.add(R,S)),h=S,E=new THREE.Points(d,h)}if(E.name=s.name||"mesh_"+e,v&&(H(E,s,c,n.accessors),h.morphTargets=!0,void 0!==E.geometry.morphAttributes.normal&&(h.morphNormals=!0)),void 0!==s.extras&&(E.userData=s.extras),void 0!==c.extras&&(E.geometry.userData=c.extras),!0===h.isGLTFSpecularGlossinessMaterial&&(E.onBeforeRender=a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),1>=o.length)return E;E.name+="_"+p,i.add(E)}return i})})},A.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],a=r[r.type];if(a)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar)),void 0!==r.name&&(t.name=r.name),r.extras&&(t.userData=r.extras),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},A.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},A.prototype.loadAnimation=function(e){this.json;var t=this.json.animations[e];return this.getMultiDependencies(["accessor","node"]).then(function(r){for(var a=[],s=0,n=t.channels.length;n>s;s++){var i=t.channels[s],o=t.samplers[i.sampler];if(o){var l=i.target,p=void 0!==l.node?l.node:l.id,u=void 0!==t.parameters?t.parameters[o.input]:o.input,c=void 0!==t.parameters?t.parameters[o.output]:o.output,h=r.accessors[u],E=r.accessors[c],m=r.nodes[p];if(m){var f;switch(m.updateMatrix(),m.matrixAutoUpdate=!0,g[l.path]){case g.weights:f=THREE.NumberKeyframeTrack;break;case g.rotation:f=THREE.QuaternionKeyframeTrack;break;case g.position:case g.scale:default:f=THREE.VectorKeyframeTrack}var T=m.name?m.name:m.uuid,v=void 0!==o.interpolation?S[o.interpolation]:THREE.InterpolateLinear,R=[];g[l.path]===g.weights?m.traverse(function(e){!0===e.isMesh&&!0===e.material.morphTargets&&R.push(e.name?e.name:e.uuid)}):R.push(T);for(var M=0,H=R.length;H>M;M++){var y=new f(R[M]+"."+g[l.path],THREE.AnimationUtils.arraySlice(h.array,0),THREE.AnimationUtils.arraySlice(E.array,0),v);"CUBICSPLINE"===o.interpolation&&(y.createInterpolant=function(e){return new d(this.times,this.values,this.getValueSize()/3,e)},y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),a.push(y)}}}}return p=void 0!==t.name?t.name:"animation_"+e,new THREE.AnimationClip(p,void 0,a)})},A.prototype.loadNode=function(e){this.json;var t=this.extensions,a=this.json.meshReferences,s=this.json.meshUses,n=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera","light"]).then(function(e){var i;if(!0===n.isBone)i=new THREE.Bone;else if(void 0!==n.mesh){var o=e.meshes[n.mesh];if(i=o.clone(),!0===o.isGroup)for(var l=0,p=o.children.length;p>l;l++){var u=o.children[l];u.material&&!0===u.material.isGLTFSpecularGlossinessMaterial&&(i.children[l].onBeforeRender=u.onBeforeRender)}else o.material&&!0===o.material.isGLTFSpecularGlossinessMaterial&&(i.onBeforeRender=o.onBeforeRender);a[n.mesh]>1&&(i.name+="_instance_"+s[n.mesh]++)}else i=void 0!==n.camera?e.cameras[n.camera]:n.extensions&&n.extensions[r.KHR_LIGHTS]&&void 0!==n.extensions[r.KHR_LIGHTS].light?t[r.KHR_LIGHTS].lights[n.extensions[r.KHR_LIGHTS].light]:new THREE.Object3D;if(void 0!==n.name&&(i.name=THREE.PropertyBinding.sanitizeNodeName(n.name)),n.extras&&(i.userData=n.extras),void 0!==n.matrix){var c=new THREE.Matrix4;c.fromArray(n.matrix),i.applyMatrix(c)}else void 0!==n.translation&&i.position.fromArray(n.translation),void 0!==n.rotation&&i.quaternion.fromArray(n.rotation),void 0!==n.scale&&i.scale.fromArray(n.scale);return i})},A.prototype.loadScene=function(){function e(t,r,a,s,n){var i=s[t],o=a.nodes[t];if(void 0!==o.skin)for(var l=!0===i.isGroup?i.children:[i],p=0,u=l.length;u>p;p++){for(var c=l[p],d=n[o.skin],h=[],E=[],m=0,f=d.joints.length;f>m;m++){var T=d.joints[m],v=s[T];if(v){h.push(v);var R=new THREE.Matrix4;void 0!==d.inverseBindMatrices&&R.fromArray(d.inverseBindMatrices.array,16*m),E.push(R)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',T)}c.bind(new THREE.Skeleton(h,E),c.matrixWorld)}if(r.add(i),o.children){var g=o.children;for(p=0,u=g.length;u>p;p++)e(g[p],i,a,s,n)}}return function(t){var a=this.json,s=this.extensions,n=this.json.scenes[t];return this.getMultiDependencies(["node","skin"]).then(function(t){var i=new THREE.Scene;void 0!==n.name&&(i.name=n.name),n.extras&&(i.userData=n.extras);for(var o=n.nodes||[],l=0,p=o.length;p>l;l++)e(o[l],i,a,t.nodes,t.skins);if(n.extensions&&n.extensions[r.KHR_LIGHTS]&&void 0!==n.extensions[r.KHR_LIGHTS].light){var u=s[r.KHR_LIGHTS].lights;i.add(u[n.extensions[r.KHR_LIGHTS].light])}return i})}}(),e}();