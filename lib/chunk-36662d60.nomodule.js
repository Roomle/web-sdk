System.register(["./chunk-9c4c520b.nomodule.js","./chunk-4be69068.nomodule.js"],function(t,e){var s,i,n,a,o,r;return{setters:[function(t){s=t.a,i=t.e,n=t.f,a=t.g},function(t){o=t.a,r=t.b}],execute:function(){const e=()=>{const t=window.navigator,e=["language","browserLanguage","userLanguage","systemLanguage"];if(Array.isArray(t.languages)&&t.languages.length>0)return t.languages[0].substr(0,2);for(let s=0,i=e.length;s<i;s++){const i=t[e[s]];if(i)return i.substr(0,2)}return"en"};class h{static init(t={}){const{locale:s,kernelInstance:i,kernelContainer:n,planObjectId:a}=t;h.kernelInstance=i,h.kernelContainer=n,h.planObjectId=a,h.actualLocale=s||e()}}t("p",h),h.actualLocale="en",h.useHDGeometry=!1,h.kernelInstance=null,h.kernelContainer=null,h.planObjectId=null;class _{constructor(){this._context=new Map,this._lookups=new Map,this._singletons=new Map}getContext(t){if(this._context.has(t)){const e=this._context.get(t);return this._context.set(t,e+1),t+e}return this._context.set(t,1),t+0}addDependencyInjectionAssignments(t){t.forEach(t=>{this._lookups.set(t.className,t)})}lookup(t,e){if(!this._lookups.has(t))return null;let s=this._lookups.get(t);if(1===s.type&&void 0===e){const e="Dependency "+t+" has definition context but no context was defined!";return console.trace(e),console.error(e),null}let i=e&&1===s.type?e:"global";if(i+="_"+t,2===s.type)return new s.classDefinition;if(this._singletons.has(i))return this._singletons.get(i);let n=new s.classDefinition(e);return this._singletons.set(i,n),n}cleanUp(t){if(t){let e=[];this._singletons.forEach((s,i)=>{i.startsWith(t)&&e.push(i)}),e.forEach(t=>{this._singletons.delete(t)})}else this._singletons.clear(),this._singletons=new Map}}class c{constructor(t,e,s){this.className=t,this.classDefinition=e,this.type=void 0===s?0:s}}t("w",c);const l=t("E",{JPG:".jpg",JPEG:".jpeg",PNG:".png",GIF:".gif"});class d{_base64toBlob(t,e){e=e||"";const s=atob(t),i=s.length,n=Math.ceil(i/1024),a=new Array(n);for(let t=0;t<n;++t){let e=1024*t,n=Math.min(e+1024,i);const o=new Array(n-e);for(let t=e,i=0;t<n;++i,++t)o[i]=s[t].charCodeAt(0);a[t]=new Uint8Array(o)}return new Blob(a,{type:e})}_createFormData(t,e,s,i){const n=new FormData;-1!==t.indexOf(",")&&(t=t.substr(t.indexOf(",")+1));const a=-1===Object.keys(l).map(t=>l[t]).indexOf(s)?"application":"image",o=this._base64toBlob(t,a+"/"+s.substr(1));return n.append(i,o,e+s),n}create(t,e,s,i){return this._createFormData(t,e,s,i)}}const u=.8,p={SOFA:"sofa",SHELF:"shelf",SHELF_FRONT:"shelf_front"};class g{static createDynamicLightSettingSource(t,e){let i={};if(t)i.url=t;else if(e)switch(e){case p.SHELF:i.url=s()+"static/predefined_lightsettings/shelf.json";break;case p.SHELF_FRONT:i.url=s()+"static/predefined_lightsettings/shelf_front.json";break;case p.SOFA:i.url=s()+"static/predefined_lightsettings/sofa.json";break;default:i=null}else i=null;return i}parse(t){let e=JSON.parse(t);return e.lights?this.load(e):[]}load(t){let e=[];return t.lights.forEach(t=>{let s;switch(t.type){case"ambient":s=this._parseAmbientLight(t);break;case"rectarea":s=this._parseRectAreaLight(t);break;case"spot":s=this._parseSpotLight(t)}s&&e.push(s)}),e}_parseAmbientLight(t){let e=new THREE.AmbientLight;return this._parseCommon(e,t),e}_parseRectAreaLight(t){let e=new THREE.RectAreaLight;this._parseCommon(e,t);let{intensity:s,castShadow:i,target:n,width:a,height:o}=t;return e.width=a||u,e.height=o||u,e.castShadow=i||!1,e.matrixAutoUpdate=!0,e.intensity=(s||240)/((a||u)*(o||u)),e.lookAt(n?new THREE.Vector3(n.x,n.y,n.z):new THREE.Vector3(0,0,0)),e}_parseSpotLight(t){let e=new THREE.SpotLight;this._parseCommon(e,t);let{angle:s,penumbra:i,target:n,castShadow:a}=t;return e.angle=(s||100)*Math.PI/180,e.penumbra=i||.5,e.lookAt(n?new THREE.Vector3(n.x,n.y,n.z):new THREE.Vector3(0,0,0)),e.shadow.camera.near=.1,e.shadow.camera.far=10,e.shadow.mapSize=new THREE.Vector2(1024,1024),e.castShadow=a||!1,e}_parseCommon(t,e){let{name:s,intensity:i,color:n,position:a,movesWithCamera:o}=e;t.name=s||"",t.intensity=i||1,t.color=new THREE.Color(n||"#ffffff"),t.position.copy(a?new THREE.Vector3(a.x,a.y,a.z):new THREE.Vector3(0,0,0)),t.visible=!0,t.layers.set(1),t.userData.movesWithCamera=o}}t("o",g);const m=40;class w{constructor(){this._queue=[],this._pendingRequests=0}_nextSlot(){if(this._pendingRequests-=1,!this._queue.length)return;const{request:t,resolve:e,reject:s}=this._queue.shift();this._fetch(t).then(e,s)}_fetch(t){return this._pendingRequests+=1,new Promise((e,s)=>{self.fetch(t).then(function(){this._nextSlot(),e(...arguments)}.bind(this),t=>{this._nextSlot(),s(t)})})}fetch(t){return this._pendingRequests>=m?new Promise((e,s)=>this._queue.push({request:t,resolve:e,reject:s})):this._fetch(t)}}class E{info(...t){console}log(...t){console}warn(...t){console.warn.apply(console,t)}error(...t){console.warn.apply(console,t)}}t("u",E);class y extends E{throw(t){this.error("[Kernel Exception]: "+t),this._eventHandler.dispatch(27)}}o([r],y.prototype,"_eventHandler",void 0);const T=new Map,f=new Map,v=new Map,M=new Map;class R{constructor(){this._bootCallbacks=[],this._isStarted=!1,this._isStarting=!1}start(t){return this._eventHandler.dispatch(79),this._startWorker().then(()=>this._handleCatalog(t)).then(()=>{const{typeChangeTag:t,floorMaterialsTag:e}=window.__RML__ENV__.initData;Promise.all([this._syncFloorTag(e),this._syncTypeChangeTag(t)]).then(()=>{M.set(t,!0),this._eventHandler.dispatch(80)})})}syncCatalog(t){return this._startWorker().then(()=>this._handleCatalog(t))}syncFloorTag(t){return this._startWorker().then(()=>this._syncFloorTag(t))}syncTypeChangeTag(t){return this._startWorker().then(()=>this._syncTypeChangeTag(t))}_syncFloorTag(t){const e=[];return t&&!v.get(t)?(e.push(this._handleTags([t])),this._rapiAccess.getTag(t).then(t=>{e.push(this._handleMaterialsAndTextures(t))}),this._singlePromiseFactory.create(1,t,s=>{Promise.all(e).then(()=>{v.set(t,!0),s()},t=>this._softReject(s,'_syncFloorTag error: "'+t+'"'))})):Promise.resolve()}_syncTypeChangeTag(t){const e=[];return t&&!M.get(t)?(e.push(this._handleTags([t])),this._rapiAccess.getTag(t).then(t=>{this._rapiAccess.getItems(t.items).then(t=>{t.forEach(t=>{this.getIsCatalogSynced(t.catalog)&&e.push(this._handleCatalog(t.catalog))})})}),this._singlePromiseFactory.create(2,t,s=>{Promise.all(e).then(()=>{v.set(t,!0),s()},t=>this._softReject(s,'_syncTypeChangeTag error: "'+t+'"'))})):Promise.resolve()}getIsCatalogSynced(t){return!!f.get(t)}_startWorker(){return new Promise((t,e)=>{if(this._isStarted)return t();this._bootCallbacks.push({resolve:t,reject:e}),this._isStarting||(this._worker=new Worker(s()+"static/workers/asset-loader.js"),this._mainThreadToWorker=new i(this,this._worker),this._isStarting=!0,this._mainThreadToWorker.sendToWorker(1))})}onCommand(t,e,s){switch(t){case 4:this._isStarted=!0,this._bootCallbacks.forEach(({resolve:t})=>t());break;case 3:this._mainThreadToWorker.resolvePromises(e,s)}}_handleCatalog(t){return this._singlePromiseFactory.create(0,t,e=>this.getIsCatalogSynced(t)?e():this._rapiAccess.getCatalog(t).then(t=>Promise.all([this._handleContentWithAssets(this._rapiAccess.getComponentsOf(t),["perspectiveImage"]),this._handleItemsAndAdditionalContents(t),this._handleMaterialsAndTextures(t),this._handleExternalMeshes(t),this._handleTags(t.tags)])).then(()=>{f.set(t,!0),e()},t=>this._softReject(e,'Catalog sync error: "'+t+'"')))}_handleTags(t){return this._handleContentWithAssets(this._rapiAccess.getTags(t),["pngIcon","svgIcon"])}_handleExternalMeshes(t){return new Promise(e=>{this._rapiAccess.getMeshesOfCatalog(t.id).then(t=>{const s=[];t.forEach(t=>{s.push(this._handleContentWithAssets(Promise.all([this._rapiAccess.getMesh(t.id)]),["url"]))}),Promise.all(s).then(e,t=>this._softReject(e,'Sync crt files error: "'+t+'"'))},t=>this._softReject(e,'getMeshesOfCatalog error: "'+t+'"'))})}_handleItemsAndAdditionalContents(t){return new Promise((e,s)=>{this._rapiAccess.getItemsOf(t).then(t=>{const s=[];s.push(this._handleContentWithAssets(Promise.resolve(t),["perspectiveImage"])),this._rapiAccess.getAdditionalContentsOfItems(t).then(t=>{const e=t.filter(t=>-1!==[5,6,4].indexOf(t.type));s.push(this._handleContentWithAssets(Promise.resolve(e),["content"]))},t=>this._softReject(e,'getAdditionalContentsOfItems error: "'+t+'"')),Promise.all(s).then(e,t=>this._softReject(e,'AdditionalContent image sync error:"'+t+'"'))})})}_handleMaterialsAndTextures(t){return new Promise((e,s)=>{this._rapiAccess.getMaterialsOf(t).then(t=>{const s=[];s.push(this._handleContentWithAssets(Promise.resolve(t),["thumbnail"])),t.forEach(t=>{s.push(this._handleContentWithAssets(this._rapiAccess.getTexturesOf(t),["image"]))}),Promise.all(s).then(e,t=>this._softReject(e,'getTexturesOf error: "'+t+'"'))},t=>this._softReject(e,'getMaterialsOf error: "'+t+'"'))})}_handleContentWithAssets(t,e){return new Promise(s=>t.then(t=>this._fetchAssets(t,e).then(s,t=>this._softReject(s,'_handleContentWithAssets error: "'+t+'"')),t=>this._softReject(s,'_handleContentWithAssets promise error: "'+t+'"')))}_fetchAssets(t,e){const s=[];t||(t=[]);for(let i=0,n=t.length;i<n;i++){const n=t[i];e.forEach(t=>{const e=n[t];e&&s.push(this._preCacheAsset(e))})}return Promise.all(s)}_preCacheAsset(t){return new Promise(e=>{if(T.get(t))return e();this._assetUrlToBase64(t).then(s=>{T.set(t,s),e()},t=>this._softReject(e,'_preCacheAsset error: "'+t+'"'))})}_assetUrlToBase64(t){return new Promise(e=>{this._mainThreadToWorker.sendToWorker(5,t,e,t=>this._softReject(e,'_assetUrlToBase64 error: "'+t+'"'))})}_softReject(t,e){this._errorHandler.softReject(t,e,2)}requestAsset(t,e=!1){return navigator.onLine?t:T.get(t)||(e?t:null)}}t("v",R),o([r],R.prototype,"_rapiAccess",void 0),o([r],R.prototype,"_eventHandler",void 0),o([r],R.prototype,"_singlePromiseFactory",void 0),o([r],R.prototype,"_errorHandler",void 0);class x{loadGLB(t,e,s,i,n){return this._gltfLoader||(this._gltfLoader=new THREE.GLTFLoader),new Promise((a,o)=>{this._gltfLoader.load(t,t=>{a(this._handleGLTFScene("GLB",t,e,s,i,n))},t=>{},t=>{o(t)})})}loadGLTF(t,e,s,i,n){return this._gltfLoader||(this._gltfLoader=new THREE.GLTFLoader),new Promise((a,o)=>{this._gltfLoader.parse(t,null,t=>{a(this._handleGLTFScene("GLTF",t,e,s,i,n))},t=>{},t=>{o(t)})})}_handleGLTFScene(t,e,s,i,n,a){return e&&e.scene&&e.scene.children&&0!==e.scene.children.length?(s&&e.scene.position.copy(s),i&&(e.scene.rotation.y=i),n&&e.scene.scale.copy(n),e.scene.type="GLB",e.scene.traverse(t=>{if(t instanceof THREE.Mesh){if(t.material instanceof THREE.MeshStandardMaterial){let e=t.material;if(e.envMap=this._environmentLoader.getEnvironmentMap(),a&&a>0){let t=new THREE.Color(a);e.color=t.copyGammaToLinear(t)}e.needsUpdate=!0}t.castShadow=!0}}),e.scene):null}}o([r],x.prototype,"_environmentLoader",void 0);const P=[new c("error-handler",class{constructor(){this._listeners={}}_subscribe(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)}subscribe(t,e){this._subscribe(t,e)}dispatch(t,e){if(!this._listeners[t])return;const s=this._listeners[t];let i=s.length;for(let t=0;t<i;t++){const i=s[t];i.apply(i,e)}}unsubscribe(t,e){if(!this._listeners[t])return;const s=this._listeners[t];let i=s.length;for(let t=0;t<i;t++)if(s[t]===e)return s.splice(t,1),i--,void t--}softReject(t,e,s){return this.dispatch(s,[e]),t()}}),new c("form-data-util",d),new c("environment-loader",class{getEnvironmentMap(){if(!this._environmentMap){let t=new THREE.CubeTextureLoader;t.setPath(s()),this._environmentMap=t.load(["static/textures/blurred/px.png","static/textures/blurred/nx.png","static/textures/blurred/py.png","static/textures/blurred/ny.png","static/textures/blurred/pz.png","static/textures/blurred/nz.png"]),this._environmentMap.wrapS=THREE.RepeatWrapping,this._environmentMap.wrapT=THREE.RepeatWrapping,this._environmentMap.generateMipmaps=!0}return this._environmentMap}}),new c("static-item-loader",x,0),new c("form-data-util",d),new c("single-promise-factory",class{constructor(t){this._promises=new Map,this._creator_=t}create(t,e,s){return new Promise((i,n)=>{let a=this._promises.get(t),o=!0;if(!a){const e=new Map;this._promises.set(t,e),a=this._promises.get(t),o=!1}a.get(e)||(a.set(e,[]),o=!1);const r=a.get(e);r.push({resolve:i,reject:n}),a.set(e,r);const h=()=>{a.delete(e),0===a.size&&this._promises.delete(t)};o||new Promise(s).then(t=>{a.get(e).forEach(({resolve:e})=>e(t)),h()},t=>{a.get(e).forEach(({reject:e})=>e(t)),h()})})}},0),new c("dynamic-light-setting-loader",g),new c("network-layer",w),new c("local-storage",class{get _localStorage(){let t=null;try{t=window.localStorage}catch(t){console.error(t)}return t}getItem(t){if(!this._localStorage)return null;const e=this._localStorage.getItem(t);try{return JSON.parse(e)}catch(t){return e}}setItem(t,e){this._localStorage&&this._localStorage.setItem(t,JSON.stringify(e))}}),new c("network-layer",w),new c("kernel-io",y),new c("data-syncer",R),new c("memory-manager",class{constructor(){this._configurationStringSet=new Set,this._singleLoadCounter=0}loadingConfigurationString(){this._singleLoadCounter+=1}loadingConfiguration(t){this._configurationStringSet.add(t),this._singleLoadCounter+=1}shouldHardReset(){return this._configurationStringSet.size>=15||this._singleLoadCounter>=30}executedHardReset(){this._configurationStringSet.clear(),this._singleLoadCounter=0}}),new c("life-cycle-manager",class{constructor(){this._listeners=[]}addEventListener(t){this._listeners.push(t)}removeEventListener(t){const e=this._listeners;let s=e.length;if(s)for(let i=0;i<s;i++)e[i]===t&&(e.splice(i,1),i--,s--)}pause(){this._listeners.forEach(t=>t.pause())}resume(){this._listeners.forEach(t=>t.resume())}destroy(){this._listeners.forEach(t=>t.destroy())}},1)];class C{static setup(t){C.addToContainer(t)}static lookup(t,e){return window.__RML__DI__?window.__RML__DI__.lookup(t,e):null}static getContext(t){return window.__RML__DI__?window.__RML__DI__.getContext(t):null}static cleanUp(t){return window.__RML__DI__?window.__RML__DI__.cleanUp(t):null}static addToContainer(t){window.__RML__DI__||(window.__RML__DI__=new _,window.__RML__DI__.addDependencyInjectionAssignments(P)),window.__RML__DI__.addDependencyInjectionAssignments(t)}}t("y",C),t("x",class{constructor(t){this._context=t}_setupCommonGlobals(){window.__RML__DEBUG__||(window.__RML__DEBUG__={}),window.__RML__ENV__||(window.__RML__ENV__={},window.__RML__ENV__.assetPath||(window.__RML__ENV__.assetPath=""));const t={retina:!1,overrideCountry:null,locale:h.actualLocale,unit:null,unitStringType:null,dls:null,ls:null,meshSelection:!0,colors:a,enableHSC:!1,mode:"3D",stats:!1,_measureTraffic:!1};window.__RML__ENV__.initData?window.__RML__ENV__.initData=Object.assign(t,window.__RML__ENV__.initData):window.__RML__ENV__.initData=t;const e=n();window.__RML__ENV__.initData=Object.assign(window.__RML__ENV__.initData,e)}_setupCommonDependencies(){}_cleanUpCommonGlobals(){window.__RML__DEBUG__&&(window.__RML__DEBUG__.Kernel&&window.__RML__DEBUG__.Kernel.clearAll&&window.__RML__DEBUG__.Kernel.clearAll(),delete window.__RML__DEBUG__),delete window.__RML__ENV__;for(const t in window.THREE)if(window.THREE.hasOwnProperty(t))try{delete window.THREE[t]}catch(t){console.error(t)}window.THREE=void 0}_cleanUpCommonDependencies(){}boot(t){this._setupCommonGlobals(),this.setupGlobals(t),this._setupCommonDependencies(),this.setupDependencies(),this.bootFinished()}lookup(t,e){return window.__RML__DI__.lookup(t,e)}teardown(){this.cleanUpDependencies(),this._cleanUpCommonDependencies(),this.cleanUpGlobals(),this._cleanUpCommonGlobals(),window.__RML__DI__&&delete window.__RML__DI__}pause(){this.lookup("life-cycle-manager",this._context).pause(),window.TWEEN&&TWEEN.removeAll()}resume(){this.lookup("life-cycle-manager",this._context).resume()}destroy(){this.pause(),this.lookup("life-cycle-manager",this._context).destroy(),C.cleanUp(this._context)}}),t("l",{HSC:"rml-hsc",HSP:"rml-hsp",GLB:"rml-glb"});const b="rml-threejs-canvas-container";class H{constructor(t){this._creator_=t,this._lifeCycleManager.addEventListener(this)}get element(){return this._container}setDomElement(t){if(!this._container){this._container=document.createElement("div"),this._container.classList.add(b),this._container.style.position="relative",this._container.style.width="100%",this._container.style.height="100%";const e=document.createElement("style");e.innerText="."+b+" canvas{position:absolute;top:0;left:0;right:0;bottom:0;}."+b+" .foreground{z-index:100; opacity:1;}."+b+" .background{z-index:-1; opacity:0;}",this._container.appendChild(e),t.appendChild(this._container)}this._element=t}getClientDimensions(){return new THREE.Vector2(this._element.clientWidth,this._element.clientHeight)}_removeDomElement(t){if(!t)return;const e=t.parentElement;e&&e.removeChild(t)}reset(){this._removeDomElement(this._element),this._element=null,this._removeDomElement(this._container),this._container=null}pause(){this.reset()}resume(){}destroy(){}}t("r",H),o([r],H.prototype,"_lifeCycleManager",void 0);class D{constructor(){this._listeners={}}_addEventListener(t,e,s){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push({callback:e,scope:s})}addEventListener(t,e,s){this._addEventListener(t,e,s)}dispatchEvent(t,e){if(!this._listeners[t])return;const s=this._listeners[t];let i=s.length;for(let t=0;t<i;t++){const i=s[t];i.callback.apply(i.scope,[e])}}removeEventListener(t,e){const s=this._listeners[t];if(s)for(let t=0,i=s.length;t<i;t++)if(s[t].callback===e)return void s.splice(t,1)}}t("b",D);const L=t("m",function(t){return t*(Math.PI/180)}),S=function(t,e,s,i,n,a){let o=Math.tan(i*(2*Math.PI/360)/2),r=s/2,h=e/2/o+r,_=t/2/(n/a)/o+r;return Math.max(h,_)},k=function(t){return Math.round(1e3*t)/1e3},A=(t("S",function(t,e){return Math.abs(t.y-e.y)+Math.abs(t.x-e.x)}),t("k",.6),t("A",.4),t("j","#DDDDDD"),t("C",1),t("B",.5),t("c",(t,e,s,i)=>{if(!t||!e||0===s||0===i)return new THREE.Vector3;let n=t.clone(),a=s/2,o=i/2;return n.project(e),n.x=n.x*a+a,n.y=-n.y*o+o,n.z=0,n}),t("a",(t,e)=>{e||(e=new THREE.Vector3(0,0,0));let s=new THREE.Vector3(t.size.x/1e3,t.size.z/1e3,t.size.y/1e3),i=new THREE.Vector3(t.origin.x/1e3,t.origin.z/1e3,t.origin.y/-1e3),n=new THREE.Vector3(0,0,-s.z).add(i).sub(e),a=new THREE.Vector3(s.x,s.y,0).add(i).add(e);return new THREE.Box3(n,a)}),t("f",(t,e,s)=>{t.castShadow=s,t.receiveShadow=e,t.children.forEach(t=>{A(t,e,s)})})),I=t("Q",(t,e)=>{let s=k(t.x),i=k(t.y),n=k(t.z),a=k(e.x),o=k(e.y),r=k(e.z);return s===a&&i===o&&n===r}),V=(t("R",(t,e)=>{let s=k(t.w),i=k(t.x),n=k(t.y),a=k(t.z),o=k(e.w),r=k(e.x),h=k(e.y),_=k(e.z);return s===o&&i===r&&n===h&&a===_}),t("P",(t,e)=>{let s=k(t.x),i=k(t.y),n=k(e.x),a=k(e.y);return s===n&&i===a})),N=(t("h",(t,e)=>{let s=new THREE.MeshPhysicalMaterial({metalness:t.shading.metallic,reflectivity:t.shading.specularity||.5,roughness:t.shading.roughness||.5,transparent:t.shading.alpha<1,opacity:t.shading.alpha,depthWrite:t.shading.alpha>=1});if(t.shading.basecolor){const e=new THREE.Color("rgb("+Math.round(100*t.shading.basecolor.r)+"%, "+Math.round(100*t.shading.basecolor.g)+"%, "+Math.round(100*t.shading.basecolor.b)+"%)");s.color=e.copyGammaToLinear(e)}return e&&(s.envMap=e),s}),t("g",(t,e,s,i,n,a)=>new Promise((o,r)=>{(new THREE.TextureLoader).load(t,t=>{t.anisotropy=i,t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(n,a),"XYZ"===e.mapping?s.normalMap=t:s.map=t,"RGBA"===e.mapping&&(s.transparent=!0,s.alphaTest=.5),o()},r)})),t("e",()=>(window.__RML_GUI__||(window.__RML_GUI__=new dat.GUI),window.__RML_GUI__)),t("M",(t,e,s=!0)=>{let i=t.getWorldDirection(new THREE.Vector3),n=Math.abs(i.y);n<.5&&!e.transparent&&N(e,!0,s),n>.5&&e.transparent&&N(e,!1,s)}),t("L",(t,e,s=!0)=>{if(!t.userData.tween)if(e)if(t.transparent=!0,s){let e={opacity:1};t.userData.tween=!0,new TWEEN.Tween(e).to({opacity:.2},400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{t.opacity=e.opacity}).onComplete(()=>{t.userData.tween=!1}).start()}else t.opacity=.2;else if(s){let e={opacity:.2};t.userData.tween=!0,new TWEEN.Tween(e).to({opacity:1},400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{t.opacity=e.opacity}).onComplete(()=>{t.transparent=!1,t.userData.tween=!1}).start()}else t.opacity=1,t.transparent=!1})),O=(t("J",t=>{let e=new THREE.Color;return e.setRGB((t>>16)/255,(t>>8&255)/255,(t>>0&255)/255),e.copyGammaToLinear(e),e}),t("H",t=>{t.traverse(t=>{if(t instanceof THREE.Mesh&&TWEEN){let e=t.material;if(0===e.opacity)return;let s={opacity:0,transparent:!0},i={opacity:e.opacity,transparent:e.transparent};e.transparent=s.transparent,e.opacity=s.opacity,new TWEEN.Tween(s).to(i,500).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{e.opacity=s.opacity}).onComplete(()=>{e.transparent=i.transparent}).start()}})}),t("N",(t,e)=>{let s=(new THREE.Box3).setFromObject(t),i=s.getSize(new THREE.Vector3),n=Math.min(i.x,i.y,i.z),a=!0;return n>5&&(console.warn("GLB seems to be too big ("+n+")",e),a=!1),s.min.y<-.01&&(console.warn("GLB seems to be under the floor ("+s.min.y+"): ",e),a=!1),a}),t("G",t=>{"Mesh"===t.type?z(t):O(t)}),t=>{t&&t.children&&0!==t.children.length&&t.children.forEach(t=>{z(t)})}),z=t("z",t=>{t&&(t.material&&U(t.material),t.geometry&&t.geometry.dispose())}),U=t("F",t=>{t&&(t.map&&t.map.dispose(),t.normalMap&&t.normalMap.dispose(),t.dispose())});let W;t("I",()=>(W||((W=new THREE.MeshBasicMaterial).visible=!1),W)),t("K",(t,e)=>{let s=.01,i=e.x/2,n=e.z/2,a=new THREE.Vector3(-i,s,n),o=(new THREE.Vector3(t.x-i,s,t.z-n),new THREE.Vector3(t.x+i,s,t.z-n),new THREE.Vector3(t.x+i,s,t.z+n),[a,new THREE.Vector3(a.x,a.y,a.z+.2),new THREE.Vector3(a.x-.2,a.y,a.z+.2),new THREE.Vector3(a.x-.2,a.y,a.z)]),r=[new THREE.Face3(3,2,0),new THREE.Face3(2,1,0)],h=new THREE.Geometry;return h.vertices.push(...o),h.faces.push(...r),h.computeFaceNormals(),h.computeVertexNormals(),h}),t("D",t=>0===t.x&&0===t.y&&0===t.z);const B=-1;class F extends D{constructor(t,e,s){super(),this._tweenEnd=null,this._pitch=L(10),this._yaw=L(-15),this._distance=B,this._locked=!1,this._inputListeners=[],this._creator_=t,this._inputManager=e,this._initInputListener(),this._addInputListeners(),this._cameraPosition=new THREE.Vector3,this._targetPosition=new THREE.Vector3,s?this._cameraPosition.copy(s):this._cameraPosition=new THREE.Vector3(0,.5,3);let i=this._domHelper.getClientDimensions();this._width=i.x,this._height=i.y}getCamera(){return this._getCamera()}_addInputListeners(){this._inputListeners.forEach(t=>{this._inputManager.addEventListener(t.key,t.fun,this)})}_removeInputListeners(){this._inputListeners.forEach(t=>{this._inputManager.removeEventListener(t.key,t.fun)}),this._inputListeners=[]}cleanUp(){this._removeInputListeners()}animateCamera(t){let e=this._cameraPosition;if(!e||I(e,this.getCamera().position))return!1;let s=this.getCamera().position.clone(),i=Math.min(10*t,1);return s.lerp(e,i),this.getCamera().position.copy(s),!0}_areEqual(t,e){return t.yaw.toFixed(5)===e.yaw.toFixed(5)&&t.pitch.toFixed(5)===e.pitch.toFixed(5)&&t.distance.toFixed(5)===e.distance.toFixed(5)&&t.targetX===e.targetX&&t.targetY===e.targetY&&t.targetZ===e.targetZ}_tweenCameraParameter(t,e,s){return new Promise(s=>{if(e.yaw-t.yaw<=-Math.PI?t.yaw-=2*Math.PI:e.yaw-t.yaw>=Math.PI&&(t.yaw+=2*Math.PI),window.TWEEN){if(null!==this._tweenEnd&&this._tweenEnd.blockOtherTweens)return;this._tweenEnd=e,new TWEEN.Tween(t).to(e,400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{this._yaw=t.yaw,this._pitch=t.pitch,this._distance=t.distance,this._update(new THREE.Vector3(t.targetX,t.targetY,t.targetZ))}).onComplete(()=>{this._tweenEnd=null,s()}).start()}})}_getCurrentCameraParameters(){let t=this._targetPosition.clone();return{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:t.x,targetY:t.y,targetZ:t.z}}_rotateHorizontal(t){this._yaw-=t,this._yaw<-Math.PI?this._yaw+=2*Math.PI:this._yaw>Math.PI&&(this._yaw-=2*Math.PI)}_rotateVertical(t){this._pitch+=t,this._pitch<-Math.PI?this._pitch+=2*Math.PI:this._pitch>Math.PI&&(this._pitch-=2*Math.PI)}saveState(t){if(t||!this._stateSaved){let t=this._yaw,e=this._pitch,s=this._distance,i=this._targetPosition.clone();if(this._stateSaved={yaw:t,pitch:e,distance:s,targetX:i.x,targetY:i.y,targetZ:i.z,blockOtherTweens:!0},this._getCamera().fov){let t=this._getCamera();this._stateSaved.fov=t.fov,this._stateSaved.near=t.near,this._stateSaved.far=t.far}return this._stateSaved}return null}resetToState(){if(this._stateSaved){this._stateSaved.blockOtherTweens=!1;let t=this._targetPosition.clone();this._tweenCameraParameter({yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:t.x,targetY:t.y,targetZ:t.z},this._stateSaved,!0)}this._stateSaved=null}setToState(t,e){this._tweenCameraParameter(t,e,!0)}hasSavedState(){return null!=this._stateSaved}lock(){this._locked=!0}unlock(){this._locked=!1}getTargetPosition(){return this._targetPosition}_saveYawAndPitch(){this._getCamera().userData.yaw=this._yaw,this._getCamera().userData.pitch=this._pitch}}t("s",F),o([r],F.prototype,"_domHelper",void 0);class j{constructor(t,e){this.minZoom=!1,this.maxZoom=!1,this.minZoom=t,this.maxZoom=e}}t("i",class extends F{constructor(t,e,s,i){super(t,e,s),this._bounds=new THREE.Vector3,this._scale=1,this._state=0,this._zoomSpeed=Math.pow(.95,4),this.minDistance=0,this.maxDistance=5,this.minPolarAngle=L(0),this.maxPolarAngle=L(85),this.minAzimuthAngle=Number.NEGATIVE_INFINITY,this.maxAzimuthAngle=Number.POSITIVE_INFINITY,this._currentZoomHash="",i?this._camera=i:this._initCamera(),this._targetPosition=new THREE.Vector3(0,0,0);let n=window.__RML__ENV__.initData.cameraRestriction;if(void 0!==n){let t=Math.abs(L(n));this.minAzimuthAngle=-t,this.maxAzimuthAngle=t,this.maxPolarAngle=Math.min(t,L(85))}}_getCamera(){return this._camera?this._camera:(this._initCamera(),this._camera)}_initCamera(){this._camera=new THREE.PerspectiveCamera,this._camera.fov=30,this._camera.aspect=this._width/this._height,this._camera.near=.1,this._camera.far=100,this._camera.updateProjectionMatrix(),this._camera.layers.set(3),this._camera.layers.enable(1),this._camera.layers.enable(2),this._camera.layers.enable(5),this._camera.layers.enable(4)}updateCamera(){let{x:t,y:e}=this._domHelper.getClientDimensions();this._camera.aspect=t/e,this._camera.updateProjectionMatrix()}animateCamera(t){if(!super.animateCamera(t))return!1;let e=this._targetPosition;return!!e&&(this.getCamera().lookAt(e),!0)}_initInputListener(){this._inputListeners.push({key:3,fun:t=>{this._state=1}}),this._inputListeners.push({key:6,fun:t=>{1!==this._state||this._locked||this._move(new THREE.Vector2(t.position.x,t.position.y))}}),this._inputListeners.push({key:4,fun:t=>{1===this._state&&this.dispatchEvent(2),this._state=0,this._orbitPosition=null}}),this._inputListeners.push({key:7,fun:t=>this.zoomIn()}),this._inputListeners.push({key:8,fun:t=>this.zoomOut()})}_move(t){this._orbitPosition||(this._orbitPosition=new THREE.Vector2(t.x,t.y),this.dispatchEvent(0));let e=t.clone().sub(this._orbitPosition),s=this._domHelper.element;this._rotateHorizontal(2*Math.PI*e.x/s.clientWidth*1),this._rotateVertical(2*Math.PI*e.y/s.clientHeight*1),V(this._orbitPosition,t)||this.dispatchEvent(1),this._orbitPosition.copy(t),this._update()}setBounds(t){let e=new THREE.Vector3(-t.x/2,0,-t.z/2),s=new THREE.Vector3(t.x/2,t.y,t.z/2);this._boundingBox=new THREE.Box3(e,s)}updateToBounds(t,e,s,i,n=!0,a){this._boundingBox=t;let o=t.getSize(new THREE.Vector3);const r=t.getCenter(new THREE.Vector3);if(this._targetPosition=a?a.clone():new THREE.Vector3(r.x,r.y,r.z),this._distance===B){let t=this._setDistanceAndRangesBasedOnBounds(o,e,s);this._distance=Math.max(4,t),this._update()}else n&&(this._setDistanceAndRangesBasedOnBounds(o,e,s),this._tweenCameraParameter(this._getCurrentCameraParameters(),{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:this._targetPosition.x,targetY:this._targetPosition.y,targetZ:this._targetPosition.z},i))}_setDistanceAndRangesBasedOnBounds(t,e,s){this._bounds.copy(t),this.minDistance=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);let i=1.1*S(t.x,t.y,t.z,this._camera.fov,e,s);return this._distance<i&&(this._distance=i),this.maxDistance=1.5*i,this.maxDistance=Math.min(this.maxDistance,i+6),this.maxDistance<4&&(this.maxDistance=4),this._camera.far=5*this.maxDistance,i}reset(t,e,s,i,n,a,o=!0){if(t){i?this._targetPosition.copy(i):this._targetPosition=new THREE.Vector3(0,t.y/2,0);let r=this._getCurrentCameraParameters();n||(n=-15),a||(a=10),this._pitch=L(a),this._yaw=L(n),this._setDistanceAndRangesBasedOnBounds(t,e,s);let h=this._targetPosition.clone();this._areEqual(r,{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:h.x,targetY:h.y,targetZ:h.z})?this._moveCameraForthAndBack():o?this._tweenCameraParameter(r,{yaw:this._yaw,pitch:this._pitch,distance:this.maxDistance,targetX:h.x,targetY:h.y,targetZ:h.z},!0):this._update(this._targetPosition)}else console.warn("you cant reset without bounds!")}updateAndReset(t,e,s,i,n,a,o,r=!0){let h=new THREE.Vector3(-t.x/2,0,-t.z/2),_=new THREE.Vector3(t.x/2,t.y,t.z/2);if(this._boundingBox=new THREE.Box3(h,_),o&&t.addScalar(o),i?this._targetPosition.copy(i):this._targetPosition=new THREE.Vector3(0,t.y/2,0),this._distance===B){let i=this._setDistanceAndRangesBasedOnBounds(t,e,s);this._distance=Math.max(4,i)}let c=this._getCurrentCameraParameters();n||(n=-15),a||(a=10),this._pitch=L(a),this._yaw=L(n),this._setDistanceAndRangesBasedOnBounds(t,e,s);let l=this._targetPosition.clone();r?this._tweenCameraParameter(c,{yaw:this._yaw,pitch:this._pitch,distance:this.maxDistance,targetX:l.x,targetY:l.y,targetZ:l.z},!0):this._update(this._targetPosition)}_moveCameraForthAndBack(){if(window.TWEEN){let t={value:.6*this._camera.far},e={value:this._distance};new TWEEN.Tween(t).to(e,300).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(()=>{this._distance=t.value,this._update()}).start()}}_restoreFromState(t){this._yaw=t.yaw,this._pitch=t.pitch,this._distance=t.distance,this._targetPosition.copy(new THREE.Vector3(t.targetX,t.targetY,t.targetZ)),this._simulateUpdate()}simulateTo2D(t,e){return new Promise(s=>{let i=Math.max(t.x,t.z),n=S(i,i,i,this._camera.fov,window.innerWidth,window.innerHeight),a=this._getCurrentCameraParameters();this._camera.near=1,this._camera.far=n+50,this._camera.updateProjectionMatrix();let o={yaw:0,pitch:L(90),distance:n,targetX:e.x,targetY:n,targetZ:e.z};if(window.TWEEN){if(null!==this._tweenEnd&&this._tweenEnd.blockOtherTweens)return;this._tweenEnd=o,new TWEEN.Tween(a).to(o,500).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(()=>{this._yaw=a.yaw,this._pitch=a.pitch,this._distance=a.distance,this._targetPosition.copy(new THREE.Vector3(a.targetX,0,a.targetZ)),this._simulateUpdate()}).onComplete(()=>{this._tweenEnd=null,s()}).start()}})}simulateTo3D(t,e){return new Promise(s=>{if(this._restoreFromState(t),window.TWEEN){if(null!==this._tweenEnd&&this._tweenEnd.blockOtherTweens)return;this._tweenEnd=e,new TWEEN.Tween(t).to(e,500).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{this._yaw=t.yaw,this._pitch=t.pitch,this._distance=t.distance,this._targetPosition.copy(new THREE.Vector3(t.targetX,t.targetY,t.targetZ)),this._simulateUpdate()}).onComplete(()=>{this._tweenEnd=null,s()}).start()}})}simulateToFirstPerson(t){return new Promise(e=>{if(window.TWEEN){let s=this.getCamera().position,i={x:s.x,y:s.y,z:s.z,yaw:this._yaw,pitch:this._pitch},n={x:t.x,y:t.y,z:t.z,yaw:0,pitch:0};new TWEEN.Tween(i).to(n,500).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{this._yaw=i.yaw,this._pitch=i.pitch,this._targetPosition.copy(new THREE.Vector3(i.x,i.y,i.z)),this._simulateUpdate()}).onComplete(()=>{this._tweenEnd=null,e()}).start()}})}_update(t){this._yaw=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this._yaw)),this._pitch=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._pitch)),this._saveYawAndPitch();let e=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX"),s=(new THREE.Quaternion).setFromEuler(e),i=new THREE.Vector3(0,0,-1);i.applyQuaternion(s),this._distance*=this._scale,this._distance=Math.min(this.maxDistance,this._distance),t&&this._targetPosition.copy(t);let n=this._targetPosition.clone().sub(i.multiplyScalar(this._distance)),a=this._getCameraSphere(n);null!=this._boundingBox&&this._boundingBox.intersectsSphere(a)&&this._scale>=1?this._distance+=.1:null==this._boundingBox||this._boundingBox.intersectsSphere(a)?this._zoomChanged(!1,!0):(this._cameraPosition.copy(n),this._distance===this.maxDistance?this._zoomChanged(!0,!1):this._zoomChanged(!1,!1)),this._scale=1}_zoomChanged(t,e){let s=t+""+e;0!==this._currentZoomHash.length&&this._currentZoomHash===s||(this.dispatchEvent(5,new j(t,e)),this._currentZoomHash=s)}_simulateUpdate(){let t=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX"),e=(new THREE.Quaternion).setFromEuler(t),s=new THREE.Vector3(0,0,-1);s.applyQuaternion(e),this._cameraPosition.copy(this._targetPosition.clone().sub(s.multiplyScalar(this._distance)))}zoomTo(t,e,s,i,n,a){return this._tweenCameraParameter(this._getCurrentCameraParameters(),{yaw:i,pitch:n,distance:2.725*S(t.x,t.y,t.z,this._camera.fov,e,s),targetX:a.x,targetY:a.y,targetZ:a.z,blockOtherTweens:!0},!0)}_getCameraSphere(t){return new THREE.Sphere(t,.1)}zoomIn(t){this._scale*=t?Math.pow(.95,t):this._zoomSpeed,this._update(),this.dispatchEvent(3)}zoomOut(t){this._scale/=t?Math.pow(.95,t):this._zoomSpeed,this._update(),this.dispatchEvent(4)}}),t("d",class{constructor(t,e){this._scene=t,e&&e.removeFromScene()}});const G="_start",Y=new Map;class X{static start(t){if(!window.performance||!window.performance.getEntriesByName)return"";let e=window.performance.getEntriesByName(t).length++,s="";e<100&&(s="0"),e<10&&(s="0"+s);const i=e>0?t+"_"+s+e:t,n=i+G;return window.performance.mark(n),i}static addMeta(t,e){const s=X.getMeta(t);Y.set(t,Object.assign(s,e))}static getMeta(t){return Y.get(t)||{}}static end(t){}static getMeasure(t){return[]}static showBenchmarks(t){const e=window.performance.getEntriesByType("measure");e.sort(function(t,e){return t.startTime-e.startTime});const s=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t&&-1===n.name.indexOf(t)||s.push({Start:parseFloat(n.startTime.toFixed(2)),Name:n.name,Duration:parseFloat(n.duration.toFixed(2))})}console.table(s)}}t("n",X);let Z={},q={};class J{constructor(t){this._creator_=t}fetch(t,e){return this._singlePromiseFactory.create(5,t,(i,n)=>{!function(t,e,i,n){if(-1===t.indexOf("http")&&(t=s()+t),Z[t])return i();if(e.id&&q[e.id])return n(new Error('There is already a script with ID "'+e.id+'"'));const a=X.start("load_"+e.id.replace(/-/g,"_")),o=document.createElement("script");o.async=!1,o.src=t,o.id=e.id,o.onload=(()=>{Z[t]=!0,q[e.id]=!0,X.end(a),Object.defineProperty(i,"name",{value:"resolve-"+e.id}),i()}),o.onerror=(t=>{n(t)}),document.body.appendChild(o)}(t,e,i,n)})}cleanUp(){for(let t in q)if(q.hasOwnProperty(t)){const e=document.getElementById(t);e&&e.parentElement.removeChild(e)}Z={},q={}}}t("t",J),o([r],J.prototype,"_singlePromiseFactory",void 0);const Q={MOUSE_MOVE:"mousemove",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_LEAVE:"mouseleave",MOUSE_ENTER:"mouseenter",MOUSE_WHEEL:"wheel",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend",CONTEXT_MENU:"contextmenu"};class K{constructor(t,e,s){this.position=t,this.positionRelative=e,this.type=s}}const $=t("O",5*window.devicePixelRatio),tt=2*window.devicePixelRatio;class et extends D{constructor(t){super(),this._debug=!1,this._delta=-1,this._state=0,this._pinchDistance=-1,this._lastMouseWheelEvent=null,this._lastTouchEvent=null,this._events=Object.keys(Q).map(t=>Q[t]),this._creator_=t,this._position={x:0,y:0},this._positionRelative={x:0,y:0},this._downPosition={x:0,y:0},this._downPositionRelative={x:0,y:0}}enableDragIn(t){this._state=1,this._dragEnabled=!0,t&&(this._dragMV=this._dragM.bind(this),this._dragEV=this._dragE.bind(this),this._dragTarget=t.currentTarget||t.target,this._delta=-1,this._dragMVName="drag",this._dragEVName="dragend",window.TouchEvent&&t instanceof TouchEvent?(this._dragMVName="touchmove",this._dragEVName="touchend"):t.dataTransfer&&t.dataTransfer.setData&&t.dataTransfer.setData("text/plain"," "),this._firefoxDragPosition={x:0,y:0},document.ondragover=(t=>{t=t||window.event,this._firefoxDragPosition.x=t.pageX,this._firefoxDragPosition.y=t.pageY}),this._dragTarget.addEventListener(this._dragMVName,this._dragMV,!1),this._dragTarget.addEventListener(this._dragEVName,this._dragEV,!1))}_dragM(t){let e=t,s=null,i=null;window.TouchEvent&&t instanceof TouchEvent?(s=this._getTouchPosition(e),i=this._getTouchPositionRelative(e)):(s=this._getMousePosition(e),i=this._getMousePositionRelative(e)),s.x>0&&s.y>0&&this._move(s,i)}_dragE(t){let e=t;document.ondragover=null,this._firefoxDragPosition=null,this._dragTarget.removeEventListener(this._dragMVName,this._dragMV),this._dragTarget.removeEventListener(this._dragEVName,this._dragEV),window.TouchEvent&&t instanceof TouchEvent?this._onUp(this._getTouchPosition(e),this._getTouchPositionRelative(e)):this._onUp(this._getMousePosition(e),this._getMousePositionRelative(e))}addEvents(t){this._events.forEach(e=>t.addEventListener(e,this,!1))}removeEvents(t){this._events.forEach(e=>t.removeEventListener(e,this,!1))}_dolly(t){if(this._lastTouchEvent&&t.timeStamp-this._lastTouchEvent.timeStamp<40)return;let e=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,i=Math.abs(e)+Math.abs(s);i>this._pinchDistance+tt&&this.dispatchEvent(7,new K),i<this._pinchDistance-tt&&this.dispatchEvent(8,new K),this._pinchDistance=i,this._lastTouchEvent=t}_move(t,e,s){void 0===s&&(s=0),void 0===this._dragEnabled&&(this._dragEnabled=!1),(1===this._state&&this._canDrag(s)||1===this._state&&this._dragEnabled&&2===s)&&(this._delta=this._getDelta(),this._delta>$&&(this._state=2,this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(0,new K(t,e)))),2===this._state&&this.dispatchEvent(1,new K(t,e)),this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(6,new K(t,e,s))}_longClick(){this._state=2,this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(0,new K(this._downPosition,this._downPositionRelative)),this.dispatchEvent(1,new K(this._downPosition,this._downPositionRelative))}_onUp(t,e){this.dispatchEvent(4,new K(t)),this._getDelta()<=$&&this.dispatchEvent(5,new K(t,e)),2===this._state&&this.dispatchEvent(2,new K(t,e)),3===this._state&&(this._pinchDistance=-1),this._lastTouchEvent=null,this._state=0,this._dragTarget=null,this._longClickTimer&&clearTimeout(this._longClickTimer)}_getTouchPosition(t){if(t.changedTouches.length){let{clientX:e,clientY:s}=t.changedTouches[0];this._position.x=e,this._position.y=s}return this._position}_getTouchPositionRelative(t){if(t.changedTouches.length){let e=this._domHelper.element.getBoundingClientRect(),{clientX:s,clientY:i}=t.changedTouches[0];this._positionRelative.x=(s-e.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(i-e.top)/this._domHelper.element.clientHeight*2+1}return this._positionRelative}_getMousePosition(t){return this._position.x=t.clientX,this._position.y=t.clientY,this._position}_getMousePositionRelative(t){if(0!==t.clientX&&0!==t.clientY){let e=this._domHelper.element.getBoundingClientRect();this._positionRelative.x=(t.clientX-e.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(t.clientY-e.top)/this._domHelper.element.clientHeight*2+1}else if(this._firefoxDragPosition&&0!==this._firefoxDragPosition.x&&0!==this._firefoxDragPosition.y){let t=this._domHelper.element.getBoundingClientRect();this._positionRelative.x=(this._firefoxDragPosition.x-t.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(this._firefoxDragPosition.y-t.top)/this._domHelper.element.clientHeight*2+1}return this._positionRelative}_getDelta(){return Math.abs(this._downPosition.y-this._position.y)+Math.abs(this._downPosition.x-this._position.x)}setDragEnabled(t){this._dragEnabled=t}handleEvent(t){switch(this._debug&&t.type,t.type){case Q.MOUSE_MOVE:this._onMouseMove(t);break;case Q.MOUSE_DOWN:this._onMouseDown(t);break;case Q.MOUSE_UP:this._onMouseUp(t);break;case Q.MOUSE_LEAVE:this._onMouseLeave(t);break;case Q.MOUSE_ENTER:this._onMouseEnter(t);break;case Q.MOUSE_WHEEL:this._onMouseWheel(t);break;case Q.TOUCH_MOVE:this._onTouchMove(t);break;case Q.TOUCH_START:this._onTouchStart(t);break;case Q.TOUCH_END:this._onTouchEnd(t);break;case Q.CONTEXT_MENU:this._onContextMenu(t)}}_onMouseDown(t){t.preventDefault();let{x:e,y:s}=this._getMousePosition(t);this._downPosition={x:e,y:s},this._downPositionRelative=this._getMousePositionRelative(t),this.dispatchEvent(3,new K({x:e,y:s},this._downPositionRelative,1)),this._state=1}_onMouseUp(t){t.preventDefault(),this._onUp(this._getMousePosition(t),this._getMousePositionRelative(t))}_onMouseMove(t){t.preventDefault(),this._move(this._getMousePosition(t),this._getMousePositionRelative(t),1)}_onMouseLeave(t){this._delta=-1,this._onMouseUp(t)}_onMouseEnter(t){t.preventDefault()}_onMouseWheel(t){t.preventDefault(),t.stopPropagation(),this._lastMouseWheelEvent&&t.timeStamp-this._lastMouseWheelEvent.timeStamp<40||(t.deltaY<0?this.dispatchEvent(7,new K):this.dispatchEvent(8,new K),this._lastMouseWheelEvent=t)}_onTouchMove(t){t.preventDefault(),this._dragTarget||(1===t.touches.length&&this._move(this._getTouchPosition(t),this._getTouchPositionRelative(t),2),2===t.touches.length&&(this._state=3,this._dolly(t)))}_onTouchStart(t){if(t.preventDefault(),1===t.touches.length){let{x:e,y:s}=this._getTouchPosition(t);this._downPosition={x:e,y:s},this._downPositionRelative=this._getTouchPositionRelative(t),this.dispatchEvent(3,new K({x:e,y:s},this._downPositionRelative,2)),this._state=1,this._longClickTimer=window.setTimeout(this._longClick.bind(this),350)}else 2===t.touches.length&&(1!==this._state&&2!==this._state||this._onUp(this._getTouchPosition(t),this._getTouchPositionRelative(t)),this._state=3)}_onTouchEnd(t){t.preventDefault(),this._onUp(this._getTouchPosition(t),this._getTouchPositionRelative(t))}_onContextMenu(t){t.preventDefault()}_canDrag(t){return 2!==t}}t("q",et),o([r],et.prototype,"_domHelper",void 0)}}});
//# sourceMappingURL=chunk-36662d60.nomodule.js.map
