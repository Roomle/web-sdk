System.register(["./chunk-4c9a4d80.legacy.js","./chunk-850740d7.legacy.js","./chunk-eb2e1ffb.legacy.js"],function(e,t){var n,o,r,i,a,s,c,u,l,h,d,f,v,g,p,_,m,y,E,w,k,b,T,R,M,H,x;return{setters:[function(e){n=e.k,o=e.g,r=e.h,i=e.a,a=e.b,s=e.c,c=e.d,u=e.e},function(e){l=e.c,h=e.D,d=e.b,f=e.E,v=e.n,g=e.F,p=e.o,_=e.G,m=e.d,y=e.q,E=e.t,w=e.H,k=e.h,b=e.r,T=e.a,R=e.I,M=e.J},function(e){H=e.a,x=e.b}],execute:function(){e("b",function(){var e=function(e){function t(e,n,o,r){var a;return i(this,t),(a=s(this,c(t).call(this)))._selected=!1,a.meshes=[],a.castShadow=!0,a.receiveShadow=!0,a._setValues(e,n,o,r),a}return u(t,e),a(t,[{key:"_setValues",value:function(e,t,n,o){e&&(this.roomleId=e),t&&(this.roomlePosition=Object.assign({},t)),n&&(this.roomleRotation=Object.assign({},n)),o&&(this.parentObjectId=o)}},{key:"addMesh",value:function(e,t){e.renderOrder=2,e.userData.meshType=0,e.castShadow=!0,e.receiveShadow=!0,t&&e.applyMatrix(S(t)),this.add(e),this.meshes.push(e)}},{key:"removeAllMeshes",value:function(){var e=this;this.meshes.forEach(function(t){e.remove(t),h(t)}),this.meshes=[],this.remove(this._loadingMesh),h(this._loadingMesh),this._loadingMesh=null,this.remove(this._boundingBoxMesh),h(this._boundingBoxMesh),this._boundingBoxMesh=null}},{key:"changeMaterialOfMesh",value:function(e,t){var n=this.meshes.find(function(t){return t.id===e});n?(n.material=t,n.material.needsUpdate=!0):console.warn("could not find mesh with id "+e)}},{key:"select",value:function(){this._selected=!0}},{key:"loading",value:function(){if(this._kernelBoundingBox){this.removeAllMeshes();var e=this._kernelBoundingBox.getSize(new THREE.Vector3),t=e.x,n=e.y,o=e.z,r=new THREE.BoxGeometry(t,n,o);this._loadingMesh=new THREE.Mesh(r,new THREE.MeshStandardMaterial({transparent:!0,opacity:p,color:new THREE.Color(v)})),this._loadingMesh.name="loading mesh",this._loadingMesh.receiveShadow=!1,this._loadingMesh.castShadow=!1,this._loadingMesh.layers.set(5),this._loadingMesh.translateOnAxis(this._kernelBoundingBox.getCenter(new THREE.Vector3),1),this._loadingMesh.renderOrder=3,this.add(this._loadingMesh)}else console.warn("Bounding box (box for measurements) for component "+this.roomleId+" not set, can not show external mesh loading box!")}},{key:"deselect",value:function(){this._selected=!1}},{key:"hoverOn",value:function(){l("pointer")}},{key:"hoverOff",value:function(){l("default")}},{key:"removeFromParent",value:function(){this.parent&&(this.parent.remove(this),this.removeAllMeshes())}},{key:"clear",value:function(e){this.hoverOff(),e&&this.children.forEach(function(n){n instanceof t&&n.clear(e)})}},{key:"computeBoundingBox",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._boundingBoxMesh&&this.remove(this._boundingBoxMesh);var o=null,r=null;if(!e||n){var i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;this.meshes.forEach(function(e){e.geometry.computeBoundingBox();var t=e.geometry.boundingBox;i=Math.min(i,t.min.x),a=Math.min(a,t.min.y),s=Math.min(s,t.min.z),c=Math.max(c,t.max.x),u=Math.max(u,t.max.y),l=Math.max(l,t.max.z)}),this._boundingBox=new THREE.Box3(new THREE.Vector3(i,a,s),new THREE.Vector3(c,u,l)),this._kernelBoundingBox=this._boundingBox.clone();var h=this._boundingBox.max.x-this._boundingBox.min.x,f=this._boundingBox.max.y-this._boundingBox.min.y,v=this._boundingBox.max.z-this._boundingBox.min.z;o=new THREE.BoxGeometry(h,f,v),r=t._generateCubeGeometry(h/2,f/2,v/2)}else{this._kernelBoundingBox=d(e),this._boundingBox=this._kernelBoundingBox.clone();var g=this._boundingBox.getSize(new THREE.Vector3),p=g.x,_=g.y,m=g.z;o=new THREE.BoxGeometry(p,_,m),r=t._generateCubeGeometry(p/2,_/2,m/2)}this._boundingBoxMesh=new THREE.Mesh(o,new THREE.MeshStandardMaterial({color:"#FFFFFF",transparent:!0,opacity:0,polygonOffset:!0,polygonOffsetFactor:-1})),this._boundingBoxMesh.position.add(this._boundingBox.getCenter(new THREE.Vector3)),this._boundingBoxMesh.layers.set(5),this._boundingBoxMesh.renderOrder=3,this.add(this._boundingBoxMesh),this._dockline=t._generateDashedLine(r,this._boundingBox.getCenter(new THREE.Vector3)),this._dockline.layers.set(5),this._selected&&this.add(this._dockline)}},{key:"recursiveMeshes",value:function(){var e=this.meshes.slice();return this.children.forEach(function(n){n instanceof t&&e.push.apply(e,r(n.recursiveMeshes()))}),e}},{key:"isChild",value:function(e){var n=!1;return this.children.forEach(function(o){o instanceof t&&!n&&(n=o.roomleId===e||o.isChild(e))}),n}},{key:"getKernelPosition",value:function(e){var t=this.parent.localToWorld(this.position);return I(e.worldToLocal(t))}},{key:"loadingMesh",get:function(){return this._loadingMesh}},{key:"boundingBoxMesh",get:function(){return this._boundingBoxMesh}},{key:"boundingBox",get:function(){return this._boundingBox}},{key:"roomlePosition",set:function(e){this._roomlePosition=e,e&&this.position.set(e.x/1e3,e.z/1e3,e.y/-1e3)},get:function(){return this._roomlePosition}},{key:"roomleRotation",set:function(e){this._roomleRotation=e,e&&this.rotation.set(e.x,e.z,-e.y)},get:function(){return this._roomleRotation}}],[{key:"_generateDashedLine",value:function(e,t){var n=new THREE.LineSegments(e,new THREE.LineDashedMaterial({color:"#000000",dashSize:.03,gapSize:.01,linewidth:1}));return n.translateOnAxis(t,1),n}},{key:"_generateCubeGeometry",value:function(e,t,n){var o=new THREE.Geometry;return o.vertices.push(new THREE.Vector3(-e,-t,-n),new THREE.Vector3(-e,t,-n),new THREE.Vector3(-e,t,-n),new THREE.Vector3(e,t,-n),new THREE.Vector3(e,t,-n),new THREE.Vector3(e,-t,-n),new THREE.Vector3(e,-t,-n),new THREE.Vector3(-e,-t,-n),new THREE.Vector3(-e,-t,n),new THREE.Vector3(-e,t,n),new THREE.Vector3(-e,t,n),new THREE.Vector3(e,t,n),new THREE.Vector3(e,t,n),new THREE.Vector3(e,-t,n),new THREE.Vector3(e,-t,n),new THREE.Vector3(-e,-t,n),new THREE.Vector3(-e,-t,-n),new THREE.Vector3(-e,-t,n),new THREE.Vector3(-e,t,-n),new THREE.Vector3(-e,t,n),new THREE.Vector3(e,t,-n),new THREE.Vector3(e,t,n),new THREE.Vector3(e,-t,-n),new THREE.Vector3(e,-t,n)),o}}]),t}(THREE.Object3D),n=function(t){function n(e,t){var o;return i(this,n),(o=s(this,c(n).call(this,e,null,null,null))).glbUrl=t,o}return u(n,e),n}(),m=function(t){function n(e,t,o,r){var a;return i(this,n),(a=s(this,c(n).call(this,e,t,o,r)))._stringId=null,a.receivedPointAssociation=!1,a.castShadow=!1,a.receiveShadow=!1,a}return u(n,e),a(n,[{key:"addMesh",value:function(e){o(c(n.prototype),"addMesh",this).call(this,e),e.renderOrder=1,e.castShadow=!1,e.receiveShadow=!1}},{key:"hoverOn",value:function(){this.remove(this._dockline),this.meshes.forEach(function(e){var t=e.material;t.opacity=.9,t.roughness=_,t.metalness=g,t.color=new THREE.Color(v)}),l("pointer")}},{key:"hoverOff",value:function(){this.add(this._dockline),this.meshes.forEach(function(e){var t=e.material;t.opacity=p,t.roughness=_,t.metalness=g,t.color=new THREE.Color(v)}),l("default")}},{key:"clonePreview",value:function(e){var t=new n(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId);return t._stringId=this.roomleId+"_"+e,this.children.forEach(function(e){e instanceof THREE.Mesh&&0===e.userData.meshType&&t.meshes.push(e.clone(!0))}),t.meshes.forEach(function(e){e.material=e.material.clone(),e.geometry=e.geometry.clone(),t.add(e)}),this._dockline&&(t._dockline=this._dockline.clone(!0)),this._boundingBoxMesh&&(t._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(t._boundingBox=this._boundingBox.clone()),t}},{key:"preparePreview",value:function(){this.add(this._dockline),this.add(this._boundingBoxMesh)}},{key:"stringId",get:function(){return this._stringId?this._stringId:this.roomleId.toString()}}]),n}(),y=function(e){function n(e,t,o,r,a){var u;return i(this,n),u=s(this,c(n).call(this,e,t,o,r)),a&&(u._stringId=u.roomleId+"_has_additional_dock_point_copy"),u}return u(n,m),a(n,[{key:"addMesh",value:function(e){o(c(n.prototype),"addMesh",this).call(this,e),e.visible=!1,e.renderOrder=3}},{key:"hoverOn",value:function(){this._dockline.visible=!0,l("pointer")}},{key:"hoverOff",value:function(){this._dockline.visible=!1,l("default")}},{key:"preparePreview",value:function(){o(c(n.prototype),"preparePreview",this).call(this),this._dockline.visible=!1;var e=this.lineTo.clone(),t=this.lineFrom.clone(),r=(new THREE.Vector3).subVectors(e,t),i=new THREE.ArrowHelper(r,t),a=new THREE.CylinderGeometry(.01,.01,r.length(),16,1);this.lineMesh=new THREE.Mesh(a,new THREE.MeshStandardMaterial({color:v,transparent:!0,opacity:f})),this.lineMesh.setRotationFromEuler(new THREE.Euler(i.rotation.x-this.rotation.x,i.rotation.y-this.rotation.y,i.rotation.z-this.rotation.z)),this.lineMesh.renderOrder=1;var s=(new THREE.Vector3).addVectors(e,t).multiplyScalar(.5);this.lineMesh.position.copy((new THREE.Vector3).subVectors(s,this.position.clone())),this.add(this.lineMesh);var u=this._boundingBox.getCenter(new THREE.Vector3),l=null,h=0;r.x>r.y&&r.x>r.z?(l=new THREE.Vector3(u.x,0,0),h=Math.sqrt(u.y*u.y+u.z*u.z)):r.y>r.x&&r.y>r.z?(l=new THREE.Vector3(0,u.y,0),h=Math.sqrt(u.x*u.x+u.z*u.z)):r.z>r.y&&r.z>r.x&&(l=new THREE.Vector3(0,0,u.z),h=Math.sqrt(u.y*u.y+u.x*u.x));var d=new THREE.CylinderGeometry(1.1*h,1.1*h,(new THREE.Vector3).subVectors(this.positionTo.clone(),this.positionFrom.clone()).length()+l.length(),32,1);this.boundingLineMesh=new THREE.Mesh(d,new THREE.MeshStandardMaterial({color:"#ffffff",transparent:!0,opacity:0}));var g=this.positionTo.clone(),p=this.positionFrom.clone(),_=(new THREE.Vector3).subVectors(g,p),m=new THREE.ArrowHelper(_,p);this.boundingLineMesh.setRotationFromEuler(new THREE.Euler(m.rotation.x-this.rotation.x,m.rotation.y-this.rotation.y,m.rotation.z-this.rotation.z)),this.boundingLineMesh.renderOrder=3;var y=(new THREE.Vector3).addVectors(this.positionTo.clone(),this.positionFrom.clone()).multiplyScalar(.5).add(u);this.boundingLineMesh.position.copy((new THREE.Vector3).subVectors(y,this.position.clone())),this.add(this.boundingLineMesh)}},{key:"clonePreviewLine",value:function(e){var t=new n(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId,this.receivedPointAssociation);return t._stringId=this.roomleId+"_"+e,this.children.forEach(function(e){e instanceof THREE.Mesh&&0===e.userData.meshType&&t.meshes.push(e.clone(!0))}),t.meshes.forEach(function(e){e.material=e.material.clone(),e.geometry=e.geometry.clone(),t.add(e)}),this._dockline&&(t._dockline=this._dockline.clone(!0)),this._boundingBoxMesh&&(t._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(t._boundingBox=this._boundingBox.clone()),t}},{key:"getPositionForIntersectionPoint",value:function(e){var t=this.positionTo.clone().add(this._boundingBox.getCenter(new THREE.Vector3)),n=this.positionFrom.clone().add(this._boundingBox.getCenter(new THREE.Vector3));return new THREE.Line3(n,t).closestPointToPoint(e,!0,new THREE.Vector3).sub(this._boundingBox.getCenter(new THREE.Vector3))}},{key:"updatePreviewPosition",value:function(e){var t=this.getPositionForIntersectionPoint(e),n=this.parent.localToWorld(t);this._newPosition=this.worldToLocal(n),this._dockline.position.copy((new THREE.Vector3).addVectors(this._newPosition,this._boundingBox.getCenter(new THREE.Vector3)))}},{key:"hideSelectionLine",value:function(){this._dockline.visible=!1}},{key:"getKernelPosition",value:function(e){if(this._newPosition){var t=this.localToWorld(this._newPosition);return I(e.worldToLocal(t))}return o(c(n.prototype),"getKernelPosition",this).call(this,e)}},{key:"roomleLineFrom",set:function(e){this._roomleLineFrom=e,this.lineFrom=t(e)},get:function(){return this._roomleLineFrom}},{key:"roomleLineTo",set:function(e){this._roomleLineTo=e,this.lineTo=t(e)},get:function(){return this._roomleLineTo}},{key:"roomlePositionFrom",set:function(e){this._roomlePositionFrom=e,this.positionFrom=t(e)},get:function(){return this._roomlePositionFrom}},{key:"roomlePositionTo",set:function(e){this._roomlePositionTo=e,this.positionTo=t(e)},get:function(){return this._roomlePositionTo}}]),n}(),E=function(e){function t(e,n,o,r,a,u){var l;return i(this,t),(l=s(this,c(t).call(this,e,n,o,r)))._element=a,l.offset=u,l}return u(t,e),a(t,[{key:"_calculateProjectionMatrix",value:function(){var e,t,n,o,r=this.fov*(2*Math.PI/360)/2;o=-(n=Math.tan(r));var i=this._element.clientWidth/this._element.clientHeight,a=Math.atan(i*Math.tan(r));e=-(t=Math.tan(a));var s=this._offset.left,c=this._offset.right,u=this._offset.top,l=this._offset.bottom,h=new THREE.Vector2(c-s,u-l),d=new THREE.Vector2(s+h.x/2,l+h.y/2);if(h.x<h.y){var f=(1-d.x)/(h.x/2),v=d.x/(h.x/2);t*=f,e*=v;var g=(f+v)/2;n*=g,o*=g}else{var p=(1-d.y)/(h.y/2),_=d.y/(h.y/2);n*=p,o*=_;var m=(_+p)/2;e*=m,t*=m}e*=this.near,t*=this.near,n*=this.near,o*=this.near;var y=2*(this.near*Math.tan(Math.PI/180*.5*this.fov)/this.zoom),E=this.aspect*y;return this.view&&this.view.enabled&&(e+=this.view.offsetX*E/this.view.fullWidth,n-=this.view.offsetY*y/this.view.fullHeight,t+=this.view.offsetX*E/this.view.fullWidth,o-=this.view.offsetY*y/this.view.fullHeight),(new THREE.Matrix4).makePerspective(e,t,n,o,this.near,this.far)}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){this._offset?this.projectionMatrix=this._calculateProjectionMatrix():o(c(t.prototype),"updateProjectionMatrix",this).call(this)}},{key:"offset",set:function(e){this._offset=e,this.updateProjectionMatrix()},get:function(){return this._offset}}]),t}(THREE.PerspectiveCamera);return{create:function(t,n,o,r){return new e(t,n,o,r)},createPreview:function(e,t){return new m(e,{x:0,y:0,z:0},{x:0,y:0,z:0},t)},createStatic:function(e,t){return new n(e,t)},createPreviewLine:function(e){var t=new y(e.id,e.roomlePosition,e.roomleRotation,e.parentObjectId,e.receivedPointAssociation);return e.meshes.forEach(function(e){var n=e.clone();n.material=e.material.clone(),n.geometry=e.geometry.clone(),t.addMesh(n)}),t.computeBoundingBox(),t},isPreview:function(e){return e instanceof m},isPreviewLine:function(e){return e instanceof y},createCamera:function(e,t,n,o,r,i){return new E(e,t,n,o,r,i)}}});var t=e("k",function(e){return new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/-1e3)}),I=(e("m",function(e){return new THREE.Euler(e.x,e.z,-e.y)}),e("l",function(e){return new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/1e3)}),function(e){return{x:1e3*e.x,y:-1e3*e.z,z:1e3*e.y}}),P=function(e){return decodeURIComponent(e)},C=e("h",function e(t){if(!t){var o=n(t);return"number"===o||"boolean"===o?t:null}if(!t.hasOwnProperty("size")&&t.size&&"function"==typeof t.size){for(var r=B(t),i=0;i<r.length;i++)r[i]=e(r[i]);return"string"==typeof r?P(r):r}if("object"===n(t))for(var a in t)t.hasOwnProperty(a)&&(t[a]=e(t[a]));return"string"==typeof t?P(t):t}),B=function(e){var t=[];if(e)for(var n=e.size(),o=0;n>o;o++)t.push(e.get(o));return t},S=e("n",function(e){var t=new THREE.Matrix4,n=C(e);return t.fromArray(n),t.transpose(),function(e){var t=new THREE.Matrix4;t.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),t.scale(new THREE.Vector3(.001,.001,.001));var n=new THREE.Matrix4;return n.set(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1),n.scale(new THREE.Vector3(1e3,1e3,1e3)),t.multiply(e).multiply(n)}(t)}),O={isProduction:!0,isUnitTesting:JSON.parse("false"),environment:"production",detailEnvironment:"development",features:{hdEnabledByDefault:JSON.parse("false")},APP:{RAPI:{server:"https://api.roomle.com/v2",liveServer:"https://api.roomle.com/v2",testServer:"https://api.test.roomle.com/v2",headers:{apiKey:"roomle_portal_v2",currentTenant:9,locale:"en",language:"en",device:1,token:"anonymous"}},WASM:{CONFIGURATOR:{URL:"static/kernel-artifacts/wasm/ConfiguratorKernel.wasm",CACHE_COMPILATION:!0,HASH:"9354de5471419fdfbc23ec5ce7257cd8",LOADER:"static/kernel-artifacts/wasm/ConfiguratorKernel.js"},PLANNER:{URL:"static/kernel-artifacts/wasm/RoomleCore.wasm",CACHE_COMPILATION:!0,HASH:"83ce18910bb7ed84f2ba4818fe58528f",LOADER:"static/kernel-artifacts/wasm/RoomleCore.js"}},ASM:{CONFIGURATOR:{MEM_URL:"static/kernel-artifacts/ConfiguratorKernelJs.mem",LOADER:"static/kernel-artifacts/ConfiguratorKernelJs.js"},PLANNER:{MEM_URL:"static/kernel-artifacts/RoomleCoreJs.mem",LOADER:"static/kernel-artifacts/RoomleCoreJs.js"}},SHORTENER_URL:"http://rml.co/"},environments:{PRODUCTION:"production",DEVELOPMENT:"development",TEST:"test",TEST_SERVER:"test_server",ALPHA:"alpha"}};window.IS_DEBUG=!0;var V=O;e("c",V);var D=y(30),A=(function(e){function t(e,n,o){var r;return i(this,t),(r=s(this,c(t).call(this)))._offset=new THREE.Vector3(0,0,0),r._scene=e,r._camera=n,r._raycaster=new THREE.Raycaster,r._addInputListeners(o),r._planeBottom=new THREE.Plane(new THREE.Vector3(0,1,0)),r._planeFront=new THREE.Plane(new THREE.Vector3(0,0,1)),r._planeSide=new THREE.Plane(new THREE.Vector3(1,0,0)),r}u(t,m),a(t,[{key:"_addInputListeners",value:function(e){var t=this;e.addEventListener(5,function(e){t._findSelection(e.positionRelative)},this),e.addEventListener(6,function(e){t._findHover(e.positionRelative,e.type)},this),e.addEventListener(0,function(e){t._onDragStart(e.positionRelative)},this),e.addEventListener(1,function(e){t._onDrag(e.positionRelative)},this),e.addEventListener(2,function(e){t._onDragEnd(e.positionRelative)},this)}},{key:"_findSelection",value:function(e){var t=this._intersection(e);t?t&&t.object.dispatchEvent({type:"select"}):this.dispatchEvent(3)}},{key:"_findHover",value:function(e,t){var n=this._intersection(e);!n&&this._currentHover?(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:t}}),this._currentHover=null):n&&(this._currentHover&&this._currentHover.id!==n.object.id&&(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:t}}),this._currentHover=null),this._currentHover?this._currentHover.dispatchEvent({type:"hover_move",attachment:{intersection:n,type:t}}):(this._currentHover=n.object,this._currentHover.dispatchEvent({type:"hover_on",attachment:{intersection:n,type:t}})))}},{key:"_intersection",value:function(e){var t=this,n=this._intersect(e);if(0>=n.length)return null;var o=n[0];return n.length>1&&this._currentHover&&this._currentDrag&&this._currentDrag.id!==this._currentHover.id&&n.forEach(function(e){e.object.id!==t._currentHover.id||e.object.userData.priority!==t._currentHover.userData.priority||o.object.userData.priority>e.object.userData.priority||(o=e)}),o}},{key:"_intersect",value:function(e){this._raycaster.setFromCamera(e,this._camera);var t=[];return this._raycaster.intersectObjects(this._scene.children,!0).forEach(function(e){e.object.userData.hasListener&&t.push(e)}),0>t.length?[]:t.sort(function(e,t){return e.object.userData.priority!==t.object.userData.priority?t.object.userData.priority-e.object.userData.priority:e.distance-t.distance})}},{key:"_onDragStart",value:function(e){var t=this._intersection(e);if((t||this._currentDrag)&&(!t||t.object.userData.roomleId!==this._rootComponentId)){!this._currentDrag&&t&&(this._currentDrag=t.object,this._currentDrag.dispatchEvent({type:"drag_start"}));var n=this._currentDrag.parent;n&&n.computeBoundingBox&&(n.computeBoundingBox(),this._positionPlanes(n),this._calculateOffset(n))}}},{key:"_onDrag",value:function(e){if(this._currentDrag){this._raycaster.setFromCamera(e,this._camera);var t=new THREE.Vector3(0,0,-5),n=new THREE.Vector3(0,0,0),o=new THREE.Vector3(0,0,0);this._raycaster.ray.intersectPlane(this._planeBottom,t),this._raycaster.ray.intersectPlane(this._planeFront,n),this._raycaster.ray.intersectPlane(this._planeSide,o);var r,i=t.clone().sub(this._camera.position),a=n.clone().sub(this._camera.position),s=o.clone().sub(this._camera.position),c=i.length(),u=a.length(),l=s.length(),h=this._camera.userData.yaw;-D>h||h>D?u>c&&l>c?r=t.clone():c>u&&l>u?r=n.clone():c>l&&u>l&&(r=o.clone()):r=u>c?t.clone():n.clone(),r.sub(this._offset),this._currentDrag.dispatchEvent({type:"drag",attachment:{position:r}})}}},{key:"_onDragEnd",value:function(e){this._currentDrag&&(this._currentDrag.dispatchEvent({type:"drag_end",attachment:{position:e}}),this._currentDrag=null)}},{key:"_positionPlanes",value:function(e){e&&e.boundingBox&&this._rootComponentPosition&&(this._planeBottom.constant=-e.boundingBox.getCenter(new THREE.Vector3).y-this._rootComponentPosition.y,this._planeSide.constant=2*-e.boundingBox.getSize(new THREE.Vector3).x+e.boundingBox.getCenter(new THREE.Vector3).x,this._camera.userData.yaw>0&&(this._planeSide.constant*=-1),this._bounds&&(this._planeFront.constant=this._bounds.z/2+e.boundingBox.getCenter(new THREE.Vector3).z))}},{key:"_calculateOffset",value:function(e){e&&e.boundingBox&&(this._offset.copy(e.boundingBox.getCenter(new THREE.Vector3)),this._offset.applyQuaternion(e.getWorldQuaternion(new THREE.Quaternion)))}},{key:"update",value:function(e,t,n){if(e&&(this._bounds=e),t&&(this._rootComponentPosition=t),n){this._backgroundScene=n;var o=this._backgroundScene.children[0];o instanceof THREE.Mesh&&(o.geometry.computeBoundingBox(),this._backgroundSceneWidth=o.geometry.boundingBox.getSize(new THREE.Vector3).x)}}},{key:"clear",value:function(){this._currentDrag&&h(this._currentDrag),this._currentHover&&h(this._currentHover)}},{key:"enableDragIn",value:function(e){this._currentDrag=e}},{key:"setRootComponentId",value:function(e){this._rootComponentId=e}},{key:"setCamera",value:function(e){this._camera=e}}])}(),e("e",function(e){return!(!e||"string"!=typeof e||e.split(":").length>2)}),e("d",function(e){if(!e||"string"!=typeof e)return null;var t=e.split(":");return 2>t.length?null:t[0]})),L=V.APP.RAPI,F=L.headers,j=F.token,N=e("g","crt"),z=new Map,W=new Map,U=new Map,G=new Map,K=new Map,J=new Map,q=new Map,Y=new Map,Q=new Map,X=e("j",function(){function e(){i(this,e),window.addEventListener("online",this._flushOfflineQueue.bind(this))}return a(e,[{key:"overrideTenant",value:function(e){e&&(this._overrideTenant=e)}},{key:"setConfiguratorId",value:function(e){e&&(this._configuratorId=e)}},{key:"overrideCountry",value:function(e){e&&(this._overrideCountry=e)}},{key:"overrideRapi",value:function(e){e&&(this._overrideRapi=e)}},{key:"getPreloadForItem",value:function(e){return this._getPreload(e,!0)}},{key:"getPreloadForConfiguration",value:function(e){return this._getPreload(e,!1)}},{key:"_getPreload",value:function(e,t){var n=this;return new Promise(function(o,r){if(!navigator.onLine)return o();if(n._dataSyncer.getIsCatalogSynced(A(e)))return o();if(q.get(e))return o();var i=t?"?itemId=":"?configurationId=";n._get("/preloads/components/"+i+e,"preloads/components").then(function(t){if(q.get(e))return o();t.forEach(function(e){n._prepareData(e,"components")}),q.set(e,!0),o()},r)})}},{key:"changeUseOfHDGeometry",value:function(){var e=G.get("components");q.clear(),J.clear(),e&&G.delete("components")}},{key:"getHSCPackage",value:function(e){var t=this;return new Promise(function(n,o){if(J.get(e))return n();t._get("/catalogs/"+e+"/package","package").then(function(o){if(J.get(e))return n(o);o.components.forEach(function(e){t._prepareData(e,"components")}),o.materials.forEach(function(e){t._prepareData(e,"materials"),t._prepareGroups(e)}),o.textures.forEach(function(e){t._prepareData(e,"textures")}),J.set(e,!0),n(o)},o)})}},{key:"getComponent",value:function(e){return this._getById(e,"components")}},{key:"getConfiguration",value:function(e){return this._getById(e,"configurations")}},{key:"getItem",value:function(e){return this._getById(e,"items")}},{key:"getComponents",value:function(e){return this._getByIds(e,"components")}},{key:"getItems",value:function(e){return this._getByIds(e,"items")}},{key:"getTag",value:function(e){return this._getById(e,"tags")}},{key:"getTags",value:function(e){return this._getByIds(e,"tags")}},{key:"getTexture",value:function(e){return this._getById(e,"textures")}},{key:"getCatalog",value:function(e){return this._getById(e,"catalogs")}},{key:"getMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return this._getById(e,"meshes",{path:"/data?format="+t+"&targetQuality="+n.toString()})}},{key:"getMeshesOfCatalog",value:function(e){var t=this;return new Promise(function(n,o){var r=K.get(e);r?n(r):t._get("/meshes?catalog="+e,"catalogMeshes").then(function(t){K.set(e,t),n(t)},o)})}},{key:"getTexturesOf",value:function(e){return this._getRelationData(e,{rapiPath:"textures"})}},{key:"getItemsOf",value:function(e){return this._getRelationData(e,{rapiPath:"items"})}},{key:"getMaterialsOf",value:function(e){return this._getRelationData(e,{rapiPath:"materials"})}},{key:"getComponentsOf",value:function(e){return this._getRelationData(e,{rapiPath:"components"})}},{key:"getAdditionalContentsOfItems",value:function(e){var t=this,n=[],o=[];return e.forEach(function(e){var t=W.get(e.id);t?o.push.apply(o,r(t)):n.push(e.id)}),new Promise(function(e,i){0!==n.length?t._getByIdsPackets(n,"itemAdditionalContents",{filterKey:"itemIds"}).then(function(t){t.forEach(function(e){var t=W.get(e.itemId);t||(t=[]);for(var n=0,o=t.length;o>n;n++)if(t[n].id===e.id)return;t.push(e),W.set(e.itemId,t)}),e(r(t).concat(o))},i):e(o)})}},{key:"getMaterial",value:function(e){return this._getById(e,"materials")}},{key:"peekMaterial",value:function(e){return this._peekData(e,"materials")}},{key:"peekComponent",value:function(e){return this._peekData(e,"components")}},{key:"getMaterials",value:function(e){return this._getByIds(e,"materials")}},{key:"getPlan",value:function(e){return this._getById(e,"plans")}},{key:"cleanUp",value:function(){z=new Map,U=new Map,G=new Map,J=new Map,q=new Map,Y=new Map,W=new Map}},{key:"getMaterialsByGroup",value:function(e){for(var t=this,n=e.slice(),o=[],i=n.length,a=0;i>a;a++){var s=z.get(n[a]);if(s){for(var c=s.length,u=0;c>u;u++){var l=this._getCache("materials").get(s[u]);o.push(l)}n.splice(a,1),i--,a--}}return new Promise(function(e,i){0!==n.length&&navigator.onLine?t._getByIdsPackets(n,"materials",{filterKey:"groups"}).then(function(n){e(t.combineMaterialsToGroups(r(n).concat(o)))},i):e(t.combineMaterialsToGroups(o))})}},{key:"_flushOfflineQueue",value:function(){var e=this;return new Promise(function(t,n){var o=e._localStorage.getItem("hsc_configurations_offline_queue_v1"),r=[];for(var i in o)o.hasOwnProperty(i)&&function(){var t=o[i];r.push(new Promise(function(n,o){e.saveConfiguration(t.data).then(function(r){var i=[];t.perspectiveImage&&!r.perspectiveImage&&i.push(e.savePerspectiveImage(r,t.perspectiveImage)),t.topImage&&!r.topImage&&i.push(e.savePerspectiveImage(r,t.topImage)),Promise.all(i).then(n,o)},o)}))}();Promise.all(r).then(function(){e._localStorage.setItem("hsc_configurations_offline_queue_v1",{}),t()},n)})}},{key:"_setQueuedConfiguration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.configurationHash,o=t.perspectiveImage,r=t.topImage,i=this._localStorage.getItem("hsc_configurations_offline_queue_v1")||{},a=i[n]||{};a.data=e,a.perspectiveImage=o,a.topImage=r,i[n]=a,this._localStorage.setItem("hsc_configurations_offline_queue_v1",i)}},{key:"saveConfiguration",value:function(e){return navigator.onLine?this._save("/configurations",{configuration:e},"configurations",{accept:"application/json",contentType:"application/json; charset=UTF-8"}):(e.perspectiveImage=null,e.topImage=null,this._setQueuedConfiguration(e),this._markConfigurationAsLocally(e),Promise.resolve(e))}},{key:"saveTopImage",value:function(e,t){return this._saveConfigurationImage(e,t,"topImage")}},{key:"savePerspectiveImage",value:function(e,t){return this._saveConfigurationImage(e,t,"perspectiveImage")}},{key:"getShortUrl",value:function(e,t){var n=this;return new Promise(function(o,r){return n._fetchJson("/shortIds","shortIds",{method:"POST",resolve:o,reject:r,data:JSON.stringify({shortId:{type:t,referencedId:e}})})})}},{key:"_peekData",value:function(e,t){var n=G.get(t);return n&&n.get(e)||null}},{key:"_saveConfigurationImage",value:function(e,t,n){if(!navigator.onLine){var o={};return o[n]=t,this._setQueuedConfiguration(e,o),this._markConfigurationAsLocally(e),e[n]=t.image,Promise.resolve(e)}var r=this._formDataUtil.create(t.image,e.configurationHash,w.PNG,n);return this._save("/configurations/"+e.id+"/"+n,r,"configurations",{accept:"application/json"})}},{key:"_markConfigurationAsLocally",value:function(e){e.isLocally=!0,e.id=e.configurationHash}},{key:"_save",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t instanceof FormData?t:JSON.stringify(t);return new Promise(function(t,a){var s={method:"POST",data:i,resolve:t,reject:a};r.contentType&&(s.contentType=r.contentType),r.accept&&(s.accept=r.accept),o._fetchJson(e,n,s)})}},{key:"combineMaterialsToGroups",value:function(e){for(var t=new Map,n={id:null,label:null,materials:[]},o=0,r=e.length;r>o;o++){var i=e[o],a=i.group,s=i.id,c=a?z.get(a):[];c||(z.set(a,[]),c=z.get(a)),-1===c.indexOf(s)&&c.push(s);var u=a?t.get(a):n;u||(t.set(a,{id:a,label:i.groupLabel,materials:[]}),u=t.get(a)),u.materials.push(i)}var l=n.materials.length?[n]:[];return t.forEach(function(e,t){l.push({id:t,label:e.label,materials:e.materials})}),l}},{key:"_getByIds",value:function(e,t){var n=this,o=this._getCache(t),i=this._getErrorCache(t),a=[],s=e.slice(),c=s.length;if(o&&o.size)for(var u=(new Date).getTime(),l=0;c>l;l++){var h=s[l],d=o.get(h),f=i.get(h),v=!1;null!=d?(a.push(d),v=!0):v=void 0!==f&&(6e4>u-f.timestamp||!1===navigator.onLine),v&&(s.splice(l,1),c--,l--)}return new Promise(function(e,o){0!==s.length&&navigator.onLine?n._getByIdsPackets(s,t).then(function(t){e(r(t).concat(a))},o):e(a)})}},{key:"_getByIdsPackets",value:function(e,t){var n,o=this,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).filterKey||"ids",a="/"+t+"/",s="?",c=[],u=e.length;if(!u)return new Promise(function(e){return e([])});var l=!0,h=[];for(n=0;u>n;n++){l=!1;var d=e[n],f=s+i+"[]="+d,v=f.length+a.length;h.push(d),s="&",v>1500?(v>1500&&(h.pop(),n--),c.push({url:a,ids:h}),l=!0,a="/"+t+"/",s="?",h=[]):a+=f}l||c.push({url:a,ids:h});var g=[];return c.forEach(function(e){return g.push(o._getByIdsSingle(e.ids,e.url,t))}),new Promise(function(e,t){Promise.all(g).then(function(t){var n=[];t.length&&t.forEach(function(e){return n.push.apply(n,r(e))}),e(n)},t)})}},{key:"_getByIdsSingle",value:function(e,t,n){var o=this;return new Promise(function(r,i){o._get(t,n).then(function(t){for(var i=0,a=t.length;a>i;i++){var s=e.indexOf(t[i].id);-1!==s&&e.splice(s,1)}var c=e.length;if(c){for(var u=o._getCache(n),l=o._getErrorCache(n),h=(new Date).getTime(),d=0;c>d;d++)l.set(e[d],{code:0,timestamp:h}),u.delete(e[d]);o._errorHandler.dispatch(2,[n,e.map(function(e){return'"'+e+'"'}).join(",")])}r(t)},i)})}},{key:"_getById",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this._getCache(t).get(e);if(o)return new Promise(function(e){return e(o)});if(!navigator.onLine)return Promise.reject("Nothing cached but tried to fetch in offline mode");var r={id:e},i=n.path||"";return this._get("/"+t+"/"+e+i,t,r)}},{key:"_get",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=E.useHDGeometry?"includeGeometryHD=true":"";if(""!==r){var i=-1===e.indexOf("?")?"?":"&";e+=i+r}return new Promise(function(r,i){var a=Y.get(e);Array.isArray(a)&&a.length>0?a.push({resolve:r,reject:i}):(Y.set(e,[{resolve:r,reject:i}]),n._fetchJson(e,t,o))})}},{key:"_fetchJson",value:function(e,t,n){var o={method:n&&n.method?n.method:"GET",headers:this._createHeaders(n),mode:"cors",cache:"default"};n&&n.data&&(o.body=n.data);var r=L.server,i=this._overrideRapi;i&&(r="live"===i?L.liveServer:L.testServer);var a=new Request(r+e,o);this._networkLayer.fetch(a).then(k.bind(this)).then(this._handleJson(e,t,n).bind(this)).catch(this._handleError(e,n).bind(this))}},{key:"_createHeaders",value:function(e){this._overrideTenant&&(F.currentTenant=this._overrideTenant),this._overrideCountry&&(F.country=this._overrideCountry);var t=window.__RML__ENV__.initData.locale;F.language=t,F.locale=t,e&&e.contentType&&(F["content-type"]=e.contentType),e&&e.accept&&(F.accept=e.accept),this._configuratorId&&(F.configurator=this._configuratorId),F.token="03-"+window.btoa((new Date).toISOString()+";"+j+";"+F.apiKey);var n=new Headers(F);return e&&e.data instanceof FormData&&n.delete("content-type"),n}},{key:"_handleJson",value:function(e,t,n){var o=this;return function(r){var i=null,a=null;for(var s in r)"meta"!==s&&r.hasOwnProperty(s)&&(i=r[s],a=s);if("error"===a)return o._handleError(e,n)(new Error(JSON.stringify(i)));if(!i)throw new TypeError("RAPI returned empty JSON");if(Array.isArray(i))for(var c=0,u=i.length;u>c;c++)o._prepareData(i[c],t,n);else o._prepareData(i,t,n);n&&n.resolve?n.resolve(i):o._notifyWaiters(e,null,i)}}},{key:"_getCache",value:function(e){return this._getCacheFrom(e,G)}},{key:"_getErrorCache",value:function(e){return this._getCacheFrom(e,Q)}},{key:"_getCacheFrom",value:function(e,t){var n=t.get(e);return n||(t.set(e,new Map),n=t.get(e)),n}},{key:"_prepareData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this._getCache(t);if(e.id||n&&n.id){var r=e.id?e.id:n.id;o.set(r,e),e.__rapi_path__=t}else"shortIds"!==t&&console.error("Can not cache because there is no ID!")}},{key:"_getRelationsCacheFor",value:function(e,t,n){var o=U.get(t);if(!o){var r=new Map,i=new Map;i.set(n,void 0),r.set(e,i),U.set(t,r),o=U.get(t)}var a=o.get(e);if(!a){var s=new Map;s.set(n,void 0),o.set(e,s),a=o.get(e)}return a.get(n)}},{key:"_prepareGroups",value:function(e){var t=e.group,n=e.id,o=z.get(t);o||(z.set(t,[]),o=z.get(t)),-1===o.indexOf(n)&&o.push(n)}},{key:"_handleError",value:function(e,t){var n=this;return function(o){navigator.onLine?(o.rmlErrorCode=1,n._errorHandler.dispatch(1,[o])):(o.rmlErrorCode=0,n._errorHandler.dispatch(0,[o])),t&&t.reject?t.reject(o):n._notifyWaiters(e,o,null)}}},{key:"_getRelationData",value:function(e,t){var n=this,o=e.id,r=e.__rapi_path__,i=t.rapiPath,a=this._getCache(i),s=this._getRelationsCacheFor(o,r,i),c=[];return s?(s.forEach(function(e){return c.push(a.get(e))}),new Promise(function(e){return e(c)})):navigator.onLine?new Promise(function(e,t){n._get("/"+r+"/"+o+"/"+i,i).then(function(t){for(var a=U.get(r).get(o),s=n._getCache(i),c=[],u=0,l=t.length;l>u;u++){var h=t[u],d=h.id;c.push(d),s.set(d,h)}a.set(i,c),e(t)},t)}):Promise.resolve([])}},{key:"_notifyWaiters",value:function(e,t,n){var o=Y.get(e);if(o&&o.length){for(var r=0,i=o.length;i>r;r++)t?o[r].reject(t):o[r].resolve(n);Y.delete(e)}}}]),e}());H([x],X.prototype,"_formDataUtil",void 0),H([x],X.prototype,"_errorHandler",void 0),H([x],X.prototype,"_dataSyncer",void 0),H([x],X.prototype,"_networkLayer",void 0),H([x],X.prototype,"_localStorage",void 0);var Z,$,ee,te,ne,oe,re=function(){function e(){i(this,e)}return a(e,null,[{key:"openDb",value:function(e,t,n){return new Promise(function(o,r){var i=indexedDB.open(e,t);i.onerror=function(){r("Error in OpenDB: ".concat(this.error))},i.onsuccess=function(){o(this.result)},i.onupgradeneeded=n})}},{key:"getObjectStore",value:function(e,t,n){return e.transaction([t],n).objectStore(t)}},{key:"getRecordFromObjectStore",value:function(t,n,o){return new Promise(function(r,i){var a=e.getObjectStore(t,n,"readonly").get(o);a.onerror=function(){i("Error in GetRecordFromObjectStore: ".concat(this.error))},a.onsuccess=function(){var e=this.result;e?r(e):i("404")}})}},{key:"deleteRecordFromObjectStore",value:function(t,n,o){return new Promise(function(r,i){var a=e.getObjectStore(t,n,"readwrite").delete(o);a.onerror=function(){i("Error in DeleteRecordFromObjectStore: ".concat(this.error))},a.onsuccess=function(){r()}})}},{key:"saveRecordToObjectStore",value:function(t,n,o){return new Promise(function(r,i){var a=null;try{a=e.getObjectStore(t,n,"readwrite").put(o)}catch(e){return i(e)}if(!a)return i(new Error("Unknown problem"));a.onerror=function(){i("Error in SaveToIndexedDB: ".concat(this.error))},a.onsuccess=function(){r()}})}}]),e}(),ie=function(){function e(){i(this,e)}return a(e,null,[{key:"getCompiledModuleFromIndexedDB",value:function(t,n,o,r){re.openDb("WasmCache",1,e.handleUpgradeDB).then(function(i){re.getRecordFromObjectStore(i,"Modules",e.DB_KEY).then(function(a){a.wasmVersion!==n?re.deleteRecordFromObjectStore(i,"Modules",e.DB_KEY).then(function(){e.loadWebAssemblyFromFile(i,t,n,o,r)}):(b.start("kernel_compile_instance"),b.addMeta("kernel_is_ready",{cachedInIndexedDB:!0}),window.WebAssembly.instantiate(a.wasmModule,o).then(function(e){return r(e)}),b.end("kernel_compile_instance"))},function(a){"404"!==a&&console.error(a),e.loadWebAssemblyFromFile(i,t,n,o,r)})},function(i){console.error(i),e.loadWebAssemblyFromFile(null,t,n,o,r)})}},{key:"handleUpgradeDB",value:function(e){e.target.result.createObjectStore("Modules",{keyPath:"key"})}},{key:"loadWebAssemblyFromFile",value:function(t,n,o,r,i){var a="function"==typeof WebAssembly.instantiateStreaming;b.addMeta("kernel_is_ready",{cachedInIndexedDB:!1});var s=null;a?(b.start("kernel_stream_compile"),s=WebAssembly.instantiateStreaming(fetch(T()+n),r),b.end("kernel_stream_compile")):(b.start("kernel_legacy_compile"),s=fetch(T()+n).then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,r)})),b.addMeta("kernel_is_ready",{instantiateStreaming:a}),s.then(function(n){if(b.end(a?"kernel_stream_compile":"kernel_legacy_compile"),i(n.instance),null!==t)try{var r={key:e.DB_KEY,wasmVersion:o,wasmModule:n.module};(window.requestIdleCallback?window.requestIdleCallback:window.requestAnimationFrame)(function(){return re.saveRecordToObjectStore(t,"Modules",r).then(function(){return!0},function(e){return console.warn("WASM not saved to IndexedDB: ".concat(e.message))})})}catch(e){console.error("Unable to save the WebAssembly module to IndexedDB: ".concat(e.message))}},function(e){console.error(e)})}}]),e}();ie.DB_KEY="";var ae=!(null!=navigator.userAgent.match(/iPad|iPhone|iPod/i)||!window.WebAssembly),se=e("f",function(){function e(t){i(this,e),this._subComponentsWaiters=new Map,this._shouldWait=!0,this._setupKernelPaths(t),this._setupEmsModule(t),this._useWASM=ae,this._kernelPath=ae?te:ne,window.KernelCallback={isReady:this.isReady.bind(this)}}return a(e,[{key:"_utilityToLongArray",value:function(e){var t=new this._kernelContainer.LongArray;return e.forEach(function(e){return t.push_back(e)}),t}},{key:"_setupKernelPaths",value:function(e){var t=0===e?"PLANNER":"CONFIGURATOR";Z=V.APP.ASM[t].MEM_URL,$=V.APP.WASM[t].URL,ee=t+":"+V.APP.WASM[t].HASH,ie.DB_KEY=t+"_KERNEL_WASM",te=V.APP.WASM[t].LOADER,ne=V.APP.ASM[t].LOADER,oe=V.APP.WASM[t].CACHE_COMPILATION}},{key:"_setupEmsModule",value:function(e){this._kernelContainer={locateFile:function(t){var n=0===e?/RoomleCoreJs[\-a-z0-9]*\.js\.mem/:/ConfiguratorKernelJs[\-a-z0-9]*\.js\.mem/;return t.match(n)?T()+Z:t},wasmBinaryFile:T()+$,preRun:[],postRun:[],setStatus:null,print:function(e){},printErr:function(e){console.error(e)},quit:function(e){console.error(e)}},oe&&ae&&(this._kernelContainer.instantiateWasm=function(e,t){return ie.getCompiledModuleFromIndexedDB($,ee,e,t),{}})}},{key:"_passSubComponentsToKernel",value:function(e,t){var n=e.id,o=t.get(n);if(o)for(var r=0,i=o.length;i>r;r++){var a=o[r],s=a.parentId,c=a.partId;this._kernelInstance.loadedSubComponent(s,c,n,e.configuration)}}},{key:"_fetchSubComponents",value:function(e){var t=this,n=r(e.keys());n.length&&this._rapiAccess.getComponents(n).then(function(n){for(var o=0,r=n.length;r>o;o++)t._passSubComponentsToKernel(n[o],e);t._flushSubComponentsWaiters()})}},{key:"_flushSubComponentsWaiters",value:function(){this._fetchSubComponents(this._subComponentsWaiters),this._subComponentsWaiters=new Map,this._shouldWait=!1}},{key:"isReady",value:function(){this._kernelContainer.setIoContext(this._kernelIo),V.isProduction||V.isUnitTesting||this.addDebugInfo(),window.KernelCallback&&(window.KernelCallback=null,delete window.KernelCallback)}},{key:"addDebugInfo",value:function(){var e=this,t=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=Object.getPrototypeOf(t),i=o?Object.getOwnPropertyNames(o):[],a=t?Object.getOwnPropertyNames(t):[];return o?e(o,r(n).concat(r(a),r(i))):r(a).concat(r(i),r(n))}(this),n=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","valueOf"];r(new Set(t)).forEach(function(t){if("_"!==t[0]&&"function"==typeof e[t]&&-1===n.indexOf(t))try{var o=e[t].bind(e);e[t]=function(){return this._kernelIo.log("[ KernelCommunication ]: "+t),o.apply(void 0,arguments)}}catch(e){}})}},{key:"loadComponent",value:function(e,t,n){var o=this;this._rapiAccess.getComponent(t.componentId).then(function(r){o._kernelInstance.loadComponent(e,r.configuration,t,n),o._flushSubComponentsWaiters()},function(r){o._kernelInstance.loadComponent(e,"error",t,n),o.onLoadComponentError(r),o._flushSubComponentsWaiters()})}},{key:"loadSubComponent",value:function(e,t,n){var o=this;if(this._shouldWait){var r=this._subComponentsWaiters.get(n);r||this._subComponentsWaiters.set(n,[]),(r=this._subComponentsWaiters.get(n)).push({parentId:e,partId:t}),this._subComponentsWaiters.set(n,r)}else this._rapiAccess.getComponent(n).then(function(r){o._kernelInstance.loadedSubComponent(e,t,n,r.configuration)})}}]),e}());H([x],se.prototype,"_rapiAccess",void 0),H([x],se.prototype,"_scriptLoader",void 0),H([x],se.prototype,"_kernelIo",void 0),H([x],se.prototype,"_dataSyncer",void 0);var ce=e("i",function(){function e(){i(this,e),this._materialCache=new Map,this._maxAnisotrophy=1,this._waitingForMaterials=[],this._textureLoader=new THREE.TextureLoader,this._previewMaterial=new THREE.MeshStandardMaterial({color:v,roughness:_,metalness:g})}return a(e,[{key:"generatePreviewBox",value:function(e,t,n,o){var r=new THREE.BoxGeometry(e.x,e.y,e.z),i=new THREE.Color(v);o>0&&(i=M(o));var a=new THREE.MeshStandardMaterial({color:i,opacity:p,transparent:!0}),s=new THREE.Mesh(r,a);return t.y=t.y+e.y/2,s.position.copy(t),s.rotation.y=n,s.castShadow=!1,s.receiveShadow=!1,s}},{key:"_generateGeometry",value:function(e,t,n,o,r){var i;(i=new THREE.Geometry).faceVertexUvs=[],i.faceVertexUvs[0]=[];for(var a=0,s=t.length;s>a;a+=3)i.vertices.push(new THREE.Vector3(t[a]/1e3,t[a+2]/1e3,t[a+1]/-1e3));for(var c=0,u=0,l=n.length;l>u;u+=3){var h=u,d=u+1,f=u+2,v=3*n[h],g=3*n[d],p=3*n[f],_=[new THREE.Vector3(r[v],r[v+2],-1*r[v+1]),new THREE.Vector3(r[g],r[g+2],-1*r[g+1]),new THREE.Vector3(r[p],r[p+2],-1*r[p+1])];i.faces.push(new THREE.Face3(n[h],n[d],n[f],_));var m=2*n[h],y=2*n[d],E=2*n[f];i.faceVertexUvs[0][c]=[],i.faceVertexUvs[0][c][0]=new THREE.Vector2(o[m],o[m+1]),i.faceVertexUvs[0][c][1]=new THREE.Vector2(o[y],o[y+1]),i.faceVertexUvs[0][c][2]=new THREE.Vector2(o[E],o[E+1]),c++}return i}},{key:"changeMaterialOfMesh",value:function(e,t){e?(e.material=t,e.material.needsUpdate=!0):console.warn("could not find mesh with id "+e.id)}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,r=this._materialCache.values()[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=o.value;R(i)}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}this._materialCache.clear(),this._waitingForMaterials=[]}},{key:"maxAnisotrophy",set:function(e){this._maxAnisotrophy=e}}]),e}());H([x],ce.prototype,"_rapiAccess",void 0),H([x],ce.prototype,"_environmentLoader",void 0),H([x],ce.prototype,"_dataSyncer",void 0)}}});
//# sourceMappingURL=chunk-3a998310.legacy.js.map
