System.register(["./chunk-cc24dbb0.legacy.js","./chunk-a2a93eba.legacy.js","./chunk-4be69068.legacy.js"],function(e,t){var n,r,o,i,s,a,h,c,l,u,d,g,p,_,m,f,E,y,w,b,v,T;return{setters:[function(e){n=e.b,r=e.e,o=e.a,i=e.h,s=e.i},function(e){a=e.B,h=e.a,c=e.C,l=e.g,u=e.D,d=e.h,g=e.E,p=e.b,_=e.j,m=e.F,f=e.r,E=e.G,y=e.p,w=e.H,b=e.I},function(e){v=e.a,T=e.b}],execute:function(){e("b",function(){class e extends THREE.Object3D{constructor(e,t,n,r){super(),this._selected=!1,this.meshes=[],this.castShadow=!0,this.receiveShadow=!0,this._setValues(e,t,n,r)}static _generateDashedLine(e,t){let n=new THREE.LineSegments(e,new THREE.LineDashedMaterial({color:"#000000",dashSize:.03,gapSize:.01,linewidth:1}));return n.translateOnAxis(t,1),n}static _generateCubeGeometry(e,t,n){let r=new THREE.Geometry;return r.vertices.push(new THREE.Vector3(-e,-t,-n),new THREE.Vector3(-e,t,-n),new THREE.Vector3(-e,t,-n),new THREE.Vector3(e,t,-n),new THREE.Vector3(e,t,-n),new THREE.Vector3(e,-t,-n),new THREE.Vector3(e,-t,-n),new THREE.Vector3(-e,-t,-n),new THREE.Vector3(-e,-t,n),new THREE.Vector3(-e,t,n),new THREE.Vector3(-e,t,n),new THREE.Vector3(e,t,n),new THREE.Vector3(e,t,n),new THREE.Vector3(e,-t,n),new THREE.Vector3(e,-t,n),new THREE.Vector3(-e,-t,n),new THREE.Vector3(-e,-t,-n),new THREE.Vector3(-e,-t,n),new THREE.Vector3(-e,t,-n),new THREE.Vector3(-e,t,n),new THREE.Vector3(e,t,-n),new THREE.Vector3(e,t,n),new THREE.Vector3(e,-t,-n),new THREE.Vector3(e,-t,n)),r}_setValues(e,t,n,r){e&&(this.roomleId=e),t&&(this.roomlePosition=Object.assign({},t)),n&&(this.roomleRotation=Object.assign({},n)),r&&(this.parentObjectId=r)}get loadingMesh(){return this._loadingMesh}get boundingBoxMesh(){return this._boundingBoxMesh}get boundingBox(){return this._boundingBox}set roomlePosition(e){this._roomlePosition=e,e&&this.position.set(e.x/1e3,e.z/1e3,e.y/-1e3)}get roomlePosition(){return this._roomlePosition}set roomleRotation(e){this._roomleRotation=e,e&&this.rotation.set(e.x,e.z,-e.y)}get roomleRotation(){return this._roomleRotation}addMesh(e,t){e.renderOrder=2,e.userData.meshType=0,e.castShadow=!0,e.receiveShadow=!0,t&&e.applyMatrix(x(t)),this.add(e),this.meshes.push(e)}removeMesh(e){const t=this.meshes.indexOf(e);this.remove(e),a(e),t<0||this.meshes.splice(t,1)}removeAllMeshes(){this.meshes.forEach(e=>{this.remove(e),a(e)}),this.meshes=[],this.remove(this._loadingMesh),a(this._loadingMesh),this._loadingMesh=null,this.remove(this._boundingBoxMesh),a(this._boundingBoxMesh),this._boundingBoxMesh=null}changeMaterialOfMesh(e,t){let n=this.meshes.find(t=>t.id===e);n?(n.material=t,n.material.transparent&&(n.receiveShadow=!1),n.material.needsUpdate=!0):console.warn("could not find mesh with id "+e)}select(){this._selected=!0}loading(){if(!this._kernelBoundingBox)return void console.warn("Bounding box (box for measurements) for component "+this.roomleId+" not set, can not show external mesh loading box!");this.removeAllMeshes();let{x:e,y:t,z:n}=this._kernelBoundingBox.getSize(new THREE.Vector3),r=new THREE.BoxGeometry(e,t,n);this._loadingMesh=new THREE.Mesh(r,new THREE.MeshStandardMaterial({transparent:!0,opacity:d,color:new THREE.Color(l)})),this._loadingMesh.name="loading mesh",this._loadingMesh.receiveShadow=!1,this._loadingMesh.castShadow=!1,this._loadingMesh.layers.set(5),this._loadingMesh.translateOnAxis(this._kernelBoundingBox.getCenter(new THREE.Vector3),1),this._loadingMesh.renderOrder=3,this.add(this._loadingMesh)}deselect(){this._selected=!1}hoverOn(){n("pointer")}hoverOff(){n("default")}removeFromParent(){this.parent&&(this.parent.remove(this),this.removeAllMeshes())}clear(t){this.hoverOff(),t&&this.children.forEach(n=>{n instanceof e&&n.clear(t)})}computeBoundingBox(t,n=!1){this._boundingBoxMesh&&this.remove(this._boundingBoxMesh);let r=null,o=null;if(!t||n){let t=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;this.meshes.forEach(e=>{e.geometry.computeBoundingBox();let r=e.geometry.boundingBox;t=Math.min(t,r.min.x),n=Math.min(n,r.min.y),i=Math.min(i,r.min.z),s=Math.max(s,r.max.x),a=Math.max(a,r.max.y),h=Math.max(h,r.max.z)}),this._boundingBox=new THREE.Box3(new THREE.Vector3(t,n,i),new THREE.Vector3(s,a,h)),this._kernelBoundingBox=this._boundingBox.clone();let c=this._boundingBox.max.x-this._boundingBox.min.x,l=this._boundingBox.max.y-this._boundingBox.min.y,u=this._boundingBox.max.z-this._boundingBox.min.z;r=new THREE.BoxGeometry(c,l,u),o=e._generateCubeGeometry(c/2,l/2,u/2)}else{this._kernelBoundingBox=h(t),this._boundingBox=this._kernelBoundingBox.clone();let{x:n,y:i,z:s}=this._boundingBox.getSize(new THREE.Vector3);r=new THREE.BoxGeometry(n,i,s),o=e._generateCubeGeometry(n/2,i/2,s/2)}this._boundingBoxMesh=new THREE.Mesh(r,new THREE.MeshStandardMaterial({color:"#FFFFFF",transparent:!0,opacity:0,polygonOffset:!0,polygonOffsetFactor:-1})),this._boundingBoxMesh.position.add(this._boundingBox.getCenter(new THREE.Vector3)),this._boundingBoxMesh.layers.set(5),this._boundingBoxMesh.renderOrder=3,this.add(this._boundingBoxMesh),this._dockline=e._generateDashedLine(o,this._boundingBox.getCenter(new THREE.Vector3)),this._dockline.name="dockline",this._dockline.layers.set(5),this._selected&&this.add(this._dockline)}recursiveMeshes(){let t=this.meshes.slice();return this.children.forEach(n=>{n instanceof e&&t.push(...n.recursiveMeshes())}),t}isChild(t){let n=!1;return this.children.forEach(r=>{r instanceof e&&!n&&(n=r.roomleId===t||r.isChild(t))}),n}getKernelPosition(e){let t=this.parent.localToWorld(this.position);return R(e.worldToLocal(t))}}class r extends e{constructor(e,t){super(e,null,null,null),this.glbUrl=t}}class o extends e{constructor(e,t,n,r){super(e,t,n,r),this._stringId=null,this.receivedPointAssociation=!1,this.castShadow=!1,this.receiveShadow=!1}get stringId(){return this._stringId?this._stringId:this.roomleId.toString()}addMesh(e,t){super.addMesh(e,t),e.renderOrder=1,e.castShadow=!1,e.receiveShadow=!1}hoverOn(){this.remove(this._dockline),this.meshes.forEach(({material:e})=>{e.opacity=.9,e.roughness=g,e.metalness=u,e.color=new THREE.Color(l)}),n("pointer")}hoverOff(){this.add(this._dockline),this.meshes.forEach(({material:e})=>{e.opacity=d,e.roughness=g,e.metalness=u,e.color=new THREE.Color(l)}),n("default")}clonePreview(e){let t=new o(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId);return t._stringId=this.roomleId+"_"+e,this.children.forEach(e=>{e instanceof THREE.Mesh&&0===e.userData.meshType&&t.meshes.push(e.clone(!0))}),t.meshes.forEach(e=>{e.material=e.material.clone(),e.geometry=e.geometry.clone(),t.add(e)}),this._dockline&&(t._dockline=this._dockline.clone(!0)),this._boundingBoxMesh&&(t._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(t._boundingBox=this._boundingBox.clone()),t}preparePreview(){this.add(this._dockline),this.add(this._boundingBoxMesh)}}class i extends o{constructor(e,t,n,r,o){super(e,t,n,r),o&&(this._stringId=this.roomleId+"_has_additional_dock_point_copy")}set roomleLineFrom(e){this._roomleLineFrom=e,this.lineFrom=t(e)}get roomleLineFrom(){return this._roomleLineFrom}set roomleLineTo(e){this._roomleLineTo=e,this.lineTo=t(e)}get roomleLineTo(){return this._roomleLineTo}set roomlePositionFrom(e){this._roomlePositionFrom=e,this.positionFrom=t(e)}get roomlePositionFrom(){return this._roomlePositionFrom}set roomlePositionTo(e){this._roomlePositionTo=e,this.positionTo=t(e)}get roomlePositionTo(){return this._roomlePositionTo}addMesh(e,t){super.addMesh(e,t),e.visible=!1,e.renderOrder=3}hoverOn(){this._dockline.visible=!0,n("pointer")}hoverOff(){this._dockline.visible=!1,n("default")}preparePreview(){super.preparePreview(),this._dockline.visible=!1;let e=this.lineTo.clone(),t=this.lineFrom.clone(),n=(new THREE.Vector3).subVectors(e,t),r=new THREE.ArrowHelper(n,t),o=new THREE.CylinderGeometry(.01,.01,n.length(),16,1);this.lineMesh=new THREE.Mesh(o,new THREE.MeshStandardMaterial({color:l,transparent:!0,opacity:c}));const i=(new THREE.Quaternion).setFromEuler(r.rotation);this.lineMesh.quaternion.multiply(i),this.lineMesh.renderOrder=1;let s=(new THREE.Vector3).addVectors(e,t).multiplyScalar(.5);this.lineMesh.position.copy((new THREE.Vector3).subVectors(s,this.position.clone())),this.add(this.lineMesh);let a=this._boundingBox.getCenter(new THREE.Vector3),h=null,u=0,d=Math.abs(n.x),g=Math.abs(n.y),p=Math.abs(n.z);d>=g&&d>=p?(h=new THREE.Vector3(a.x,0,0),u=Math.sqrt(a.y*a.y+a.z*a.z)):g>=d&&g>=p?(h=new THREE.Vector3(0,a.y,0),u=Math.sqrt(a.x*a.x+a.z*a.z)):p>=g&&p>=d&&(h=new THREE.Vector3(0,0,a.z),u=Math.sqrt(a.y*a.y+a.x*a.x));let _=new THREE.CylinderGeometry(1.1*u,1.1*u,(new THREE.Vector3).subVectors(this.positionTo.clone(),this.positionFrom.clone()).length()+h.length(),32,1);this.boundingLineMesh=new THREE.Mesh(_,new THREE.MeshStandardMaterial({color:"#ffffff",transparent:!0,opacity:0}));let m=this.positionTo.clone(),f=this.positionFrom.clone(),E=(new THREE.Vector3).subVectors(m,f),y=new THREE.ArrowHelper(E,f);const w=(new THREE.Quaternion).setFromEuler(y.rotation);this.boundingLineMesh.quaternion.multiply(w),this.boundingLineMesh.renderOrder=3;let b=(new THREE.Vector3).addVectors(this.positionTo.clone(),this.positionFrom.clone()).multiplyScalar(.5).add(a);this.boundingLineMesh.position.copy((new THREE.Vector3).subVectors(b,this.position.clone())),this.add(this.boundingLineMesh)}clonePreviewLine(e){let t=new i(this.roomleId,this.roomlePosition,this.roomleRotation,this.parentObjectId,this.receivedPointAssociation);return t._stringId=this.roomleId+"_"+e,this.children.forEach(e=>{e instanceof THREE.Mesh&&0===e.userData.meshType&&t.meshes.push(e.clone(!0))}),t.meshes.forEach(e=>{e.material=e.material.clone(),e.geometry=e.geometry.clone(),t.add(e)}),this._dockline&&(t._dockline=this._dockline.clone(!0)),this._boundingBoxMesh&&(t._boundingBoxMesh=this._boundingBoxMesh.clone(!0)),this._boundingBox&&(t._boundingBox=this._boundingBox.clone()),t}getPositionForIntersectionPoint(e){let t=this.positionTo.clone().add(this._boundingBox.getCenter(new THREE.Vector3)),n=this.positionFrom.clone().add(this._boundingBox.getCenter(new THREE.Vector3));return new THREE.Line3(n,t).closestPointToPoint(e,!0,new THREE.Vector3).sub(this._boundingBox.getCenter(new THREE.Vector3))}updatePreviewPosition(e){let t=this.getPositionForIntersectionPoint(e),n=this.parent.localToWorld(t);this._newPosition=this.worldToLocal(n),this._dockline.position.copy((new THREE.Vector3).addVectors(this._newPosition,this._boundingBox.getCenter(new THREE.Vector3))),this._dockline.rotation.copy(this.docklineRotation)}hideSelectionLine(){this._dockline.visible=!1}getKernelPosition(e){if(this._newPosition){let t=this.localToWorld(this._newPosition);return R(e.worldToLocal(t))}return super.getKernelPosition(e)}}class s extends THREE.PerspectiveCamera{constructor(e,t,n,r,o){super(e,t,n,r),this.offset=o}set offset(e){this._offset=e,this.updateProjectionMatrix()}get offset(){return this._offset}_calculateProjectionMatrix(){let e,t,n,r,o=this.fov*(2*Math.PI/360)/2;r=-(n=Math.tan(o));let i=Math.atan(this.aspect*Math.tan(o));e=-(t=Math.tan(i));let s=this._offset.left,a=this._offset.right,h=this._offset.top,c=this._offset.bottom,l=new THREE.Vector2(a-s,h-c),u=new THREE.Vector2(s+l.x/2,c+l.y/2);if(l.x<l.y){let o=(1-u.x)/(l.x/2),i=u.x/(l.x/2);t*=o,e*=i;let s=(o+i)/2;n*=s,r*=s}else{let o=(1-u.y)/(l.y/2),i=u.y/(l.y/2);n*=o,r*=i;let s=(i+o)/2;e*=s,t*=s}e*=this.near,t*=this.near,n*=this.near,r*=this.near;let d=this.near*Math.tan(Math.PI/180*.5*this.fov)/this.zoom*2,g=this.aspect*d;return this.view&&this.view.enabled&&(e+=this.view.offsetX*g/this.view.fullWidth,n-=this.view.offsetY*d/this.view.fullHeight,t+=this.view.offsetX*g/this.view.fullWidth,r-=this.view.offsetY*d/this.view.fullHeight),(new THREE.Matrix4).makePerspective(e,t,n,r,this.near,this.far)}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){this._offset?this.projectionMatrix=this._calculateProjectionMatrix():super.updateProjectionMatrix()}}return{create:function(t,n,r,o){return new e(t,n,r,o)},createPreview:function(e,t){return new o(e,{x:0,y:0,z:0},{x:0,y:0,z:0},t)},createStatic:function(e,t){return new r(e,t)},createPreviewLine:function(e){let t=new i(e.id,e.roomlePosition,e.roomleRotation,e.parentObjectId,e.receivedPointAssociation);return e.meshes.forEach(e=>{let n=e.clone();n.material=e.material.clone(),n.geometry=e.geometry.clone(),t.addMesh(n)}),t.computeBoundingBox(),t},isPreview:function(e){return e instanceof o},isPreviewLine:function(e){return e instanceof i},createCamera:function(e,t,n,r,o){return new s(e,t,n,r,o)}}});const t=e("m",function(e){return new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/-1e3)}),R=(e("d",function(e){return new THREE.Euler(e.x,e.z,-e.y)}),e("n",function(e){return new THREE.Vector3(e.x/1e3,e.z/1e3,e.y/1e3)}),function(e){return{x:1e3*e.x,y:-1e3*e.z,z:1e3*e.y}}),M=function(e){return decodeURIComponent(e)},H=e("i",function(e){if(!e){const t=typeof e;return"number"===t||"boolean"===t?e:null}if(!e.hasOwnProperty("size")&&e.size&&"function"==typeof e.size){let t=C(e);for(let e=0;e<t.length;e++)t[e]=H(t[e]);return"string"==typeof t?M(t):t}if("object"==typeof e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=H(e[t]));return"string"==typeof e?M(e):e}),C=function(e){let t=[];if(e){let n=e.size();for(let r=0;r<n;r++)t.push(e.get(r))}return t},x=e("o",function(e){let t=new THREE.Matrix4,n=H(e);return t.fromArray(n),t.transpose(),function(e){let t=new THREE.Matrix4;t.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),t.scale(new THREE.Vector3(.001,.001,.001));let n=new THREE.Matrix4;return n.set(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1),n.scale(new THREE.Vector3(1e3,1e3,1e3)),t.multiply(e).multiply(n)}(t)}),P={isProduction:!0,isUnitTesting:JSON.parse("false"),environment:"production",detailEnvironment:"development",features:{hdEnabledByDefault:JSON.parse("false")},APP:{RAPI:{server:"https://api.roomle.com/v2",liveServer:"https://api.roomle.com/v2",testServer:"https://api.test.roomle.com/v2",headers:{apiKey:"roomle_portal_v2",currentTenant:9,locale:"en",language:"en",device:1,token:"anonymous",platform:"web"},itemHeaders:{assetRevision:"glb",assetFileFormat:"glb"}},WASM:{CONFIGURATOR:{URL:"static/kernel-artifacts/wasm/ConfiguratorKernel.wasm",CACHE_COMPILATION:!0,HASH:"0abcc5a5e66eed7cd7a0e0e7e593749a",LOADER:"static/kernel-artifacts/wasm/ConfiguratorKernel.js"},PLANNER:{URL:"static/kernel-artifacts/wasm/RoomleCore.wasm",CACHE_COMPILATION:!0,HASH:"c02d43488cd26b27cfec5067f5f65abd",LOADER:"static/kernel-artifacts/wasm/RoomleCore.js"}},ASM:{CONFIGURATOR:{MEM_URL:"static/kernel-artifacts/ConfiguratorKernelJs.mem",LOADER:"static/kernel-artifacts/ConfiguratorKernelJs.js"},PLANNER:{MEM_URL:"static/kernel-artifacts/RoomleCoreJs.mem",LOADER:"static/kernel-artifacts/RoomleCoreJs.js"}},SHORTENER_URL:"http://rml.co/"},environments:{PRODUCTION:"production",DEVELOPMENT:"development",TEST:"test",TEST_SERVER:"test_server",ALPHA:"alpha"}};window.IS_DEBUG=!0;const I=P;e("c",I);const S=_(30);e("a",class extends p{constructor(e,t,n,r){super(),this._offset=new THREE.Vector3(0,0,0),this._mode=void 0===r?1:r,this._scene=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._addInputListeners(n),this._planeBottom=new THREE.Plane(new THREE.Vector3(0,1,0)),this._planeFront=new THREE.Plane(new THREE.Vector3(0,0,1)),this._planeSide=new THREE.Plane(new THREE.Vector3(1,0,0))}_addInputListeners(e){e.addEventListener(5,e=>{this._findSelection(e.positionRelative)},this),e.addEventListener(6,e=>{this._findHover(e.positionRelative,e.type)},this),e.addEventListener(0,e=>{this._onDragStart(e.positionRelative)},this),e.addEventListener(1,e=>{this._onDrag(e.positionRelative)},this),e.addEventListener(2,e=>{this._onDragEnd(e.positionRelative)},this)}_findSelection(e){let t=this._intersection(e);t?t&&t.object.dispatchEvent({type:"select"}):this.dispatchEvent(3)}_findHover(e,t){let n=this._intersection(e);!n&&this._currentHover?(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:t}}),this._currentHover=null):n&&(this._currentHover&&this._currentHover.id!==n.object.id&&(this._currentHover.dispatchEvent({type:"hover_off",attachment:{type:t}}),this._currentHover=null),this._currentHover?this._currentHover.dispatchEvent({type:"hover_move",attachment:{intersection:n,type:t}}):(this._currentHover=n.object,this._currentHover.dispatchEvent({type:"hover_on",attachment:{intersection:n,type:t}})))}_intersection(e){let t=this._intersect(e);if(t.length<=0)return null;let n=t[0];return t.length>1&&this._currentHover&&this._currentDrag&&this._currentDrag.id!==this._currentHover.id&&t.forEach(e=>{e.object.id===this._currentHover.id&&e.object.userData.priority===this._currentHover.userData.priority&&n.object.userData.priority<=e.object.userData.priority&&(n=e)}),n}_intersect(e){this._raycaster.setFromCamera(e,this._camera);let t=[];return this._raycaster.intersectObjects(this._scene.children,!0).forEach(e=>{e.object.userData.hasListener&&t.push(e)}),t.length>=0?t.sort((e,t)=>e.object.userData.priority!==t.object.userData.priority?t.object.userData.priority-e.object.userData.priority:e.distance-t.distance):[]}_onDragStart(e){let t=this._intersection(e);if(!t&&!this._currentDrag)return;if(t&&t.object.userData.roomleId===this._rootComponentId)return;!this._currentDrag&&t&&(this._currentDrag=t.object,this._currentDrag.dispatchEvent({type:"drag_start"}));let n=this._currentDrag.parent;n&&n.computeBoundingBox&&(n.computeBoundingBox(),this._calculateOffset(n)),this._positionPlanes(n)}_onDrag(e){if(!this._currentDrag)return;this._raycaster.setFromCamera(e,this._camera);let t,n=new THREE.Vector3(0,0,-5);this._raycaster.ray.intersectPlane(this._planeBottom,n);let r=this._getDistanceToCamera(n),o=this._camera.userData.yaw;if(0===this._mode)this._currentDragOffset||(this._currentDragOffset=n.clone().sub(this._currentDrag.parent.position.clone())),(t=n.clone().sub(this._currentDragOffset)).y=this._currentDrag.parent.position.y;else{let e=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,0,0);this._raycaster.ray.intersectPlane(this._planeFront,e),this._raycaster.ray.intersectPlane(this._planeSide,i);let s=this._getDistanceToCamera(i),a=this._getDistanceToCamera(e);o>=-S&&o<=S?t=r<a?n.clone():e.clone():r<a&&r<s?t=n.clone():a<r&&a<s?t=e.clone():s<r&&s<a&&(t=i.clone()),t.sub(this._offset)}this._currentDrag.dispatchEvent({type:"drag",attachment:{position:t}})}_getDistanceToCamera(e){let t=e.clone().sub(this._camera.position).length();return m(e)&&(t=Number.POSITIVE_INFINITY),t}_onDragEnd(e){this._currentDrag&&(this._currentDrag.dispatchEvent({type:"drag_end",attachment:{position:e}}),this._currentDrag=null,this._currentDragOffset=null)}_positionPlanes(e){0===this._mode?(this._planeBottom.constant=0,this._camera.userData&&this._camera.userData.pitch&&this._camera.userData.pitch<0&&(this._planeBottom.constant=-3)):e&&e.boundingBox&&this._rootComponentPosition&&(this._planeBottom.constant=-e.boundingBox.getCenter(new THREE.Vector3).y-this._rootComponentPosition.y,this._planeSide.constant=2*-e.boundingBox.getSize(new THREE.Vector3).x+e.boundingBox.getCenter(new THREE.Vector3).x,this._camera.userData.yaw>0&&(this._planeSide.constant*=-1),this._bounds&&(this._planeFront.constant=this._bounds.z/2+e.boundingBox.getCenter(new THREE.Vector3).z))}_calculateOffset(e){e&&e.boundingBox&&(this._offset.copy(e.boundingBox.getCenter(new THREE.Vector3)),this._offset.applyQuaternion(e.getWorldQuaternion(new THREE.Quaternion)))}update(e,t,n){if(e&&(this._bounds=e),t&&(this._rootComponentPosition=t),n){this._backgroundScene=n;let e=this._backgroundScene.children[0];e instanceof THREE.Mesh&&e.geometry.computeBoundingBox()}}clear(){this._currentDrag&&a(this._currentDrag),this._currentHover&&a(this._currentHover)}enableDragIn(e){this._currentDrag=e}setRootComponentId(e){this._rootComponentId=e}setCamera(e){this._camera=e}setScene(e){this._scene=e}}),e("f",function(e){return!(!e||"string"!=typeof e||e.split(":").length>2)});const B=e("e",function(e){if(!e||"string"!=typeof e)return null;const t=e.split(":");return t.length<2?null:t[0]}),{APP:O}=I,{RAPI:D}=O,k=D.headers,V=D.itemHeaders,A=k.token,L="live",j=1500,F=e("h","crt"),N=50,U="0",z={GET:"GET",POST:"POST"},W=6e4;let G=new Map,K=new Map,J=new Map,Q=new Map,q=new Map,Y=new Map,X=new Map,Z=new Map;const $="hsc_configurations_offline_queue_v1";let ee=new Map;const te="__rapi_path__";class ne{constructor(){window.addEventListener("online",this._flushOfflineQueue.bind(this))}overrideTenant(e){e&&(this._overrideTenant=e)}setConfiguratorId(e){e&&(this._configuratorId=e)}overrideCountry(e){e&&(this._overrideCountry=e)}overrideRapi(e){e&&(this._overrideRapi=e)}setCustomApiUrl(e){this._customApiUrl=e}getPreloadForItem(e){return this._getPreload(e,!0)}getPreloadForConfiguration(e){return this._getPreload(e,!1)}_getPreload(e,t){return new Promise((n,r)=>{if(!navigator.onLine)return n();if(this._dataSyncer.getIsCatalogSynced(B(e)))return n();if(X.get(e))return n();const o=t?"?itemId=":"?configurationId=";this._get("/preloads/components/"+o+e,"preloads/components").then(t=>{if(X.get(e))return n();t.forEach(e=>{this._prepareData(e,"components")}),X.set(e,!0),n()},r)})}changeUseOfHDGeometry(){const e=Q.get("components");X.clear(),Y.clear(),e&&Q.delete("components")}getHSCPackage(e){return new Promise((t,n)=>{if(Y.get(e))return t();this._get("/catalogs/"+e+"/package","package").then(n=>{if(Y.get(e))return t(n);n.components.forEach(e=>{this._prepareData(e,"components")}),n.materials.forEach(e=>{this._prepareData(e,"materials"),this._prepareGroups(e)}),n.textures.forEach(e=>{this._prepareData(e,"textures")}),Y.set(e,!0),t(n)},n)})}getComponent(e){return this._getById(e,"components")}getConfiguration(e){return this._getById(e,"configurations")}getItem(e){return this._getById(e,"items",{additionalHeaders:V})}getComponents(e){return this._getByIds(e,"components")}getItems(e){return this._getByIds(e,"items",{additionalHeaders:V})}getTag(e){return this._getById(e,"tags")}getTags(e){return this._getByIds(e,"tags")}getTexture(e){return this._getById(e,"textures")}getCatalog(e){return this._getById(e,"catalogs")}getMesh(e,t=F,n=N){return this._getById(e,"meshes",{pathSuffix:"/data?format="+t+"&targetQuality="+n.toString()})}getMeshesOfCatalog(e){return new Promise((t,n)=>{const r=q.get(e);r?t(r):this._get("/meshes?catalog="+e,"catalogMeshes").then(n=>{q.set(e,n),t(n)},n)})}getTexturesOf(e){return this._getRelationData(e,{rapiPath:"textures"})}getItemsOf(e){return this._getRelationData(e,{rapiPath:"items"})}getMaterialsOf(e){return this._getRelationData(e,{rapiPath:"materials"},{embed:["textures"]})}getComponentsOf(e){return this._getRelationData(e,{rapiPath:"components"})}getAdditionalContentsOfItems(e){const t=[],n=[];return e.forEach(e=>{const r=K.get(e.id.toString());r?n.push(...r):t.push(e.id.toString())}),new Promise((e,r)=>{0!==t.length?this._getByIdsPackets(t,"itemAdditionalContents",{filterKey:"itemIds"}).then(t=>{t.forEach(e=>{let t=K.get(e.itemId);t||(t=[]);for(let n=0,r=t.length;n<r;n++)if(t[n].id===e.id)return;t.push(e),K.set(e.itemId,t)}),e([...t,...n])},r):e(n)})}getMaterial(e){return this._getById(e,"materials",{embed:["textures"]})}peekMaterial(e){return this._peekData(e,"materials")}peekComponent(e){return this._peekData(e,"components")}getMaterials(e){return this._getByIds(e,"materials",{embed:["textures"]})}getPlan(e){return this._getById(e,"plans")}cleanUp(){G=new Map,J=new Map,Q=new Map,Y=new Map,X=new Map,Z=new Map,K=new Map}getMaterialsByGroup(e){const t=e.slice(),n=[];let r=t.length;for(let e=0;e<r;e++){const o=G.get(t[e]);if(o){const i=o.length;for(let e=0;e<i;e++){const t=this._getCache("materials").get(o[e]);n.push(t)}t.splice(e,1),r--,e--}}return new Promise((e,r)=>{0!==t.length&&navigator.onLine?this._getByIdsPackets(t,"materials",{filterKey:"groups",embed:["textures"]}).then(t=>{e(this.combineMaterialsToGroups([...t,...n]))},r):e(this.combineMaterialsToGroups(n))})}_flushOfflineQueue(){return new Promise((e,t)=>{const n=this._localStorage.getItem($),r=[];for(let e in n)if(n.hasOwnProperty(e)){const t=n[e];r.push(new Promise((e,n)=>{this.saveConfiguration(t.data).then(r=>{const o=[];t.perspectiveImage&&!r.perspectiveImage&&o.push(this.savePerspectiveImage(r,t.perspectiveImage)),t.topImage&&!r.topImage&&o.push(this.savePerspectiveImage(r,t.topImage)),Promise.all(o).then(e,n)},n)}))}Promise.all(r).then(()=>{this._localStorage.setItem($,{}),e()},t)})}_setQueuedConfiguration(e,t={}){const n=e.configurationHash,{perspectiveImage:r,topImage:o}=t;let i=this._localStorage.getItem($)||{},s=i[n]||{};s.data=e,s.perspectiveImage=r,s.topImage=o,i[n]=s,this._localStorage.setItem($,i)}saveConfiguration(e){return navigator.onLine?this._save("/configurations",{configuration:e},"configurations",{accept:"application/json",contentType:"application/json; charset=UTF-8"}):(e.perspectiveImage=null,e.topImage=null,this._setQueuedConfiguration(e),this._markConfigurationAsLocally(e),Promise.resolve(e))}saveTopImage(e,t){return this._saveConfigurationImage(e,t,"topImage")}savePerspectiveImage(e,t){return this._saveConfigurationImage(e,t,"perspectiveImage")}getShortUrl(e,t){return new Promise((n,r)=>this._fetchJson("/shortIds","shortIds",{method:z.POST,resolve:n,reject:r,data:JSON.stringify({shortId:{type:t,referencedId:e}})}))}_peekData(e,t){const n=Q.get(t);return n&&n.get(e)||null}_saveConfigurationImage(e,t,n){if(!navigator.onLine){const r={};return r[n]=t,this._setQueuedConfiguration(e,r),this._markConfigurationAsLocally(e),e[n]=t.image,Promise.resolve(e)}const r=this._formDataUtil.create(t.image,e.configurationHash,E.PNG,n);return this._save("/configurations/"+e.id+"/"+n,r,"configurations",{accept:"application/json"})}_markConfigurationAsLocally(e){e.isLocally=!0,e.id=e.configurationHash}_save(e,t,n,r={}){const o=t instanceof FormData?t:JSON.stringify(t);return new Promise((t,i)=>{const s={method:z.POST,data:o,resolve:t,reject:i};r.contentType&&(s.contentType=r.contentType),r.accept&&(s.accept=r.accept),this._fetchJson(e,n,s)})}combineMaterialsToGroups(e){const t=new Map,n={id:null,label:null,materials:[]};for(let r=0,o=e.length;r<o;r++){const o=e[r],i=o.group,s=o.id,a=[];let h=i?G.get(i):a;h||(G.set(i,[]),h=G.get(i)),-1===h.indexOf(s.toString())&&h.push(s.toString());let c=i?t.get(i):n;c||(t.set(i,{id:i,label:o.groupLabel,materials:[]}),c=t.get(i)),c.materials.push(o)}const r=n.materials.length?[n]:[];return t.forEach((e,t)=>{r.push({id:t,label:e.label,materials:e.materials})}),r}_getByIds(e,t,n={}){const r=this._getCache(t),o=this._getErrorCache(t),i=[],s=e.slice();let a=s.length;if(r&&r.size){const e=(new Date).getTime();for(let t=0;t<a;t++){const n=s[t],h=r.get(n),c=o.get(n);let l=!1;null!=h?(i.push(h),l=!0):l=void 0!==c&&(e-c.timestamp<W||!1===navigator.onLine),l&&(s.splice(t,1),a--,t--)}}return new Promise((e,r)=>{0!==s.length&&navigator.onLine?this._getByIdsPackets(s,t,n).then(t=>{e([...t,...i])},r):e(i)})}_getByIdsPackets(e,t,n={}){const r=n.filterKey||"ids";let o,i="/"+t+"/",s="?",a=[];const h=e.length;if(!h)return new Promise(e=>e([]));let c=!0,l=[];for(o=0;o<h;o++){c=!1;const n=e[o],h=s+r+"[]="+n,u=h.length+i.length;l.push(n),s="&",u<=j?i+=h:(u>j&&(l.pop(),o--),a.push({url:i,ids:l}),c=!0,i="/"+t+"/",s="?",l=[])}c||a.push({url:i,ids:l});const u=[];return a.forEach(e=>u.push(this._getByIdsSingle(e.ids,e.url,t,n))),new Promise((e,t)=>{Promise.all(u).then(t=>{const n=[];t.length&&t.forEach(e=>n.push(...e)),e(n)},t)})}_getByIdsSingle(e,t,n,r={}){return new Promise((o,i)=>{this._get(t,n,r).then(t=>{for(let n=0,r=t.length;n<r;n++){const r=e.indexOf(t[n].id.toString());-1!==r&&e.splice(r,1)}const r=e.length;if(r){const t=this._getCache(n),o=this._getErrorCache(n),i=(new Date).getTime();for(let n=0;n<r;n++)o.set(e[n],{code:0,timestamp:i}),t.delete(e[n]);this._errorHandler.dispatch(2,[n,e.map(e=>'"'+e+'"').join(",")])}o(t)},i)})}_getById(e,t,n={}){const r=this._getCache(t).get(e);if(r)return new Promise(e=>e(r));if(!navigator.onLine)return Promise.reject("Nothing cached but tried to fetch in offline mode");const o=Object.assign({},n,{id:e}),i=n.pathSuffix||"";return this._get("/"+t+"/"+e+i,t,o)}_get(e,t,n={}){const r=f.useHDGeometry?"includeGeometryHD=true":"";let o=-1===e.indexOf("?")?"?":"&";return""!==r&&(e+=o+r),n.embed&&Array.isArray(n.embed)&&n.embed.forEach(t=>{e+=o+"embed"+(t[0].toUpperCase()+t.substr(1))+"=true",o="&"}),new Promise((r,o)=>{const i=Z.get(e);Array.isArray(i)&&i.length>0?i.push({resolve:r,reject:o}):(Z.set(e,[{resolve:r,reject:o}]),this._fetchJson(e,t,n))})}_fetchJson(e,t,n={}){const o={method:n.method?n.method:z.GET,headers:this._createHeaders(n),mode:"cors",cache:"default"};n.data&&(o.body=n.data);let i=D.server;const s=this._overrideRapi;s&&(i=s===L?D.liveServer:D.testServer),this._customApiUrl&&(i=this._customApiUrl);const a=new Request(i+e,o);this._networkLayer.fetch(a).then(r.bind(this)).then(this._handleJson(e,t,n).bind(this)).catch(this._handleError(e,n).bind(this))}_createHeaders(e={}){const t=Object.assign({},k);this._overrideTenant&&(t.currentTenant=this._overrideTenant),this._overrideCountry&&(t.country=this._overrideCountry);const{locale:n}=window.__RML__ENV__.initData;t.language=n,t.locale=n;const{contentType:r,accept:o,additionalHeaders:i,data:s}=e;if(r&&(t["content-type"]=e.contentType),o&&(t.accept=e.accept),i)for(let e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);this._configuratorId&&(t.configurator=this._configuratorId),t.token="03-"+window.btoa((new Date).toISOString()+";"+A+";"+k.apiKey);const a=new Headers(t);return s instanceof FormData&&a.delete("content-type"),a}_handleJson(e,t,n={}){return r=>{let o=null,i=null;"number"==typeof r&&(o=r);for(let e in r)"meta"!==e&&r.hasOwnProperty(e)&&(o=r[e],i=e);if("error"===i)return this._handleError(e,n)(new Error(JSON.stringify(o)));if(!o)throw new TypeError("RAPI returned empty JSON");if(Array.isArray(o))for(let e=0,r=o.length;e<r;e++)this._prepareData(o[e],t,n),this._prepareEmbeddedData(o[e],t,n);else this._prepareData(o,t,n),this._prepareEmbeddedData(o,t,n);n.resolve?n.resolve(o):this._notifyWaiters(e,null,o)}}_prepareEmbeddedData(e,t,n={}){n.embed&&Array.isArray(n.embed)&&n.embed.forEach(r=>{const o=e[r.slice(0,-1)+"Objects"];if(Array.isArray(o)){for(let e=0,t=o.length;e<t;e++)this._prepareData(o[e],r,n);this._prepareRelationalData(t,r,e.id,o)}else o&&(this._prepareData(o,r,n),this._prepareRelationalData(t,r,e.id,[o]))})}_getCache(e){return this._getCacheFrom(e,Q)}_getErrorCache(e){return this._getCacheFrom(e,ee)}_getCacheFrom(e,t){let n=t.get(e);return n||(t.set(e,new Map),n=t.get(e)),n}_setCache(e,t,n){n.set(e.toString(),t)}_prepareData(e,t,n=null){let r=this._getCache(t);if(e.id||n&&n.id||"tenants/me"===t)if("tenants/me"!==t){{const t=e.id?e.id:n.id;this._setCache(t,e,r)}e[te]=t}else this._setCache(U,e,r);else"shortIds"!==t&&console.error("Can not cache because there is no ID!")}_getRelationsCacheFor(e,t,n){let r=J.get(t);if(!r){const o=new Map,i=new Map;i.set(n,void 0),o.set(e,i),J.set(t,o),r=J.get(t)}let o=r.get(e);if(!o){const t=new Map;t.set(n,void 0),r.set(e,t),o=r.get(e)}return o.get(n)}_prepareGroups(e){const t=e.group,n=e.id;let r=G.get(t);r||(G.set(t,[]),r=G.get(t)),-1===r.indexOf(n.toString())&&r.push(n.toString())}_handleError(e,t={}){return n=>{navigator.onLine?(n.rmlErrorCode=1,this._errorHandler.dispatch(1,[n])):(n.rmlErrorCode=0,this._errorHandler.dispatch(0,[n])),t.reject?t.reject(n):this._notifyWaiters(e,n,null)}}_getRelationData(e,t,n={}){const r=e.id,o=e[te],i=t.rapiPath;let s=this._getCache(i),a=this._getRelationsCacheFor(r.toString(),o,i),h=[];return a?(a.forEach(e=>h.push(s.get(e))),new Promise(e=>e(h))):navigator.onLine?new Promise((e,t)=>{this._get("/"+o+"/"+r+"/"+i,i,n).then(t=>{this._prepareRelationalData(o,i,r,t),e(t)},t)}):Promise.resolve([])}_prepareRelationalData(e,t,n,r){J.has(e)||J.set(e,new Map);let o=J.get(e);const i=n.toString();o.has(i)||o.set(i,new Map);let s=o.get(i),a=this._getCache(t),h=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],n=t.id.toString();h.push(n),a.set(n,t)}s.set(t,h)}_notifyWaiters(e,t,n){const r=Z.get(e);if(r&&r.length){for(let e=0,o=r.length;e<o;e++)t?r[e].reject(t):r[e].resolve(n);Z.delete(e)}}_tenantMe(){return new Promise((e,t)=>{const n=this._getCache("tenants/me"),r=this._overrideTenant?this._overrideTenant:n.get(U);if(r)return e(r);this._fetchJson("/tenants/me","tenants/me",{resolve:t=>e(t),reject:t})})}getCurrentSkin(){return this._tenantMe().then(e=>this._getById(e.toString(),"tenants").then(e=>this._getById(e.skin.toString(),"skins")))}}e("l",ne),v([T],ne.prototype,"_formDataUtil",void 0),v([T],ne.prototype,"_errorHandler",void 0),v([T],ne.prototype,"_dataSyncer",void 0),v([T],ne.prototype,"_networkLayer",void 0),v([T],ne.prototype,"_localStorage",void 0);const re=(e,t,n)=>{const r="function"==typeof WebAssembly.instantiateStreaming;y.addMeta("kernel_is_ready",{cachedInIndexedDB:!1});let i=null;r?(y.start("kernel_stream_compile"),i=WebAssembly.instantiateStreaming(fetch(o()+e),t),y.end("kernel_stream_compile")):(y.start("kernel_legacy_compile"),i=fetch(o()+e).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,t))),y.addMeta("kernel_is_ready",{instantiateStreaming:r}),i.then(e=>{y.end(r?"kernel_stream_compile":"kernel_legacy_compile"),n(e.instance)},e=>console.error(e))};let oe,ie,se,ae,he;const ce=!(null!=navigator.userAgent.match(/iPad|iPhone|iPod/i)||!window.WebAssembly);class le{constructor(e,t){this._subComponentsWaiters=new Map,this._shouldWait=!0,this._creator_=e,this._setupKernelPaths(t),this._setupEmsModule(t),this._useWASM=ce,this._kernelPath=ce?se:ae,window.KernelCallback={isReady:this.isReady.bind(this)},this._lifeCycleManager.addEventListener(this)}_utilityToLongArray(e){const t=new this._kernelContainer.LongArray;return e.forEach(e=>t.push_back(e)),t}get kernelContainer(){return this._kernelContainer}_setupKernelPaths(e){const t=0===e?"PLANNER":"CONFIGURATOR";oe=I.APP.ASM[t].MEM_URL,ie=I.APP.WASM[t].URL,se=I.APP.WASM[t].LOADER,ae=I.APP.ASM[t].LOADER,he=I.APP.WASM[t].CACHE_COMPILATION}_setupEmsModule(e){this._kernelContainer={locateFile(t){const n=0===e?/RoomleCoreJs[\-a-z0-9]*\.js\.mem/:/ConfiguratorKernelJs[\-a-z0-9]*\.js\.mem/;return t.match(n)?o()+oe:t},wasmBinaryFile:o()+ie,preRun:[],postRun:[],setStatus:null,print(e){},printErr(e){console.error(e)},quit(e){console.error(e)}},he&&ce&&(this._kernelContainer.instantiateWasm=function(e,t){return re(ie,e,t),{}})}_passSubComponentsToKernel(e,t){const n=e.id,r=t.get(n);if(r)for(let t=0,o=r.length;t<o;t++){const{parentId:o,partId:i}=r[t];this._kernelInstance.loadedSubComponent(o,i,n,e.configuration)}}_fetchSubComponents(e){let t=[...e.keys()];t.length&&this._rapiAccess.getComponents(t).then(t=>{for(let n=0,r=t.length;n<r;n++)this._passSubComponentsToKernel(t[n],e);this._flushSubComponentsWaiters()})}_flushSubComponentsWaiters(){this._fetchSubComponents(this._subComponentsWaiters),this._subComponentsWaiters=new Map,this._shouldWait=!1}isReady(){this._kernelContainer.setExternalHelpers(this._kernelIo,{convertCObject:H}),I.isProduction||I.isUnitTesting||this.addDebugInfo(),window.KernelCallback&&(window.KernelCallback=null,delete window.KernelCallback)}addDebugInfo(){const e=function(t,n=[]){const r=Object.getPrototypeOf(t),o=r?Object.getOwnPropertyNames(r):[],i=t?Object.getOwnPropertyNames(t):[];return r?e(r,[...n,...i,...o]):[...i,...o,...n]},t=e(this),n=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","valueOf"];[...new Set(t)].forEach(e=>{if("_"!==e[0]&&"function"==typeof this[e]&&-1===n.indexOf(e))try{const t=this[e].bind(this);this[e]=function(...n){return this._kernelIo.log("[ KernelCommunication ]: "+e),t(...n)}}catch(e){}})}loadComponent(e,t,n){this._rapiAccess.getComponent(t.componentId).then(r=>{this._kernelInstance.loadComponent(e,r.configuration,t,n),this._flushSubComponentsWaiters()},r=>{this._kernelInstance.loadComponent(e,"error",t,n),this.onLoadComponentError(r),this._flushSubComponentsWaiters()})}loadSubComponent(e,t,n){if(this._shouldWait){let r=this._subComponentsWaiters.get(n);r||this._subComponentsWaiters.set(n,[]),(r=this._subComponentsWaiters.get(n)).push({parentId:e,partId:t}),this._subComponentsWaiters.set(n,r)}else this._rapiAccess.getComponent(n).then(r=>{this._kernelInstance.loadedSubComponent(e,t,n,r.configuration)})}cleanUpCallbacks(){this._kernelContainer.unregisterConfiguratorCallback(this)}registerCallbacks(){this._kernelContainer.registerConfiguratorCallback(this)}pause(){this.cleanUpCallbacks()}resume(){this.cleanUpCallbacks(),this.registerCallbacks()}destroy(){}}e("g",le),v([T],le.prototype,"_rapiAccess",void 0),v([T],le.prototype,"_scriptLoader",void 0),v([T],le.prototype,"_kernelIo",void 0),v([T],le.prototype,"_dataSyncer",void 0),v([T],le.prototype,"_lifeCycleManager",void 0);class ue{constructor(e){this._maxAnisotrophy=1,this._textureLoader=new THREE.TextureLoader,this._creator_=e,this._previewMaterial=new THREE.MeshStandardMaterial({color:l,roughness:g,metalness:u})}_generateGeometry(e,t,n,r,o){let i;if(e&&this._cacheHolder.geometryCache.has(e))i=this._cacheHolder.geometryCache.get(e);else{(i=new THREE.Geometry).faceVertexUvs=[],i.faceVertexUvs[0]=[];for(let e=0,n=t.length;e<n;e+=3)i.vertices.push(new THREE.Vector3(t[e]/1e3,t[e+2]/1e3,t[e+1]/-1e3));let s=0,a=0,h=0,c=0,l=0,u=0,d=0,g=0,p=0,_=0,m=[];for(let e=0,t=n.length;e<t;e+=3)h=e+1,c=e+2,l=3*n[a=e],u=3*n[h],d=3*n[c],m=[new THREE.Vector3(o[l],o[l+2],-1*o[l+1]),new THREE.Vector3(o[u],o[u+2],-1*o[u+1]),new THREE.Vector3(o[d],o[d+2],-1*o[d+1])],i.faces.push(new THREE.Face3(n[a],n[h],n[c],m)),g=2*n[a],p=2*n[h],_=2*n[c],i.faceVertexUvs[0][s]=[],i.faceVertexUvs[0][s][0]=new THREE.Vector2(r[g],r[g+1]),i.faceVertexUvs[0][s][1]=new THREE.Vector2(r[p],r[p+1]),i.faceVertexUvs[0][s][2]=new THREE.Vector2(r[_],r[_+1]),s++;e&&this._cacheHolder.geometryCache.set(e,i)}return i}changeMaterialOfMesh(e,t){e?(e.material=t,e.material.transparent&&(e.receiveShadow=!1),e.material.needsUpdate=!0):console.warn("could not find mesh with id "+e.id)}_createMaterial(e,t,n){this._cacheHolder.materialCache.has(e)?t():this._rapiAccess.getMaterial(e).then(n=>{let r=b(n,this._environmentLoader.getEnvironmentMap());this._rapiAccess.getTexturesOf(n).then(n=>{let o=[];n.forEach(e=>{o.push(w(this._dataSyncer.requestAsset(e.image,!0),e,r,this._maxAnisotrophy,1/(0===e.mmWidth?1:e.mmWidth),1/(0===e.mmHeight?1:e.mmHeight)))}),Promise.all(o).then(()=>{this._cacheHolder.materialCache.set(e,r),t()})}),(!n.textures||n.textures&&0===n.textures.length)&&(this._cacheHolder.materialCache.set(e,r),t())},n)}_loadMaterial(e){return new Promise((t,n)=>{this._singlePromiseFactory.create(6,e,(t,n)=>this._createMaterial(e,t,n)).then(()=>{setTimeout(()=>t(this._cacheHolder.materialCache.get(e)),0)},n)})}_assignMaterial(e,t){return new Promise((n,r)=>{this._loadMaterial(t).then(t=>{this.changeMaterialOfMesh(e,t),n()},r)})}set maxAnisotrophy(e){this._maxAnisotrophy=e}clear(){this._cacheHolder.clear()}}e("j",ue),v([T],ue.prototype,"_rapiAccess",void 0),v([T],ue.prototype,"_environmentLoader",void 0),v([T],ue.prototype,"_dataSyncer",void 0),v([T],ue.prototype,"_singlePromiseFactory",void 0),v([T],ue.prototype,"_cacheHolder",void 0);const de="on",ge="_isMute";class pe{constructor(){return this._isMute=!1,s(this,ge,{enumerable:!1,writable:!1}),s(pe.prototype,"_setMute",{enumerable:!1,writable:!1}),s(pe.prototype,"mute",{enumerable:!1,writable:!1}),s(pe.prototype,"unmute",{enumerable:!1,writable:!1}),new Proxy(this,this)}_setMute(e){i(this,ge,!0),this._isMute=e,i(this,ge,!1)}mute(){this._setMute(!0)}unmute(){this._setMute(!1)}get(e,t){return this._isMute&&"function"==typeof this[t]&&t.substr(0,2)===de?()=>void 0:this[t]}}e("k",pe)}}});
//# sourceMappingURL=chunk-954e23ee.legacy.js.map
