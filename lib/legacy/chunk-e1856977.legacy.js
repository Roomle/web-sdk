System.register(["./chunk-4c9a4d80.legacy.js","./chunk-1415f7c3.legacy.js","./chunk-eb2e1ffb.legacy.js"],function(e,t){var n,i,a,o,r,s,d,c,h,_,u,l,m,p,f;return{setters:[function(e){n=e.a,i=e.b,a=e.c,o=e.d,r=e.g,s=e.e},function(e){d=e.w,c=e.l,h=e.U,_=e.J,u=e.g,l=e.r,m=e.m},function(e){p=e.a,f=e.b}],execute:function(){var v=2,g=e("b",function(e){function t(e,i){var r;return n(this,t),(r=a(this,o(t).call(this,e,i)))._scale=1,r._state=0,r._lastPosition=new THREE.Vector2,r._zoomSpeed=Math.pow(.95,v),r._cameraZoom=1,r._initCamera(i||new THREE.Vector3(0,10,0)),r}return s(t,d),i(t,[{key:"_getCamera",value:function(){return this._camera?this._camera:(this._initCamera(new THREE.Vector3(0,10,0)),this._camera)}},{key:"_initCamera",value:function(e){var t=this._domHelper.getClientDimensions(),n=t.x/t.y*20;this._camera=new THREE.OrthographicCamera(n/-2,n/2,10,-10,1,1e3),this._camera.position.copy(e),this._cameraPosition=e,this._camera.lookAt(new THREE.Vector3(0,0,0))}},{key:"updateCamera",value:function(){this._camera.updateProjectionMatrix()}},{key:"_initInputListener",value:function(){var e=this;this._inputListeners.push({key:3,fun:function(t){e._state=1,e._lastPosition.set(t.position.x,t.position.y),e.dispatchEvent(0)}}),this._inputListeners.push({key:6,fun:function(t){1===e._state&&(e._move(new THREE.Vector2(t.position.x,t.position.y)),e.dispatchEvent(1))}}),this._inputListeners.push({key:4,fun:function(t){1===e._state&&e.dispatchEvent(2),e._state=0,e._orbitPosition=null}}),this._inputListeners.push({key:7,fun:function(t){e._scale*=e._zoomSpeed,e._update()}}),this._inputListeners.push({key:8,fun:function(t){e._scale/=e._zoomSpeed,e._update()}})}},{key:"_move",value:function(e){var t=new THREE.Vector2;t.subVectors(this._lastPosition,e),t.divideScalar(100),this._cameraPosition.x+=t.x,this._cameraPosition.z+=t.y,this._lastPosition.copy(e)}},{key:"updateToBounds",value:function(e,t){var n=this._domHelper.getClientDimensions(),i=n.x/n.y,a=Math.max(e.x,e.z),o=a*i;this._camera.left=o/-2,this._camera.right=o/2,this._camera.top=a/2,this._camera.bottom=a/-2,this._camera.zoom=1,this._camera.position.set(t.x,10,t.z),this._cameraPosition.copy(this._camera.position)}},{key:"_update",value:function(e){this._scale=Math.min(this._scale,5),this._scale=Math.max(this._scale,.5),this._cameraZoom=this._scale,this._camera.updateProjectionMatrix()}},{key:"animateCamera",value:function(e){return!(!r(o(t.prototype),"animateCamera",this).call(this,e)&&this._cameraZoom===this._camera.zoom||(this._camera.zoom=this._cameraZoom,0))}}]),t}()),E=null,w=null,y=e("a",function(){function e(t,i,a,o){var r=this;n(this,e),this._clock=new THREE.Clock,this._delta=0,this._devicePixelRatio=1,this._stopRendering=!1,this._forceRender=!1,this._lastChange=Date.now(),this._running=!1,this._devicePixelRatio=window.devicePixelRatio&&window.__RML__ENV__.initData.retina?window.devicePixelRatio:1,this.createCameraControl(a),this._addCameraControlListener(),this._setupScene(i,t,o);var s=function(){r._requestRender(!0)};this._getInputManager().addEventListener(7,s,this),this._getInputManager().addEventListener(8,s,this)}return i(e,[{key:"onBeforeRender",value:function(){}},{key:"_changeCameraControl",value:function(e){this._cameraControl&&this._cameraControl.cleanUp(),this._cameraControl=e,this.cameraControlChanged()}},{key:"cameraControlChanged",value:function(){}},{key:"_addCameraControlListener",value:function(){this._cameraControl.addEventListener(0,this._requestRender,this),this._cameraControl.addEventListener(1,this._requestRender,this),this._cameraControl.addEventListener(2,this._requestRender,this),this._cameraControl.addEventListener(6,this._requestRender,this)}},{key:"_requestRender",value:function(e){var t=this;this._renderer&&(this._pixotron&&(this._pixotron.needsUpdate=!0,e&&(this._forceRender=!0)),this._lastChange=Date.now(),this._running||this._stopRendering||(this._running=!0,requestAnimationFrame(function e(){t._delta=t._clock.getDelta(),t._animateCamera(),t._cameraControl.getCamera().layers.mask=65535,t._renderLoopFunction&&(t._renderLoopFunction(),t._renderLoopFunction=null),t.onBeforeRender(),t._statsHelper&&t._statsHelper.update(t._renderer.info),t._pixotron?(t._forceRender&&(t._pixotron.autoShadowsClear=!0,t._pixotron.autoSAOClear=!0),t._pixotron.render(t._renderer,t._scene,t._cameraControl.getCamera()),t._forceRender=!1):(t._renderer.clear(),t._renderer.render(t._scene,t._cameraControl.getCamera()),t._renderer.clearDepth()),window.TWEEN&&TWEEN.update(),t._lastChange+3e3<Date.now()||t._stopRendering?t._running=!1:(t._running=!0,requestAnimationFrame(e))})))}},{key:"_animateCamera",value:function(){this._cameraControl&&(this._cameraControl.animateCamera(this._delta)||!this._pixotron||this._forceRender?this._pixotron&&(this._pixotron.needsUpdate=!0):(this._pixotron.autoShadowsClear=!1,this._pixotron.autoSAOClear=!1))}},{key:"_setupScene",value:function(e,t,n){var i=this._domHelper.getClientDimensions();this._width=i.x,this._height=i.y,this._scene=new THREE.Scene,(n=n||!1)||(this._scene.background=new THREE.Color(m().DEFAULT_BACKGROUND)),this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:n}),this._renderer.setPixelRatio(this._devicePixelRatio),this._renderer.setSize(this._width,this._height),this._renderer.gammaOutput=!0,this._renderer.gammaInput=!0,this._renderer.autoClear=!1,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=THREE.BasicShadowMap,this._renderer.domElement.classList.add(e),this._domHelper.element.appendChild(this._renderer.domElement),this._getInputManager().addEvents(this._renderer.domElement),this._requestRender(),E=this._onWindowResize.bind(this),window.addEventListener("resize",E,!1),w=this._onKeyDown.bind(this),window.addEventListener("keydown",w,!1),document.addEventListener("visibilitychange",this._tabVisible.bind(this))}},{key:"_tabVisible",value:function(e){this._requestRender(!0)}},{key:"updateCamera",value:function(){var e=this._domHelper.getClientDimensions(),t=e.x,n=e.y;if(this._renderer.setSize(t,n),this._pixotron){this._pixotron.autoShadowsClear=!0,this._pixotron.autoSAOClear=!0,this._forceRender=!0;try{this._pixotron.setSize(t,n)}catch(e){console.warn(e)}}this._cameraControl.updateCamera(),this._requestRender(!0)}},{key:"_onWindowResize",value:function(){this.updateCamera(),this._pixotron&&this._pixotron.setSize(this._renderer.getSize().width,this._renderer.getSize().height),this._requestRender(!0)}},{key:"_isPartOfScene",value:function(e){return"Object3D"===e.type||"Mesh"===e.type||"GLB"===e.type||"Group"===e.type}},{key:"cleanUp",value:function(){window.removeEventListener("resize",E,!1),window.removeEventListener("keydown",w,!1)}},{key:"clearScene",value:function(){var e=this,t=[];this._scene.children.forEach(function(n){e._isPartOfScene(n)&&t.push(n)}),t.forEach(function(t){h(t),e._scene.remove(t)}),this._renderer.renderLists.dispose()}},{key:"enableHD",value:function(){var e={saoparams:{intensity:.25,occlusionWorldRadius:.4,smoothTransition:!0,samplesPerFrame:4,bias:.016,numSamples:200},shadowparams:{shadowMapResolution:1024,shadowRadius:3,shadowQuality:1,smoothTransition:!0,enableAccumulation:!0,shadowBiasMultiplier:.6,nearPlane:.1,farPlane:50,fov:110,side:THREE.FrontSide,numSamples:100}};this._pixotron=new window.PIXOTRON.Pixotron(e),this._requestRender()}},{key:"_loadGLTF",value:function(e,t,n,i,a){var o=this;return this._gltfLoader||(this._gltfLoader=new THREE.GLTFLoader),new Promise(function(r,s){o._gltfLoader.parse(e,null,function(e){if(e&&e.scene&&e.scene.children&&e.scene.children.length>0){if(t&&e.scene.position.copy(t),n&&(e.scene.rotation.y=n),i&&e.scene.scale.copy(i),e.scene.type="GLB",e.scene.traverse(function(e){if(e instanceof THREE.Mesh){if(e.material instanceof THREE.MeshStandardMaterial){var t=e.material;t.envMap=o._environmentLoader.getEnvironmentMap(),t.needsUpdate=!0,a&&a>0&&(t.color=_(a))}e.receiveShadow=!0,e.castShadow=!0}}),!t&&!n&&!i){var s=o._calculateBoundingBoxOfAllMeshes(e.scene.children);if(o._cameraControl instanceof c){var d=o._domHelper.getClientDimensions(),h=d.x,u=d.y;o._cameraControl.updateAndReset(s.getSize(new THREE.Vector3),h,u,s.getCenter(new THREE.Vector3),-15,70,5,!1)}o._cameraControl instanceof g&&o._cameraControl.updateToBounds(s.getSize(new THREE.Vector3),s.getCenter(new THREE.Vector3)),o.updateCamera()}l.end("loadingTime"),r(e.scene)}},function(e){},function(e){s(e)})})}},{key:"_calculateBoundingBoxOfAllMeshes",value:function(e){var t=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.forEach(function(e){e.geometry.computeBoundingBox();var s=e.geometry.boundingBox.clone();s.translate(e.getWorldPosition(new THREE.Vector3)),t=Math.min(t,s.min.x),n=Math.min(n,s.min.y),i=Math.min(i,s.min.z),a=Math.max(a,s.max.x),o=Math.max(o,s.max.y),r=Math.max(r,s.max.z)}),new THREE.Box3(new THREE.Vector3(t,n,i),new THREE.Vector3(a,o,r))}},{key:"_loadGLB",value:function(e,t,n,i,a){var o=this;return this._gltfLoader||(this._gltfLoader=new THREE.GLTFLoader),new Promise(function(r,s){o._gltfLoader.load(e,function(e){e&&e.scene&&e.scene.children&&e.scene.children.length>0&&(t&&e.scene.position.copy(t),n&&(e.scene.rotation.y=n),i&&e.scene.scale.copy(i),e.scene.type="GLB",e.scene.traverse(function(e){if(e instanceof THREE.Mesh){if(e.material instanceof THREE.MeshStandardMaterial){var t=e.material;t.envMap=o._environmentLoader.getEnvironmentMap(),a&&a>0&&(t.color=new THREE.Color(a)),t.needsUpdate=!0}e.castShadow=!0}}),t||n||i||(e.scene.children[0].geometry.computeBoundingBox(),o._cameraControl instanceof c&&o._cameraControl.updateToBounds(e.scene.children[0].geometry.boundingBox.getSize(),window.innerWidth,window.innerHeight,!1),o.updateCamera()),r(e.scene))},function(e){},function(e){s(e)})})}},{key:"showGUI",value:function(){var e=this,t=document.createElement("style");t.innerText=".dg.ac {right:auto!important}",document.head.appendChild(t),this._scriptLoader.fetch("static/three/dat.gui.min.js",{id:"dat-gui-js"}).then(function(){return e._guiLoaded()},function(e){return console.error(e)})}},{key:"_guiLoaded",value:function(){this._lightSetting&&this._lightSetting.showGUI();var e=u();if(this._pixotron){var t=e.addFolder("Renderer");t.add(this._pixotron.getSAOPass(),"enabled"),t.add(this._pixotron.getSAOPass(),"smoothTransition"),t.add(this._pixotron.getSAOPass(),"occlusionWorldRadius").min(0).max(2).step(.01),t.add(this._pixotron.getSAOPass(),"intensity").min(.1).max(2).step(.05),t.add(this._pixotron.getSAOPass(),"bias").min(-.1).max(.1).step(.001),t.add(this._pixotron.getSAOPass(),"numSamples").min(10).max(3e3).step(10),t.add(this._pixotron.getShadowPass(),"enabled"),t.add(this._pixotron.getShadowPass(),"smoothTransition"),t.add(this._pixotron.getShadowPass(),"enableAccumulation"),t.add(this._pixotron.getShadowPass(),"shadowRadius").min(0).max(5).step(.1),t.add(this._pixotron.getShadowPass(),"shadowBiasMultiplier").min(0).max(3).step(.1),t.add(this._pixotron.getShadowPass(),"numSamples").min(10).max(3e3).step(10)}this._addGUIListener(e)}},{key:"_addGUIListener",value:function(e){var t=this,n=e.__folders;Object.keys(n).forEach(function(e,i){var a=n[e];a.__folders&&Object.keys(a.__folders).forEach(function(e,i){var a=n[e];t._addGUIListener(a)}),a.__controllers&&a.__controllers.forEach(function(e){e.onFinishChange(function(){t._requestRender()})})})}},{key:"showStats",value:function(){var e=this;t.import("./stats-helper.legacy.js").then(function(t){return e._statsHelper=new t.default})}},{key:"_onKeyDown",value:function(e){}}]),e}());p([f],y.prototype,"_domHelper",void 0),p([f],y.prototype,"_environmentLoader",void 0),p([f],y.prototype,"_scriptLoader",void 0)}}});
//# sourceMappingURL=chunk-e1856977.legacy.js.map
