System.register(["./chunk-4c9a4d80.legacy.js","./chunk-eb2e1ffb.legacy.js"],function(t,e){var n,i,a,s,o,r,h,u,c,l;return{setters:[function(t){n=t.a,i=t.b,a=t.c,s=t.d,o=t.e,r=t.g,h=t.i,u=t.j},function(t){c=t.a,l=t.b}],execute:function(){var e=t("t",function(){function t(){n(this,t)}return i(t,null,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.locale,i=e.kernelInstance,a=e.kernelContainer,s=e.planObjectId;t.kernelInstance=i,t.kernelContainer=a,t.planObjectId=s,t.actualLocale=n||function(){var t=window.navigator,e=["language","browserLanguage","userLanguage","systemLanguage"];if(Array.isArray(t.languages)&&t.languages.length>0)return t.languages[0].substr(0,2);for(var n=0,i=e.length;n<i;n++){var a=t[e[n]];if(a)return a.substr(0,2)}return"en"}()}}]),t}());e.actualLocale="en",e.useHDGeometry=!1,e.kernelInstance=null,e.kernelContainer=null,e.planObjectId=null;var _,d={PRIMARY:"#db0000",ON_PRIMARY:"#ffffff",DEFAULT_BACKGROUND:"#f9fafc",SELECTION:"#ffffff"},f=(t("c",function(t){document.body.style.cursor=t}),t("h",function(t){var e=t.headers.get("content-type");if(e&&e.includes("application/json"))return t.json();throw new TypeError("No JSON returned")}),t("m",function(){return window.__RML__ENV__?window.__RML__ENV__.initData.colors:d}),t("a",function(){return window.__RML__ENV__&&window.__RML__ENV__.assetPath?window.__RML__ENV__.assetPath:""})),p=(i(function t(){n(this,t)},[{key:"_setupCommonGlobals",value:function(){window.__RML__DEBUG__||(window.__RML__DEBUG__={}),window.__RML__ENV__||(window.__RML__ENV__={},window.__RML__ENV__.assetPath||(window.__RML__ENV__.assetPath=""));var t={retina:!1,overrideCountry:null,locale:e.actualLocale,unit:null,unitStringType:null,dls:null,ls:null,meshSelection:!0,colors:d,enableHSC:!1,mode:"3D",stats:!1};window.__RML__ENV__.initData?window.__RML__ENV__.initData=Object.assign(t,window.__RML__ENV__.initData):window.__RML__ENV__.initData=t;var n=function(t){t||(t=window.location.href);var e=t.split("?");if(2!==e.length)return{};var n=e[1].split("&"),i={};return n.forEach(function(t){var e,n,a=t.split("="),s=a[1];"true"===s&&(s=!0),"false"===s&&(s=!1),n=e=s,!Number.isNaN(n)&&!isNaN(n)&&Number.isFinite(parseFloat(e))&&(s=parseFloat(s)),i[a[0]]=s}),i}();window.__RML__ENV__.initData=Object.assign(window.__RML__ENV__.initData,n)}},{key:"_setupCommonDependencies",value:function(){}},{key:"_cleanUpCommonGlobals",value:function(){for(var t in window.__RML__DEBUG__&&(window.__RML__DEBUG__.Kernel&&window.__RML__DEBUG__.Kernel.clearAll&&window.__RML__DEBUG__.Kernel.clearAll(),delete window.__RML__DEBUG__),delete window.__RML__ENV__,window.THREE)if(window.THREE.hasOwnProperty(t))try{delete window.THREE[t]}catch(t){console.error(t)}window.THREE=void 0}},{key:"_cleanUpCommonDependencies",value:function(){}},{key:"boot",value:function(t){this._setupCommonGlobals(),this.setupGlobals(t),this._setupCommonDependencies(),this.setupDependencies(),this.bootFinished()}},{key:"lookup",value:function(t){return window.__RML__DI__.lookup(t)}},{key:"teardown",value:function(){this.cleanUpDependencies(),this._cleanUpCommonDependencies(),this.cleanUpGlobals(),this._cleanUpCommonGlobals(),window.__RML__DI__&&delete window.__RML__DI__}},{key:"resetDom",value:function(){this.lookup("dom-helper").reset()}}]),t("p",{HSC:"rml-hsc",HSP:"rml-hsp",GLB:"rml-glb"}),i(function t(){n(this,t)},[{key:"setDomElement",value:function(t){var e=this;if(!this._container){this._container=document.createElement("div");var n="rml-threejs-canvas-container";this._container.classList.add(n),this._container.style.position="relative",this._container.style.width="100%",this._container.style.height="100%";var i=document.createElement("style");i.innerText="."+n+" canvas{position:absolute;top:0;left:0;right:0;bottom:0;}."+n+" .foreground{z-index:100; opacity:1;}."+n+" .background{z-index:-1; opacity:0;}",this._container.appendChild(i),t.appendChild(this._container)}this._element=this._container,this._setClientDimensions(t),this._resizeListener=function(){return e._setClientDimensions(t)},window.addEventListener("resize",this._resizeListener)}},{key:"_setClientDimensions",value:function(t){var e=t.clientWidth,n=t.clientHeight;this._width=e,this._height=n}},{key:"getClientDimensions",value:function(){return new THREE.Vector2(this._width,this._height)}},{key:"cleanUp",value:function(){if(this._element){var t=this._element.cloneNode();this._element.parentElement.replaceChild(t,this._element)}}},{key:"_removeDomElement",value:function(t){if(t){var e=t.parentElement;e&&e.removeChild(t)}}},{key:"reset",value:function(){this.cleanUp(),this._removeDomElement(this._element),this._element=null,this._removeDomElement(this._canvas),this._canvas=null,this._removeDomElement(this._container),this._container=null,window.removeEventListener("resize",this._resizeListener)}},{key:"element",get:function(){return this._element}},{key:"canvas",get:function(){return this._canvas},set:function(t){this._canvas=t}}]),t("d",function(){function t(){n(this,t),this._listeners={}}return i(t,[{key:"_addEventListener",value:function(t,e,n){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push({callback:e,scope:n})}},{key:"addEventListener",value:function(t,e,n){this._addEventListener(t,e,n)}},{key:"dispatchEvent",value:function(t,e){if(this._listeners[t])for(var n=this._listeners[t],i=n.length,a=0;a<i;a++){var s=n[a];s.callback.apply(s.scope,[e])}}},{key:"removeEventListener",value:function(t,e){var n=this._listeners[t];if(n)for(var i=0,a=n.length;i<a;i++)if(n[i].callback===e)return void n.splice(i,1)}}]),t}())),v=t("q",function(t){return t*(Math.PI/180)}),g=function(t,e,n,i,a,s){var o=Math.tan(i*(2*Math.PI/360)/2),r=n/2,h=e/2/o+r,u=t/2/(a/s)/o+r;return Math.max(h,u)},m=function(t){return Math.round(1e3*t)/1e3},y=(t("O",function(t,e){return Math.abs(t.y-e.y)+Math.abs(t.x-e.x)}),t("o",.6),t("E",.4),t("n","#DDDDDD"),t("G",1),t("F",.5),t("e",function(t,e,n,i){if(!t||!e||0===n||0===i)return new THREE.Vector3;var a=t.clone(),s=n/2,o=i/2;return a.project(e),a.x=a.x*s+s,a.y=-a.y*o+o,a.z=0,a}),t("b",function(t,e){e||(e=new THREE.Vector3(0,0,0));var n=new THREE.Vector3(t.size.x/1e3,t.size.z/1e3,t.size.y/1e3),i=new THREE.Vector3(t.origin.x/1e3,t.origin.z/1e3,t.origin.y/-1e3),a=new THREE.Vector3(0,0,-n.z).add(i).sub(e),s=new THREE.Vector3(n.x,n.y,0).add(i).add(e);return new THREE.Box3(a,s)}),t("i",function t(e,n,i){e.castShadow=i,e.receiveShadow=n,e.children.forEach(function(e){t(e,n,i)})}),t("M",function(t,e){var n=m(t.x),i=m(t.y),a=m(t.z),s=m(e.x),o=m(e.y),r=m(e.z);return n===s&&i===o&&a===r})),w=(t("N",function(t,e){var n=m(t.w),i=m(t.x),a=m(t.y),s=m(t.z),o=m(e.w),r=m(e.x),h=m(e.y),u=m(e.z);return n===o&&i===r&&a===h&&s===u}),t("L",function(t,e){var n=m(t.x),i=m(t.y),a=m(e.x),s=m(e.y);return n===a&&i===s})),E=(t("k",function(t,e){var n=new THREE.MeshPhysicalMaterial({metalness:t.shading.metallic,reflectivity:t.shading.specularity||.5,roughness:t.shading.roughness||.5,color:"rgb("+Math.round(100*t.shading.basecolor.r)+"%, "+Math.round(100*t.shading.basecolor.g)+"%, "+Math.round(100*t.shading.basecolor.b)+"%)",transparent:t.shading.alpha<1,opacity:t.shading.alpha,depthWrite:t.shading.alpha>=1});return e&&(n.envMap=e),n}),t("j",function(t,e,n,i,a,s){return new Promise(function(o,r){(new THREE.TextureLoader).load(t,function(t){t.anisotropy=i,t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(a,s),"XYZ"===e.mapping?n.normalMap=t:n.map=t,"RGBA"===e.mapping&&(n.transparent=!0,n.alphaTest=.5),o()},r)})}),t("g",function(){return window.__RML_GUI__||(window.__RML_GUI__=new dat.GUI),window.__RML_GUI__}),t("T",function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.getWorldDirection(new THREE.Vector3),a=Math.abs(i.y);a<.5&&!e.transparent&&E(e,!0,n),a>.5&&e.transparent&&E(e,!1,n)}),t("S",function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t.userData.tween)if(e)if(t.transparent=!0,n){var i={opacity:1};t.userData.tween=!0,new TWEEN.Tween(i).to({opacity:.2},400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(function(){t.opacity=i.opacity}).onComplete(function(){t.userData.tween=!1}).start()}else t.opacity=.2;else if(n){var a={opacity:.2};t.userData.tween=!0,new TWEEN.Tween(a).to({opacity:1},400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(function(){t.opacity=a.opacity}).onComplete(function(){t.transparent=!1,t.userData.tween=!1}).start()}else t.opacity=1,t.transparent=!1})),k=(t("J",function(t){var e=new THREE.Color;return e.setRGB((t>>16)/255,(t>>8&255)/255,(t>>0&255)/255),e}),t("Q",function(t){t.traverse(function(t){if(t instanceof THREE.Mesh){var e=t.material;if(0===e.opacity)return;var n={opacity:0,transparent:!0},i={opacity:e.opacity,transparent:e.transparent};e.transparent=n.transparent,e.opacity=n.opacity,new TWEEN.Tween(n).to(i,500).easing(TWEEN.Easing.Linear.None).onUpdate(function(){e.opacity=n.opacity}).onComplete(function(){e.transparent=i.transparent}).start()}})}),t("R",function(t,e){t.traverse(function(n){if(n instanceof THREE.Mesh){var i=n.material;if(0===i.opacity)return;var a={opacity:i.opacity,transparent:i.transparent},s={opacity:0,transparent:!0};i.transparent=!0,i.opacity=a.opacity,new TWEEN.Tween(a).to(s,500).easing(TWEEN.Easing.Linear.None).onUpdate(function(){i.opacity=a.opacity}).onComplete(function(){i.transparent=s.transparent,e&&e.remove(t)}).start()}})}),t("P",function(t,e){var n=(new THREE.Box3).setFromObject(t),i=n.getSize(new THREE.Vector3),a=Math.min(i.x,i.y,i.z),s=!0;return a>5&&(console.warn("GLB seems to be too big ("+a+")",e),s=!1),n.min.y<-.01&&(console.warn("GLB seems to be under the floor ("+n.min.y+"): ",e),s=!1),s}),t("U",function(t){"Mesh"===t.type?T(t):k(t)}),function(t){t&&t.children&&0!==t.children.length&&t.children.forEach(function(t){T(t)})}),T=t("D",function(t){t&&(t.material&&P(t.material),t.geometry&&t.geometry.dispose())}),P=t("I",function(t){t&&(t.map&&t.map.dispose(),t.normalMap&&t.normalMap.dispose(),t.dispose())}),R=(t("V",function(){return _||((_=new THREE.MeshBasicMaterial).visible=!1),_}),-1),M=t("w",function(t){function e(t,i){var o;n(this,e),(o=a(this,s(e).call(this)))._tweenEnd=null,o._pitch=v(10),o._yaw=v(-15),o._distance=R,o._locked=!1,o._inputListeners=[],o._inputManager=t,o._initInputListener(),o._addInputListeners(),o._cameraPosition=new THREE.Vector3,o._targetPosition=new THREE.Vector3,i?o._cameraPosition.copy(i):o._cameraPosition=new THREE.Vector3(0,.5,3);var r=o._domHelper.getClientDimensions();return o._width=r.x,o._height=r.y,o}return o(e,p),i(e,[{key:"getCamera",value:function(){return this._getCamera()}},{key:"_addInputListeners",value:function(){var t=this;this._inputListeners.forEach(function(e){t._inputManager.addEventListener(e.key,e.fun,t)})}},{key:"_removeInputListeners",value:function(){var t=this;this._inputListeners.forEach(function(e){t._inputManager.removeEventListener(e.key,e.fun)}),this._inputListeners=[]}},{key:"cleanUp",value:function(){this._removeInputListeners()}},{key:"animateCamera",value:function(t){var e=this._cameraPosition;if(!e||y(e,this.getCamera().position))return!1;var n=this.getCamera().position.clone(),i=Math.min(10*t,1);return n.lerp(e,i),this.getCamera().position.copy(n),!0}},{key:"_areEqual",value:function(t,e){return t.yaw.toFixed(5)===e.yaw.toFixed(5)&&t.pitch.toFixed(5)===e.pitch.toFixed(5)&&t.distance.toFixed(5)===e.distance.toFixed(5)&&t.targetX===e.targetX&&t.targetY===e.targetY&&t.targetZ===e.targetZ}},{key:"_tweenCameraParameter",value:function(t,e,n){var i=this;return new Promise(function(n){if(e.yaw-t.yaw<=-Math.PI?t.yaw-=2*Math.PI:e.yaw-t.yaw>=Math.PI&&(t.yaw+=2*Math.PI),window.TWEEN){if(null!==i._tweenEnd&&i._tweenEnd.blockOtherTweens)return;i._tweenEnd=e,new TWEEN.Tween(t).to(e,400).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(function(){i._yaw=t.yaw,i._pitch=t.pitch,i._distance=t.distance,i._update(new THREE.Vector3(t.targetX,t.targetY,t.targetZ))}).onComplete(function(){i._tweenEnd=null,n()}).start()}})}},{key:"_getCurrentCameraParameters",value:function(){var t=this._targetPosition.clone();return{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:t.x,targetY:t.y,targetZ:t.z}}},{key:"_rotateHorizontal",value:function(t){this._yaw-=t,this._yaw<-Math.PI?this._yaw+=2*Math.PI:this._yaw>Math.PI&&(this._yaw-=2*Math.PI)}},{key:"_rotateVertical",value:function(t){this._pitch+=t,this._pitch<-Math.PI?this._pitch+=2*Math.PI:this._pitch>Math.PI&&(this._pitch-=2*Math.PI)}},{key:"saveState",value:function(t){if(t||!this._stateSaved){var e=this._yaw,n=this._pitch,i=this._distance,a=this._targetPosition.clone();if(this._stateSaved={yaw:e,pitch:n,distance:i,targetX:a.x,targetY:a.y,targetZ:a.z,blockOtherTweens:!0},this._getCamera().fov){var s=this._getCamera();this._stateSaved.fov=s.fov,this._stateSaved.near=s.near,this._stateSaved.far=s.far}return this._stateSaved}return null}},{key:"resetToState",value:function(){if(this._stateSaved){var t=this._targetPosition.clone();this._tweenCameraParameter({yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:t.x,targetY:t.y,targetZ:t.z},this._stateSaved,!0)}this._stateSaved=null}},{key:"setToState",value:function(t,e){this._tweenCameraParameter(t,e,!0)}},{key:"hasSavedState",value:function(){return null!=this._stateSaved}},{key:"lock",value:function(){this._locked=!0}},{key:"unlock",value:function(){this._locked=!1}},{key:"getTargetPosition",value:function(){return this._targetPosition}}]),e}());c([l],M.prototype,"_domHelper",void 0);var x=function t(e,i){n(this,t),this.minZoom=!1,this.maxZoom=!1,this.minZoom=e,this.maxZoom=i},b=4,C=(function(t){function e(t,i,o,r){var h;return n(this,e),(h=a(this,s(e).call(this,t,o)))._bounds=new THREE.Vector3,h._scale=1,h._state=0,h._zoomSpeed=Math.pow(.95,b),h.minDistance=0,h.maxDistance=5,h.minPolarAngle=v(0),h.maxPolarAngle=v(85),h.minAzimuthAngle=Number.NEGATIVE_INFINITY,h.maxAzimuthAngle=Number.POSITIVE_INFINITY,h._currentZoomHash="",r?h._camera=r:h._initCamera(),h._domElement=i,h._targetPosition=new THREE.Vector3(0,0,0),h}o(e,M),i(e,[{key:"_getCamera",value:function(){return this._camera?this._camera:(this._initCamera(),this._camera)}},{key:"_initCamera",value:function(){this._camera=new THREE.PerspectiveCamera,this._camera.fov=30,this._camera.aspect=this._width/this._height,this._camera.near=.1,this._camera.far=100,this._camera.updateProjectionMatrix(),this._camera.layers.set(3),this._camera.layers.enable(1),this._camera.layers.enable(2),this._camera.layers.enable(5),this._camera.layers.enable(4)}},{key:"updateCamera",value:function(){var t=this._domHelper.getClientDimensions(),e=t.x,n=t.y;this._camera.aspect=e/n,this._camera.updateProjectionMatrix()}},{key:"animateCamera",value:function(t){if(!r(s(e.prototype),"animateCamera",this).call(this,t))return!1;var n=this._targetPosition;return!!n&&(this.getCamera().lookAt(n),!0)}},{key:"_initInputListener",value:function(){var t=this;this._inputListeners.push({key:3,fun:function(e){t._state=1}}),this._inputListeners.push({key:6,fun:function(e){1!==t._state||t._locked||t._move(new THREE.Vector2(e.position.x,e.position.y))}}),this._inputListeners.push({key:4,fun:function(e){1===t._state&&t.dispatchEvent(2),t._state=0,t._orbitPosition=null}}),this._inputListeners.push({key:7,fun:function(e){return t.zoomIn()}}),this._inputListeners.push({key:8,fun:function(e){return t.zoomOut()}})}},{key:"_move",value:function(t){this._orbitPosition||(this._orbitPosition=new THREE.Vector2(t.x,t.y),this.dispatchEvent(0));var e=t.clone().sub(this._orbitPosition),n=this._domElement instanceof Document?this._domElement.body:this._domElement;this._rotateHorizontal(2*Math.PI*e.x/n.clientWidth*1),this._rotateVertical(2*Math.PI*e.y/n.clientHeight*1),w(this._orbitPosition,t)||this.dispatchEvent(1),this._orbitPosition.copy(t),this._update()}},{key:"setBounds",value:function(t){var e=new THREE.Vector3(-t.x/2,0,-t.z/2),n=new THREE.Vector3(t.x/2,t.y,t.z/2);this._boundingBox=new THREE.Box3(e,n)}},{key:"updateToBounds",value:function(t,e,n,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5?arguments[5]:void 0,o=new THREE.Vector3(-t.x/2,0,-t.z/2),r=new THREE.Vector3(t.x/2,t.y,t.z/2);if(this._boundingBox=new THREE.Box3(o,r),this._targetPosition=s?s.clone():new THREE.Vector3(0,t.y/2,0),this._distance===R){var h=this._setDistanceAndRangesBasedOnBounds(t,e,n);this._distance=Math.max(4,h),this._update()}else a&&(this._setDistanceAndRangesBasedOnBounds(t,e,n),this._tweenCameraParameter(this._getCurrentCameraParameters(),{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:this._targetPosition.x,targetY:this._targetPosition.y,targetZ:this._targetPosition.z},i))}},{key:"_setDistanceAndRangesBasedOnBounds",value:function(t,e,n){this._bounds.copy(t),this.minDistance=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);var i=1.1*g(t.x,t.y,t.z,this._camera.fov,e,n);return this._distance<i&&(this._distance=i),this.maxDistance=1.5*i,this.maxDistance=Math.min(this.maxDistance,i+6),this.maxDistance<4&&(this.maxDistance=4),this._camera.far=5*this.maxDistance,i}},{key:"reset",value:function(t,e,n,i,a,s){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(t){i?this._targetPosition.copy(i):this._targetPosition=new THREE.Vector3(0,t.y/2,0);var r=this._getCurrentCameraParameters();a||(a=-15),s||(s=10),this._pitch=v(s),this._yaw=v(a),this._setDistanceAndRangesBasedOnBounds(t,e,n);var h=this._targetPosition.clone();this._areEqual(r,{yaw:this._yaw,pitch:this._pitch,distance:this._distance,targetX:h.x,targetY:h.y,targetZ:h.z})?this._moveCameraForthAndBack():o?this._tweenCameraParameter(r,{yaw:this._yaw,pitch:this._pitch,distance:this.maxDistance,targetX:h.x,targetY:h.y,targetZ:h.z},!0):this._update(this._targetPosition)}else console.warn("you cant reset without bounds!")}},{key:"updateAndReset",value:function(t,e,n,i,a,s,o){var r=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],h=new THREE.Vector3(-t.x/2,0,-t.z/2),u=new THREE.Vector3(t.x/2,t.y,t.z/2);if(this._boundingBox=new THREE.Box3(h,u),o&&t.addScalar(o),i?this._targetPosition.copy(i):this._targetPosition=new THREE.Vector3(0,t.y/2,0),this._distance===R){var c=this._setDistanceAndRangesBasedOnBounds(t,e,n);this._distance=Math.max(4,c)}var l=this._getCurrentCameraParameters();a||(a=-15),s||(s=10),this._pitch=v(s),this._yaw=v(a),this._setDistanceAndRangesBasedOnBounds(t,e,n);var _=this._targetPosition.clone();r?this._tweenCameraParameter(l,{yaw:this._yaw,pitch:this._pitch,distance:this.maxDistance,targetX:_.x,targetY:_.y,targetZ:_.z},!0):this._update(this._targetPosition)}},{key:"_moveCameraForthAndBack",value:function(){var t=this;if(window.TWEEN){var e={value:.6*this._camera.far},n={value:this._distance};new TWEEN.Tween(e).to(n,300).easing(TWEEN.Easing.Sinusoidal.In).onUpdate(function(){t._distance=e.value,t._update()}).start()}}},{key:"_restoreFromState",value:function(t){this._yaw=t.yaw,this._pitch=t.pitch,this._distance=t.distance,this._targetPosition.copy(new THREE.Vector3(t.targetX,t.targetY,t.targetZ)),this._simulateUpdate()}},{key:"simulateTo2D",value:function(t,e){var n=this;return new Promise(function(i){var a=Math.max(t.x,t.z),s=g(a,a,a,n._camera.fov,window.innerWidth,window.innerHeight),o=n._getCurrentCameraParameters();n._camera.near=1,n._camera.far=s+50,n._camera.updateProjectionMatrix();var r={yaw:0,pitch:v(90),distance:s,targetX:e.x,targetY:s,targetZ:e.z};if(window.TWEEN){if(null!==n._tweenEnd&&n._tweenEnd.blockOtherTweens)return;n._tweenEnd=r,new TWEEN.Tween(o).to(r,500).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){n._yaw=o.yaw,n._pitch=o.pitch,n._distance=o.distance,n._targetPosition.copy(new THREE.Vector3(o.targetX,0,o.targetZ)),n._simulateUpdate()}).onComplete(function(){n._tweenEnd=null,i()}).start()}})}},{key:"simulateTo3D",value:function(t,e){var n=this;return new Promise(function(i){if(n._restoreFromState(t),window.TWEEN){if(null!==n._tweenEnd&&n._tweenEnd.blockOtherTweens)return;n._tweenEnd=e,new TWEEN.Tween(t).to(e,500).easing(TWEEN.Easing.Linear.None).onUpdate(function(){n._yaw=t.yaw,n._pitch=t.pitch,n._distance=t.distance,n._targetPosition.copy(new THREE.Vector3(t.targetX,t.targetY,t.targetZ)),n._simulateUpdate()}).onComplete(function(){n._tweenEnd=null,i()}).start()}})}},{key:"simulateToFirstPerson",value:function(t){var e=this;return new Promise(function(n){if(window.TWEEN){var i=e.getCamera().position,a={x:i.x,y:i.y,z:i.z,yaw:e._yaw,pitch:e._pitch},s={x:t.x,y:t.y,z:t.z,yaw:0,pitch:0};new TWEEN.Tween(a).to(s,500).easing(TWEEN.Easing.Linear.None).onUpdate(function(){e._yaw=a.yaw,e._pitch=a.pitch,e._targetPosition.copy(new THREE.Vector3(a.x,a.y,a.z)),e._simulateUpdate()}).onComplete(function(){e._tweenEnd=null,n()}).start()}})}},{key:"_update",value:function(t){this._yaw=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this._yaw)),this._pitch=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._pitch)),this._saveYawAndPitch();var e=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX"),n=(new THREE.Quaternion).setFromEuler(e),i=new THREE.Vector3(0,0,-1);i.applyQuaternion(n),this._distance*=this._scale,this._distance=Math.min(this.maxDistance,this._distance),t&&this._targetPosition.copy(t);var a=this._targetPosition.clone().sub(i.multiplyScalar(this._distance)),s=this._getCameraSphere(a);null!=this._boundingBox&&this._boundingBox.intersectsSphere(s)&&this._scale>=1?this._distance+=.1:null==this._boundingBox||this._boundingBox.intersectsSphere(s)?this._zoomChanged(!1,!0):(this._cameraPosition.copy(a),this._distance===this.maxDistance?this._zoomChanged(!0,!1):this._zoomChanged(!1,!1)),this._scale=1}},{key:"_zoomChanged",value:function(t,e){var n=t+""+e;0!==this._currentZoomHash.length&&this._currentZoomHash===n||(this.dispatchEvent(5,new x(t,e)),this._currentZoomHash=n)}},{key:"_simulateUpdate",value:function(){var t=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX"),e=(new THREE.Quaternion).setFromEuler(t),n=new THREE.Vector3(0,0,-1);n.applyQuaternion(e),this._cameraPosition.copy(this._targetPosition.clone().sub(n.multiplyScalar(this._distance)))}},{key:"zoomTo",value:function(t,e,n,i,a,s){return this._tweenCameraParameter(this._getCurrentCameraParameters(),{yaw:i,pitch:a,distance:2.725*g(t.x,t.y,t.z,this._camera.fov,e,n),targetX:s.x,targetY:s.y,targetZ:s.z,blockOtherTweens:!0},!0)}},{key:"_getCameraSphere",value:function(t){return new THREE.Sphere(t,.1)}},{key:"_saveYawAndPitch",value:function(){this._camera.userData.yaw=this._yaw,this._camera.userData.pitch=this._pitch}},{key:"zoomIn",value:function(t){this._scale*=t?Math.pow(.95,t):this._zoomSpeed,this._update(),this.dispatchEvent(3)}},{key:"zoomOut",value:function(t){this._scale/=t?Math.pow(.95,t):this._zoomSpeed,this._update(),this.dispatchEvent(4)}}])}(),t("f",function t(e,i){n(this,t),this._scene=e,i&&i.removeFromScene()}),new Map),D=t("r",function(){function t(){n(this,t)}return i(t,null,[{key:"start",value:function(t){if(!window.performance||!window.performance.getEntriesByName)return"";var e=window.performance.getEntriesByName(t).length++,n="";e<100&&(n="0"),e<10&&(n="0"+n);var i=e>0?t+"_"+n+e:t,a=i+"_start";return window.performance.mark(a),i}},{key:"addMeta",value:function(e,n){var i=t.getMeta(e);C.set(e,Object.assign(i,n))}},{key:"getMeta",value:function(t){return C.get(t)||{}}},{key:"end",value:function(t){}},{key:"getMeasure",value:function(t){return[]}},{key:"showBenchmarks",value:function(t){var e=window.performance.getEntriesByType("measure");e.sort(function(t,e){return t.startTime-e.startTime});for(var n=[],i=0,a=e.length;i<a;i++){var s=e[i];t&&-1===s.name.indexOf(t)||n.push({Start:parseFloat(s.startTime.toFixed(2)),Name:s.name,Duration:parseFloat(s.duration.toFixed(2))})}console.table(n)}}]),t}()),L=t("s",function(){function t(){n(this,t)}return i(t,[{key:"parse",value:function(t){var e=JSON.parse(t);return e.lights?this.load(e):[]}},{key:"load",value:function(t){var e=this,n=[];return t.lights.forEach(function(t){var i;switch(t.type){case"ambient":i=e._parseAmbientLight(t);break;case"rectarea":i=e._parseRectAreaLight(t);break;case"spot":i=e._parseSpotLight(t)}i&&n.push(i)}),n}},{key:"_parseAmbientLight",value:function(t){var e=new THREE.AmbientLight;return this._parseCommon(e,t),e}},{key:"_parseRectAreaLight",value:function(t){var e=new THREE.RectAreaLight;this._parseCommon(e,t);var n=t.intensity,i=t.castShadow,a=t.target,s=t.width,o=t.height;return e.width=s||.8,e.height=o||.8,e.castShadow=i||!1,e.matrixAutoUpdate=!0,e.intensity=(n||240)/((s||.8)*(o||.8)),e.lookAt(a?new THREE.Vector3(a.x,a.y,a.z):new THREE.Vector3(0,0,0)),e}},{key:"_parseSpotLight",value:function(t){var e=new THREE.SpotLight;this._parseCommon(e,t);var n=t.angle,i=t.penumbra,a=t.target,s=t.castShadow;return e.angle=(n||100)*Math.PI/180,e.penumbra=i||.5,e.lookAt(a?new THREE.Vector3(a.x,a.y,a.z):new THREE.Vector3(0,0,0)),e.shadow.camera.near=.1,e.shadow.camera.far=10,e.shadow.mapSize=new THREE.Vector2(1024,1024),e.castShadow=s||!1,e}},{key:"_parseCommon",value:function(t,e){var n=e.name,i=e.intensity,a=e.color,s=e.position,o=e.movesWithCamera;t.name=n||"",t.intensity=i||1,t.color=new THREE.Color(a||"#ffffff"),t.position.copy(s?new THREE.Vector3(s.x,s.y,s.z):new THREE.Vector3(0,0,0)),t.visible=!0,t.layers.set(1),t.userData.movesWithCamera=o}}],[{key:"createDynamicLightSettingSource",value:function(t,e){var n={};if(t)n.url=t;else if(e)switch(e){case"shelf":n.url=f()+"static/predefined_lightsettings/shelf.json";break;case"sofa":n.url=f()+"static/predefined_lightsettings/sofa.json";break;default:n=null}else n=null;return n}}]),t}()),H={},S={};i(function t(){n(this,t)},[{key:"fetch",value:function(t,e){return new Promise(function(n,i){!function(t,e,n,i){if(-1===t.indexOf("http")&&(t=f()+t),H[t])return n();if(e.id&&S[e.id])return i('There is already a script with ID "'+e.id+'"');var a=D.start("load_"+e.id.replace(/-/g,"_")),s=document.createElement("script");s.async=!1,s.src=t,s.id=e.id,s.onload=function(){H[t]=!0,S[e.id]=!0,D.end(a),Object.defineProperty(n,"name",{value:"resolve-"+e.id}),n()},s.onerror=function(t){i(t)},document.body.appendChild(s)}(t,e,n,i)})}},{key:"cleanUp",value:function(){for(var t in S)if(S.hasOwnProperty(t)){var e=document.getElementById(t);e&&e.parentElement.removeChild(e)}H={},S={}}}]);var A=t("H",{JPG:".jpg",JPEG:".jpeg",PNG:".png",GIF:".gif"}),I=function(){function t(){n(this,t)}return i(t,[{key:"_base64toBlob",value:function(t,e){e=e||"";for(var n=atob(t),i=n.length,a=Math.ceil(i/1024),s=new Array(a),o=0;o<a;++o){for(var r=1024*o,h=Math.min(r+1024,i),u=new Array(h-r),c=r,l=0;c<h;++l,++c)u[l]=n[c].charCodeAt(0);s[o]=new Uint8Array(u)}return new Blob(s,{type:e})}},{key:"_createFormData",value:function(t,e,n,i){var a=new FormData;-1!==t.indexOf(",")&&(t=t.substr(t.indexOf(",")+1));var s=-1===Object.keys(A).map(function(t){return A[t]}).indexOf(n)?"application":"image",o=this._base64toBlob(t,s+"/"+n.substr(1));return a.append(i,o,e+n),a}},{key:"create",value:function(t,e,n,i){return this._createFormData(t,e,n,i)}}]),t}(),N=t("y",function(){function t(){n(this,t)}return i(t,[{key:"info",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.warn.apply(console,e)}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.warn.apply(console,e)}}]),t}()),V=new Map,z=new Map,W=new Map,B=new Map,O=new Map,j=0,U=t("z",function(){function t(){n(this,t),this._bootCallbacks=[],this._isStarted=!1,this._isStarting=!1}return i(t,[{key:"start",value:function(t){var e=this;return this._eventHandler.dispatch(79),this._startWorker().then(function(){return e._handleCatalog(t)}).then(function(){var t=window.__RML__ENV__.initData,n=t.typeChangeTag,i=t.floorMaterialsTag;Promise.all([e._syncFloorTag(i),e._syncTypeChangeTag(n)]).then(function(){B.set(n,!0),e._eventHandler.dispatch(80)})})}},{key:"syncCatalog",value:function(t){var e=this;return this._startWorker().then(function(){return e._handleCatalog(t)})}},{key:"syncFloorTag",value:function(t){var e=this;return this._startWorker().then(function(){return e._syncFloorTag(t)})}},{key:"syncTypeChangeTag",value:function(t){var e=this;return this._startWorker().then(function(){return e._syncTypeChangeTag(t)})}},{key:"_syncFloorTag",value:function(t){var e=this,n=[];return t&&!W.get(t)?(n.push(this._handleTags([t])),this._rapiAccess.getTag(t).then(function(t){n.push(e._handleMaterialsAndTextures(t))}),this._singlePromiseFactory.create(1,t,function(i){Promise.all(n).then(function(){W.set(t,!0),i()},function(t){return e._softReject(i,'_syncFloorTag error: "'+t+'"')})})):Promise.resolve()}},{key:"_syncTypeChangeTag",value:function(t){var e=this,n=[];return t&&!B.get(t)?(n.push(this._handleTags([t])),this._rapiAccess.getTag(t).then(function(t){e._rapiAccess.getItems(t.items).then(function(t){t.forEach(function(t){e.getIsCatalogSynced(t.catalog)&&n.push(e._handleCatalog(t.catalog))})})}),this._singlePromiseFactory.create(2,t,function(i){Promise.all(n).then(function(){W.set(t,!0),i()},function(t){return e._softReject(i,'_syncTypeChangeTag error: "'+t+'"')})})):Promise.resolve()}},{key:"getIsCatalogSynced",value:function(t){return!!z.get(t)}},{key:"_startWorker",value:function(){var t=this;return new Promise(function(e,n){if(t._isStarted)return e();t._bootCallbacks.push({resolve:e,reject:n}),t._isStarting||(t._worker=new Worker(f()+"static/web-workers/asset-loader.js"),t._worker.addEventListener("message",t._receiveFromWorker.bind(t),!1),t._isStarting=!0,t._sendToWorker(1))})}},{key:"_sendToWorker",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=this._nextConversationId(),s=function(){return!1};!n&&i&&(n=s),n&&!i&&(i=s),n&&i&&O.set(a,{resolve:n,reject:i}),this._worker.postMessage(JSON.stringify(["rml."+t,a,e]))}},{key:"_nextConversationId",value:function(){return j++}},{key:"_receiveFromWorker",value:function(t){if(t&&t.data){var e=JSON.parse(t.data),n=h(e,3),i=n[0],a=n[1],s=n[2];if(i&&0===i.indexOf("rml")){var o=i.split("."),r=h(o,2),u=(r[0],r[1]);switch(parseInt(u,10)){case 4:this._isStarted=!0,this._bootCallbacks.forEach(function(t){return(0,t.resolve)()});break;case 3:this._triggerCallback(a,s)}}}}},{key:"_triggerCallback",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=O.get(t);n.resolve.apply(n,e),O.delete(t)}},{key:"_handleCatalog",value:function(t){var e=this;return this._singlePromiseFactory.create(0,t,function(n){return e.getIsCatalogSynced(t)?n():e._rapiAccess.getCatalog(t).then(function(t){return Promise.all([e._handleContentWithAssets(e._rapiAccess.getComponentsOf(t),["perspectiveImage"]),e._handleItemsAndAdditionalContents(t),e._handleMaterialsAndTextures(t),e._handleExternalMeshes(t),e._handleTags(t.tags)])}).then(function(){z.set(t,!0),n()},function(t){return e._softReject(n,'Catalog sync error: "'+t+'"')})})}},{key:"_handleTags",value:function(t){return this._handleContentWithAssets(this._rapiAccess.getTags(t),["pngIcon","svgIcon"])}},{key:"_handleExternalMeshes",value:function(t){var e=this;return new Promise(function(n){e._rapiAccess.getMeshesOfCatalog(t.id).then(function(t){var i=[];t.forEach(function(t){i.push(e._handleContentWithAssets(Promise.all([e._rapiAccess.getMesh(t.id)]),["url"]))}),Promise.all(i).then(n,function(t){return e._softReject(n,'Sync crt files error: "'+t+'"')})},function(t){return e._softReject(n,'getMeshesOfCatalog error: "'+t+'"')})})}},{key:"_handleItemsAndAdditionalContents",value:function(t){var e=this;return new Promise(function(n,i){e._rapiAccess.getItemsOf(t).then(function(t){var i=[];i.push(e._handleContentWithAssets(Promise.resolve(t),["perspectiveImage"])),e._rapiAccess.getAdditionalContentsOfItems(t).then(function(t){var n=t.filter(function(t){return-1!==[5,6,4].indexOf(t.type)});i.push(e._handleContentWithAssets(Promise.resolve(n),["content"]))},function(t){return e._softReject(n,'getAdditionalContentsOfItems error: "'+t+'"')}),Promise.all(i).then(n,function(t){return e._softReject(n,'AdditionalContent image sync error:"'+t+'"')})})})}},{key:"_handleMaterialsAndTextures",value:function(t){var e=this;return new Promise(function(n,i){e._rapiAccess.getMaterialsOf(t).then(function(t){var i=[];i.push(e._handleContentWithAssets(Promise.resolve(t),["thumbnail"])),t.forEach(function(t){i.push(e._handleContentWithAssets(e._rapiAccess.getTexturesOf(t),["image"]))}),Promise.all(i).then(n,function(t){return e._softReject(n,'getTexturesOf error: "'+t+'"')})},function(t){return e._softReject(n,'getMaterialsOf error: "'+t+'"')})})}},{key:"_handleContentWithAssets",value:function(t,e){var n=this;return new Promise(function(i){return t.then(function(t){return n._fetchAssets(t,e).then(i,function(t){return n._softReject(i,'_handleContentWithAssets error: "'+t+'"')})},function(t){return n._softReject(i,'_handleContentWithAssets promise error: "'+t+'"')})})}},{key:"_fetchAssets",value:function(t,e){var n=this,i=[];t||(t=[]);for(var a=function(a,s){var o=t[a];e.forEach(function(t){var e=o[t];e&&i.push(n._preCacheAsset(e))})},s=0,o=t.length;s<o;s++)a(s);return Promise.all(i)}},{key:"_preCacheAsset",value:function(t){var e=this;return new Promise(function(n){if(V.get(t))return n();e._assetUrlToBase64(t).then(function(e){V.set(t,e),n()},function(t){return e._softReject(n,'_preCacheAsset error: "'+t+'"')})})}},{key:"_assetUrlToBase64",value:function(t){var e=this;return new Promise(function(n){e._sendToWorker(5,t,n,function(t){return e._softReject(n,'_assetUrlToBase64 error: "'+t+'"')})})}},{key:"_softReject",value:function(t,e){this._errorHandler.softReject(t,e,2)}},{key:"requestAsset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return navigator.onLine?t:V.get(t)||(e?t:null)}}]),t}());c([l],U.prototype,"_rapiAccess",void 0),c([l],U.prototype,"_eventHandler",void 0),c([l],U.prototype,"_singlePromiseFactory",void 0),c([l],U.prototype,"_errorHandler",void 0);var F=function(){function t(){n(this,t),this._lookups=new Map,this._singletons=new Map}return i(t,[{key:"addDependencyInjectionAssignments",value:function(t){var e=this;t.forEach(function(t){e._lookups.set(t.className,t)})}},{key:"lookup",value:function(t){if(!this._lookups.has(t))return null;var e=this._lookups.get(t);if(!e.singleton)return new e.classDefinition;if(this._singletons.has(t))return this._singletons.get(t);var n=new e.classDefinition;return this._singletons.set(t,n),n}}]),t}(),Y=t("A",function t(e,i,a){n(this,t),this.className=e,this.classDefinition=i,this.singleton=void 0===a||a}),G=function t(e,i,a){n(this,t),this.position=e,this.positionRelative=i,this.type=a},X=t("K",5*window.devicePixelRatio),Z=2*window.devicePixelRatio,q=t("u",function(t){function e(){var t;return n(this,e),(t=a(this,s(e).call(this)))._debug=!1,t._delta=-1,t._state=0,t._pinchDistance=-1,t._lastMouseWheelEvent=null,t._lastTouchEvent=null,t._position={x:0,y:0},t._positionRelative={x:0,y:0},t._downPosition={x:0,y:0},t._downPositionRelative={x:0,y:0},t}return o(e,p),i(e,[{key:"enableDragIn",value:function(t){var e=this;this._state=1,this._dragEnabled=!0,t&&(this._dragMV=this._dragM.bind(this),this._dragEV=this._dragE.bind(this),this._dragTarget=t.currentTarget||t.target,this._delta=-1,this._dragMVName="drag",this._dragEVName="dragend",window.TouchEvent&&t instanceof TouchEvent?(this._dragMVName="touchmove",this._dragEVName="touchend"):t.dataTransfer&&t.dataTransfer.setData&&t.dataTransfer.setData("text/plain"," "),this._firefoxDragPosition={x:0,y:0},document.ondragover=function(t){t=t||window.event,e._firefoxDragPosition.x=t.pageX,e._firefoxDragPosition.y=t.pageY},this._dragTarget.addEventListener(this._dragMVName,this._dragMV,!1),this._dragTarget.addEventListener(this._dragEVName,this._dragEV,!1))}},{key:"_dragM",value:function(t){var e=t,n=null,i=null;window.TouchEvent&&t instanceof TouchEvent?(n=this._getTouchPosition(e),i=this._getTouchPositionRelative(e)):(n=this._getMousePosition(e),i=this._getMousePositionRelative(e)),n.x>0&&n.y>0&&this._move(n,i)}},{key:"_dragE",value:function(t){var e=t;document.ondragover=null,this._firefoxDragPosition=null,this._dragTarget.removeEventListener(this._dragMVName,this._dragMV),this._dragTarget.removeEventListener(this._dragEVName,this._dragEV),window.TouchEvent&&t instanceof TouchEvent?this._onUp(this._getTouchPosition(e),this._getTouchPositionRelative(e)):this._onUp(this._getMousePosition(e),this._getMousePositionRelative(e))}},{key:"addEvents",value:function(t){t.addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),t.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),t.addEventListener("mouseup",this._onDocumentMouseCancel.bind(this),!1),t.addEventListener("mouseleave",this._onDocumentMouseLeave.bind(this),!1),t.addEventListener("mouseenter",this._onDocumentMouseEnter.bind(this),!1),t.addEventListener("touchmove",this._onDocumentTouchMove.bind(this),!1),t.addEventListener("touchstart",this._onDocumentTouchStart.bind(this),!1),t.addEventListener("touchend",this._onDocumentTouchEnd.bind(this),!1),t.addEventListener("wheel",this._onMouseWheel.bind(this),!1),t.addEventListener("contextmenu",this._onContextMenu.bind(this),!1)}},{key:"_onDocumentMouseMove",value:function(t){this._debug,t.preventDefault(),this._move(this._getMousePosition(t),this._getMousePositionRelative(t),1)}},{key:"_onDocumentTouchMove",value:function(t){this._debug,t.preventDefault(),this._dragTarget||(1===t.touches.length&&this._move(this._getTouchPosition(t),this._getTouchPositionRelative(t),2),2===t.touches.length&&(this._state=3,this._dolly(t)))}},{key:"_dolly",value:function(t){if(!(this._lastTouchEvent&&t.timeStamp-this._lastTouchEvent.timeStamp<40)){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.abs(e)+Math.abs(n);i>this._pinchDistance+Z&&this.dispatchEvent(7,new G),i<this._pinchDistance-Z&&this.dispatchEvent(8,new G),this._pinchDistance=i,this._lastTouchEvent=t}}},{key:"_move",value:function(t,e,n){void 0===n&&(n=0),void 0===this._dragEnabled&&(this._dragEnabled=!1),(1===this._state&&2!==n||1===this._state&&this._dragEnabled&&2===n)&&(this._delta=this._getDelta(),this._delta>X&&(this._state=2,this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(0,new G(t,e)))),2===this._state&&this.dispatchEvent(1,new G(t,e)),this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(6,new G(t,e,n))}},{key:"_onDocumentMouseDown",value:function(t){this._debug,t.preventDefault();var e=this._getMousePosition(t),n=e.x,i=e.y;this._downPosition={x:n,y:i},this._downPositionRelative=this._getMousePositionRelative(t),this.dispatchEvent(3,new G({x:n,y:i},this._downPositionRelative,1)),this._state=1}},{key:"_onDocumentTouchStart",value:function(t){if(this._debug,t.preventDefault(),1===t.touches.length){var e=this._getTouchPosition(t),n=e.x,i=e.y;this._downPosition={x:n,y:i},this._downPositionRelative=this._getTouchPositionRelative(t),this.dispatchEvent(3,new G({x:n,y:i},this._downPositionRelative,2)),this._state=1,this._longClickTimer=window.setTimeout(this._longClick.bind(this),350)}else 2===t.touches.length&&(1!==this._state&&2!==this._state||this._onUp(this._getTouchPosition(t),this._getTouchPositionRelative(t)),this._state=3)}},{key:"_longClick",value:function(){this._state=2,this._longClickTimer&&clearTimeout(this._longClickTimer),this.dispatchEvent(0,new G(this._downPosition,this._downPositionRelative)),this.dispatchEvent(1,new G(this._downPosition,this._downPositionRelative))}},{key:"_onDocumentMouseLeave",value:function(t){this._delta=-1,this._onDocumentMouseCancel(t)}},{key:"_onDocumentMouseEnter",value:function(t){this._debug,t.preventDefault()}},{key:"_onDocumentMouseCancel",value:function(t){this._debug,t.preventDefault(),this._onUp(this._getMousePosition(t),this._getMousePositionRelative(t))}},{key:"_onDocumentTouchEnd",value:function(t){this._debug,t.preventDefault(),this._onUp(this._getTouchPosition(t),this._getTouchPositionRelative(t))}},{key:"_onUp",value:function(t,e){this.dispatchEvent(4,new G(t)),this._getDelta()<=X&&this.dispatchEvent(5,new G(t,e)),2===this._state&&this.dispatchEvent(2,new G(t,e)),3===this._state&&(this._pinchDistance=-1),this._lastTouchEvent=null,this._state=0,this._dragTarget=null,this._longClickTimer&&clearTimeout(this._longClickTimer)}},{key:"_onMouseWheel",value:function(t){this._debug,t.preventDefault(),t.stopPropagation(),this._lastMouseWheelEvent&&t.timeStamp-this._lastMouseWheelEvent.timeStamp<40||(t.deltaY<0?this.dispatchEvent(7,new G):this.dispatchEvent(8,new G),this._lastMouseWheelEvent=t)}},{key:"_onContextMenu",value:function(t){t.preventDefault()}},{key:"_getTouchPosition",value:function(t){if(t.changedTouches.length){var e=t.changedTouches[0],n=e.clientX,i=e.clientY;this._position.x=n,this._position.y=i}return this._position}},{key:"_getTouchPositionRelative",value:function(t){if(t.changedTouches.length){var e=this._domHelper.element.getBoundingClientRect(),n=t.changedTouches[0],i=n.clientX,a=n.clientY;this._positionRelative.x=(i-e.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(a-e.top)/this._domHelper.element.clientHeight*2+1}return this._positionRelative}},{key:"_getMousePosition",value:function(t){return this._position.x=t.clientX,this._position.y=t.clientY,this._position}},{key:"_getMousePositionRelative",value:function(t){if(0!==t.clientX&&0!==t.clientY){var e=this._domHelper.element.getBoundingClientRect();this._positionRelative.x=(t.clientX-e.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(t.clientY-e.top)/this._domHelper.element.clientHeight*2+1}else if(this._firefoxDragPosition&&0!==this._firefoxDragPosition.x&&0!==this._firefoxDragPosition.y){var n=this._domHelper.element.getBoundingClientRect();this._positionRelative.x=(this._firefoxDragPosition.x-n.left)/this._domHelper.element.clientWidth*2-1,this._positionRelative.y=-(this._firefoxDragPosition.y-n.top)/this._domHelper.element.clientHeight*2+1}return this._positionRelative}},{key:"_getDelta",value:function(){return Math.abs(this._downPosition.y-this._position.y)+Math.abs(this._downPosition.x-this._position.x)}},{key:"setDragEnabled",value:function(t){this._dragEnabled=t}}]),e}());c([l],q.prototype,"_domHelper",void 0),u(Error);var J=function(){function t(){n(this,t),this._listeners={}}return i(t,[{key:"_subscribe",value:function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)}},{key:"subscribe",value:function(t,e){this._subscribe(t,e)}},{key:"dispatch",value:function(t,e){if(this._listeners[t])for(var n=this._listeners[t],i=n.length,a=0;a<i;a++){var s=n[a];s.apply(s,e)}}},{key:"unsubscribe",value:function(t,e){if(this._listeners[t])for(var n=this._listeners[t],i=n.length,a=0;a<i;a++)if(n[a]===e)return n.splice(a,1),i--,void a--}},{key:"softReject",value:function(t,e,n){return this.dispatch(n,[e]),t()}}]),t}(),K=function(){function t(){n(this,t)}return i(t,[{key:"getEnvironmentMap",value:function(){if(!this._environmentMap){var t=new THREE.CubeTextureLoader;t.setPath(f()),this._environmentMap=t.load(["static/textures/blurred/px.png","static/textures/blurred/nx.png","static/textures/blurred/py.png","static/textures/blurred/ny.png","static/textures/blurred/pz.png","static/textures/blurred/nz.png"]),this._environmentMap.wrapS=THREE.RepeatWrapping,this._environmentMap.wrapT=THREE.RepeatWrapping,this._environmentMap.generateMipmaps=!0}return this._environmentMap}}]),t}(),Q=function(){function t(){n(this,t),this._promises=new Map}return i(t,[{key:"create",value:function(t,e,n){var i=this;return new Promise(function(a,s){var o=i._promises.get(t),r=!0;if(!o){var h=new Map;i._promises.set(t,h),o=i._promises.get(t),r=!1}o.get(e)||(o.set(e,[]),r=!1);var u=o.get(e);u.push({resolve:a,reject:s}),o.set(e,u),r||new Promise(n).then(function(n){o.get(e).forEach(function(t){return(0,t.resolve)(n)}),i._promises.delete(t)},function(n){o.get(e).forEach(function(t){return(0,t.reject)(n)}),i._promises.delete(t)})})}}]),t}(),$=function(){function t(){n(this,t),this._queue=[],this._pendingRequests=0}return i(t,[{key:"_nextSlot",value:function(){if(this._pendingRequests-=1,this._queue.length){var t=this._queue.shift(),e=t.request,n=t.resolve,i=t.reject;this._fetch(e).then(n,i)}}},{key:"_fetch",value:function(t){var e=this;return this._pendingRequests+=1,new Promise(function(n,i){self.fetch(t).then(function(){this._nextSlot(),n.apply(void 0,arguments)}.bind(e),function(t){e._nextSlot(),i(t)})})}},{key:"fetch",value:function(t){var e=this;return this._pendingRequests>=40?new Promise(function(n,i){return e._queue.push({request:t,resolve:n,reject:i})}):this._fetch(t)}}]),t}(),tt=function(t){function e(){return n(this,e),a(this,s(e).apply(this,arguments))}return o(e,N),i(e,[{key:"throw",value:function(t){this.error("[Kernel Exception]: "+t),this._eventHandler.dispatch(27)}}]),e}();c([l],tt.prototype,"_eventHandler",void 0);var et=function(){function t(){n(this,t)}return i(t,[{key:"getItem",value:function(t){if(!this._localStorage)return null;var e=this._localStorage.getItem(t);try{return JSON.parse(e)}catch(t){return e}}},{key:"setItem",value:function(t,e){this._localStorage&&this._localStorage.setItem(t,JSON.stringify(e))}},{key:"_localStorage",get:function(){var t=null;try{t=window.localStorage}catch(t){console.error(t)}return t}}]),t}(),nt=function(){function t(){n(this,t),this._configurationStringSet=new Set,this._singleLoadCounter=0}return i(t,[{key:"loadingConfigurationString",value:function(){this._singleLoadCounter+=1}},{key:"loadingConfiguration",value:function(t){this._configurationStringSet.add(t),this._singleLoadCounter+=1}},{key:"shouldHardReset",value:function(){return this._configurationStringSet.size>=15||this._singleLoadCounter>=30}},{key:"executedHardReset",value:function(){this._configurationStringSet.clear(),this._singleLoadCounter=0}}]),t}(),it=[new Y("error-handler",J),new Y("form-data-util",I),new Y("environment-loader",K),new Y("form-data-util",I),new Y("single-promise-factory",Q),new Y("dynamic-light-setting-loader",L),new Y("network-layer",$),new Y("local-storage",et),new Y("network-layer",$),new Y("kernel-io",tt),new Y("data-syncer",U),new Y("memory-manager",nt)];!function(){function t(){n(this,t)}i(t,null,[{key:"setup",value:function(e){t.addToContainer(e)}},{key:"lookup",value:function(t){return window.__RML__DI__?window.__RML__DI__.lookup(t):null}},{key:"addToContainer",value:function(t){window.__RML__DI__||(window.__RML__DI__=new F,window.__RML__DI__.addDependencyInjectionAssignments(it)),window.__RML__DI__.addDependencyInjectionAssignments(t)}}])}()}}});
//# sourceMappingURL=chunk-850740d7.legacy.js.map
